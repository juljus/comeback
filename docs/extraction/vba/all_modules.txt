olevba 0.60.2 on Python 3.14.2 - http://decalage.info/python/oletools
===============================================================================
FILE: /Users/juljus/Projects/comeback/comeback0198e.xls
Type: OLE
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/ThisWorkbook'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet2.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet2'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet3.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet3'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module1.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 



' Ver. 0198+ - programmed by Kristjan Stolin - kristjan.pork@mail.ee +372 50 77079
' assisted by Andres Mõisja

Sub start_game()

Dim x As Integer
Dim y As Integer
Dim what_player As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

'randomi näide
'Randomize    ' Initialize random-number generator.

'MyValue = Int((6 * Rnd) + 1)    ' Generate random value between 1 and 6.



'nuppude arv laual
Sheets("Game_data1").Cells(3, 2).Value = 2

Sheets("Game_data1").Cells(46, 2).Value = 1000 'moblist_ID

'playerite colorid
Sheets("Game_data1").Cells(11, 1).Font.ColorIndex = Sheets("Game_data1").Cells(106, 2).Value
Sheets("Game_data1").Cells(12, 1).Font.ColorIndex = Sheets("Game_data1").Cells(107, 2).Value
Sheets("Game_data1").Cells(13, 1).Font.ColorIndex = Sheets("Game_data1").Cells(108, 2).Value
Sheets("Game_data1").Cells(14, 1).Font.ColorIndex = Sheets("Game_data1").Cells(109, 2).Value


For x = 1 To 4
        Sheets("Game_data1").Cells(112 + x, 2).Value = 1 'all players start as dead
        Sheets("Game_data1").Cells(5 + x, 2).Value = 0 'playerite alustamis ruut
        Sheets("Game_data1").Cells(46 + x, 2).Value = 1 '1 mob side listis
        Sheets("Game_data1").Cells(51 + x, 2).Value = 1 'ja see on seal player
        Sheets("Game_data1").Cells(24 + x, 2).Value = 200 'algusraha
        Sheets("Game_data1").Cells(63 + x, 2).Value = 0 'playerite omatud landiarvu reset
        Sheets("Game_data1").Cells(188 + x, 2).Value = 0
        Sheets("Game_data1").Cells(116 + x, 2).Value = 0 'playerite targeting needed
        Sheets("Game_data1").Cells(192 + x, 2).Value = 0 'kings_gift_for_baron
        Sheets("Game_data1").Cells(196 + x, 2).Value = 0 'kings_gift_for_count
        Sheets("Game_data1").Cells(200 + x, 2).Value = 0 'kings_gift_for_duke
        Sheets("Game_data1").Cells(10 + x, 2).Font.Color = Sheets("Game_data1").Cells(10 + x, 1).Font.Color
        Sheets("Game_data1").Cells(263 + x, 2).Value = 0 'portal teleport reset
Next

Sheets("Game_data1").Cells(10, 2).Value = 1 'kes alustab, kelle turn on

For what_player = 1 To 4

    Sheets("Game_data1").Cells(46, 2).Value = Sheets("Game_data1").Cells(46, 2).Value + 1
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 35).Value = Sheets("Game_data1").Cells(46, 2).Value
    
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = 20 'elud
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 3).Value = 10000 'Max_playerelud
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value = 1 'number of strikes per round
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value = 1 '1d4 manually
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value = 4
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7).Value = 0 'set to hand dam
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 15).Value = "No weapon"
    
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 14).Value = 0 'armor
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 37).Value = 0 'ei ole building
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 38).Value = 0 'ega varju ka müüri taha
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 39).Value = 0 'ei ole merc
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 40).Value = 0 'mobi spellicontroll
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 41).Value = 0 'spell slots for mobs
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 42).Value = 0
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 43).Value = 0
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 44).Value = 0
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 45).Value = 0 'spell knowledge for mobs
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 46).Value = 0
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 47).Value = 0
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 48).Value = 0
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value = 0 'speed bonus
    
    'extra dam
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 50).Value = 0 'fire extra dam
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 51).Value = 0 ' extra
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 52).Value = 0 ' -""-
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 53).Value = 0 'poison extra dam
    
    'effects
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 54).Value = 0 'bleeding
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 55).Value = 0 'stun
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 56).Value = 0 'poison
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 57).Value = 0 'frozen
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 58).Value = 0 'burning
    
    'immunities
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 59).Value = 0 'fire
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 60).Value = 0 'lightning
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 61).Value = 0 'cold
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 62).Value = 0 'pois
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 63).Value = 0 'bleed
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 64).Value = 0 'stun
    
    'evolving pets
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 65).Value = 0 'counter
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 66).Value = 0 'upgrade_into_what
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 67).Value = 0 'is not pet
    
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 68).Value = 0 'no spelllevel bonus
     
    For y = 0 To 5
            Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 8 + y).Value = 2 'Statsid
    Next
    
    For y = 0 To 13 'mana
            Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 16 + y).Value = 0
    Next
    
    Sheets("Game_data1").Cells(120 + what_player, 2).Value = 1 'anname 1 itemi
    Sheets("Game_data1").Cells(1, 2 + what_player).Value = 2 'ja see on itemtabeli relv nr
    Sheets("Game_data1").Cells(1, 7 + what_player).Value = 6 'ja see on wielditud kui relv
    do_it = equip_weapon(what_player, 1)
    
    Sheets("Game_data1").Cells(92 + what_player, 2).Value = 0 'counting players hp loss in battle reset
    
Next

Sheets("Game_data1").Cells(16, 2).Value = 0 'aktiivne player pole lahingut võitnud
Sheets("Game_data1").Cells(29, 2).Value = 0 'kui palju võitlevaid pooli
Sheets("Game_data1").Cells(30, 2).Value = 0 'each sides enemy list
Sheets("Game_data1").Cells(31, 2).Value = 0
Sheets("Game_data1").Cells(32, 2).Value = 0
Sheets("Game_data1").Cells(33, 2).Value = 0
Sheets("Game_data1").Cells(34, 2).Value = 0
Sheets("Game_data1").Cells(35, 2).Value = 0 'number of player chars in fight
Sheets("Game_data1").Cells(44, 2).Value = 0 'menyyde reset, set to MAIN
Sheets("Game_data1").Cells(45, 2).Value = 0 'spell menu - being cast in combat menu

Sheets("Game_data1").Cells(51, 2).Value = 0 'side 5 number
Sheets("Game_data1").Cells(56, 2).Value = 0 'how many still fighting
Sheets("Game_data1").Cells(57, 2).Value = 0
Sheets("Game_data1").Cells(58, 2).Value = 0
Sheets("Game_data1").Cells(59, 2).Value = 0
Sheets("Game_data1").Cells(60, 2).Value = 0
Sheets("Game_data1").Cells(80, 2).Value = 0 'has active player engaged with land defenders
Sheets("Game_data1").Cells(88, 2).Value = 0 'land hostility
Sheets("Game_data1").Cells(87, 2).Value = 0 'kas combat on peal
Sheets("Game_data1").Cells(84, 2).Value = 0 'kas hommik, õhtu, päev, reset
Sheets("Game_data1").Cells(71, 2).Value = 0 'log_line reset
Sheets("Game_data1").Cells(81, 2).Value = 1 'mitmes turn on reset
Sheets("Game_data1").Cells(19, 2).Value = 0 'Valikunuppude arvu reset
Sheets("Game_data1").Cells(90, 2).Value = 0 'Duubel valiknupp errori reset

Sheets("Game_data1").Cells(102, 2).Value = 0 'vilgutamise reset
Sheets("Game_data1").Cells(103, 2).Value = 0

Sheets("Game_data1").Cells(104, 2).Value = 0 'can player build
Sheets("Game_data1").Cells(190, 2).Value = 0 'event reset
Sheets("Game_data1").Cells(129, 2).Value = 0 'various menu buttons listi controller

Sheets("game_data1").Cells(130, 2).Value = 0 'mitu messijuppi värvida reset

'items and treasure
Sheets("Game_data1").Cells(189, 2).Value = 0 'items on ground
Sheets("Game_data1").Cells(191, 2).Value = 0 'gold on ground
Sheets("Game_data1").Cells(205, 2).Value = 0 'closed gold
Sheets("Game_data1").Cells(206, 2).Value = 0 'closed items
Sheets("Game_data1").Cells(207, 2).Value = 0 'battle for treasure
Sheets("Game_data1").Cells(208, 2).Value = 0 '(spell)effects controller
Sheets("Game_data1").Cells(209, 2).Value = 0 'prison guardian
Sheets("Game_data1").Cells(212, 2).Value = 0 'teleport reset
Sheets("Game_data1").Cells(217, 2).Value = 0 'custom_itemite reset
Sheets("Game_data1").Cells(244, 2).Value = 0
Sheets("Game_data1").Cells(245, 2).Value = 0
Sheets("Game_data1").Cells(246, 2).Value = 0
Sheets("Game_data1").Cells(247, 2).Value = 0
Sheets("Game_data1").Cells(263, 2).Value = 0
Sheets("Game_data1").Cells(274, 2).Value = 0 'AI desisions reset

'spelliknowledge reset

For x = 1 To Sheets("Game_data1").Cells(186, 2).Value 'kõik spellid listis
        For y = 0 To 3
                Sheets("Spells").Cells(x, 3 + y).Value = 0 'ükski player ei tea ühtki spelli
        Next
Next

'ajutine... paneme playerile paar spelli ja paar mobi
If Sheets("Game_data1").Cells(15, 2).Value = 1 Then 'debug
        For what_player = 1 To 2

                Sheets("Spells").Cells(find_spell_by_name("Maagia Nool"), 2 + what_player).Value = 1
                Sheets("Spells").Cells(find_spell_by_name("Maagiline turvis"), 2 + what_player).Value = 1
                Sheets("Spells").Cells(find_spell_by_name("Kutsu metsloomi"), 2 + what_player).Value = 1
                Sheets("Spells").Cells(find_spell_by_name("Jumalate viha"), 2 + what_player).Value = 1

                'lisa hapsud
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = 100
                
              '     more power
              '     Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 13).Value = 10
                
                'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 16).Value = 100
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 21).Value = 100
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 17).Value = 100
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 18).Value = 100
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 19).Value = 100
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 20).Value = 100
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22).Value = 100
        Next
End If
'Sheets("Spells").Cells(find_spell_by_name("Air Shield"), 2 + what_player).Value = 1
'Sheets("Spells").Cells(find_spell_by_name("Raise Dead"), 2 + what_player).Value = 2
'Sheets("Spells").Cells(find_spell_by_name("Possession"), 2 + what_player).Value = 1
'Sheets("Spells").Cells(find_spell_by_name("Slow"), 2 + what_player).Value = 1
'Sheets("Spells").Cells(find_spell_by_name("Vampiric Bats"), 2 + what_player).Value = 1
'Sheets("Spells").Cells(find_spell_by_name("Unholy Strength"), 2 + what_player).Value = 1
'Sheets("Spells").Cells(find_spell_by_name("Prosperity"), 2 + what_player).Value = 1
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 16).Value = 100
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 21).Value = 100
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 17).Value = 100
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 18).Value = 100
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 19).Value = 100
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 20).Value = 100
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22).Value = 100
'

'do_it = Add_new_mob(1, 1)
'do_it = Add_new_mob(1, 2)
'do_it = Add_new_mob(1, 3)
'
'do_it = Add_new_mob(2, 1)
'do_it = Add_new_mob(2, 1)
'do_it = Add_new_mob(2, 1)




'ajutine lõpp

'poe itemite arvude reset
Sheets("Game_data1").Cells(168, 2).Value = 0
Sheets("Game_data1").Cells(169, 2).Value = 0
Sheets("Game_data1").Cells(170, 2).Value = 0
Sheets("Game_data1").Cells(171, 2).Value = 0
Sheets("Game_data1").Cells(172, 2).Value = 0

Rem Maa_alade reset
For x = 1 To 34
        For y = 1 To Sheets("Game_data1").Cells(174, 2).Value + 8 'buildingute arv
                If Sheets("Game_map").Cells(x, y + 17).Value <> 0 Then
                        Sheets("Game_map").Cells(x, y + 17).Value = 0
                End If
        Next
Next

do_it = generate_map()

For x = 1 To 34
    
        Sheets("Game_map").Cells(x, 2).Value = 0 'omanik reset
        
        For y = 1 To 4
                Sheets("Game_map").Cells(x, 11 + y).Value = 0 'castle level etc. reset
        Next
        
        Sheets("Game_map").Cells(x, 17).Value = 1 'kas kaitsja kohal reset
        
Next

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(1, 1).Value, "start_game", 1, 3) 'Start game nupu kustutamine
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(2, 1).Value, "options", 1, 4)  'options nupu kustutamine

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(8, 1).Value, "end_game", 0, 2) 'Quit nupu tekitamine ja sellele proge panemine


Rem How many players nuppude tekitamine

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(9, 1).Value, "select_2players", 0, 1)
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(10, 1).Value, "select_3players", 0, 1)
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(11, 1).Value, "select_4players", 0, 1)

End Sub
Sub change_option_give()
        
If Sheets("Game_data1").Cells(225, 2).Value = 0 Then
        Sheets("Game_data1").Cells(225, 2).Value = 1
Else
        Sheets("Game_data1").Cells(225, 2).Value = 0
End If

do_it = options_main_menu()
End Sub
Sub change_option_lan()
Dim Language As Integer
Dim x As Integer
Dim y As Integer
Dim items_total As Integer
Dim temp_name As String
      
items_total = Sheets("Game_data1").Cells(184, 2).Value + Sheets("Game_data1").Cells(166, 2).Value
       
'either estonian or english language
If Sheets("Game_data1").Cells(100, 2).Value = 1 Then
        Sheets("Game_data1").Cells(100, 2).Value = 2
Else
        Sheets("Game_data1").Cells(100, 2).Value = 1
End If

Language = Sheets("Game_data1").Cells(100, 2).Value

If Language = 1 Then
        Sheets("Game_map").Cells(1, 4).Value = "Royal Court"
End If

If Language = 2 Then
        Sheets("Game_map").Cells(1, 4).Value = "Palee"
End If

'landinimed mis on buildings sheedil
For x = 1 To Sheets("Game_data1").Cells(174, 2).Value
         For y = 1 To 2
                If Sheets("Buildings").Cells(x, 9 + y).Value <> 0 Then
                        temp_name = Sheets("Buildings").Cells(x, 9 + y).Value
                        Sheets("Buildings").Cells(x, 9 + y).Value = Sheets("Map_defaults").Cells(find_land_by_name(temp_name), 28 + (Language - 1) * 2).Value
                End If
        Next

Next

'landinimed
For x = 2 To Sheets("Game_data1").Cells(173, 2).Value + 20
        Sheets("Map_defaults").Cells(x, 1).Value = Sheets("Map_defaults").Cells(x, 28 + (Language - 1) * 2).Value
        Sheets("Map_defaults").Cells(x, 2).Value = Sheets("Map_defaults").Cells(x, 29 + (Language - 1) * 2).Value
        For y = 1 To 4 'landi kaitsjad
                temp_name = Sheets("Map_defaults").Cells(x, 8 + y).Value
                Sheets("Map_defaults").Cells(x, 8 + y).Value = Sheets("Mobs").Cells(find_mob_by_name(temp_name), 59 + Language).Value
        Next
        
        For y = 1 To 12
                If Sheets("Map_defaults").Cells(x, 13 + y).Value <> "" Then
                        temp_name = Sheets("Map_defaults").Cells(x, 13 + y).Value
                        Sheets("Map_defaults").Cells(x, 13 + y).Value = Sheets("Buildings").Cells(find_building_by_name(temp_name), 39 + Language).Value
                End If
        Next
        
Next

'buildings misc
For x = 1 To Sheets("Game_data1").Cells(174, 2).Value

        If Sheets("Buildings").Cells(x, 8).Value <> 0 Then
                temp_name = Sheets("Buildings").Cells(x, 8).Value
                Sheets("Buildings").Cells(x, 8).Value = Sheets("Spells").Cells(find_spell_by_name(temp_name), 50 + (Language - 1) * 2).Value
        End If
        
        For y = 1 To 2
                If Sheets("Buildings").Cells(x, 19 + y).Value <> 0 Then
                        temp_name = Sheets("Buildings").Cells(x, 19 + y).Value
                        Sheets("Buildings").Cells(x, 19 + y).Value = Sheets("Mobs").Cells(find_mob_by_name(temp_name), 59 + Language).Value
                End If
        Next
        
        If Sheets("Buildings").Cells(x, 25).Value <> 0 Then
                temp_name = Sheets("Buildings").Cells(x, 25).Value
                Sheets("Buildings").Cells(x, 25).Value = Sheets("Mobs").Cells(find_mob_by_name(temp_name), 59 + Language).Value
        End If
        
        If Sheets("Buildings").Cells(x, 9).Value <> 0 Then
                temp_name = Sheets("Buildings").Cells(x, 9).Value
                Sheets("Buildings").Cells(x, 9).Value = Sheets("Spells").Cells(find_spell_by_name(temp_name), 50 + (Language - 1) * 2).Value
        End If
        
        For y = 1 To 4 'pre-req buildings
                If Sheets("Buildings").Cells(x, 1 + y).Value <> "" Then
                        temp_name = Sheets("Buildings").Cells(x, 1 + y).Value
                        Sheets("Buildings").Cells(x, 1 + y).Value = Sheets("Buildings").Cells(find_building_by_name(temp_name), 39 + Language).Value
                End If
        Next
        
Next

'buildings on game_map
For x = 1 To (Sheets("Game_data1").Cells(174, 2).Value + 8)
        If Sheets("Game_map").Cells(35, 17 + x).Value <> "" Then
                 temp_name = Sheets("Game_map").Cells(35, 17 + x).Value
                 Sheets("Game_map").Cells(35, 17 + x).Value = Sheets("Buildings").Cells(find_building_by_name(temp_name), 39 + Language).Value
        End If
Next

'buildings themselves
For x = 1 To Sheets("Game_data1").Cells(174, 2).Value
        temp_name = Sheets("Buildings").Cells(x, 1).Value
        Sheets("Buildings").Cells(x, 1).Value = Sheets("Buildings").Cells(find_building_by_name(temp_name), 39 + Language).Value
Next

'spellide summon mobs
For x = 1 To Sheets("Game_data1").Cells(186, 2).Value
        For y = 1 To 4
                If Sheets("Spells").Cells(x, 13 + y).Value <> 0 Then
                        temp_name = Sheets("Spells").Cells(x, 13 + y).Value
                        Sheets("Spells").Cells(x, 13 + y).Value = Sheets("Mobs").Cells(find_mob_by_name(temp_name), 59 + Language).Value
                End If
        Next
Next

'Mobs
For x = 1 To Sheets("Game_data1").Cells(185, 2).Value
        For y = 1 To 4
                If Sheets("Mobs").Cells(x, 32 + y).Value <> 0 Then
                        'mobide spellid mida nad oskavad
                        temp_name = Sheets("Mobs").Cells(x, 32 + y).Value
                        Sheets("Mobs").Cells(x, 32 + y).Value = Sheets("Spells").Cells(find_spell_by_name(temp_name), 50 + (Language - 1) * 2).Value
                End If
        Next
        Sheets("Mobs").Cells(x, 1) = Sheets("Mobs").Cells(x, 59 + Language)
        If Sheets("Mobs").Cells(x, 51).Value <> 0 Then
               temp_name = Sheets("Mobs").Cells(x, 51).Value
               Sheets("Mobs").Cells(x, 51).Value = Sheets("Levelup").Cells(find_level_up_by_name(temp_name), 49 + Language).Value
        End If
        
Next

For x = 1 To Sheets("Game_data1").Cells(230, 2).Value
        If Sheets("Levelup").Cells(x, 47).Value <> 0 Then
                temp_name = Sheets("Levelup").Cells(x, 47).Value
                Sheets("Levelup").Cells(x, 47).Value = Sheets("Levelup").Cells(find_level_up_by_name(temp_name), 49 + Language).Value
        End If
Next

For x = 1 To Sheets("Game_data1").Cells(230, 2).Value
        temp_name = Sheets("Levelup").Cells(x, 1).Value
        Sheets("Levelup").Cells(x, 1).Value = Sheets("Levelup").Cells(find_level_up_by_name(temp_name), 49 + Language).Value
        For y = 1 To 4
                If Sheets("Levelup").Cells(x, 20 + y).Value <> 0 Then
                        'levelupide spellid mida nad oskama saavad
                        temp_name = Sheets("Levelup").Cells(x, 20 + y).Value
                        Sheets("Levelup").Cells(x, 20 + y).Value = Sheets("Spells").Cells(find_spell_by_name(temp_name), 50 + (Language - 1) * 2).Value
                End If
        Next
Next

'to do arcane tower mobs from hard coded into something better

'items
For x = 2 To items_total
       
        If Sheets("Items").Cells(x, 14).Value <> "" And Sheets("Items").Cells(x, 14).Value <> 0 Then
                temp_name = Sheets("Items").Cells(x, 14).Value
                Sheets("Items").Cells(x, 14).Value = Sheets("Spells").Cells(find_spell_by_name(temp_name), 50 + (Language - 1) * 2).Value
        End If
        
        Sheets("Items").Cells(x, 1).Value = Sheets("Items").Cells(x, 38 + Language).Value
Next

'spells
For x = 1 To Sheets("Game_data1").Cells(186, 2).Value
        Sheets("Spells").Cells(x, 1).Value = Sheets("Spells").Cells(x, 50 + (Language - 1) * 2).Value
        Sheets("Spells").Cells(x, 10).Value = Sheets("Spells").Cells(x, 51 + (Language - 1) * 2).Value
Next


do_it = options_main_menu()
End Sub


Function options_main_menu()
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = valiknuppude_Kustutamine()

'Start game nupu kustutamine
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(1, 1).Value, "start_game", 1, 3)
'options nupu kustutamine
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(2, 1).Value, "options", 1, 4)

do_it = text_Output("", 3)

do_it = text_Output(Sheets("Lan" & Language).Cells(12, 1).Value, 0)

If Sheets("Game_data1").Cells(100, 2).Value = 1 Then
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(13, 1).Value, 1, 5)
                
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(15, 1).Value, "change_option_lan", 0, 1)

Else
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(14, 1).Value, 1, 5)
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(15, 1).Value, "change_option_lan", 0, 1)
        
End If



do_it = text_Output(Sheets("Lan" & Language).Cells(3, 1).Value, 0)

If Sheets("Game_data1").Cells(225, 2).Value = 0 Then
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(5, 1).Value, 1, 3)
        
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(6, 1).Value, "change_option_give", 0, 1)

Else
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(4, 1).Value, 1, 5)
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(7, 1).Value, "change_option_give", 0, 1)
        
        
End If





        do_it = Nuppudega_tegeleja("Ok", "options_ok", 0, 1)
        
        
        
End Function

Function generate_map()
Dim base_hind As Integer
Dim Total_basic_lands As Integer
Dim y As Integer
Dim kas_basic_vyi_utiliti As Integer
Dim Land_type As Integer
Dim mitu_basicut_reas As Integer
Dim basic_ridu As Integer
Dim number_of_shops As Integer
Dim Number_of_utilities As Integer
Dim pick_utility As Integer
Dim pick_basic_land As Integer
Dim utilitied_total As Integer
Dim bonus As Integer
Dim pick_new_basic As Integer

base_hind = 10
Total_basic_lands = Sheets("Game_data1").Cells(173, 2).Value
number_of_shops = 5
Number_of_utilities = 6

Sheets("Game_data1").Cells(22, 2).Value = 0

For x = 1 To Total_basic_lands
        Sheets("Nupud").Cells(x, 15).Value = 20 + x
        Sheets("Nupud").Cells(x, 13).Value = Sheets("Map_defaults").Cells(x + 20, 13).Value
Next

For x = 1 To number_of_shops
        Sheets("Nupud").Cells(x, 16).Value = x + 1
        'sans
        Sheets("Nupud").Cells(x, 14).Value = Sheets("Map_defaults").Cells(x + 1, 13).Value
        
        
        Sheets("Game_data1").Cells(22, 2).Value = Sheets("Game_data1").Cells(22, 2).Value + 1
Next

For x = 1 To Number_of_utilities
        Sheets("Game_data1").Cells(22, 2).Value = Sheets("Game_data1").Cells(22, 2).Value + 1
        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(22, 2).Value, 16).Value = 9 + x
        
        'sans
        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(22, 2).Value, 14).Value = Sheets("Map_defaults").Cells(x + 9, 13).Value
Next

For x = 1 To 4 'arcane towers
        Sheets("Game_data1").Cells(22, 2).Value = Sheets("Game_data1").Cells(22, 2).Value + 1
        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(22, 2).Value, 16).Value = 20
        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(22, 2).Value, 14).Value = Sheets("Map_defaults").Cells(20, 13).Value
Next

Sheets("Game_data1").Cells(21, 2).Value = Total_basic_lands 'mitu landi listis

utilitied_total = 0
basic_ridu = 0
mitu_basicut_reas = 0

For x = 2 To 34
        If Sheets("Game_data1").Cells(211, 2).Value = 0 Then
        
                pick_new_basic = 0
                
                If mitu_basicut_reas = 0 Then
                        pick_basic_land = 3
                        pick_utility = 6
                End If
                
                If mitu_basicut_reas = 1 Then
                        pick_basic_land = 2
                        pick_utility = 0
                End If
                
                If mitu_basicut_reas = 2 Then
                        pick_basic_land = 10
                        pick_utility = 2
                End If
                
                If mitu_basicut_reas = 3 Then
                        
                        
                        pick_basic_land = 2
                        pick_utility = 5
                        mitu_basicut_reas = 0
                End If
                        
                        kas_basic_vyi_utiliti = Int(Rnd * (pick_basic_land + pick_utility) + 1)
                        
                        
                        If utilitied_total > 13 Then
                                pick_utility = 0
                        End If
                        
                        If utilitied_total < 14 And basic_ridu > 2 And mitu_basicut_reas = 0 Then
                                pick_utility = 100
                        End If
                        
                        If x = 34 And mitu_basicut_reas = 0 Then
                                pick_utility = 100
                        End If
                        
                        If pick_utility > kas_basic_vyi_utiliti Then
                        
                                y = rolling_odds(Sheets("Game_data1").Cells(22, 2).Value, 14)
                                
                                Land_type = Sheets("Nupud").Cells(y, 16).Value
                                
                                do_it = remove_utility_land_from_map_generate_list(y)
                                utilitied_total = utilitied_total + 1
                                mitu_basicut_reas = 0
                                basic_ridu = 0
                        Else
                                If mitu_basicut_reas = 0 Then
                                        pick_new_basic = 1
                                End If
                                
                                If mitu_basicut_reas = 1 Then
                                        pick_new_basic = 0
                                End If
                                
                                If mitu_basicut_reas = 2 Then
                                        pick_new_basic = Rnd * 30 + 1 'siin seome asja land costiga
                                End If
                                
                                If x = 34 Then
                                        pick_new_basic = 0
                                End If
                                
                                If pick_new_basic = 1 Then
                                        
                                        y = rolling_odds(Sheets("Game_data1").Cells(21, 2).Value, 13)
                                        
                                        Land_type = Sheets("Nupud").Cells(y, 15).Value
                                        
                                        do_it = remove_basic_land_from_map_generate_list(y)
                                        
                                        basic_ridu = basic_ridu + 1
                                        mitu_basicut_reas = 1
                                        
                                Else
                                        Land_type = Sheets("Game_map").Cells(x - 1, 1).Value
                                        mitu_basicut_reas = mitu_basicut_reas + 1
                                End If
                        
                        End If
        Else
                
                'predefined map
                If Sheets("Game_data1").Cells(211, 2).Value <> 0 Then
                        Land_type = Sheets("Nupud").Cells(x, 29 + Sheets("Game_data1").Cells(211, 2).Value).Value
                        
                        If Land_type > 20 Then
                                If Land_type <> basic_ridu Then 'using basic ridu as temp for comparision
                                        basic_ridu = Land_type
                                        mitu_basicut_reas = 1
                                Else
                                        mitu_basicut_reas = mitu_basicut_reas + 1
                                End If
                                
                        End If
                        
                End If
        End If
        'maatüüp
        Sheets("Game_map").Cells(x, 1).Value = Land_type
                
         'hind
        Sheets("Game_map").Cells(x, 3).Value = 10 * Sheets("Map_defaults").Cells(Land_type, 3).Value
        
        'nimi
        Sheets("Game_map").Cells(x, 4).Value = Sheets("Map_defaults").Cells(Land_type, 1).Value
        
        'kaitsja
        bonus = 0
        If mitu_basicut_reas = 3 Then
                bonus = Int(Rnd * 2)
                Sheets("Game_map").Cells(x - 1, 5).Value = find_mob_by_name(Sheets("Map_defaults").Cells(Land_type, 9 + bonus).Value)
                bonus = 0
                mitu_basicut_reas = 0
        End If
        
        'kaitsja
        Sheets("Game_map").Cells(x, 5).Value = find_mob_by_name(Sheets("Map_defaults").Cells(Land_type, 9 + bonus).Value)
        
        'päevane tax
        Sheets("Game_map").Cells(x, 6).Value = Sheets("Map_defaults").Cells(Land_type, 4).Value * 5
        Sheets("Game_map").Cells(x, 7).Value = Sheets("Map_defaults").Cells(Land_type, 4).Value * 5
        
        'healing value
        Sheets("Game_map").Cells(x, 11).Value = Sheets("Map_defaults").Cells(Land_type, 5).Value
        Sheets("Game_map").Cells(x, 16).Value = Sheets("Map_defaults").Cells(Land_type, 5).Value
        'mana building
        If Sheets("Map_defaults").Cells(Land_type, 26).Value <> "" Then
                Sheets("Game_map").Cells(x, find_building_slot_in_map(Sheets("Map_defaults").Cells(Land_type, 26).Value)).Value = 1
        End If
Next


End Function
Function find_mob_by_name(mob_name As String) As Integer
find_mob_by_name = 20
Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(185, 2).Value
        If mob_name = Sheets("Mobs").Cells(x, 1).Value Then
                find_mob_by_name = x
        End If
Next

End Function
Function find_level_up_by_name(level_up_name As String) As Integer

find_level_up_by_name = 1 'default

Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(230, 2).Value
        If level_up_name = Sheets("Levelup").Cells(x, 1).Value Then
                find_level_up_by_name = x
        End If
Next


End Function


Function find_land_by_name(land_Name As String) As Integer
find_land_by_name = 1
Dim x As Integer

For x = 1 To (20 + Sheets("Game_data1").Cells(173, 2).Value)
        If land_Name = Sheets("Map_defaults").Cells(x, 1).Value Then
                find_land_by_name = x
        End If
Next

End Function

Function find_spell_by_name(spell_Name As String) As Integer
find_spell_by_name = 1 'Magic Arrow is default if spell is not found by name
Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(186, 2).Value
        If spell_Name = Sheets("Spells").Cells(x, 1).Value Then
                find_spell_by_name = x
        End If
Next

End Function
Function find_item_by_name(item_name As String) As Integer
find_item_by_name = 2 'knife default
Dim x As Integer

For x = 1 To 200
        If item_name = Sheets("Items").Cells(x, 1).Value Then
                find_item_by_name = x
        End If
Next

End Function
Function remove_basic_land_from_map_generate_list(mitmes As Integer)
Dim y As Integer
Dim z As Integer


        If (mitmes < Sheets("Game_data1").Cells(21, 2).Value) Then
            
                y = Sheets("Game_data1").Cells(21, 2).Value - mitmes
                              
                For z = 1 To y
                        Sheets("Nupud").Cells(mitmes - 1 + z, 15).Value = Sheets("Nupud").Cells(mitmes + z, 15).Value
                        Sheets("Nupud").Cells(mitmes - 1 + z, 13).Value = Sheets("Nupud").Cells(mitmes + z, 13).Value
                Next
                      
        End If
        
        Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_data1").Cells(21, 2).Value - 1

End Function
Function remove_utility_land_from_map_generate_list(mitmes As Integer)
Dim y As Integer
Dim z As Integer


        If (mitmes < Sheets("Game_data1").Cells(22, 2).Value) Then
            
                y = Sheets("Game_data1").Cells(22, 2).Value - mitmes
                              
                For z = 1 To y
                        Sheets("Nupud").Cells(mitmes - 1 + z, 16).Value = Sheets("Nupud").Cells(mitmes + z, 16).Value
                        Sheets("Nupud").Cells(mitmes - 1 + z, 14).Value = Sheets("Nupud").Cells(mitmes + z, 14).Value
                Next
                      
        End If
        
        Sheets("Game_data1").Cells(22, 2).Value = Sheets("Game_data1").Cells(22, 2).Value - 1

End Function
Function end_turn_resets()
Dim x As Integer

Sheets("Game_data1").Cells(16, 2).Value = 0 'aktiivne player pole lahingut võitnud

Sheets("Game_data1").Cells(190, 2).Value = 0 'evendi reset

Sheets("Game_data1").Cells(189, 2).Value = 0 'treasure_items_on_ground reset
Sheets("Game_data1").Cells(191, 2).Value = 0 'gold on ground
Sheets("Game_data1").Cells(205, 2).Value = 0 'closed gold
Sheets("Game_data1").Cells(206, 2).Value = 0 'closed items

'combat enemy side reset igaks juhuks
For x = 1 To 5
        Sheets("Game_data1").Cells(29 + x, 2).Value = 0
Next


End Function


Function playerite_vahetus()

Dim current_Player As Integer
Dim number_of_players As Integer
Dim player_position As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

do_it = end_turn_resets()

current_Player = Sheets("Game_data1").Cells(10, 2).Value
number_of_players = Sheets("Game_data1").Cells(2, 2).Value

do_it = shadow_list_of_players()

do_it = remove_dead()

If Sheets("Game_data1").Cells(2, 2).Value = 0 Then
        'kõik surnud, viik
        do_it = text_Output("", 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(739, 1).Value, 1, 5)

End If


If Sheets("Game_data1").Cells(2, 2).Value = 1 Then
    'declare victory for only player left
        
        do_it = declare_victory()
        
End If

If Sheets("Game_data1").Cells(2, 2).Value > 1 Then

        player_position = where_is_player_in_list()
        
        If player_position = 0 Then 'active player has died

                player_position = where_is_player_in_old_list(number_of_players, current_Player)
                
                
                Sheets("Game_data1").Cells(21, 2).Value = 0
                
                do_it = next_alive_player(player_position, number_of_players)
                
                
        Else
        
                If player_position >= Sheets("Game_data1").Cells(2, 2).Value Then
                        'day count
                        Sheets("Game_data1").Cells(81, 2).Value = Sheets("Game_data1").Cells(81, 2).Value + 1
                        'järgmine aktiivne player
                        Sheets("Game_data1").Cells(10, 2).Value = Sheets("nupud").Cells(1, 4).Value
                Else
                        'järgmine aktiivne player
                        Sheets("Game_data1").Cells(10, 2).Value = Sheets("nupud").Cells(player_position + 1, 4).Value
                End If
        
        End If
        Rem ja alustame uue playeriga

        'landide kaitsjad kõik oma kohtadele
        do_it = neutrals_reset()


        Sheets("Game_data1").Cells(84, 2).Value = 0 'player hasnt moved yet, round=0
        do_it = Greet_player()
        do_it = Main_turn()

End If

End Function
Function next_alive_player(player_position As Integer, number_of_players As Integer)

If Sheets("Game_data1").Cells(21, 2).Value = 0 Then
        Sheets("Game_data1").Cells(21, 2).Value = player_position
End If

If Sheets("Game_data1").Cells(21, 2).Value >= number_of_players Then
        Sheets("Game_data1").Cells(21, 2).Value = 1
        'day count
        Sheets("Game_data1").Cells(81, 2).Value = Sheets("Game_data1").Cells(81, 2).Value + 1
Else
        Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_data1").Cells(21, 2).Value + 1

End If

If Sheets("Game_data1").Cells(112 + Sheets("nupud").Cells(Sheets("Game_data1").Cells(21, 2).Value, 1).Value, 2).Value = 1 Then
        do_it = next_alive_player(player_position, number_of_players)
Else
        Sheets("Game_data1").Cells(10, 2).Value = Sheets("nupud").Cells(Sheets("Game_data1").Cells(21, 2).Value, 1).Value
End If


End Function
Function shadow_list_of_players()
Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        
        Sheets("nupud").Cells(x, 1).Value = Sheets("nupud").Cells(x, 4).Value

Next

End Function


Function remove_dead()

Dim number_of_players
Dim x As Integer
Dim z As Integer
Dim T As Integer
number_of_players = Sheets("Game_data1").Cells(2, 2).Value

For z = 1 To number_of_players

        T = Sheets("Game_data1").Cells(2, 2).Value
        For x = 1 To T
        
                        If Sheets("Game_data1").Cells(112 + Sheets("nupud").Cells(x, 4).Value, 2).Value = 1 Then
                                
                                do_it = remove_dead_player_from_list(x)
                                Exit For
                        
                        End If
        
        Next

Next

End Function
Function remove_dead_player_from_list(mitmes As Integer)
Dim y As Integer
Dim z As Integer
Dim player_nr As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

        
        MsgBox (Sheets("Lan" & Language).Cells(740, 1).Value & Sheets("Game_data1").Cells(10 + Sheets("Nupud").Cells(mitmes, 4).Value, 2).Value & Sheets("Lan" & Language).Cells(741, 1).Value)
        player_nr = Sheets("Nupud").Cells(mitmes, 4).Value
        
        If (mitmes < Sheets("Game_data1").Cells(2, 2).Value) Then
            
                y = Sheets("Game_data1").Cells(2, 2).Value - mitmes
                              
                For z = 1 To y
                        
                        Sheets("Nupud").Cells(mitmes - 1 + z, 4).Value = Sheets("Nupud").Cells(mitmes + z, 4).Value
                        
                Next
                      
        End If
        
        do_it = reset_lands(player_nr)
        
        Sheets("Game_data1").Cells(2, 2).Value = Sheets("Game_data1").Cells(2, 2).Value - 1

End Function
Function reset_lands(player_nr As Integer)
Dim x As Integer
Dim empty_stat As Integer

For x = 1 To 34
        If Sheets("Game_map").Cells(x, 2).Value = player_nr Then
                'omanik reset
                Sheets("Game_map").Cells(x, 2).Value = 0
                
                For y = 1 To 4
                        Sheets("Game_map").Cells(x, 11 + y).Value = 0 'castle level etc. reset
                Next
        
                Sheets("Game_map").Cells(x, 17).Value = 1 'kas kaitsja kohal reset
                
                do_it = Joonista_asukoht(x, 0, 6)
                do_it = Joonista_asukoht(x, 0, 9)
                
                do_it = Joonista_asukoht(x, 0, 11)
                do_it = Joonista_asukoht(x, 0, 13, "")
                do_it = Joonista_asukoht(x, 0, 10)
                
                For y = 1 To Sheets("Game_data1").Cells(174, 2).Value + 8 'buildingute arv
                        
                        empty_stat = 1
                        If Sheets("Game_map").Cells(x, y + 17).Value <> 0 Then
                                If Sheets("Game_map").Cells(35, 17 + y).Value = "Fire mana" _
                                Or Sheets("Game_map").Cells(35, 17 + y).Value = "Earth mana" _
                                Or Sheets("Game_map").Cells(35, 17 + y).Value = "Water mana" _
                                Or Sheets("Game_map").Cells(35, 17 + y).Value = "Air mana" _
                                Or Sheets("Game_map").Cells(35, 17 + y).Value = "Life mana" _
                                Or Sheets("Game_map").Cells(35, 17 + y).Value = "Death mana" _
                                Or Sheets("Game_map").Cells(35, 17 + y).Value = "Arcane mana" Then
                                        empty_stat = 0
                                End If
                                
                                If empty_stat = 1 Then
                                        Sheets("Game_map").Cells(x, y + 17).Value = 0
                                End If
                        End If
                Next
        End If
Next

End Function

Function declare_victory()
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
        do_it = text_Output("", 3)

        If Language = 2 Then
                do_it = text_Output(Sheets("Game_data1").Cells(10 + Sheets("Nupud").Cells(1, 4).Value, 2).Value, 0, Sheets("Game_data1").Cells(105 + Sheets("Nupud").Cells(1, 4).Value, 2).Value)
                do_it = text_Output(", ", 0)
        End If
        
        
        do_it = text_Output("+*+", 0, 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(743, 1).Value, 0, 5)
        do_it = text_Output("+*+", 0, 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(744, 1).Value, 0)
        
        If Language = 1 Then
                do_it = text_Output(Sheets("Game_data1").Cells(10 + Sheets("Nupud").Cells(1, 4).Value, 2).Value, 0, Sheets("Game_data1").Cells(105 + Sheets("Nupud").Cells(1, 4).Value, 2).Value)
        End If
        
        do_it = text_Output("!!", 1)
End Function
Function where_is_player_in_list() As Integer
Dim x As Integer

where_is_player_in_list = 0

For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        If Sheets("Game_data1").Cells(10, 2).Value = Sheets("nupud").Cells(x, 4).Value Then
              where_is_player_in_list = x
        End If
Next

End Function
Function where_is_player_in_old_list(number_of_players_before_death As Integer, player As Integer) As Integer

where_is_player_in_old_list = 0

For x = 1 To number_of_players_before_death
        If player = Sheets("nupud").Cells(x, 1).Value Then
             where_is_player_in_old_list = x
        End If
Next

End Function

Sub select_2players()
    
    Sheets("Game_data1").Cells(2, 2).Value = 2
    
    do_it = after_selecting_players
    

End Sub

Sub select_3players()
Dim x As Integer

    Sheets("Game_data1").Cells(2, 2).Value = 3
    For x = 1 To 4
            Sheets("Game_data1").Cells(24 + x, 2).Value = 250
    Next
    do_it = after_selecting_players
    
End Sub

Sub select_4players()
Dim x As Integer

    Sheets("Game_data1").Cells(2, 2).Value = 4
    
    For x = 1 To 4
            
            Sheets("Game_data1").Cells(24 + x, 2).Value = 300
    Next
    
    do_it = after_selecting_players
End Sub


Function after_selecting_players()

Dim x As Integer
Dim y As Integer
Dim how_many_Times As Integer

do_it = valiknuppude_Kustutamine()

do_it = Insert_name()

If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
        For x = 1 To 4
                Sheets("Game_data1").Cells(24 + x, 2).Value = 10000
        Next
End If

do_it = display_status(1)

'vastavalt playerite arvule nende alguspositsiooni ja listipanemine
For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        Sheets("Nupud").Cells(x, 4).Value = x
        Sheets("Game_data1").Cells(5 + x, 2).Value = 1
        Sheets("Game_data1").Cells(112 + x, 2).Value = 0 'playerid ärkavad ellu
Next


For x = 1 To 34
        
        Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_map").Cells(x, 4).Value
        do_it = Joonista_asukoht(x, 0, 5)
        If Sheets("Game_map").Cells(x, 1).Value >= 20 Then
                do_it = Joonista_asukoht(x, 0, 9)
        End If
        do_it = Joonista_asukoht(x, 0, 10)
        
        how_many_Times = 3
        If (Sheets("Game_map").Cells(x, 1).Value >= 2 And Sheets("Game_map").Cells(x, 1).Value <= 6) Then
                
                If Sheets("Game_map").Cells(x, 1).Value = 5 Then
                        how_many_Times = 7
                End If
                
                If Sheets("Game_map").Cells(x, 1).Value = 6 Then
                        how_many_Times = 5
                End If
            
                For T = 1 To how_many_Times
                        do_it = outfit_shop(Sheets("Game_map").Cells(x, 1).Value)
                Next
        End If

Next

For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        do_it = Joonista_asukoht(1, 0, x)
Next

do_it = Greet_player()
do_it = Main_turn()

End Function

Function create_item(itemtype As Integer, Optional items_begin_at_value As Integer = 0, Optional items_end_at_value As Integer = 3000) As Integer
Dim y As Integer
Dim x As Integer
Dim item_value As Integer
Dim item_nr As Integer
Dim counter As Integer
counter = 0
y = 0

If (itemtype >= 1 And itemtype <= 9) Then
        
        For x = 1 To Sheets("Game_data1").Cells(157 + itemtype, 2).Value
                item_nr = Sheets("Game_data1").Cells(175 + itemtype, 2).Value - 1 + x
                item_value = Sheets("items").Cells(item_nr, 5).Value
                
                If items_begin_at_value <= item_value And items_end_at_value >= item_value Then
                       counter = counter + 1
                       Sheets("nupud").Cells(counter, 17).Value = item_nr
                       Sheets("nupud").Cells(counter, 18).Value = Round(2000 / item_value + 1, 0)
                End If
        Next
        
       If counter <> 0 Then
            y = Sheets("nupud").Cells(rolling_odds(counter, 18), 17).Value
       Else
            do_it = text_Output("ERROR: Itemtype did not fit into price range in create_item, knife made", 1)
            y = 2
       End If
End If



If (y = 0) Then
        do_it = text_Output("ERROR: Itemtype did not trigger in create_item, knife made", 1)
        create_item = 2
Else
        create_item = y
End If


End Function
Function train_knowledge_menu()
'knowledge menüü
Dim what_player As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value


do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

what_player = Sheets("Game_data1").Cells(10, 2).Value
Sheets("Game_data1").Cells(187, 2).Value = 0
Sheets("Game_data1").Cells(187, 2).Value = check_spell_knowledge(what_player)
                
comma_Needed = 0
dot_needed = 0



                
If (Sheets("Game_data1").Cells(187, 2).Value >= 1) Then
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_to_main", 0, 1)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(745, 1).Value, 1)
        For x = 1 To Sheets("Game_data1").Cells(186, 2).Value
                       
                If Sheets("Spells").Cells(x, 2 + what_player).Value > 0 Then
                
                        If comma_Needed = 1 Then
                                do_it = text_Output(",", 1)
                                comma_Needed = 0
                        End If
                                 
                        dot_needed = dot_needed + 1
                        comma_Needed = comma_Needed + 1
                        
                        do_it = what_damage_type(Sheets("Spells").Cells(x, 7).Value, 0)
                        
                        do_it = text_Output(Chr(34), 0)
                        do_it = text_Output(Sheets("Spells").Cells(x, 1).Value, 0, Sheets("Game_data1").Cells(21, 2).Value)
                        do_it = text_Output(Chr(34), 0)
                
                        do_it = text_Output(Sheets("Lan" & Language).Cells(746, 1).Value, 0)
                        do_it = text_Output(Sheets("Spells").Cells(x, 2 + what_player).Value * 200, 0)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(747, 1).Value, 0)
                        do_it = text_Output(Sheets("Spells").Cells(x, 2 + what_player).Value, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(748, 1).Value, 0)
                        do_it = text_Output(Sheets("Spells").Cells(x, 2 + what_player).Value + 1, 0, 5)
                        
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(749, 1).Value & Sheets("Spells").Cells(x, 1).Value & Sheets("Lan" & Language).Cells(752, 1).Value, "Train_spell_" & x, 0, 1)
        
                End If
        Next
        
        If (dot_needed > 0) Then
        do_it = text_Output(".", 1)
        End If

Else
        do_it = text_Output(Sheets("Lan" & Language).Cells(750, 1).Value, 1)
        do_it = text_Output(Sheets("Lan" & Language).Cells(751, 1).Value, 1)
        do_it = Nuppudega_tegeleja("Ok", "cancel_to_main", 0, 1)

End If


End Function
Function train_spell(mitmes As Integer, Optional true_train As Integer = 0, Optional free As Integer = 0)
Dim what_player As Integer
Dim cost As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

Sheets("Game_data1").Cells(23, 2).Value = mitmes

If free = 0 Then
    
    cost = Sheets("Spells").Cells(mitmes, 2 + what_player).Value * 200

End If

If true_train = 1 Then
    
    If free = 1 Then
            
            do_it = text_Output(Sheets("Lan" & Language).Cells(753, 1).Value, 0)
            do_it = text_Output(Chr(34), 0)
            do_it = text_Output(eesti_nimi(Sheets("Spells").Cells(mitmes, 1).Value, 1), 0, Sheets("Game_data1").Cells(21, 2).Value)
            do_it = text_Output(Chr(34), 0)
            do_it = text_Output(Sheets("Lan" & Language).Cells(754, 1).Value, 1)
            
             
            Sheets("Game_data1").Cells(190, 2).Value = 0
            
            'knowledge juurde
            Sheets("Spells").Cells(mitmes, 2 + what_player).Value = Sheets("Spells").Cells(mitmes, 2 + what_player).Value + 1
             
            Sheets("Game_data1").Cells(84, 2).Value = 4
            do_it = Main_turn()

    Else
            If cost <= Sheets("Game_data1").Cells(24 + what_player, 2).Value Then
                    do_it = text_Output(Sheets("Lan" & Language).Cells(753, 1).Value, 0)
                    do_it = text_Output(Chr(34), 0)
                    do_it = text_Output(eesti_nimi(Sheets("Spells").Cells(mitmes, 1).Value, 1), 0, Sheets("Game_data1").Cells(21, 2).Value)
                    do_it = text_Output(Chr(34), 0)
                    do_it = text_Output(Sheets("Lan" & Language).Cells(754, 1).Value, 1)
                    
                    'raha maha
                    Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - cost
                    'knowledge juurde
                    Sheets("Spells").Cells(mitmes, 2 + what_player).Value = Sheets("Spells").Cells(mitmes, 2 + what_player).Value + 1
                    
                    Sheets("Game_data1").Cells(84, 2).Value = 4
                    do_it = display_status(2)
                    do_it = Main_turn()
            Else
                    do_it = text_Output(Sheets("Lan" & Language).Cells(70, 1).Value, 1)
                    do_it = Main_turn()
            End If
            
            
    End If
    
Else
        
        do_it = what_damage_type(Sheets("Spells").Cells(mitmes, 7).Value, 0)
        
        If Sheets("Spells").Cells(mitmes, 2 + what_player).Value = 0 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(762, 1).Value, 0)
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(755, 1).Value, 0)
        
        End If
        
        do_it = text_Output(Chr(34), 0)
        do_it = text_Output(eesti_nimi(Sheets("Spells").Cells(mitmes, 1).Value, 1), 0, Sheets("Game_data1").Cells(21, 2).Value)
        
        If Sheets("Spells").Cells(mitmes, 2 + what_player).Value = 0 Then
            do_it = text_Output(Chr(34), 0)
        Else
            do_it = text_Output(Chr(34), 1)
        End If
        
        If Sheets("Spells").Cells(mitmes, 2 + what_player).Value = 0 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(763, 1).Value, 1)
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(756, 1).Value, 0)
                do_it = text_Output(Sheets("Spells").Cells(mitmes, 2 + what_player).Value, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(757, 1).Value, 0)
                do_it = text_Output(Sheets("Spells").Cells(mitmes, 2 + what_player).Value + 1, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(758, 1).Value, 1)
        End If
        
        
        
        do_it = text_Output(Chr(34), 0)
        do_it = text_Output(Sheets("Spells").Cells(mitmes, 1).Value, 0)
        do_it = text_Output(Chr(34), 0)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(687, 1).Value, 0)
        do_it = text_Output(Sheets("Spells").Cells(mitmes, 9).Value, 0)
        do_it = text_Output(" ", 0)
        do_it = text_Output(what_damage_type(Sheets("Spells").Cells(mitmes, 7).Value, 0), 0, Sheets("Game_data1").Cells(21, 2).Value)
        do_it = text_Output(" mana.", 1)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(742, 1).Value & Sheets("Spells").Cells(mitmes, 10).Value, 1)
        
        If free = 0 Then
        
            do_it = text_Output(Sheets("Lan" & Language).Cells(759, 1).Value, 0)
            do_it = text_Output(Sheets("Spells").Cells(mitmes, 2 + what_player).Value * 200, 0, 14)
            do_it = text_Output(Sheets("Lan" & Language).Cells(760, 1).Value, 1)
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_to_train_spell", 0, 1)
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "true_train_spell", 0, 1)
        
        Else
        
             do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_to_main", 0, 1)
             do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "true_train_spell_f", 0, 1)
             do_it = text_Output(Sheets("Lan" & Language).Cells(761, 1).Value, 1, 1)
        
        End If
        
        
        
        
End If

End Function
Function Send_stuff_button_check()
Dim what_player As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

If Sheets("Game_data1").Cells(24 + what_player, 2).Value > 0 Or Sheets("Game_data1").Cells(120 + what_player, 2).Value > 0 Or Sheets("Game_data1").Cells(63 + what_player, 2).Value > 0 Then
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(764, 1).Value, "send_stuff", 0, 1)
End If

End Function
Function send_stuff_menu()
Dim what_player As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)

do_it = text_Output(Sheets("Lan" & Language).Cells(901, 1).Value, 1)
do_it = text_Output(Sheets("Lan" & Language).Cells(902, 1).Value, 0)
do_it = text_Output(Sheets("Game_data1").Cells(226, 2).Value, 0, 45)
do_it = text_Output(Sheets("Lan" & Language).Cells(903, 1).Value, 0)
do_it = text_Output(Sheets("Lan" & Language).Cells(904, 1).Value, 0, 5)
do_it = text_Output(Sheets("Lan" & Language).Cells(905, 1).Value, 1)

do_it = text_Output("", 1)
do_it = text_Output(Sheets("Lan" & Language).Cells(906, 1).Value, 1)

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_to_main", 0, 1)

If Sheets("Game_data1").Cells(24 + what_player, 2).Value >= Sheets("Game_data1").Cells(226, 2).Value Then

        If Sheets("Game_data1").Cells(24 + what_player, 2).Value > Sheets("Game_data1").Cells(226, 2).Value Then
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(907, 1).Value, "send_gold", 0, 1)
        End If
        
        If Sheets("Game_data1").Cells(120 + what_player, 2).Value > 0 Then
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(908, 1).Value, "send_item", 0, 1)
        End If
        
        If Sheets("Game_data1").Cells(63 + what_player, 2).Value > 0 Then
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(909, 1).Value, "send_land", 0, 1)
        End If

End If


End Function
Function send_menu(what As Integer)
Dim what_player As Integer
Dim legal_to_send As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
        
        
do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)

legal_to_send = 1

If Sheets("Game_data1").Cells(24 + what_player, 2).Value < Sheets("Game_data1").Cells(24 + what_player, 2).Value - (Sheets("Game_data1").Cells(226, 2).Value + 1) Then
        
        If what = 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(884, 1).Value, 1)
                legal_to_send = 0
        End If
        
End If

If Sheets("Game_data1").Cells(24 + what_player, 2).Value < Sheets("Game_data1").Cells(24 + what_player, 2).Value - Sheets("Game_data1").Cells(226, 2).Value Then
        
        If what = 2 Or what = 3 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(885, 1).Value, 1)
                legal_to_send = 0
        End If
        
End If

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "send_Stuff", 0, 1)

If legal_to_send = 1 Then

        If what = 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(886, 1).Value, 1)
        End If
        
        If what = 2 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(887, 1).Value, 1)
        End If
        
        If what = 3 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(888, 1).Value, 1)
        End If


        do_it = legal_send_list(what)

End If



End Function
Function legal_send_list(what As Integer)
Dim what_player As Integer
Dim checkitav_Player As Integer
Dim button_string As String

what_player = Sheets("Game_data1").Cells(10, 2).Value

If what = 1 Then
    button_string = "send_gold_to_"
End If

If what = 2 Then
    button_string = "send_item_to_"
End If

If what = 3 Then
    button_string = "send_land_to_"
End If


For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        checkitav_Player = Sheets("Nupud").Cells(x, 4).Value
        
        If checkitav_Player <> what_player Then
                If Sheets("Game_data1").Cells(112 + checkitav_Player, 2).Value = 0 Then
                        do_it = Nuppudega_tegeleja(eesti_nimi(Sheets("Game_data1").Cells(10 + checkitav_Player, 2).Value, 5), button_string & checkitav_Player, 0, 1)
                End If
        End If
Next
        
End Function
Function sending_land(mitmes_ruut As Integer, Optional true_send_land As Integer = 0)

Dim what_player As Integer
Dim ruut As Integer
Dim target_side As Integer
Dim mitmes_effect As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
target_side = Sheets("Game_data1").Cells(228, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

Sheets("Game_data1").Cells(167, 2).Value = mitmes_ruut

If true_send_land = 1 Then

        Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value + 1
        mitmes_effect = Sheets("Game_data1").Cells(208, 2).Value
        do_it = reset_all_effect_Bonuses(mitmes_effect)

        Sheets("Effects").Cells(mitmes_effect, 1).Value = Sheets("Side" & target_side).Cells(Sheets("Game_data1").Cells(51 + target_side, 2).Value, 35).Value
        Sheets("Effects").Cells(mitmes_effect, 2).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 35).Value

        'duration
        If Sheets("Game_data1").Cells(5 + target_side, 2).Value = ruut Then
                Sheets("Effects").Cells(mitmes_effect, 3).Value = 1
        Else
                Sheets("Effects").Cells(mitmes_effect, 3).Value = 3
        End If
        
        Sheets("Effects").Cells(mitmes_effect, 11).Value = mitmes_ruut
        
        
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(889, 1).Value, 0)
        
        
        If Sheets("Game_map").Cells(mitmes_ruut, 12).Value > 0 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(890, 1).Value, 0)
                
                If Language = 1 Then
                        do_it = text_Output(Sheets("Game_map").Cells(mitmes_ruut, 4).Value & "s", 0, 5)
                End If
                
                If Language = 2 Then
                        do_it = text_Output(eesti_nimi(Sheets("Game_map").Cells(mitmes_ruut, 4).Value, 7), 0, 5)
                End If
                
                If Language = 2 Then
                        do_it = text_Output(" " & eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5), 0)
                End If
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(891, 1).Value, 0)
                
                do_it = text_Output(eesti_nimi(Sheets("Game_map").Cells(mitmes_ruut, 4).Value, 1), 0, 5)
                
                If Language = 2 Then
                        do_it = text_Output(" " & eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5), 0)
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(892, 1).Value & mitmes_ruut, 0)
        End If
        
        

        do_it = text_Output(Sheets("Lan" & Language).Cells(893, 1).Value, 0)
        
        If Language = 1 Then
                do_it = text_Output(eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5), 0)
        End If
        
        do_it = text_Output(".", 1)
        do_it = text_Output(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(895, 1).Value, 0)
        
        If Sheets("Effects").Cells(mitmes_effect, 3).Value > 1 Then
                do_it = text_Output(Sheets("Effects").Cells(mitmes_effect, 3).Value, 0)
        End If
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(896, 1).Value, 1)
        Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - 50
Else

        do_it = text_Output(Sheets("Lan" & Language).Cells(897, 1).Value, 0)
        
        If Sheets("Game_map").Cells(mitmes_ruut, 12).Value = 0 Then
        
                If Language = 2 Then
                        do_it = text_Output(eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5), 0)
                End If
        End If
        
        If Sheets("Game_map").Cells(mitmes_ruut, 12).Value > 0 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(890, 1).Value, 0)
                
                If Language = 1 Then
                        do_it = text_Output(Sheets("Game_map").Cells(mitmes_ruut, 4).Value & "s", 0, 5)
                End If
                
                If Language = 2 Then
                        do_it = text_Output(eesti_nimi(Sheets("Game_map").Cells(mitmes_ruut, 4).Value, 7), 0, 5)
                
                End If
                
                If Language = 2 Then
                        do_it = text_Output(" " & eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5), 0)
                End If
                
        Else
                If Language = 2 Then
                        do_it = text_Output(" ", 0)
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(891, 1).Value, 0)
                do_it = text_Output(eesti_nimi(Sheets("Game_map").Cells(mitmes_ruut, 4).Value, 1), 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(892, 1).Value & mitmes_ruut, 0)
        End If
        
                do_it = text_Output(Sheets("Lan" & Language).Cells(893, 1).Value, 0)
                
                If Language = 1 Then
                        do_it = text_Output(eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5), 0)
                End If
                
                do_it = text_Output("?", 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(898, 1).Value, 1)
                
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_send_land", 0, 1)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_send_land", 0, 1)
End If

If true_send_land = 1 Then
        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
        do_it = Main_turn()
End If

End Function

Function send_gold_to(target_player As Integer)
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
Dim amount_of_gold As Integer


Dim what_player As Integer
what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)

amount_of_gold = InputBox(Sheets("Lan" & Language).Cells(910, 1).Value & Sheets("Game_data1").Cells(24 + what_player, 2).Value - Sheets("Game_data1").Cells(226, 2).Value, Sheets("Lan" & Language).Cells(911, 1).Value, Sheets("Game_data1").Cells(24 + what_player, 2).Value - Sheets("Game_data1").Cells(226, 2).Value)

If amount_of_gold > Sheets("Game_data1").Cells(24 + what_player, 2).Value - Sheets("Game_data1").Cells(226, 2).Value Or amount_of_gold < 1 Then
        amount_of_gold = Sheets("Game_data1").Cells(24 + what_player, 2).Value - Sheets("Game_data1").Cells(226, 2).Value
End If

Sheets("Game_data1").Cells(227, 2).Value = amount_of_gold
Sheets("Game_data1").Cells(228, 2).Value = target_player

do_it = text_Output(Sheets("Lan" & Language).Cells(912, 1).Value, 0)
do_it = text_Output(amount_of_gold & " ", 0, 45)

If amount_of_gold > 1 Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(913, 1).Value, 0)
Else
        do_it = text_Output(Sheets("Lan" & Language).Cells(921, 1).Value, 0)
End If

do_it = text_Output(eesti_nimi(Sheets("Game_data1").Cells(10 + target_player, 2).Value, 5), 1)

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "send_Stuff", 0, 1)
do_it = Nuppudega_tegeleja("Ok", "ok_send_gold", 0, 1)

End Function
Function send_item_to(target_player As Integer)

Dim what_player As Integer
what_player = Sheets("Game_data1").Cells(10, 2).Value

Sheets("Game_data1").Cells(228, 2).Value = target_player


do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)

do_it = Nuppudega_tegeleja("Cancel", "send_Stuff", 0, 1)

do_it = sell_list(1)


End Function
Function send_land_to(target_player As Integer)
Dim Language As Integer
Dim N As Integer
Dim buttoncounter As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

Dim what_player As Integer
what_player = Sheets("Game_data1").Cells(10, 2).Value

Sheets("Game_data1").Cells(228, 2).Value = target_player


do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "send_Stuff", 0, 1)

buttoncounter = 0

Sheets("Game_data1").Cells(229, 2).Value = 0

For x = 1 To 34
        
        If Sheets("Game_map").Cells(x, 2).Value = what_player Then
                
                do_button = 1
                
                If Sheets("Game_map").Cells(x, 12).Value > 0 Then
                        
                        If Sheets("Game_data1").Cells(229, 2).Value > 0 Then
                                
                                For z = 1 To Sheets("Game_data1").Cells(229, 2).Value
                                
                                    If Sheets("Nupud").Cells(Sheets("Game_data1").Cells(229, 2).Value, 7).Value = Sheets("Game_map").Cells(x, 4).Value Then
                                             do_button = 0
                                    End If
                                       
                                Next
                        
                        End If
                        
                        If do_button = 1 Then
                                Sheets("Game_data1").Cells(229, 2).Value = Sheets("Game_data1").Cells(229, 2).Value + 1
                        End If
                        
                End If
                
                For N = 1 To buttoncounter
                        If Sheets("Nupud").Cells(N, 40).Value = Sheets("Game_map").Cells(x, 4).Value Then
                                do_button = 0
                        End If
                Next
                
                
                If do_button = 1 Then
                        
                        If Sheets("Game_map").Cells(x, 12).Value > 0 Then
                        
                                If Language = 1 Then
                                        do_it = Nuppudega_tegeleja("Send all " & Sheets("Game_map").Cells(x, 4).Value & "s", "Send_land_nr_" & x, 0, 1)
                                End If
                                
                                If Language = 2 Then
                                        do_it = Nuppudega_tegeleja("Saada kõik " & eesti_nimi(Sheets("Game_map").Cells(x, 4).Value, 7), "Send_land_nr_" & x, 0, 1)
                                End If
                                
                                buttoncounter = buttoncounter + 1
                                Sheets("Nupud").Cells(buttoncounter, 40).Value = Sheets("Game_map").Cells(x, 4).Value
                                
                        Else
                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(899, 1).Value & Sheets("Game_map").Cells(x, 4).Value & Sheets("Lan" & Language).Cells(900, 1).Value & x, "Send_land_nr_" & x, 0, 1)
                                
                        End If
                        
                End If
                
        End If

Next



End Function

Sub ok_send_gold()
Dim what_player As Integer
Dim mitmes_effect As Integer
Dim target_side As Integer
Dim ruut As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
target_side = Sheets("Game_data1").Cells(228, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value

do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)

do_it = text_Output(Sheets("Lan" & Language).Cells(919, 1).Value, 1)

Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - Sheets("Game_data1").Cells(227, 2).Value - Sheets("Game_data1").Cells(226, 2).Value

Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value + 1
mitmes_effect = Sheets("Game_data1").Cells(208, 2).Value
do_it = reset_all_effect_Bonuses(mitmes_effect)

'kelle poolt (siin on asi veidi segadusseajav- mõlemasse panen target_id
Sheets("Effects").Cells(mitmes_effect, 1).Value = Sheets("Side" & target_side).Cells(Sheets("Game_data1").Cells(51 + target_side, 2).Value, 35).Value
Sheets("Effects").Cells(mitmes_effect, 2).Value = Sheets("Side" & target_side).Cells(Sheets("Game_data1").Cells(51 + target_side, 2).Value, 35).Value

'kelle peale

'duration
If Sheets("Game_data1").Cells(5 + target_side, 2).Value = ruut Then
        Sheets("Effects").Cells(mitmes_effect, 3).Value = 1
Else
        Sheets("Effects").Cells(mitmes_effect, 3).Value = 3
End If

Sheets("Effects").Cells(mitmes_effect, 9).Value = Sheets("Game_data1").Cells(227, 2).Value

Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
do_it = Main_turn()

End Sub

Function Main_turn()
Dim rest_Bonus As Integer
Dim income_Bonus As Integer
Dim what_player As Integer
Dim ruut As Integer
Dim petcontroll As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value

do_it = valiknuppude_Kustutamine() 'kyik nupud minema (tekitame naad main_turnis vajadusel uuesti)
do_it = display_status(1)
do_it = mobs_display()

If (Sheets("Game_data1").Cells(84, 2).Value = 0) Then
        do_it = upkeep()
End If

'surmakontroll
If Sheets("Game_data1").Cells(112 + what_player, 2).Value = 1 Then
        Sheets("Game_data1").Cells(84, 2).Value = 4
Else
        
        'kui aktiivne player on võitnud battle
        If Sheets("Game_data1").Cells(16, 2).Value = 1 Then
               'ja kui ta pole surnud
               do_it = active_player_won_battle_and_main_turn_starts()
               
        End If
        
        'if any items and gold on ground
        If Sheets("Game_data1").Cells(189, 2).Value > 0 Or Sheets("Game_data1").Cells(191, 2).Value Then
                do_it = treasure_list()
        End If
        
        
        Sheets("Game_data1").Cells(44, 2).Value = 0 'me oleme main turn menus
        
        If (Sheets("Game_data1").Cells(84, 2).Value > 1) Then
                do_it = clean_worm_tail(what_player)
        End If
        
        
        
        
        Rem kui on käigu algus, siis saab vaid liikuda....
        If (Sheets("Game_data1").Cells(84, 2).Value = 0) Then
                If is_player_ai(what_player) = 0 Then
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(17, 1).Value, "move_around", 0, 1)
                        Sheets("Game_data1").Cells(103, 2).Value = 1
                        Sheets("Game_data1").Cells(101, 2).Value = 0
                        do_it = Vilgutamine_a
                Else
                        do_it = add_ai_choice(10)
                End If
        End If
        
        Rem Kui on saabunud 4 round ja ikka käib võitlus
        If (Sheets("Game_data1").Cells(84, 2).Value = 4 And Sheets("Game_data1").Cells(87, 2).Value = 1) Then
                
                Sheets("Game_data1").Cells(87, 2).Value = 0
                
                do_it = remove_combat_effects_globally()
                do_it = text_Output(Sheets("Lan" & Language).Cells(16, 1).Value, 1)
                
        End If
        
        
        If (Sheets("Game_data1").Cells(84, 2).Value > 0 And Sheets("Game_data1").Cells(84, 2).Value < 4) Then
                
        
                ' kui on esimene round neutraalsel maal
                If (Sheets("Game_data1").Cells(84, 2).Value < 2) Then
                        
                        If (Sheets("Game_data1").Cells(89, 2).Value = 1) Then 'ja ta on ostetav siis osta
                                If is_player_ai(what_player) = 0 Then
                                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(18, 1).Value, "Buy_place", 0, 1)
                                Else
                                        do_it = add_ai_choice(12)
                                End If
                        End If
                
                End If
        
                ' Kas Võitlus on peal?
                If Sheets("Game_data1").Cells(87, 2).Value <> 1 Then
        
                        Rem kui maa on neutraalne
                        If (Sheets("Game_data1").Cells(88, 2).Value = 2) Then
                                If Sheets("Fight").Cells(30, 10).Value = 0 Then
                                        If is_player_ai(what_player) = 0 Then
                                            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(19, 1).Value, "attack_playerland", 0, 1)
                                        Else
                                            do_it = add_ai_choice(13)
                                        End If
                                End If
                        End If
                        
                        do_it = make_attack_buttons_for_player(what_player)
                        
                        Rem Kui maa on sõbralik
                        If (Sheets("Game_data1").Cells(88, 2).Value = 4) Then
                                
                                 'income improvement
                                
                                    If Sheets("Game_map").Cells(ruut, 2).Value = what_player And Sheets("Game_map").Cells(ruut, 7).Value > 0 Then
                                            If Sheets("Game_map").Cells(ruut, 6).Value < Sheets("Game_map").Cells(ruut, 7).Value * 3 Then
                                                    If is_player_ai(what_player) = 0 Then
                                                    
                                                            income_Bonus = Int((Sheets("Game_map").Cells(ruut, 7).Value / 2 + 10) / 3 * (4 - Sheets("Game_data1").Cells(84, 2).Value))
                                                            
                                                            If Sheets("Game_map").Cells(ruut, 6).Value + income_Bonus > Sheets("Game_map").Cells(ruut, 7).Value * 3 Then
                                                                    income_Bonus = Sheets("Game_map").Cells(ruut, 7).Value * 3 - Sheets("Game_map").Cells(ruut, 6).Value
                                                            End If
                                                            If Language = 1 Then
                                                                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(20, 1).Value & income_Bonus, "improve_income", 0, 1)
                                                            End If
                                                            
                                                            If Language = 2 Then
                                                                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(20, 1).Value & income_Bonus & " võrra", "improve_income", 0, 1)
                                                            End If
                                                    Else
                                                            do_it = add_ai_choice(17)
                                                    End If
                                            End If
                                    End If
                                
                                 'upgrade defender if
                                If Sheets("Game_map").Cells(ruut, 2).Value = what_player And Sheets("Game_map").Cells(ruut, 1).Value <> 20 Then
                                        
                                        If Sheets("Game_map").Cells(ruut, 5).Value <> find_mob_by_name(Sheets("Map_defaults").Cells(Sheets("Game_map").Cells(ruut, 1).Value, 12).Value) Then
                                                If is_player_ai(what_player) = 0 Then
                                                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(21, 1).Value, "u_defender", 0, 1)
                                                Else
                                                        do_it = add_ai_choice(19)
                                                End If
                                        End If
                                        
                                End If
                                
                                'recruit check
                                If Sheets("Game_map").Cells(ruut, 2).Value = what_player And Sheets("Game_map").Cells(ruut, 47).Value > 0 Then
                                        
                                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(22, 1).Value & Sheets("Game_map").Cells(ruut, 46).Value, "l_recruit", 0, 1)
                                
                                End If
                                
                                
                                
                                'Player built smithy checks
'                                If Sheets("Game_map").Cells(ruut, 2).Value = what_player And Sheets("Game_map").Cells(ruut, find_building_slot_in_map("Weaponsmith")).Value = 1 Then
'                                        do_It = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(59, 1).Value, "forge_weapons", 0, 1)
'                                End If
                                
                               
                                
'                                If Sheets("Game_map").Cells(ruut, 2).Value = what_player And Sheets("Game_map").Cells(ruut, find_building_slot_in_map("Armorer")).Value = 1 Then
'                                        do_It = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(60, 1).Value, "forge_armor", 0, 1)
'                                End If
                                
                                If (Sheets("Game_map").Cells(ruut, 11).Value > 0) Then
                                        If is_player_ai(what_player) = 0 Then
                                                rest_Bonus = (Sheets("Game_map").Cells(ruut, 11).Value + sanctuary_Check(what_player)) / 3 * (4 - Sheets("Game_data1").Cells(84, 2).Value)
                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(61, 1).Value & rest_Bonus & Sheets("Lan" & Language).Cells(62, 1).Value, "rest_and_heal", 0, 1)
                                        Else
                                                do_it = add_ai_choice(18)
                                        End If
                                End If
                                
                                Rem Shop-i kood
                                If (Sheets("Game_map").Cells(ruut, 1).Value >= 2 And Sheets("Game_map").Cells(ruut, 1).Value <= 6) Then
                                        
                                        'buy menu
                                        If is_player_ai(what_player) = 0 Then
                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(63, 1).Value, "buy_menu", 0, 1)
                                        Else
                                                do_it = buy_list()
                                        End If
                                        
                                        'train power in mage guild
                                        If Sheets("Game_map").Cells(ruut, 1).Value = 6 Then 'mage guild
                                                If Sheets("Game_data1").Cells(84, 2).Value = 1 Then
                                                
                                                        If is_player_ai(what_player) = 0 Then
                                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(64, 1).Value, "Train_power", 0, 1)
                                                        Else
                                                                do_it = add_ai_choice(21)
                                                        End If
                                                        
                                                End If
                                                
                                        End If
                                        
                                        'improve knowledge in library
                                        If Sheets("Game_map").Cells(ruut, 1).Value = 5 Then 'library
                                                
                                                If Sheets("Game_data1").Cells(84, 2).Value = 1 Then
                                                        If is_player_ai(what_player) = 0 Then
                                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(65, 1).Value, "Train_Knowledge", 0, 1)
                                                        Else
                                                                do_it = add_ai_choice(22)
                                                        End If
                                                End If
                                                
                                        End If
                                        
                                        If Sheets("Game_map").Cells(ruut, 1).Value = 4 Then 'bazaar
                                                
                                                'caravans
                                                If Sheets("Game_data1").Cells(84, 2).Value = 1 Then
                                                        If is_player_ai(what_player) = 0 Then
                                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(158, 1).Value, "hire_caravan", 0, 1)
                                                        Else
                                                                If Sheets("Game_data1").Cells(24 + what_player, 2).Value >= Sheets("Game_data1").Cells(248, 2).Value Then
                                                                        do_it = add_ai_choice(20)
                                                                End If
                                                                
                                                                If Sheets("Game_data1").Cells(24 + what_player, 2).Value >= Sheets("Game_data1").Cells(249, 2).Value Then
                                                                        do_it = add_ai_choice(23)
                                                                End If
                                                                
                                                        End If
                                                End If
                                                
                                        End If
                                        
                                        If Sheets("Game_map").Cells(ruut, 1).Value = 3 Then 'sepikoda
                                                
                                                'improve weapon
                                                If Sheets("Game_data1").Cells(84, 2).Value < 3 Then
                                                        If is_player_ai(what_player) = 0 Then
                                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(923, 1).Value, "improve_weapon", 0, 1)
                                                        Else
                                                                
                                                            'AI variant not coded yet
                                                        End If
                                                End If
                                                
                                        End If
                                        
                                        If Sheets("Game_map").Cells(ruut, 1).Value = 2 Then 'shop

                                                'petcontroll
                                                petcontroll = check_for_pet(what_player)
                                                
                                                If petcontroll > 0 Then
                                                        
                                                        If Sheets("Side" & what_player).Cells(petcontroll, 66).Value <> 0 Then
                                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(136, 1).Value, "Train_pet", 0, 1)
                                                        End If
                                                        
                                                Else
                                                        If Sheets("Game_data1").Cells(84, 2).Value = 1 Then
                                                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(135, 1).Value, "buy_pet", 0, 1)
                                                        End If
                                                        
                                                End If

                                        End If
                                        
                                        'sell list
                                        If (Sheets("Game_data1").Cells(120 + what_player, 2).Value > 0) Then
                                                If is_player_ai(what_player) = 0 Then
                                                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(167, 1).Value, "sell_menu", 0, 1)
                                                Else
                                                        do_it = sell_list()
                                                End If
                                        End If
                                        
                                End If
                                
                                'arcane tower teleport nupud
                                If Sheets("Game_map").Cells(ruut, 1).Value = 20 Then
                                        'kui on morning
                                        If Sheets("Game_data1").Cells(84, 2).Value = 1 Then
                                                do_it = arcane_tower()
                                        End If
                                End If
                                
                                'mercenary campi kood
                                If Sheets("Game_map").Cells(ruut, 1).Value = 10 Then
                                        do_it = mercenary_camp()
                                End If
                                
                                'training groundi kood
                                If Sheets("Game_map").Cells(ruut, 1).Value = 11 Then
                                        do_it = training_ground()
                                End If
                                
                                If Sheets("Game_map").Cells(ruut, 1).Value = 12 Then
                                        do_it = shrine()
                                End If
                                
                        
                                If Sheets("Game_map").Cells(ruut, 1).Value >= 13 And Sheets("Game_map").Cells(ruut, 1).Value <= 15 Then
                                        do_it = event_in_main_turn(Sheets("Game_data1").Cells(190, 2).Value)
                                End If
                                
                                
                                
                                
                        End If
                        
                        Rem Kui Maa on Playeri oma ja vaenulik
                        If (Sheets("Game_data1").Cells(88, 2).Value = 2 And Sheets("Game_map").Cells(ruut, 6).Value > 0) Then
                                
                                'land was attacked by player
                                If Sheets("Game_data1").Cells(80, 2).Value = 1 Then
                                        If Sheets("Game_data1").Cells(16, 2).Value = 1 Then
                                                If Sheets("Game_map").Cells(ruut, 6).Value > 0 Then
                                                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(851, 1).Value, "pillage", 0, 1)
                                                End If
                                        End If
                                End If
                        End If
                        
                        
                        Sheets("Game_data1").Cells(187, 2).Value = 0
                        Sheets("Game_data1").Cells(187, 2).Value = check_spell_knowledge(what_player)
                        
                        If (Sheets("Game_data1").Cells(187, 2).Value >= 1) Then
                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(24, 1).Value, "spell_menu", 0, 1)
                        End If
                        
                        Sheets("Game_data1").Cells(104, 2).Value = 0
                        do_it = check_build(1)
                        
                        If (Sheets("Game_data1").Cells(104, 2).Value = 1) Then
                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(25, 1).Value, "build_menu", 0, 1)
                        End If
                        
                        'inventory
                        If (Sheets("Game_data1").Cells(120 + what_player, 2).Value > 0) Then
                                If is_player_ai(what_player) = 0 Then
                                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(23, 1).Value, "inventory_menu", 0, 1)
                                Else
                                        do_it = equipment_list()
                                End If
                        End If
                        
                        'send stuff
                        If Sheets("Game_data1").Cells(225, 2).Value > 0 Then
                                do_it = Send_stuff_button_check()
                        End If
                Else
                       
                        do_it = text_Output("That is strange, really strange!", 1)
        
                End If
        
        End If
End If
Rem ei tohi olla pre-round ja combat, siis tuleb ka end turni nupp

If (Sheets("Game_data1").Cells(84, 2).Value = 4 And Sheets("Game_data1").Cells(87, 2).Value = 1) Then
            
    Sheets("Game_data1").Cells(87, 2).Value = 0
    
    do_it = remove_combat_effects_globally()
    do_it = text_Output(Sheets("Lan" & Language).Cells(16, 1).Value, 1)
                
End If


If (Sheets("Game_data1").Cells(87, 2).Value <> 1 And Sheets("Game_data1").Cells(84, 2).Value > 0) Then
                
        
        
        If is_player_ai(what_player) = 0 Then
             do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(26, 1).Value, "end_turn", 0, 1)
        Else
             do_it = add_ai_choice(11)
        End If
        
        
End If

do_it = day_output()

If is_player_ai(what_player) = 1 Then
        do_it = Ai_commands(what_player)
End If

End Function
Function upkeep()
Dim what_player As Integer

Dim T As Integer
Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim R As Integer
Dim counter As Integer
Dim main_Cycle As Integer
Dim mana_first_time As Integer
Dim mana_output_line_counter As Integer
Dim line_break_Needed As Integer
Dim comma_Needed As Integer
Dim is_there As Integer
Dim poison_Damage As Integer
Dim before As Integer
Dim hp_gain As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

line_break_Needed = 0
comma_Needed = 0
counter = 0

For x = 1 To Sheets("Game_data1").Cells(46 + what_player, 2).Value
   
    Sheets("Nupud").Cells(x, 27).Value = Sheets("Side" & what_player).Cells(x, 35).Value
                               
    counter = counter + 1
        
Next

For R = 1 To counter
  
        is_there = is_id_Target_in_game(Sheets("Nupud").Cells(R, 27).Value)
        
        'merc and their removal if needed
        If is_there = 1 Then
                what_player = Sheets("Game_data1").Cells(61, 2).Value
                x = Sheets("Game_data1").Cells(62, 2).Value
                
                If Sheets("Side" & what_player).Cells(x, 39).Value > 0 Then 'merci counter

                        Sheets("Side" & what_player).Cells(x, 39).Value = Sheets("Side" & what_player).Cells(x, 39).Value - 1
                
                        If Sheets("Side" & what_player).Cells(x, 39).Value <= 0 Then
                        
                                 do_it = text_Output(Sheets("Lan" & Language).Cells(765, 1).Value & Sheets("Side" & what_player).Cells(x, 1).Value, 0)
                                 do_it = text_Output(Sheets("Lan" & Language).Cells(766, 1).Value, 1)
                                 do_it = death_from_combat(x, what_player)
                        End If
                        
                End If
                
        End If
        
        
        is_there = is_id_Target_in_game(Sheets("Nupud").Cells(R, 27).Value)
        'poison
        If is_there = 1 Then
        
                If Sheets("Side" & what_player).Cells(x, 56).Value > 0 Then 'poison
                        poison_Damage = Sheets("Side" & what_player).Cells(x, 56).Value
                        
                        If x = Sheets("Game_data1").Cells(51 + what_player, 2).Value Then
                                     
                                do_it = text_Output(Sheets("Lan" & Language).Cells(767, 1).Value, 0)
                        Else
                                do_it = text_Output(Sheets("Side" & what_player).Cells(x, 1).Value & Sheets("Lan" & Language).Cells(774, 1).Value, 0)
                        End If
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(768, 1).Value, 0)
                        do_it = text_Output(poison_Damage & " ", 0, 10)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(769, 1).Value, 1)
                        
                        'poison väheneb vastavalt rnd*str
                        Sheets("Side" & what_player).Cells(x, 56).Value = Sheets("Side" & what_player).Cells(x, 56).Value - Int(Rnd * Sheets("Side" & what_player).Cells(x, 11).Value + 1)
                        If Sheets("Side" & what_player).Cells(x, 56).Value < 0 Then
                                Sheets("Side" & what_player).Cells(x, 56).Value = 0
                        End If
                        
                        
                        'ja elu maha
                        Sheets("Side" & what_player).Cells(x, 2).Value = Sheets("Side" & what_player).Cells(x, 2).Value - poison_Damage
                        If Sheets("Side" & what_player).Cells(x, 2).Value <= 0 Then
                                do_it = text_Output(Sheets("Side" & what_player).Cells(x, 1).Value & Sheets("Lan" & Language).Cells(775, 1).Value, 1)
                                
                                If Sheets("Side" & what_player).Cells(x, 35).Value <= 1004 Then
                                'player char dies
                                        do_it = player_char_dies(what_player)
                                End If
                                
                                
                                do_it = death_from_combat(x, what_player)
                        End If
                Else
                        'normal hp regeneration
                        If Sheets("Side" & what_player).Cells(x, 2).Value < Sheets("Side" & what_player).Cells(x, 11).Value * 10 Then
                                before = Sheets("Side" & what_player).Cells(x, 2).Value
                                hp_gain = Sheets("Side" & what_player).Cells(x, 11).Value - Int(Sheets("Side" & what_player).Cells(x, 2).Value / 10)
                                Sheets("Side" & what_player).Cells(x, 2).Value = Sheets("Side" & what_player).Cells(x, 2).Value + hp_gain
                                
                                If Sheets("Side" & what_player).Cells(x, 2).Value > Sheets("Side" & what_player).Cells(x, 3).Value Then
                                        Sheets("Side" & what_player).Cells(x, 2).Value = Sheets("Side" & what_player).Cells(x, 3).Value
                                End If
                                
                                If Sheets("Side" & what_player).Cells(x, 35).Value <= 1004 Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(770, 1).Value, 0)
                                        do_it = text_Output(hp_gain & " ", 0, 4)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(771, 1).Value, 1)
                                End If
                        
                        End If
                
                End If
        End If
        
        
        
        is_there = is_id_Target_in_game(Sheets("Nupud").Cells(R, 27).Value)
        
        If is_there = 1 Then
                
                
                mana_first_time = 0
                mana_output_line_counter = 0
        
                For y = 1 To 7
                
                        If Sheets("Side" & what_player).Cells(x, 22 + y).Value <> 0 Then ' mana counter
                        
                                If x = Sheets("Game_data1").Cells(51 + what_player, 2).Value Then
                                        If mana_first_time = 0 Then
                                                mana_first_time = 1
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(772, 1).Value, 0)
                                    
                                        End If
                                        
                                        If comma_Needed = 1 Then
                                                do_it = text_Output(", ", 0)
                                                comma_Needed = 0
                                        End If
                                        If line_break_Needed = 1 Then
                                                do_it = text_Output(",", 1)
                                                line_break_Needed = 0
                                        End If
                                        
                                        
                                        do_it = text_Output(Sheets("Side" & what_player).Cells(x, 22 + y).Value & " ", 0)
                                        do_it = text_Output(what_damage_type(y + 3), 0, Sheets("Game_data1").Cells(21, 2).Value)
                                        Sheets("Side" & what_player).Cells(x, 15 + y).Value = Sheets("Side" & what_player).Cells(x, 15 + y).Value + Sheets("Side" & what_player).Cells(x, 22 + y).Value
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(776, 1).Value & Sheets("Side" & what_player).Cells(x, 15 + y).Value & Sheets("Lan" & Language).Cells(773, 1).Value, 0)
                                        
                                        mana_output_line_counter = mana_output_line_counter + 1
                                        
                                        If mana_output_line_counter = 1 Then
                                                comma_Needed = 1
                                        End If
                                        If mana_output_line_counter = 2 Then
                                                line_break_Needed = 1
                                                mana_output_line_counter = 0
                                        End If
                                Else
                                        Sheets("Side" & what_player).Cells(x, 15 + y).Value = Sheets("Side" & what_player).Cells(x, 15 + y).Value + Sheets("Side" & what_player).Cells(x, 22 + y).Value
                                
                                End If
                                
                                
                        End If
                        
                        
                Next
                
                If mana_first_time = 1 Then
                        do_it = text_Output(".", 1)
                End If
                
                If Sheets("Side" & what_player).Cells(x, 66).Value <> 0 Then 'then check pet counter
                
                        Sheets("Side" & what_player).Cells(x, 65).Value = Sheets("Side" & what_player).Cells(x, 65).Value + 1
                        
                        do_it = level_up_check(what_player, x)
                        
                        
                End If
                
        End If
        
        main_Cycle = Sheets("Game_data1").Cells(208, 2).Value
        
        For z = 1 To main_Cycle 'effect checked reset
                Sheets("Effects").Cells(z, 8).Value = 0
        Next
        
        For z = 1 To main_Cycle
                For T = 1 To Sheets("Game_data1").Cells(208, 2).Value
                        'effectid (current_playeri party spellide kehtivuse tsekk)
                        If Sheets("Effects").Cells(T, 8).Value = 0 Then
                        
                                Sheets("Effects").Cells(T, 8).Value = 1
                                
                                If Sheets("Effects").Cells(T, 1).Value = Sheets("Side" & what_player).Cells(x, 35).Value Then
                                        If Sheets("Effects").Cells(T, 3).Value <> 0 Then
                                                Sheets("Effects").Cells(T, 3).Value = Sheets("Effects").Cells(T, 3).Value - 1
                                                If Sheets("Effects").Cells(T, 3).Value <= 0 Then
                                                        'remove effect
                                                        do_it = remove_effect(T)
                                                        Exit For
                                                End If
                                                
                                        End If
                                End If
                        End If
                Next
        Next
        
        
        
        
        
Next

do_it = display_status(0)
do_it = display_status(1)
do_it = mobs_display()

End Function
Function is_effect_on_target(target_id As Integer, mitmes As Integer) As Integer
Dim T As Integer
Dim effect_triggered As Integer

is_effect_on_target = 0

For T = 1 To Sheets("Game_data1").Cells(208, 2).Value

        effect_triggered = 0
        
        If mitmes <> 7 Then
                If Sheets("Effects").Cells(T, 2).Value = target_id Then
                        If Sheets("Effects").Cells(T, mitmes).Value <> 0 Then
                                effect_triggered = 1
                        End If
                End If
        Else
                If Sheets("Effects").Cells(T, 1).Value = target_id Then
                        If Sheets("Effects").Cells(T, mitmes).Value <> 0 Then
                                effect_triggered = 1
                        End If
                End If
        End If
        
        If effect_triggered = 1 Then
        'duration
                Sheets("Game_data1").Cells(268, 2).Value = Sheets("Effects").Cells(T, 3).Value
                'power of the effect
                Sheets("Game_data1").Cells(269, 2).Value = Sheets("Effects").Cells(T, mitmes).Value
        
                is_effect_on_target = 1
        End If
        
Next

End Function

Function remove_effect(mitmes As Integer)
Dim check_target_id As Integer
Dim target_side As Integer
Dim target_mob As Integer
Dim what_player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

check_target_id = 0
check_target_id = is_id_Target_in_game(Sheets("Effects").Cells(mitmes, 2).Value)

If check_target_id = 1 Then
        target_side = Sheets("Game_data1").Cells(61, 2).Value
        target_mob = Sheets("Game_data1").Cells(62, 2).Value
        
        If Sheets("Effects").Cells(mitmes, 4).Value <> 0 Then 'armor
                
                Sheets("Side" & target_side).Cells(target_mob, 14).Value = Sheets("Side" & target_side).Cells(target_mob, 14).Value - Sheets("Effects").Cells(mitmes, 4).Value
                do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                do_it = text_Output(Sheets("Lan" & Language).Cells(777, 1).Value, 1)
        End If
        
        If Sheets("Effects").Cells(mitmes, 5).Value <> 0 Then 'haste
                'dex
                do_it = add_stat(-Sheets("Effects").Cells(mitmes, 5).Value, 12, target_side, target_mob)
                'extra attacks
                Sheets("Side" & target_side).Cells(target_mob, 4).Value = Sheets("Side" & target_side).Cells(target_mob, 4).Value - Sheets("Effects").Cells(mitmes, 5).Value
                
                do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                do_it = text_Output(Sheets("Lan" & Language).Cells(778, 1).Value, 1)
        End If
        
        If Sheets("Effects").Cells(mitmes, 6).Value <> 0 Then 'strength
                do_it = add_stat(-Sheets("Effects").Cells(mitmes, 6).Value, 11, target_side, target_mob)
                do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(779, 1).Value, 1)
                
                
                player_under_str = 0
        
                If target_side <> 5 Then
                        If Sheets("Game_data1").Cells(51 + target_side, 2).Value = target_mob Then
                                do_it = recalculate_damage(target_side, 0)
                                player_under_str = 1
                        End If
                End If
                
                If player_under_str = 0 Then
                       
                                do_it = add_stat(-Sheets("Effects").Cells(mitmes, 6).Value * 5, 3, target_side, target_mob)
                                do_it = add_stat(-Sheets("Effects").Cells(mitmes, 6).Value, 6, target_side, target_mob)
                End If
                
        End If
        
        If Sheets("Effects").Cells(mitmes, 9).Value <> 0 Then 'recieve money
                do_it = text_Output(Sheets("Lan" & Language).Cells(914, 1).Value, 0)
                do_it = text_Output(Sheets("Effects").Cells(mitmes, 9).Value, 0, 45)
                If Sheets("Effects").Cells(mitmes, 9).Value > 1 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(915, 1).Value, 1)
                Else
                        do_it = text_Output(Sheets("Lan" & Language).Cells(920, 1).Value, 1)
                End If
                
                Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value + Sheets("Effects").Cells(mitmes, 9).Value
        End If
        
        If Sheets("Effects").Cells(mitmes, 10).Value <> 0 Then 'recieve item
                do_it = text_Output(Sheets("Lan" & Language).Cells(916, 1).Value, 0)
                do_it = text_Output(Sheets("Items").Cells(Sheets("Effects").Cells(mitmes, 10).Value, 1).Value, 0, 5)
                do_it = text_Output("!", 1)
                Sheets("Game_data1").Cells(189, 2).Value = Sheets("Game_data1").Cells(189, 2).Value + 1
                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 18).Value = Sheets("Effects").Cells(mitmes, 10).Value
                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 19).Value = 0
        
        End If
        
        If Sheets("Effects").Cells(mitmes, 11).Value <> 0 Then 'recieve land
                If Sheets("Game_map").Cells(Sheets("Effects").Cells(mitmes, 11).Value, 2).Value = target_side Then
                        
                         do_it = text_Output(Sheets("Lan" & Language).Cells(917, 1).Value, 0)
                        If Sheets("Game_map").Cells(Sheets("Effects").Cells(mitmes, 11).Value, 12).Value > 0 Then
                                
                                If Language = 1 Then
                                        do_it = text_Output(Sheets("Game_map").Cells(Sheets("Effects").Cells(mitmes, 11).Value, 4).Value & "s", 0, 5)
                                End If
                                
                                If Language = 2 Then
                                        do_it = text_Output(eesti_nimi(Sheets("Game_map").Cells(Sheets("Effects").Cells(mitmes, 11).Value, 4).Value, 7), 0, 5)
                                End If
                                
                        Else
                                do_it = text_Output(Sheets("Game_map").Cells(Sheets("Effects").Cells(mitmes, 11).Value, 4).Value, 0, 5)
                        
                        End If
                        do_it = text_Output(Sheets("Lan" & Language).Cells(918, 1).Value, 1)
                        
                        do_it = give_active_land_ownership_to_player(what_player, Sheets("Effects").Cells(mitmes, 11).Value)
                End If
                
        End If
        
        

End If



do_it = remove_effect_from_list(mitmes)

End Function
Function remove_effect_from_list(mitmes As Integer)

Dim y As Integer
Dim z As Integer
Dim T As Integer
Dim how_many_cells As Integer
how_many_cells = 40

        If mitmes < Sheets("Game_data1").Cells(208, 2).Value Then
            
                y = Sheets("Game_data1").Cells(208, 2).Value - mitmes
                              
                For z = 1 To y
                        For T = 1 To how_many_cells
                                Sheets("Effects").Cells(mitmes - 1 + z, T).Value = Sheets("Effects").Cells(mitmes + z, T).Value
                        Next
                Next
                      
        End If
        
        Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value - 1


End Function

Function is_id_Target_in_game(id_number As Integer)
Dim what_side As Integer
Dim z As Integer
Dim x As Integer

is_id_Target_in_game = 0

For what_side = 1 To 5
        
        For x = 1 To Sheets("Game_data1").Cells(46 + what_side, 2).Value
        
                If Sheets("Side" & what_side).Cells(x, 35).Value = id_number Then
                
                        Sheets("Game_data1").Cells(61, 2).Value = what_side
                        Sheets("Game_data1").Cells(62, 2).Value = x
                        is_id_Target_in_game = 1
                        
                End If
        Next
Next

End Function

Function upgrade_defender(Optional true_train As Integer = 0)

Dim merci_nr As Integer
Dim what_player As Integer
Dim merci_hind As Integer
Dim mitmes_slot As Integer
Dim training_succeeded As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value


training_succeeded = 0

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

what_player = Sheets("Game_data1").Cells(10, 2).Value

For x = 12 To 9 Step -1

        If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 5).Value <> find_mob_by_name(Sheets("Map_defaults").Cells(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 1).Value, x).Value) Then
               merci_nr = find_mob_by_name(Sheets("Map_defaults").Cells(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 1).Value, x).Value)
               mitmes_slot = x - 8
        Else
                Exit For
        End If

Next

merci_hind = Sheets("Mobs").Cells(merci_nr, 31).Value * 4 * mitmes_slot

If mitmes_slot = 3 Then

merci_hind = Sheets("Mobs").Cells(merci_nr, 31).Value * 5 * mitmes_slot

End If

If mitmes_slot = 4 Then

merci_hind = Sheets("Mobs").Cells(merci_nr, 31).Value * 6 * mitmes_slot

End If


If true_train = 1 Then

        If Sheets("Game_data1").Cells(24 + what_player, 2).Value < merci_hind Then
                                        
                do_it = text_Output(Sheets("Lan" & Language).Cells(70, 1).Value, 1)
                                        
        Else
                training_succeeded = 1
                Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - merci_hind
                        
                do_it = text_Output(Sheets("Lan" & Language).Cells(780, 1).Value & Sheets("Mobs").Cells(merci_nr, 1).Value & Sheets("Lan" & Language).Cells(781, 1).Value, 0)
                do_it = text_Output(" " & merci_hind, 0, 45)
                do_it = text_Output(Sheets("Lan" & Language).Cells(782, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(783, 1).Value & Sheets("Mobs").Cells(merci_nr, 1).Value & ".)", 1)
                 
                Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 5).Value = merci_nr
                do_it = Joonista_asukoht(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 0, 10)
        
        End If
        

Else
        do_it = text_Output("", 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(785, 1).Value & eesti_nimi(Sheets("Mobs").Cells(merci_nr, 1).Value, 1) & Sheets("Lan" & Language).Cells(786, 1).Value, 0)
        
        If Language = 1 Then
        do_it = text_Output(merci_hind & " ", 0, 45)
        End If
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(787, 1).Value, 0)
        
        do_it = text_Output(eesti_nimi(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 4).Value, 1), 0)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(789, 1).Value, 0)
        
        If Language = 2 Then
        do_it = text_Output(merci_hind & " ", 0, 45)
        End If
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(788, 1).Value, 1)
        
        
        
        'algab mobi statside displamine
        do_it = display_mob_stats(merci_nr)
        
        Sheets("Game_data1").Cells(167, 2).Value = mitmes
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_u_defender", 0, 1)
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_u_defender", 0, 1)

End If

If true_train = 1 Then
        If training_succeeded = 1 Then
                If Sheets("Game_data1").Cells(15, 2).Value <> 1 Then
                        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
                End If
        End If
        do_it = display_status(2)
        do_it = Main_turn
End If

End Function
Function land_recruit(Optional true_train As Integer = 0)

Dim merci_nr As Integer
Dim what_player As Integer
Dim merci_hind As Integer
Dim z As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

what_player = Sheets("Game_data1").Cells(10, 2).Value
merci_nr = find_mob_by_name(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 46).Value)


merci_hind = Sheets("Mobs").Cells(merci_nr, 31).Value * 20

If true_train = 1 Then

        If Sheets("Game_data1").Cells(24 + what_player, 2).Value < merci_hind Then
                                        
                do_it = text_Output(Sheets("Lan" & Language).Cells(70, 1).Value, 1)
                                        
        Else
                If Sheets("Game_data1").Cells(46 + what_player, 2).Value >= 20 Then
                       do_it = text_Output(Sheets("Lan" & Language).Cells(145, 1).Value, 1)
                Else
                        do_it = Add_new_mob(what_player, merci_nr)
                        
                        Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - merci_hind
                        
                        do_it = text_Output(Sheets("Mobs").Cells(merci_nr, 1).Value & Sheets("Lan" & Language).Cells(790, 1).Value, 0)
                        
                        'vähendame recruitablesi
                        For z = 1 To 34
                                If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 1).Value = Sheets("Game_map").Cells(z, 1).Value Then
                                        Sheets("Game_map").Cells(z, 47).Value = Sheets("Game_map").Cells(z, 47).Value - 1
                                End If
                        Next
                        
                        If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 47).Value > 0 Then
                                do_it = text_Output(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 47).Value & Sheets("Lan" & Language).Cells(791, 1).Value, 1)
                        Else
                                do_it = text_Output(Sheets("Lan" & Language).Cells(792, 1).Value, 1)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(793, 1).Value, 1)
                        End If
                
                        If Sheets("Game_data1").Cells(15, 2).Value <> 1 Then
                                Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
                        End If
                
                End If
                
                
        
        End If

Else
        do_it = text_Output("", 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(794, 1).Value & eesti_nimi(Sheets("Mobs").Cells(merci_nr, 1).Value, 1) & Sheets("Lan" & Language).Cells(795, 1).Value, 0)

        do_it = text_Output(merci_hind & " ", 0, 45)
        do_it = text_Output(Sheets("Lan" & Language).Cells(796, 1).Value, 1)
        
        'algab mobi statside displamine
        do_it = display_mob_stats(merci_nr)
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_l_recruit", 0, 1)
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_l_recruit", 0, 1)

End If

If true_train = 1 Then
        do_it = display_status(2)
        do_it = Main_turn
        
End If

End Function
Function set_up_arcane_tower(ruut As Integer)
Dim what_player As Integer
Dim x As Integer
Dim counter As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(127, 1).Value

counter = 0

If Sheets("Game_map").Cells(ruut, 2).Value = 0 Then
        do_it = Add_new_mob(5, find_mob_by_name(Sheets("Lan" & Language).Cells(127, 1).Value), 1, 0, 1)
Else
        'who owns the tower
        what_player = Sheets("Game_map").Cells(ruut, 2).Value
        
        'lets check for other arcane towers player might own
        For x = 1 To 34
                If Sheets("Game_map").Cells(x, 2).Value = what_player And Sheets("Game_map").Cells(x, 1).Value = 20 Then
                        counter = counter + 1
                End If
        Next
        
        If counter = 1 Then
                do_it = Add_new_mob(5, find_mob_by_name(Sheets("Lan" & Language).Cells(127, 1).Value), 1, 0, 1)
        End If
        
        If counter = 2 Then
                do_it = Add_new_mob(5, find_mob_by_name(Sheets("Lan" & Language).Cells(128, 1).Value), 1, 0, 1)
        End If
        
        If counter = 3 Then
                do_it = Add_new_mob(5, find_mob_by_name(Sheets("Lan" & Language).Cells(129, 1).Value), 1, 0, 1)
        End If
        
        If counter = 4 Then
                do_it = Add_new_mob(5, find_mob_by_name(Sheets("Lan" & Language).Cells(130, 1).Value), 1, 0, 1)
        End If
        
End If

do_it = Add_new_mob(5, find_mob_by_name(Sheets("Lan" & Language).Cells(131, 1).Value))

End Function
Function arcane_tower()
Dim what_player As Integer
Dim place_name As String
Dim one_time As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value


what_player = Sheets("game_data1").Cells(10, 2).Value
one_time = 0


For x = 1 To 34
        If Sheets("game_map").Cells(x, 1).Value > 1 And Sheets("game_map").Cells(x, 1).Value < 20 Then
                place_name = Sheets("Map_defaults").Cells(find_land_by_name(Sheets("game_map").Cells(x, 4).Value), 2).Value
                
                If one_time = 0 Then
                        one_time = 1
                        do_it = text_Output(Sheets("Lan" & Language).Cells(797, 1).Value, 1)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(798, 1).Value, 1)
                End If
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(799, 1).Value & eesti_nimi(place_name, 6), "teleport_" & x, 0, 1)
        End If
Next

End Function
Function teleport_to(place_nr As Integer)
Dim what_player As Integer
what_player = Sheets("game_data1").Cells(10, 2).Value

do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)
do_it = clean_worm_tail(what_player)

Sheets("Game_data1").Cells(212, 2).Value = Sheets("game_data1").Cells(5 + what_player, 2).Value

do_it = Joonista_asukoht(place_nr, Sheets("Game_data1").Cells(212, 2).Value, what_player)



Sheets("game_data1").Cells(5 + what_player, 2).Value = place_nr
Sheets("game_data1").Cells(51, 2).Value = 0


do_it = maandus_ruudule()

End Function

Function outfit_shop(what_shop As Integer)
Dim y As Integer
Dim item As Integer
Dim item_Type As Integer
Dim min_Value As Integer
Dim max_Value As Integer

item = 0

min_Value = 25 'this leaves the knife out
max_Value = 10000

If (what_shop = 2) Then 'Shop
        item_Type = random_itemtype_based_on_value(min_Value, max_Value, 4, 5, 6, 7, 8, 9)
        item = create_item(item_Type, min_Value, max_Value)
End If

If (what_shop = 3) Then 'Smithy
        item_Type = random_itemtype_based_on_value(min_Value, max_Value, 1, 2, 3, 4, 5, 6)
        item = create_item(item_Type, min_Value, max_Value)
End If

If (what_shop = 4) Then 'Bazaar
        max_Value = 400
        item_Type = random_itemtype_based_on_value(min_Value, max_Value)
        item = create_item(item_Type, min_Value, max_Value)
End If

If (what_shop = 5) Then 'Library
        item_Type = random_itemtype_based_on_value(min_Value, max_Value, 9)
        item = create_item(item_Type, min_Value, max_Value)
End If

If (what_shop = 6) Then 'Mage Guild
        y = Int(Rnd * 6 + 1)
        If y < 5 Then
                item_Type = random_itemtype_based_on_value(min_Value, max_Value, 9)
        Else
                item_Type = random_itemtype_based_on_value(min_Value, max_Value, 7, 8)
        End If
        item = create_item(item_Type, min_Value, max_Value)
End If
        
      If (item <> 0) Then
      
      Sheets("Game_data1").Cells(166 + what_shop, 2).Value = Sheets("Game_data1").Cells(166 + what_shop, 2).Value + 1
      Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(166 + what_shop, 2).Value, 11 + what_shop).Value = item
      
      End If
End Function

Function random_itemtype_based_on_value(items_begin_at_value As Integer, items_end_at_value As Integer, Optional item_type1 As Integer = 0, Optional item_type2 As Integer = 0, _
Optional item_type3 As Integer = 0, Optional item_type4 As Integer = 0, Optional item_type5 As Integer = 0, Optional item_type6 As Integer = 0, Optional item_type7 As Integer = 0, _
Optional item_type8 As Integer = 0, Optional item_type9 As Integer = 0) As Integer

Dim listi_Counter As Integer
Dim z As Integer
Dim kas_Sobib As Integer
Dim max_item_Types As Integer

random_itemtype_based_on_value = 0

max_item_Types = 0

Sheets("nupud").Cells(1, 20).Value = item_type1
Sheets("nupud").Cells(2, 20).Value = item_type2
Sheets("nupud").Cells(3, 20).Value = item_type3
Sheets("nupud").Cells(4, 20).Value = item_type4
Sheets("nupud").Cells(5, 20).Value = item_type5
Sheets("nupud").Cells(6, 20).Value = item_type6
Sheets("nupud").Cells(7, 20).Value = item_type7
Sheets("nupud").Cells(8, 20).Value = item_type8
Sheets("nupud").Cells(9, 20).Value = item_type9


If item_type1 = 0 Then

        For z = 1 To 9
                max_item_Types = max_item_Types + 1
                Sheets("nupud").Cells(max_item_Types, 19).Value = z
        Next
Else
        For z = 1 To 9
                If Sheets("nupud").Cells(z, 20).Value <> 0 Then
                        max_item_Types = max_item_Types + 1
                        Sheets("nupud").Cells(max_item_Types, 19).Value = Sheets("nupud").Cells(z, 20).Value
                End If
        Next

End If



For z = 1 To max_item_Types
                
        kas_Sobib = check_item_type_eligibility(Sheets("nupud").Cells(z, 19).Value, items_begin_at_value, items_end_at_value)
        If kas_Sobib > 0 Then
                listi_Counter = listi_Counter + 1
                Sheets("nupud").Cells(listi_Counter, 20).Value = Sheets("nupud").Cells(z, 19).Value
        End If
        
Next
If listi_Counter > 0 Then
        random_itemtype_based_on_value = Sheets("nupud").Cells(Int(listi_Counter * Rnd + 1), 20).Value
End If
End Function


Function check_item_type_eligibility(item_Type As Integer, items_begin_at_value As Integer, items_end_at_value As Integer) As Integer
check_item_type_eligibility = 0
Dim x As Integer


'scrollib itemtyybi itemid läbi
'fori sees on if mis kontrollib iga itemi valuet ja kui see on aktsepteeritud vahemikus siis
' check_item_type_eligibility = 1
'Sheets("Game_data1").Cells(175 + itemtype, 2).Value + x - 1 = x.koord
        
For x = 1 To Sheets("Game_data1").Cells(157 + item_Type, 2).Value
        
        If Sheets("items").Cells(Sheets("Game_data1").Cells(175 + item_Type, 2).Value + x - 1, 5).Value >= items_begin_at_value And Sheets("items").Cells(Sheets("Game_data1").Cells(175 + item_Type, 2).Value + x - 1, 5).Value <= items_end_at_value Then
                check_item_type_eligibility = 1
        End If

Next

End Function


Function what_damage_type(type_nr As Integer, Optional type_output As Integer = 0) As String

what_damage_type = "Error on damage type"
Sheets("Game_data1").Cells(21, 2).Value = 1

Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

If (type_nr = -1) Then
    what_damage_type = Sheets("Lan" & Language).Cells(852, 1).Value
        If (type_output = 1) Then
        what_damage_type = Sheets("Lan" & Language).Cells(853, 1).Value
        End If
        If (type_output = 2) Then
        what_damage_type = Sheets("Lan" & Language).Cells(854, 1).Value
        End If
        If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(855, 1).Value
        End If
        
End If


If (type_nr = 0) Then
    what_damage_type = Sheets("Lan" & Language).Cells(83, 1).Value
        If (type_output = 1) Then
        what_damage_type = Sheets("Lan" & Language).Cells(80, 1).Value
        End If
        If (type_output = 2) Then
        what_damage_type = Sheets("Lan" & Language).Cells(81, 1).Value
        End If
        If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(82, 1).Value
        End If
        
End If
If (type_nr = 1) Then
    what_damage_type = Sheets("Lan" & Language).Cells(84, 1).Value
        If (type_output = 1) Then
        what_damage_type = Sheets("Lan" & Language).Cells(85, 1).Value
        End If
        If (type_output = 2) Then
        what_damage_type = Sheets("Lan" & Language).Cells(86, 1).Value
        End If
        If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(87, 1).Value
        End If
        
        If (type_output = 4) Then
        what_damage_type = Sheets("Lan" & Language).Cells(237, 1).Value
        End If
        
End If
If (type_nr = 2) Then
    what_damage_type = Sheets("Lan" & Language).Cells(88, 1).Value
        If (type_output = 1) Then
        what_damage_type = Sheets("Lan" & Language).Cells(89, 1).Value
        End If
        If (type_output = 2) Then
        what_damage_type = Sheets("Lan" & Language).Cells(90, 1).Value
        End If
        If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(91, 1).Value
        End If
        If (type_output = 4) Then
        what_damage_type = Sheets("Lan" & Language).Cells(238, 1).Value
        End If
End If
If (type_nr = 3) Then
    what_damage_type = Sheets("Lan" & Language).Cells(92, 1).Value
        If (type_output = 1) Then
        what_damage_type = Sheets("Lan" & Language).Cells(93, 1).Value
        End If
        If (type_output = 2) Then
        what_damage_type = Sheets("Lan" & Language).Cells(94, 1).Value
        End If
        If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(95, 1).Value
        End If
        If (type_output = 4) Then
        what_damage_type = Sheets("Lan" & Language).Cells(239, 1).Value
        End If
End If

If (type_nr = 4) Then 'Fire
    what_damage_type = Sheets("Lan" & Language).Cells(96, 1).Value
    Sheets("Game_data1").Cells(21, 2).Value = 3
    If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(97, 1).Value
    End If
    
    If (type_output = 4) Then
        what_damage_type = Sheets("Lan" & Language).Cells(232, 1).Value
    End If
    
    If (type_output = 5) Then
        what_damage_type = Sheets("Lan" & Language).Cells(285, 1).Value
    End If
    
    
End If
        
If (type_nr = 5) Then 'Earth
    what_damage_type = Sheets("Lan" & Language).Cells(98, 1).Value
    Sheets("Game_data1").Cells(21, 2).Value = 10
    If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(99, 1).Value
    End If
    
    If (type_output = 4) Then
        what_damage_type = Sheets("Lan" & Language).Cells(233, 1).Value
    End If
    
    If (type_output = 5) Then
        what_damage_type = Sheets("Lan" & Language).Cells(286, 1).Value
    End If
    
End If

If (type_nr = 6) Then 'Air
    what_damage_type = Sheets("Lan" & Language).Cells(100, 1).Value
    Sheets("Game_data1").Cells(21, 2).Value = 33
    If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(101, 1).Value
    End If
    
    If (type_output = 4) Then
        what_damage_type = Sheets("Lan" & Language).Cells(234, 1).Value
    End If
    
    If (type_output = 5) Then
        what_damage_type = Sheets("Lan" & Language).Cells(287, 1).Value
    End If
    
End If

If (type_nr = 7) Then 'Water
    what_damage_type = Sheets("Lan" & Language).Cells(102, 1).Value
    Sheets("Game_data1").Cells(21, 2).Value = 17
    If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(103, 1).Value
    End If
    If (type_output = 4) Then
        what_damage_type = Sheets("Lan" & Language).Cells(235, 1).Value
    End If
    If (type_output = 5) Then
        what_damage_type = Sheets("Lan" & Language).Cells(288, 1).Value
    End If
End If

If (type_nr = 8) Then 'death
    what_damage_type = Sheets("Lan" & Language).Cells(104, 1).Value
    Sheets("Game_data1").Cells(21, 2).Value = 25
    If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(105, 1).Value
    End If
End If

If (type_nr = 9) Then 'Life
    what_damage_type = Sheets("Lan" & Language).Cells(106, 1).Value
    Sheets("Game_data1").Cells(21, 2).Value = 15
    If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(107, 1).Value
    End If
End If


If (type_nr = 10) Then 'Arcane
    what_damage_type = Sheets("Lan" & Language).Cells(108, 1).Value
    Sheets("Game_data1").Cells(21, 2).Value = 44
    If (type_output = 3) Then
        what_damage_type = Sheets("Lan" & Language).Cells(109, 1).Value
    End If
End If

If (type_nr = 11) Then 'missile
    what_damage_type = Sheets("Lan" & Language).Cells(110, 1).Value
        If (type_output = 1) Then
            what_damage_type = Sheets("Lan" & Language).Cells(111, 1).Value
        End If
        If (type_output = 2) Then
            what_damage_type = Sheets("Lan" & Language).Cells(112, 1).Value
        End If
        If (type_output = 3) Then
            what_damage_type = Sheets("Lan" & Language).Cells(113, 1).Value
        End If
End If


End Function
Function improve_income_true()

Dim ruut As Integer
Dim what_player As Integer
Dim income_Bonus As Integer
Dim old_income As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

do_it = valiknuppude_Kustutamine()
do_it = text_Output("", 3)

what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
income_Bonus = Int((Sheets("Game_map").Cells(ruut, 7).Value / 2 + 10) / 3 * (4 - Sheets("Game_data1").Cells(84, 2).Value))
                                            
old_income = Sheets("Game_map").Cells(ruut, 6).Value
Sheets("Game_map").Cells(ruut, 6).Value = Sheets("Game_map").Cells(ruut, 6).Value + income_Bonus

If Sheets("Game_map").Cells(ruut, 6).Value > Sheets("Game_map").Cells(ruut, 7).Value * 3 Then
        Sheets("Game_map").Cells(ruut, 6).Value = Sheets("Game_map").Cells(ruut, 7).Value * 3
End If

do_it = text_Output(Sheets("Lan" & Language).Cells(800, 1).Value, 0)
do_it = text_Output(old_income & " ", 0)
do_it = text_Output(Sheets("Lan" & Language).Cells(801, 1).Value, 0)
do_it = text_Output(Sheets("Game_map").Cells(ruut, 6).Value, 0, 5)
do_it = text_Output(Sheets("Lan" & Language).Cells(802, 1).Value, 1)


If Sheets("Game_data1").Cells(84, 2).Value = 1 Then
        If Sheets("Game_map").Cells(ruut, 11).Value < Sheets("Game_map").Cells(ruut, 16).Value * 2 Then
                Sheets("Game_map").Cells(ruut, 11).Value = Sheets("Game_map").Cells(ruut, 11).Value + 1
                do_it = text_Output(Sheets("Lan" & Language).Cells(803, 1).Value, 1)
        End If
End If

Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_map").Cells(ruut, 6).Value 'mingi temp muutuja mis taxi piltlikult vaatab
do_it = Joonista_asukoht(ruut, 0, 12)
do_it = Joonista_asukoht(ruut, 0, 10) 'ja commenti update kah
do_it = display_status(2)

Sheets("Game_data1").Cells(84, 2).Value = 4
do_it = Main_turn()
 
End Function
Sub pillage()
Dim ruut As Integer
Dim what_player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

do_it = text_Output("", 3)

what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value

doit = text_Output(Sheets("Lan" & Language).Cells(804, 1).Value, 0)
doit = text_Output(Sheets("Game_map").Cells(ruut, 6).Value, 0)
doit = text_Output(Sheets("Lan" & Language).Cells(805, 1).Value, 1)

'raha juurde
Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value + Sheets("Game_map").Cells(ruut, 6).Value

Sheets("Game_map").Cells(ruut, 6).Value = 0
Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_map").Cells(ruut, 6).Value 'mingi temp muutuja mis taxi piltlikult vaatab
do_it = Joonista_asukoht(ruut, 0, 12)
do_it = Joonista_asukoht(ruut, 0, 10) 'ja commenti update kah

Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1 '+1 round
do_it = Main_turn()

End Sub

Function greeting_from_enemy_land()
Dim nimi As String
Dim tiitel As String
Dim castles_Owner As Integer
Dim full_nimi As String
Dim what_player As Integer
Dim ruut As Integer
Dim Land_type As Integer
Dim land_Name As String
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value


what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
Land_type = Sheets("Game_map").Cells(ruut, 1).Value
land_Name = Sheets("Map_defaults").Cells(find_land_by_name(Sheets("Game_map").Cells(ruut, 4).Value), 2).Value

castles_Owner = Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 2).Value
tiitel = title_name(castles_Owner)
nimi = Sheets("Game_data1").Cells(10 + castles_Owner, 2).Value

If tiitel = "" Then

        full_nimi = nimi
Else
        full_nimi = tiitel & " " & nimi
End If
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(820, 1).Value, 0)
        do_it = text_Output(eesti_nimi(land_Name, 6), 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(821, 1).Value, 0)
        
        doit = text_Output(full_nimi, 0, Sheets("Game_data1").Cells(105 + castles_Owner, 2).Value)
        do_it = text_Output(Sheets("Lan" & Language).Cells(822, 1).Value, 1)
        
        If Land_type = 20 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(823, 1).Value, 1)
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(824, 1).Value, 1)
        End If

do_it = display_status(2)
        
End Function

Function greeting_from_castle()
Dim nimi As String
Dim tiitel As String
Dim castles_Owner As Integer
Dim full_nimi As String
Dim what_side As Integer
Dim bonus As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_side = Sheets("Game_data1").Cells(10, 2).Value

castles_Owner = Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 2).Value

If castles_Owner <> 5 Then 'kui ei ole independent
        tiitel = title_name(castles_Owner)
        
        nimi = Sheets("Game_data1").Cells(10 + castles_Owner, 2).Value
        
        
        If tiitel = "" Then
                full_nimi = nimi
        Else
                full_nimi = tiitel & " " & nimi
        End If
End If

If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 12).Value = 1 Then
        doit = text_Output(Sheets("Lan" & Language).Cells(825, 1).Value, 0)
End If

If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 12).Value = 2 Then
        doit = text_Output(Sheets("Lan" & Language).Cells(826, 1).Value, 0)
End If

If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 12).Value = 3 Then
        doit = text_Output(Sheets("Lan" & Language).Cells(827, 1).Value, 0)
        doit = text_Output(LCase(eesti_nimi(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 13).Value, 7)), 0, 53)
        doit = text_Output(Sheets("Lan" & Language).Cells(828, 1).Value, 1)
        doit = text_Output(Sheets("Lan" & Language).Cells(829, 1).Value, 0)
End If
        
If castles_Owner <> 5 Then
        doit = text_Output(full_nimi, 0, Sheets("Game_data1").Cells(105 + castles_Owner, 2).Value)
        
        If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 12).Value = 3 Then
                doit = text_Output(Sheets("Lan" & Language).Cells(832, 1).Value, 1)
        Else
                doit = text_Output(Sheets("Lan" & Language).Cells(830, 1).Value, 1)
        End If
        
        
Else
        doit = text_Output(Sheets("Lan" & Language).Cells(831, 1).Value, 1)
End If

        
'ja combat läheb peale

do_it = Fight_player_land()


End Function

Function give_active_land_ownership_to_player(what_side As Integer, Optional another_land As Integer = 0)
Dim x As Integer
Dim y As Integer
Dim active_Land As Integer
Dim Land_type As Integer
Dim land_Name As String
Dim last_Owner As Integer
Dim what_player As Integer
Dim z As Integer
Dim buildingu_nr As Integer
Dim mitmes_game_mapis As Integer
Dim text_Out As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
text_Out = 1
'läheb moment ainult active playerile
what_player = Sheets("Game_data1").Cells(10, 2).Value

If another_land = 0 Then
        active_Land = Sheets("Game_data1").Cells(5 + what_player, 2).Value
Else
        active_Land = another_land
End If

Land_type = Sheets("Game_map").Cells(active_Land, 1).Value
land_Name = Sheets("Game_map").Cells(active_Land, 4).Value
last_Owner = Sheets("Game_map").Cells(active_Land, 2).Value

If another_land = 0 Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(833, 1).Value, 1)
End If

If (Sheets("Game_map").Cells(active_Land, 12).Value > 0) Then
'siis on tegemist castliga
        one_time_bonus = 0
        For x = 1 To 34
                
                If Sheets("Game_map").Cells(x, 1).Value = Land_type Then
                         
                        'mana buildings
                        text_Out = 0
                        If x <> active_Land Then
                                do_it = mana_buildings(x, what_player, last_Owner, text_Out)
                        End If
                        
                        If one_time_bonus = 0 Then
                                one_time_bonus = 1
                                
                                For z = 1 To Sheets("Game_data1").Cells(174, 2).Value + 8
                                        If Sheets("Game_map").Cells(35, 17 + z).Value <> "" And Sheets("Game_map").Cells(x, 17 + z).Value > 0 Then
                                                
                                                buildingu_nr = find_building_by_name(Sheets("Game_map").Cells(35, 17 + z).Value)
                                                
                                                'moment ei display me castlite ülevõtmise puhul managa seoses mingit teksi
                                                        do_it = building_bonus_to_player(what_player, land_Name, buildingu_nr, 1, 1, 0, 1)
                                                        do_it = building_bonus_to_player(last_Owner, land_Name, buildingu_nr, 0)
                                                
                                                
                                        End If
                                Next
                        End If
                        'landcount teisel vähemaks
                        If last_Owner > 0 Then
                                Sheets("Game_data1").Cells(63 + Sheets("Game_map").Cells(x, 2).Value, 2).Value = Sheets("Game_data1").Cells(63 + Sheets("Game_map").Cells(x, 2).Value, 2).Value - 1
                        End If
                        
                        
                        Sheets("Game_map").Cells(x, 2).Value = what_player
                        
                        Sheets("Game_data1").Cells(63 + what_player, 2).Value = Sheets("Game_data1").Cells(63 + what_player, 2).Value + 1
                        
                        do_it = titles_check(3)
                        do_it = titles_check(1)
                        
                        do_it = display_status(1)
                        do_it = display_status(2) 'player comment update
                        
                        do_it = Joonista_asukoht(x, 0, 6)
                        do_it = Joonista_asukoht(x, 0, 10)
                        do_it = Joonista_asukoht(x, 0, 12)
                        do_it = Joonista_asukoht(x, 0, 11)
        
                        

                End If
        
        Next
Else
         
        If last_Owner > 0 Then
        
                Sheets("Game_data1").Cells(63 + Sheets("Game_map").Cells(active_Land, 2).Value, 2).Value = Sheets("Game_data1").Cells(63 + Sheets("Game_map").Cells(active_Land, 2).Value, 2).Value - 1
        
                If (Sheets("Game_map").Cells(active_Land, 1).Value = 20) Then
                       do_it = tower_check(last_Owner, 1)
                End If
                
        End If
        
        do_it = mana_buildings(active_Land, what_player, last_Owner, text_Out)
        
        Sheets("Game_map").Cells(active_Land, 2).Value = what_player
        
        If Land_type = 20 Then
                do_it = tower_check(what_player, 0)
        End If
        
        Rem ja muudame ka värvi ära (Maaala_active playeri värvi)
        
        
        
        
        Rem Aktiivsele mängijale 1 land juurde
        Sheets("Game_data1").Cells(63 + what_player, 2).Value = Sheets("Game_data1").Cells(63 + what_player, 2).Value + 1
        
        do_it = titles_check(1)
        
        do_it = display_status(1)
        do_it = display_status(2) 'player comment update
        
        
        do_it = Joonista_asukoht(active_Land, 0, 6)
        do_it = Joonista_asukoht(active_Land, 0, 12)
        do_it = Joonista_asukoht(active_Land, 0, 10) 'kommenti update maa-alal


End If

If another_land = 0 Then
        Sheets("Game_data1").Cells(88, 2).Value = 4 'Land on nyyd sybralik
End If

End Function
Function mana_buildings(Land_Nr As Integer, what_player As Integer, Optional last_Owner As Integer = 0, Optional text_Output As Integer = 0)
Dim z As Integer
Dim active_Land As Integer
Dim land_Name As String
Dim buildingu_nr As Integer

Land_type = Sheets("Game_map").Cells(Land_Nr, 1).Value
land_Name = Sheets("Game_map").Cells(Land_Nr, 4).Value


For z = 1 To Sheets("Game_data1").Cells(174, 2).Value + 8
        If Sheets("Game_map").Cells(35, 17 + z).Value = "Fire mana" _
        Or Sheets("Game_map").Cells(35, 17 + z).Value = "Earth mana" _
        Or Sheets("Game_map").Cells(35, 17 + z).Value = "Water mana" _
        Or Sheets("Game_map").Cells(35, 17 + z).Value = "Air mana" _
        Or Sheets("Game_map").Cells(35, 17 + z).Value = "Life mana" _
        Or Sheets("Game_map").Cells(35, 17 + z).Value = "Death mana" _
        Or Sheets("Game_map").Cells(35, 17 + z).Value = "Arcane mana" Then
        
                If Sheets("Game_map").Cells(Land_Nr, 17 + z).Value > 0 Then
                
                        buildingu_nr = find_building_by_name(Sheets("Game_map").Cells(35, 17 + z).Value)
                        
                        do_it = building_bonus_to_player(what_player, land_Name, buildingu_nr, 1, text_Output, 1)
                        
                        If last_Owner > 0 Then
                                do_it = building_bonus_to_player(last_Owner, land_Name, buildingu_nr, 0)
                        End If
                End If
        End If
Next

End Function
Function rest_and_heal_True()
        Dim what_player As Integer
        Dim x As Integer
        Dim z As Integer
        Dim rest_Bonus As Integer
        Dim Language As Integer
        Language = Sheets("Game_data1").Cells(100, 2).Value
        'Sheets("Lan" & Language).Cells(9, 1).Value
        what_player = Sheets("Game_data1").Cells(10, 2).Value
        
        ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
        
        
        rest_Bonus = (Sheets("Game_map").Cells(ruut, 11).Value + sanctuary_Check(what_player)) / 3 * (4 - Sheets("Game_data1").Cells(84, 2).Value)
                
                doit = text_Output("", 3)
                doit = text_Output(Sheets("Lan" & Language).Cells(834, 1).Value, 0)
                doit = text_Output("+" & rest_Bonus, 0, 4)
                doit = text_Output(Sheets("Lan" & Language).Cells(835, 1).Value, 1)
                For x = 1 To Sheets("Game_data1").Cells(46 + what_player, 2).Value
                Sheets("Side" & what_player).Cells(x, 2).Value = Sheets("Side" & what_player).Cells(x, 2).Value + rest_Bonus
                
                        If Sheets("Side" & what_player).Cells(x, 2).Value > Sheets("Side" & what_player).Cells(x, 3).Value Then
                                Sheets("Side" & what_player).Cells(x, 2).Value = Sheets("Side" & what_player).Cells(x, 3).Value
                        End If
                
                Next
                Sheets("Game_data1").Cells(84, 2).Value = 4
                do_it = display_status(2)
                do_it = Main_turn()

End Function

Function sanctuary_Check(what_player As Integer) As Integer

Dim z As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

sanctuary_Check = 0

For z = 1 To 34
        If Sheets("Game_map").Cells(z, 2).Value = what_player Then
                If Sheets("Game_map").Cells(z, find_building_slot_in_map(Sheets("Lan" & Language).Cells(78, 1).Value)).Value = 1 Then
                        'sanctuary_Check = sanctuary_Check + 1 'liiga palju elu
                        sanctuary_Check = 1
                End If
        End If
Next

End Function
Function buy_land()

Dim x As Integer
Dim y As Integer
Dim what_player As Integer
Dim active_Land As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output("", 3)


what_player = Sheets("Game_data1").Cells(10, 2).Value
active_Land = Sheets("Game_data1").Cells(5 + what_player, 2).Value
Sheets("Game_data1").Cells(89, 2).Value = 0 'ostmisvõimalus on lännu

Rem ja see võtab terve käigu
Sheets("Game_data1").Cells(84, 2).Value = 4

do_it = mana_buildings(active_Land, what_player, 0, 1)

Rem ownership muutub
Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 2).Value = Sheets("Game_data1").Cells(10, 2).Value

Rem raha vähemaks
Sheets("Game_data1").Cells(24 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value = Sheets("Game_data1").Cells(24 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value - Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 3).Value

If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 1).Value = 20 Then
'arcane tower
do_it = tower_check(what_player, 0)

End If

Rem ja muudame ka värvi ära (Maaala_active playeri värvi)
y = 6
x = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
do_it = Joonista_asukoht(x, 0, y)
do_it = Joonista_asukoht(x, 0, 12)
do_it = Joonista_asukoht(x, 0, 10) 'commenti muutus


        doit = text_Output(Sheets("Lan" & Language).Cells(121, 1).Value, 0)
        doit = text_Output(Sheets("Game_data1").Cells(24 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 0)
        doit = text_Output(Sheets("Lan" & Language).Cells(122, 1).Value, 1)
       

Sheets("Game_data1").Cells(63 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value = Sheets("Game_data1").Cells(63 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value + 1

do_it = titles_check(3)
do_it = titles_check(1)

do_it = display_status(1)
do_it = display_status(2) 'player comment update

do_it = Main_turn()


End Function


Function tower_check(what_player As Integer, lost_tower As Integer)
Dim counter As Integer
Dim x As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

counter = 0

        For x = 1 To 34
                If Sheets("Game_map").Cells(x, 2).Value = what_player And Sheets("Game_map").Cells(x, 1).Value = 20 Then
                        counter = counter + 1
                End If
        Next
                
        If lost_tower = 0 Then
                If counter = 1 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(132, 1).Value, 0)
                Else
                        do_it = text_Output(Sheets("Lan" & Language).Cells(133, 1).Value, 0)
                End If
        End If
                
        If counter = 1 Then 'playeri esimene tower
                If lost_tower = 0 Then
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value + 1
                Else
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value - 1
                End If
        End If
        
        If counter = 2 Then 'teine
                If lost_tower = 0 Then
                        do_it = text_Output("3 ", 0)
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value + 2
                Else
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value - 2
                End If
        End If
        
        If counter = 3 Then
                If lost_tower = 0 Then
                        do_it = text_Output("6 ", 0)
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value + 3
                Else
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value - 3
                End If
        End If
        
        If counter = 4 Then
                If lost_tower = 0 Then
                        do_it = text_Output("12 ", 0)
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value + 6
                Else
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 29).Value - 6
                End If
        End If
        
        If lost_tower = 0 Then
                do_it = text_Output(what_damage_type(10), 0, Sheets("Game_data1").Cells(21, 2).Value)
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(134, 1).Value, 1)
                
                
        End If

End Function
Function title_name(what_player As Integer) As String
Dim Language As Integer
Dim z As Integer
Dim gender As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
title_name = ""
do_it = titles_check(3)

title_name = ""
       
If what_player > 0 And what_player < 5 Then

        gender = Sheets("Game_data1").Cells(252 + what_player, 2).Value
        
        For z = 1 To 3
                If Sheets("Game_data1").Cells(124 + what_player, 2).Value = z Then
                        title_name = Sheets("Lan" & Language).Cells(805 + z + (gender * 3), 1).Value
                End If
        Next

End If

End Function


Function titles_check(what_to_do As Integer, Optional player As Integer = 0)
Dim what_player As Integer
Dim y As Integer
Dim z As Integer
Dim Language As Integer
Dim salary_size As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

If (what_to_do = 1) Then

        do_it = titles_check(3)
        
        For z = 1 To 3
                
                If Sheets("Game_data1").Cells(63 + what_player, 2).Value = Sheets("Game_data1").Cells(76 + z, 2).Value Then
                
                        doit = text_Output(Sheets("Lan" & Language).Cells(812, 1).Value, 0)
                        doit = text_Output(Sheets("Game_data1").Cells(76 + z, 2).Value, 0)
                        doit = text_Output(Sheets("Lan" & Language).Cells(813, 1).Value, 0)
                        
                        doit = text_Output(Sheets("Lan" & Language).Cells(814, 1).Value, 0)
                        
                        If Language = 1 Then
                                do_it = text_Output(title_name(what_player) & Chr(39) & "s", 0, 10 + z)
                        End If
                        
                        If Language = 2 Then
                                do_it = text_Output(eesti_nimi(title_name(what_player), 1), 0, 10 + z)
                        End If
                        
                        
                        doit = text_Output(Sheets("Lan" & Language).Cells(815, 1).Value, 0)
                        
                        doit = text_Output(Sheets("Game_data1").Cells(73 + z, 2).Value, 0, 5)
                        doit = text_Output(Sheets("Lan" & Language).Cells(816, 1).Value, 1)
                        
                        If Sheets("Game_data1").Cells(188 + (z * 4) + what_player, 2).Value = 0 Then
                            
                            do_it = kings_gift(z)
                            
                            Sheets("Game_data1").Cells(188 + (z * 4) + what_player, 2).Value = 1
                            
                        End If
                
                End If
        Next
    
End If

If (what_to_do = 2) Then 'payroll

        do_it = titles_check(3)
        
        ' Z is the title
        For z = 0 To 3
                If Sheets("Game_data1").Cells(124 + what_player, 2).Value = z Then
                        
                        If z = 0 Then
                                salary_size = 20
                        Else
                                salary_size = Sheets("Game_data1").Cells(73 + z, 2).Value
                        End If
                        
                Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value + salary_size
                
                doit = text_Output(Sheets("Lan" & Language).Cells(817, 1).Value, 0)
                
                do_it = text_Output(" " & salary_size, 0, 5)
                
                doit = text_Output(Sheets("Lan" & Language).Cells(818, 1).Value, 0)
                
                If z > 0 Then
                
                        If Language = 1 Then
                                do_it = text_Output(title_name(what_player) & Chr(39) & "s", 0)
                        End If
                        
                        If Language = 2 Then
                                do_it = text_Output(eesti_nimi(title_name(what_player), 1), 0)
                        End If
                        
                        do_it = text_Output(" ", 0)
                End If
                
                        doit = text_Output(Sheets("Lan" & Language).Cells(819, 1).Value, 1)
                End If
        Next
        
End If
Rem Selgita tiitel
If what_to_do = 3 Then
        
        For y = 1 To 4
        
                If player > 0 Then
                        what_player = y
                End If
                
                Sheets("Game_data1").Cells(124 + what_player, 2).Value = 0
        
                For z = 1 To 3
                        If Sheets("Game_data1").Cells(63 + what_player, 2).Value >= Sheets("Game_data1").Cells(76 + z, 2).Value Then
                                Sheets("Game_data1").Cells(124 + what_player, 2).Value = Sheets("Game_data1").Cells(124 + what_player, 2).Value + 1
                        End If
                Next
        
        Next
        
End If


If (player = 0) Then
        do_it = display_status(1)
End If

End Function
Sub end_turn()

do_it = end_players_turn()

End Sub
Function end_players_turn()
Dim what_side As Integer
Dim x As Integer

what_side = Sheets("Game_data1").Cells(10, 2).Value

Rem kustutame kyik ebavajalikud nupud
do_it = valiknuppude_Kustutamine

'ja maosaba
do_it = clean_worm_tail(what_side)

do_it = text_Output("", 3)

If Sheets("Game_data1").Cells(212, 2).Value > 0 Then 'teleport
        do_it = Joonista_asukoht(Sheets("Game_data1").Cells(212, 2).Value, Sheets("Game_data1").Cells(5 + what_side, 2).Value, what_side)

        Sheets("Game_data1").Cells(5 + what_side, 2).Value = Sheets("Game_data1").Cells(212, 2).Value
        
        Sheets("Game_data1").Cells(212, 2).Value = 0
End If


For x = 1 To 4 'castle portal teleports
        If Sheets("Game_data1").Cells(263 + x, 2).Value <> 0 Then
                do_it = Joonista_asukoht(Sheets("Game_data1").Cells(263 + x, 2).Value, Sheets("Game_data1").Cells(5 + x, 2).Value, x)
                Sheets("Game_data1").Cells(5 + x, 2).Value = Sheets("Game_data1").Cells(263 + x, 2).Value
                Sheets("Game_data1").Cells(263 + x, 2).Value = 0
        End If
Next


do_it = display_status(1)

do_it = display_status(1)
do_it = mobs_display(1)
do_it = playerite_vahetus()



End Function
Function neutrals_reset()
Dim x As Integer
For x = 1 To 34
        Sheets("Game_map").Cells(x, 17).Value = 1
Next

'side5 meeste arv
Sheets("Game_data1").Cells(51, 2).Value = 0
Sheets("Game_data1").Cells(60, 2).Value = 0

End Function


Function Check_add_taxes(Optional player As Integer = 0)
Dim what_player As Integer
Dim z As Integer
Dim bank_owned As Integer
Dim kas_tuleb As Integer

Dim total_tax As Integer
Dim total_taxed_lands As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

bank_owned = 0
'check for owned bank

If player = 0 Then
        what_player = Sheets("Game_data1").Cells(10, 2).Value
Else
        what_player = player
End If

For z = 1 To 34
        If Sheets("Game_map").Cells(z, 2).Value = what_player Then
                If Sheets("Game_map").Cells(z, find_building_slot_in_map(Sheets("Lan" & Language).Cells(77, 1).Value)).Value = 1 Then
                        bank_owned = bank_owned + 1
                End If
        End If
Next
'AJUTINE Temporary
'võtame randimiga sansu kas sellele playerile tuleb recruitablesid juurde
kas_tuleb = Int(Rnd * 100 + 1)
total_tax = 0
total_taxed_lands = 0

For z = 1 To 34

        If Sheets("Game_map").Cells(z, 2).Value = what_player Then
        
                If Sheets("Game_map").Cells(z, 6).Value > 0 Then
                        total_tax = total_tax + Sheets("Game_map").Cells(z, 6).Value
                        total_taxed_lands = total_taxed_lands + 1
                End If
                
                If player = 0 Then
                
                        If Sheets("Game_map").Cells(z, 7).Value > 0 Then
                                If Sheets("Game_map").Cells(z, 6).Value < Sheets("Game_map").Cells(z, 7).Value Then
                                        Sheets("Game_map").Cells(z, 6).Value = Sheets("Game_map").Cells(z, 6).Value + Int(Sheets("Game_map").Cells(z, 7).Value / 4)
                                        If Sheets("Game_map").Cells(z, 6).Value > Sheets("Game_map").Cells(z, 7).Value Then
                                                Sheets("Game_map").Cells(z, 6).Value = Sheets("Game_map").Cells(z, 7).Value
                                        End If
                                        Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_map").Cells(z, 6).Value
                                        do_it = Joonista_asukoht(z, 0, 12)
                                        do_it = Joonista_asukoht(z, 0, 10)
                                End If
                        End If
                
                        If Sheets("Game_map").Cells(z, 46).Value <> 0 And kas_tuleb < 25 Then
                                Sheets("Game_map").Cells(z, 47).Value = Sheets("Game_map").Cells(z, 47).Value + 1
                        End If
                
                End If
        End If
        
Next
If player = 0 Then

        If total_tax > 0 Then
                
                        do_it = text_Output(Sheets("Lan" & Language).Cells(836, 1).Value, 0)
                        do_it = text_Output(" " & total_tax, 0, 45)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(837, 1).Value, 0)
                
                
                If bank_owned > 0 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(838, 1).Value, 0)
                        do_it = text_Output(" " & total_taxed_lands * bank_owned * 10, 0, 10)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(839, 1).Value, 0)
                End If
                o_it = text_Output(".", 1)
        
                Sheets("Game_data1").Cells(24 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value = Sheets("Game_data1").Cells(24 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value + total_tax + total_taxed_lands * bank_owned * 10
        End If

End If

Sheets("Game_data1").Cells(262, 2).Value = total_tax + total_taxed_lands * bank_owned * 10


End Function

Function Greet_player()
Dim Language As Integer
Dim what_player As Integer
Dim tiitel As String
Dim nimi As String
Dim full_nimi As String

Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

tiitel = title_name(what_player)
        
nimi = Sheets("Game_data1").Cells(10 + what_player, 2).Value


If tiitel = "" Then
        full_nimi = nimi
Else
        full_nimi = tiitel & " " & nimi
End If

        If Sheets("Game_data1").Cells(100, 2).Value = 1 Then

                do_it = text_Output("Day ", 0)
                do_it = text_Output(Sheets("Game_data1").Cells(81, 2).Value, 0)
                do_it = text_Output(" for ", 0)
                
                do_it = text_Output(full_nimi, 0, Sheets("Game_data1").Cells(105 + what_player, 2).Value)
                
                do_it = text_Output(".  ", 1)
        
        End If
        
        If Sheets("Game_data1").Cells(100, 2).Value = 2 Then
                
                do_it = text_Output(full_nimi, 0, Sheets("Game_data1").Cells(105 + what_player, 2).Value)
                
                do_it = text_Output(",", 0)
                
                do_it = text_Output(" päev ", 0)
                do_it = text_Output(Sheets("Game_data1").Cells(81, 2).Value, 0)
                do_it = text_Output(".", 1)
        
        End If
        
End Function

Function move_player()

Dim what_player As Integer
Dim asukoht As Integer


do_it = text_Output("", 3)

what_player = Sheets("Game_data1").Cells(10, 2).Value
asukoht = Sheets("Game_data1").Cells(5 + what_player, 2).Value

'vilgutamise lõpetamine

If Sheets("Game_data1").Cells(102, 2).Value = 1 Then
        do_it = Joonista_asukoht(asukoht, 0, what_player, "V2")
        Sheets("Game_data1").Cells(102, 2).Value = 0
End If

Sheets("Game_data1").Cells(103, 2).Value = 0

do_it = valiknuppude_Kustutamine()

Rem ja saabub hommik
Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1

'Ühesuguste arvude veeretamise reset
Sheets("Game_data1").Cells(240, 2).Value = 0
Sheets("Game_data1").Cells(241, 2).Value = 0
Sheets("Game_data1").Cells(242, 2).Value = 0

do_it = liigutamise_veeretus()

End Function

Function liigutamise_veeretus()
Dim X_die As Integer
Dim Y_die As Integer
Dim A_liikumine As Integer

Dim x As Integer
Dim current_Player As Integer
Dim Old_location As Integer
Dim Player_location As Integer
Dim speed_add As Integer
Dim money_bonus As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

current_Player = Sheets("Game_data1").Cells(10, 2).Value
speed_add = 0

'checkime speedi
speed_add = Sheets("Side" & current_Player).Cells(Sheets("Game_data1").Cells(51 + current_Player, 2).Value, 49).Value


Rem Veeretame täringut
X_die = Int((Rnd * (6 + speed_add)) + 1)
Y_die = Int((Rnd * (6 + speed_add)) + 1)

Sheets("Game_data1").Cells(4, 2).Value = X_die
Sheets("Game_data1").Cells(5, 2).Value = Y_die
A_liikumine = X_die + Y_die

do_it = text_Output(Sheets("Lan" & Language).Cells(27, 1).Value, 0)

doit = text_Output(Sheets("Game_data1").Cells(5, 2).Value, 0, 5)

doit = text_Output(Sheets("Lan" & Language).Cells(28, 1).Value, 0)

doit = text_Output(Sheets("Game_data1").Cells(4, 2).Value, 0, 5)

doit = text_Output(".", 1)

If X_die <> Y_die Then
        do_it = additional_movement_modifiers_check(A_liikumine)
Else
        
        doit = text_Output(Sheets("Lan" & Language).Cells(29, 1).Value, 1)
        doit = text_Output(Sheets("Lan" & Language).Cells(30, 1).Value, 1)
        
        Player_location = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
        
        Player_location = Player_location + A_liikumine
        
        If (Player_location > 34) Then
                Player_location = Player_location - 34
        End If
        
        If Sheets("Game_data1").Cells(240, 2).Value > 1 Then
                do_it = Joonista_asukoht(0, Sheets("Game_data1").Cells(240, 2).Value, current_Player)
            Sheets("Game_data1").Cells(240, 2).Value = 0
        End If
        
        do_it = Joonista_asukoht(Player_location, 0, current_Player, "+???+")
        Sheets("Game_data1").Cells(21, 2).Value = Player_location
        Sheets("Game_data1").Cells(240, 2).Value = Player_location
                
        If Sheets("Game_data1").Cells(242, 2).Value > 0 And Sheets("Game_data1").Cells(241, 2).Value = X_die Then
                
                If Sheets("Game_data1").Cells(242, 2).Value = 1 Then
                    doit = text_Output(Sheets("Lan" & Language).Cells(33, 1).Value, 1)
                Else
                    doit = text_Output(Sheets("Lan" & Language).Cells(36, 1).Value, 1)
                End If
                
                
                doit = text_Output(Sheets("Lan" & Language).Cells(34, 1).Value, 0)
                money_bonus = 50 * (Sheets("Game_data1").Cells(242, 2).Value * Sheets("Game_data1").Cells(242, 2).Value)
                doit = text_Output(" " & money_bonus & " ", 0, 45)
                doit = text_Output(Sheets("Lan" & Language).Cells(35, 1).Value, 1)
                
                'raha juurde
                Sheets("Game_data1").Cells(24 + current_Player, 2).Value = Sheets("Game_data1").Cells(24 + current_Player, 2).Value + money_bonus
                do_it = display_status(1)

        End If
        
        If Sheets("Game_data1").Cells(241, 2).Value <> X_die Then
                Sheets("Game_data1").Cells(242, 2).Value = 0
        End If
        
        Sheets("Game_data1").Cells(241, 2).Value = X_die
        Sheets("Game_data1").Cells(242, 2).Value = Sheets("Game_data1").Cells(242, 2).Value + 1
        
        If is_player_ai(current_Player) = 0 Then
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(31, 1).Value, "keep_move_roll", 0, 1)
        Else
                do_it = add_ai_choice(14)
        End If
                
        If is_player_ai(current_Player) = 0 Then
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(32, 1).Value, "roll_move_again", 0, 1)
        Else
                do_it = add_ai_choice(15)
        End If
        
        If is_player_ai(current_Player) = 1 Then
                do_it = Ai_commands(current_Player)
        End If
             
End If



End Function
Function additional_movement_modifiers_check(A_liikumine As Integer)
Dim x As Integer
Dim winds_Counter As Integer
Dim winds_controller As Integer
Dim winds_Strength As Integer
Dim Caster_exists As Integer
Dim caster_side As Integer
Dim caster_pos As Integer
Dim effect_nr As Integer
Dim what_side As Integer


winds_Counter = 0
Caster_exists = 0

For x = 1 To Sheets("Game_data1").Cells(208, 2).Value
        If Sheets("Effects").Cells(x, 7).Value > 0 Then
                winds_Counter = winds_Counter + 1
                winds_controller = Sheets("Effects").Cells(x, 1).Value
                winds_Strength = Sheets("Effects").Cells(x, 7).Value
        End If
Next

If winds_Counter > 0 Then

        If winds_Counter > 1 Then
                doit = text_Output("The winds rage back and forth but nothing really happens!", 1)
                do_it = liiguta_playerit(A_liikumine)
        Else
                Caster_exists = is_id_Target_in_game(winds_controller)
                
                If Caster_exists = 1 Then
                        caster_side = Sheets("Game_data1").Cells(61, 2).Value
                        caster_pos = Sheets("Game_data1").Cells(62, 2).Value
                        
                        do_it = manipulate_check(A_liikumine, caster_side, caster_pos, winds_Strength)
                        
                        
                Else
                        do_it = liiguta_playerit(A_liikumine)
                End If
                
        End If
Else
        
        do_it = liiguta_playerit(A_liikumine)

End If
End Function
Function find_eesti_nimi(nimi As String) As Integer
Dim x As Integer

find_eesti_nimi = 0

For x = 2 To 600 + Sheets("Game_data1").Cells(261, 2).Value
        
        If UCase(Sheets("Lan2").Cells(x, 2).Value) = UCase(nimi) Then
                    find_eesti_nimi = 1
        End If
                
Next

End Function


Function eesti_nimi(nimi As String, mis_kääne As Integer) As String
Dim x As Integer

Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

If Language = 2 Then
        
        'kelle default
        If mis_kääne = 1 Then 'kelle oma
                eesti_nimi = nimi & "i"
        End If
        
        If mis_kääne = 2 Then 'kus
                eesti_nimi = nimi & "is"
        End If
        
        If mis_kääne = 3 Then 'keda, mida
                eesti_nimi = nimi & "it"
        End If
        
        If mis_kääne = 4 Then 'kellest, millest
                eesti_nimi = nimi & "st"
        End If
        
        If mis_kääne = 5 Then 'kellele, millele
                eesti_nimi = nimi & "ile"
        End If
        
        If mis_kääne = 6 Then 'kuhu
                eesti_nimi = nimi & "ule"
        End If
        
        For x = 2 To 600 + Sheets("Game_data1").Cells(261, 2).Value
        
                If UCase(Sheets("Lan2").Cells(x, 2).Value) = UCase(nimi) Then
                        If Sheets("Lan2").Cells(x, 2 + mis_kääne).Value <> "" Then
                                eesti_nimi = Sheets("Lan2").Cells(x, 2 + mis_kääne).Value
                        End If
                End If
                
        Next
Else
        eesti_nimi = nimi
End If

End Function

Function manipulate_check(A_liikumine As Integer, what_side As Integer, who As Integer, winds_Strength As Integer)
Dim target_side As Integer
Dim Player_location As Integer
Dim target_mob As Integer
Dim x As Integer
Dim y As Integer
Dim how_many_buttons As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

skip_buttons = 0
Sheets("Game_data1").Cells(21, 2).Value = 0 'needed for  execute_winds_to_move
Sheets("Game_data1").Cells(22, 2).Value = A_liikumine 'needed for  execute_winds_to_move

target_side = Sheets("Game_data1").Cells(10, 2).Value
target_mob = Sheets("Game_data1").Cells(51 + target_side, 2).Value
        
If target_side = what_side Then

        do_it = text_Output(Sheets("Lan" & Language).Cells(37, 1).Value, 1)

Else
        'resist rolli valem (random (2*power) + 10)
        y = Int(Rnd * (Sheets("Side" & target_side).Cells(target_mob, 13).Value * 2) + 10)
        If Language = 1 Then
                do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
        End If
        
        If Language = 2 Then
                do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(who, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
        End If
        
        
        If y <= winds_Strength Then
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(38, 1).Value, 1)
                
                Sheets("Game_data1").Cells(21, 2).Value = 1
                
                If Language = 1 Then
                        MsgBox (Sheets("Side" & what_side).Cells(who, 1).Value & ", how you want to affect " & Sheets("Game_data1").Cells(10 + target_side, 2).Value & " movement?")
                End If
                
                If Language = 2 Then
                        MsgBox (Sheets("Side" & what_side).Cells(who, 1).Value & ", kuidas sa tahad mõjutada " & eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 1) & " liikumist?")
                End If
                
        Else
                'resists
                do_it = text_Output(Sheets("Lan" & Language).Cells(39, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(40, 1).Value, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(41, 1).Value, 1)
                skip_buttons = 1
        
        End If
        
        
End If

If skip_buttons = 0 Then
        
        Player_location = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
        
        Player_location = Player_location + A_liikumine
        
        If (Player_location > 34) Then
                Player_location = Player_location - 34
        End If

        Sheets("Game_data1").Cells(240, 2).Value = Player_location
        do_it = Joonista_asukoht(Player_location, 0, target_side, "+???+")

        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(42, 1).Value, "wind_affect_minus_1", 0, 1)

        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(43, 1).Value, "wind_affect_0", 0, 1)

        how_many_buttons = 1 + Int(winds_Strength / 3)
        
        If how_many_buttons > 4 Then
                how_many_buttons = 4
        End If
        
        For x = 1 To how_many_buttons
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(44, 1).Value & x & Sheets("Lan" & Language).Cells(45, 1).Value, "wind_affect_" & x, 0, 1)
        Next
        
Else
        do_it = liiguta_playerit(A_liikumine)
End If
        
End Function
Function execute_winds_to_move(move As Integer)
Dim what_side As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
what_side = Sheets("Game_data1").Cells(10, 2).Value

        do_it = text_Output("", 3)
        
        If Sheets("Game_data1").Cells(240, 2).Value > 0 Then
                do_it = Joonista_asukoht(0, Sheets("Game_data1").Cells(240, 2).Value, what_side)
                Sheets("Game_data1").Cells(240, 2).Value = 0
        End If
        
        If Sheets("Game_data1").Cells(21, 2).Value = 1 Then
                MsgBox (Sheets("Game_data1").Cells(10 + what_side, 2).Value & Sheets("Lan" & Language).Cells(46, 1).Value)
        End If
        
        If move <> 0 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(47, 1).Value & Sheets("Game_data1").Cells(22, 2).Value + move & Sheets("Lan" & Language).Cells(48, 1).Value, 1)
        End If
        
        do_it = liiguta_playerit(Sheets("Game_data1").Cells(22, 2).Value + move)
        
End Function

Function keep_after_double()
Dim A_liikumine As Integer
do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()
A_liikumine = Sheets("Game_data1").Cells(4, 2).Value + Sheets("Game_data1").Cells(5, 2).Value

do_it = additional_movement_modifiers_check(A_liikumine)

End Function
Function roll_again()
        do_it = text_Output("", 3)
        do_it = valiknuppude_Kustutamine()
        do_it = liigutamise_veeretus()
End Function
Function liiguta_playerit(A_liikumine As Integer)

Dim x As Integer
Dim current_Player As Integer
Dim Old_location As Integer
Dim Player_location As Integer

Dim big_X_part As Integer 'wormtaili suur X part
Dim small_x_part As Integer 'wormtaili väiksem X part


If Sheets("Game_data1").Cells(15, 2).Value = 1 Then 'Kalevipoeg
        A_liikumine = InputBox("Die_roll", "Rollnr", 34)
End If

current_Player = Sheets("Game_data1").Cells(10, 2).Value

Old_location = 0

Player_location = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value

Player_location = Player_location + A_liikumine

If (Player_location > 34) Then
    do_it = Check_add_taxes()
    do_it = titles_check(2)
    Player_location = Player_location - 34
End If
          
Old_location = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value = Player_location
        
Rem joonistame playeri uue asukoha

big_X_part = A_liikumine / 2
small_x_part = A_liikumine - big_X_part
    
For x = 1 To 34
        If Old_location < Player_location Then
                If x > Old_location And x <= Old_location + small_x_part Then
                        do_it = Joonista_asukoht(x, 0, current_Player, "x")
                End If
                
                If x > Old_location + small_x_part And x < Player_location Then
                        do_it = Joonista_asukoht(x, 0, current_Player, "X")
                End If
        Else
                If x > Old_location Then
                
                        If x > Old_location And x <= Old_location + small_x_part Then
                                do_it = Joonista_asukoht(x, 0, current_Player, "x")
                        Else
                                do_it = Joonista_asukoht(x, 0, current_Player, "X")
                        End If
                End If
                If x < Player_location Then
                        
                        If x < Old_location - 34 + small_x_part Then
                                do_it = Joonista_asukoht(x, 0, current_Player, "x")
                        Else
                                do_it = Joonista_asukoht(x, 0, current_Player, "X")
                        End If
                
                End If
                
        End If
Next

If Player_location = Old_location Then
        Old_location = 0
End If
                        
do_it = Joonista_asukoht(Player_location, Old_location, current_Player)

do_it = maandus_ruudule()

End Function
Function port_in(what_player As Integer)

Dim ruut As Integer

ruut = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value

Sheets("Game_data1").Cells(263 + what_player, 2).Value = Sheets("Game_data1").Cells(5 + what_player, 2).Value

Sheets("Game_data1").Cells(5 + what_player, 2).Value = ruut

do_it = Joonista_asukoht(ruut, Sheets("Game_data1").Cells(263 + what_player, 2).Value, what_player)

do_it = global_detection()
do_it = players_detect_side5(what_player, ruut)

End Function



Function attack_player(what_player As Integer, target_side As Integer)

Dim ruut As Integer

ruut = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()
do_it = mobs_display()

do_it = add_combat(what_player, target_side)

If Sheets("Game_map").Cells(ruut, 2).Value = what_player Then
        do_it = add_combat(5, target_side)
End If

If Sheets("Game_map").Cells(ruut, 2).Value = target_side Then
        do_it = add_combat(5, what_player)
End If

do_it = recalculate_combat_order()
do_it = make_shadow_list_of_combatants
do_it = targeting_global()

End Function
Function global_detection()

Dim x As Integer
Dim z As Integer
Dim ruut As Integer
Dim checkitav_Player As Integer
Dim what_player As Integer
Dim other_player As Integer
Dim land_owner As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value

'algul resetime playerite detectionid
For x = 1 To 5
        Sheets("Fight").Cells(30, x).Value = 0
        Sheets("Fight").Cells(30, x + 5).Value = 0
Next

'checkime kas playerid on aktiivsel ruudul ja teeme default üksteise nägemise listi
For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        
        checkitav_Player = Sheets("Nupud").Cells(x, 4).Value
        
        'kui tsekitav player ise on seal ruudul
        If Sheets("Game_data1").Cells(5 + checkitav_Player, 2).Value = ruut Then
        
                For z = 1 To Sheets("Game_data1").Cells(2, 2).Value
                        
                        other_player = Sheets("Nupud").Cells(z, 4).Value
                        
                        If Sheets("Game_data1").Cells(5 + other_player, 2).Value = ruut Then
                            'lisame samal ruudul olevad playerid listi (fight_sheet)
                               Sheets("fight").Cells(30, checkitav_Player).Value = Sheets("fight").Cells(30, checkitav_Player).Value + 1
                               Sheets("fight").Cells(30 + Sheets("fight").Cells(30, checkitav_Player).Value, checkitav_Player).Value = other_player
                               
                               'flag nulliks- moment nad veel ei näe
                               If checkitav_Player = other_player Then
                                    Sheets("fight").Cells(30 + Sheets("fight").Cells(30, checkitav_Player).Value, checkitav_Player + 5).Value = 2
                               Else
                                    Sheets("fight").Cells(30 + Sheets("fight").Cells(30, checkitav_Player).Value, checkitav_Player + 5).Value = 0
                               End If
                               
                        End If
                        
                Next
                
        End If
        
Next


End Function


Function maandus_ruudule()

Dim x As Integer
Dim z As Integer
Dim ruut As Integer
Dim main_turn_needed As Integer
Dim checkitav_Player As Integer
Dim what_player As Integer
Dim other_player As Integer
Dim land_owner As Integer
Dim Active_player_detected As Integer
Dim player_name As String
Dim long_land_name As String
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value


what_player = Sheets("Game_data1").Cells(10, 2).Value
player_name = Sheets("Game_data1").Cells(10 + what_player, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
long_land_name = Sheets("Map_defaults").Cells(find_land_by_name(Sheets("Game_map").Cells(ruut, 4).Value), 2).Value


Active_player_detected = 0
main_turn_needed = 1






Sheets("Game_data1").Cells(80, 2).Value = 0 '(resettime kas landi rünnati aktiivse mängija poolt)
Sheets("Game_data1").Cells(89, 2).Value = 0 '(resettime kas landi saab osta)


do_it = global_detection()


If (Sheets("Game_map").Cells(ruut, 1).Value = 1) Then
    Rem Royal Court ajutine TEMPORARY
       Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
End If

If (Sheets("Game_map").Cells(ruut, 1).Value = 10) Then
    Rem Mercenary camp
    Rem check tiitel for list, tekitada mercenaride list (list on sheets "nupud" kohal 6)
       Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
       do_it = greeting_from_mercenary_camp()
End If


If (Sheets("Game_map").Cells(ruut, 1).Value = 11) Then
        Rem training ground
       Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
       do_it = greeting_from_training_ground
End If

If (Sheets("Game_map").Cells(ruut, 1).Value = 12) Then

        Rem shrine
       Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
       do_it = greeting_shrine
End If

If (Sheets("Game_map").Cells(ruut, 1).Value = 14) Then
       Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
        do_it = greeting_t_island()
End If

If (Sheets("Game_map").Cells(ruut, 1).Value = 15) Then
        
       Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
        do_it = greeting_dungeon()
End If
If (Sheets("Game_map").Cells(ruut, 1).Value = 13) Then
        
       Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
        do_it = greeting_cave()
End If


If (Sheets("Game_map").Cells(ruut, 1).Value >= 2 And Sheets("Game_map").Cells(ruut, 1).Value <= 6) Then
        'siin player sattus poodi -
        'siin peaks poe inventorile itemeid juurde kirjutama või välja vahetama
        Sheets("Game_data1").Cells(175, 2).Value = Sheets("Game_map").Cells(ruut, 1).Value - 2
        
        'see on aktiivse poe inventory itemite arv
        'Sheets("Game_data1").Cells(166+Sheets("Game_map").Cells(ruut, 1).Value, 2).Value
        
        If Sheets("Game_data1").Cells(166 + Sheets("Game_map").Cells(ruut, 1).Value, 2).Value < 9 Then
                do_it = outfit_shop(Sheets("Game_map").Cells(ruut, 1).Value)
        Else
                Randomize
                x = Int(Rnd * Sheets("Game_data1").Cells(166 + Sheets("Game_map").Cells(ruut, 1).Value, 2).Value + 1)
                                
                do_it = remove_item(5, x)
                do_it = outfit_shop(Sheets("Game_map").Cells(ruut, 1).Value)
                
        End If
        
        do_it = find_land_by_name(Sheets("Game_map").Cells(ruut, 4).Value)
        
        If Language = 1 Then
                doit = text_Output("You can buy and sell stuff here at ", 0)
                doit = text_Output(long_land_name, 0, 5)
                doit = text_Output(".", 1)
        End If
        
        If Language = 2 Then
                doit = text_Output("Siin ", 0)
                doit = text_Output(eesti_nimi(long_land_name, 2), 0, 5)
                doit = text_Output(" saad osta ja müüa asju.", 1)
        End If
        
        If Sheets("Game_map").Cells(ruut, 1).Value = 4 Then 'bazaar
                If Sheets("Game_data1").Cells(243 + what_player, 2).Value > 0 Then
                        do_it = caravan_has_arrived(what_player)
                End If
        End If
        
        Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
        Sheets("Game_data1").Cells(243, 2).Value = 0 'pet shop reset
        
End If


If Sheets("Game_map").Cells(ruut, 1).Value > 19 Then

        'defender lahkus map_datast
        Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 17).Value = 0
        
        'aktiivne mängija näeb team-5-t (land defenders)
        do_it = players_detect_side5(what_player, ruut)
        
        
        If Sheets("Game_map").Cells(ruut, 1).Value = 20 Then
                do_it = set_up_arcane_tower(ruut)
        Else
                If (Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 12) > 0) Then
                'castle, seetõttu defenderid berserkis
                        do_it = Add_new_mob(5, Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 5).Value, 0, 0, 1)
                Else
                        do_it = Add_new_mob(5, Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 5).Value)
                End If
                
        End If
        
        If (Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 12) > 0) Then
                'gate
                do_it = Add_new_mob(5, find_mob_by_name(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 15).Value), 0, 0, 1)
                
                'missile units
                For x = 1 To Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 14).Value
                        do_it = Add_new_mob(5, find_mob_by_name(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 13).Value), 1, 0, 1)
                Next
        
        End If
       
         
        
        do_it = mobs_display()
        
        If (Sheets("Game_map").Cells(ruut, 2).Value = 0) Then
        
                ruut = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
                
                If (Sheets("Game_map").Cells(ruut, 3).Value <= Sheets("Game_data1").Cells(24 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value) Then
     
                    doit = text_Output(Sheets("Lan" & Language).Cells(49, 1).Value, 0)
                    If Language = 1 Then
                            doit = text_Output(long_land_name, 0)
                    End If
                    
                    If Language = 2 Then
                            doit = text_Output(eesti_nimi(long_land_name, 1), 0)
                    End If
                    
                    doit = text_Output(Sheets("Lan" & Language).Cells(50, 1).Value, 0)
                    doit = text_Output(Sheets("Game_map").Cells(ruut, 3).Value, 0, 45)
                    doit = text_Output(Sheets("Lan" & Language).Cells(51, 1).Value, 0)
                    doit = text_Output(Sheets("Lan" & Language).Cells(52, 1).Value, 0)
                    doit = text_Output(Sheets("Game_data1").Cells(24 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 0)
                    doit = text_Output(Sheets("Lan" & Language).Cells(53, 1).Value, 1)
                   
                    Sheets("Game_data1").Cells(89, 2).Value = 1 'land is buyable
                    
                    Sheets("Game_data1").Cells(88, 2).Value = 2 'land is neutral
                    
                Else
        
                    doit = text_Output(Sheets("Lan" & Language).Cells(54, 1).Value, 1)
                    doit = text_Output(Sheets("Lan" & Language).Cells(55, 1).Value, 0)
                    doit = text_Output(Sheets("Game_map").Cells(ruut, 3).Value & "$", 1)
                    Sheets("Game_data1").Cells(88, 2).Value = 2 'land is neutral
    
                End If
    
            
        Else
    
                If Sheets("Game_data1").Cells(10, 2).Value = Sheets("Game_map").Cells(ruut, 2).Value Then
                        
                        Sheets("Game_data1").Cells(88, 2).Value = 4 'land is friendly
                        
                Else
                                
                        If Sheets("Game_map").Cells(ruut, 1).Value = 20 Then
                                'arcane tower teise playeri käes
                                Sheets("Game_data1").Cells(88, 2).Value = 2 'land is neutral
                                do_it = greeting_from_enemy_land()
                        Else
                        
                                Sheets("Game_data1").Cells(88, 2).Value = 1 'land is hostile, belongs to another player
                                
                                'siia tuleb castle kood
                                If (Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + what_player, 2).Value, 12) > 0) Then
                                        
                                        main_turn_needed = 0
                                        do_it = greeting_from_castle()
                                        
                                Else
                                        land_owner = Sheets("Game_map").Cells(ruut, 2).Value
                                        
                                        
                                        If Sheets("Fight").Cells(30, land_owner).Value > 0 Then
                                        'omanik sama ruudu peal
                                                Sheets("Game_data1").Cells(88, 2).Value = 2
                                        
                                                If Sheets("Game_data1").Cells(46 + land_owner, 2).Value > 1 Then
                                                        
                                                        Active_player_detected = detect_Other(land_owner, what_player)
                                                
                                                End If
                                                
                                               
                                               If Active_player_detected = 0 Then
                                               
                                                        do_it = text_Output(Sheets("Lan" & Language).Cells(56, 1).Value, 1)
                                                        do_it = set_Detection(what_player, land_owner, 2)
                                               Else
                                                        do_it = text_Output(Sheets("Lan" & Language).Cells(57, 1).Value, 1)
                                                        
                                                        do_it = set_Detection(what_player, land_owner, 2)
                                                        do_it = set_Detection(land_owner, what_player, 2)
                                                        main_turn_needed = 0
                                                       
                                                        
                                               End If
                                                
                                               
                                                
                                        
                                        Else
                                                main_turn_needed = 0
                                                do_it = greeting_from_enemy_land()
                                                do_it = Fight_player_land() 'player will be attacked
                                        
                                        End If
                                        
                                        
                                        
                                End If
                                
                        End If
                
                End If
                
        End If

End If




If main_turn_needed = 1 Then
        
        do_it = Main_turn()
        
Else
        
        
        If Active_player_detected = 1 Then
        
                If Language = 1 Then
                        MsgBox (Sheets("Game_data1").Cells(10 + land_owner, 2).Value & ", shall you fight with " & player_name & " or leave it be?")
                End If
                
                If Language = 2 Then
                        MsgBox (Sheets("Game_data1").Cells(10 + land_owner, 2).Value & ", kas sa ründad " & eesti_nimi(player_name, 3) & " või lased tal olla?")
                End If
                
                do_it = text_Output("", 3)
                
                If Language = 1 Then
                        do_it = Nuppudega_tegeleja("Attack " & player_name, "attack_" & land_owner, 0, 1)
                End If
                
                If Language = 2 Then
                        do_it = Nuppudega_tegeleja("Ründa " & eesti_nimi(player_name, 3), "attack_" & land_owner, 0, 1)
                End If
                
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(58, 1).Value, "Do_not_Attack", 0, 1)
                
        End If

End If

End Function
Function players_detect_side5(what_player As Integer, ruut As Integer)
Dim x As Integer
Dim checkitav_Player As Integer
'what player is active player

For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        
        checkitav_Player = Sheets("Nupud").Cells(x, 4).Value
        
        'kui tsekitav player ise on seal ruudul
        If Sheets("Game_data1").Cells(5 + checkitav_Player, 2).Value = ruut Then

                Sheets("fight").Cells(30, checkitav_Player).Value = Sheets("fight").Cells(30, checkitav_Player).Value + 1
                Sheets("fight").Cells(30 + Sheets("fight").Cells(30, checkitav_Player).Value, checkitav_Player).Value = 5
                If what_player = checkitav_Player Then
                        Sheets("fight").Cells(30 + Sheets("fight").Cells(30, checkitav_Player).Value, checkitav_Player + 5).Value = 2
                End If
        End If
Next

End Function
Function detect_Other(player_who_sees As Integer, target_side As Integer) As Integer
Dim x As Integer
Dim y As Integer
Dim enemy_party_Size As Integer

enemy_party_Size = Sheets("Game_data1").Cells(46 + target_side, 2).Value
detect_Other = 0

For x = 1 To Sheets("Game_data1").Cells(46 + player_who_sees, 2).Value
        
        y = Int(Rnd * 10 + 1)
        
        If y > (9 - enemy_party_Size) Then
                detect_Other = 1
        End If

Next

End Function

Function make_attack_buttons_for_player(player_who_sees As Integer)
Dim player_name As String
Dim what_side As Integer
Dim counter As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
        For x = 1 To Sheets("Fight").Cells(30, player_who_sees).Value
                
                If Sheets("Fight").Cells(30 + x, player_who_sees).Value <> player_who_sees And Sheets("Fight").Cells(30 + x, player_who_sees).Value <> 5 Then
                        
                        what_side = Sheets("Fight").Cells(30 + x, player_who_sees).Value
                        player_name = Sheets("Game_data1").Cells(10 + what_side, 2).Value
                        
                        If Sheets("Fight").Cells(30 + x, player_who_sees + 5).Value = 2 And Sheets("Fight").Cells(30, what_side + 5).Value = 0 Then
                        
                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(627, 1).Value & eesti_nimi(player_name, 3), "attack_" & what_side, 0, 1)
                                
                        End If
                        
                        If Sheets("Fight").Cells(30 + x, player_who_sees + 5).Value = 1 And Sheets("Fight").Cells(30, what_side + 5).Value = 0 Then
                        
                                do_it = Nuppudega_tegeleja("Track " & player_name, "track_ & what_side", 0, 1)
                                
                        End If
                        
                End If
        
        Next


End Function

Function set_Detection(player_who_sees As Integer, player_who_is_seen As Integer, level_of_detection As Integer)
Dim x As Integer

For x = 1 To Sheets("Fight").Cells(30, player_who_sees).Value
        
        If Sheets("Fight").Cells(30 + x, player_who_sees).Value = player_who_is_seen Then
                Sheets("Fight").Cells(30 + x, player_who_sees + 5).Value = level_of_detection
        End If

Next

End Function



Function Insert_name()
Dim default_name As String
Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim T As Integer
Dim mis_kääne As Integer
Dim kui_palju_playereid_alles As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

For x = 1 To Sheets("Game_data1").Cells(2, 2).Value

    Message = Sheets("Lan" & Language).Cells(840, 1).Value & x & Sheets("Lan" & Language).Cells(841, 1).Value
    title = Sheets("Lan" & Language).Cells(842, 1).Value
    default_name = Sheets("Game_data1").Cells(256 + x, 2).Value
    
    MyValue = InputBox(Message, title, default_name)
    
    If (MyValue <> "") Then
    
            Sheets("Nupud").Cells(x, 41).Value = MyValue
            Sheets("Game_data1").Cells(256 + x, 2).Value = MyValue
    Else
            Sheets("Nupud").Cells(x, 41).Value = "Jobu" & x
    
    End If
    
    If Sheets("Game_data1").Cells(15, 2).Value <> 1 Then
    
            Message = Sheets("Nupud").Cells(x, 41).Value & Sheets("Lan" & Language).Cells(843, 1).Value
            title = Sheets("Lan" & Language).Cells(844, 1).Value
            
            If Sheets("Game_data1").Cells(252 + x, 2).Value = 1 Then
                    default_name = Sheets("Lan" & Language).Cells(845, 1).Value
            Else
                    default_name = Sheets("Lan" & Language).Cells(846, 1).Value
            End If
            
            MyValue = InputBox(Message, title, default_name)
            
            If LCase(MyValue) = "m" Then
                    Sheets("Nupud").Cells(x, 42).Value = 0
                    
            Else
                    Sheets("Nupud").Cells(x, 42).Value = 1
            End If
            
            If Language = 2 Then
                    If find_eesti_nimi(Sheets("Nupud").Cells(x, 41).Value) = 0 Then
                    
                            Sheets("Game_data1").Cells(261, 2).Value = Sheets("Game_data1").Cells(261, 2).Value + 1
                            
                            For mis_kääne = 0 To 6
                            
                            Message = "Teie nime ei olnud databases. Aita seda käänata? "
                            
                            If mis_kääne = 0 Then
                                    title = ""
                                    default_name = Sheets("Nupud").Cells(x, 41).Value
                            End If
                           
                            If mis_kääne = 1 Then 'Kelle mille?
                                    title = "Kelle mille? (Hobuse)"
                                    Message = Message & title
                                    default_name = Sheets("Nupud").Cells(x, 41).Value & "i"
                            End If
                            
                            If mis_kääne = 3 Then 'keda, mida
                                    title = "Keda mida? (Hobust)"
                                    Message = Message & title
                                    default_name = Sheets("Nupud").Cells(x, 41).Value & "it"
                            End If
                            
                            If mis_kääne = 4 Then 'kellest, millest
                                    title = "Kellest, millest? (Hobusest)"
                                    Message = Message & title
                                    default_name = Sheets("Nupud").Cells(x, 41).Value & "st"
                            End If
                            
                            If mis_kääne = 5 Then 'kellele, millele
                                    title = "Kellele, millele? (Hobusele)"
                                    Message = Message & title
                                    default_name = Sheets("Nupud").Cells(x, 41).Value & "ile"
                            End If
                            Sheets("Lan2").Cells(600 + Sheets("Game_data1").Cells(261, 2).Value, 2 + mis_kääne).Value = default_name
                            'Sheets("Game_data1").Cells(261, 2).Value
        
                            If mis_kääne = 1 Or mis_kääne = 3 Or mis_kääne = 4 Or mis_kääne = 5 Then
                                    Uus_lisand = InputBox(Message, title, default_name)
                                    Sheets("Lan2").Cells(600 + Sheets("Game_data1").Cells(261, 2).Value, 2 + mis_kääne).Value = Uus_lisand
                            End If
                            
                            Next
                    
                    End If
            End If
    
    End If
Next

kui_palju_playereid_alles = Sheets("Game_data1").Cells(2, 2).Value

Randomize

For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
    
    T = Int((Rnd * kui_palju_playereid_alles) + 1)

    Sheets("Game_data1").Cells(256 + x, 2).Value = Sheets("Nupud").Cells(T, 41).Value
    Sheets("Game_data1").Cells(10 + x, 2).Value = Sheets("Nupud").Cells(T, 41).Value
    Sheets("Game_data1").Cells(252 + x, 2).Value = Sheets("Nupud").Cells(T, 42).Value
    Sheets("Side" & x).Cells(Sheets("Game_data1").Cells(51 + x, 2).Value, 1).Value = Sheets("Nupud").Cells(T, 41).Value
    
   If (T < kui_palju_playereid_alles) Then
            
        y = kui_palju_playereid_alles - T
                      
        For z = 1 To y
                Sheets("Nupud").Cells(T - 1 + z, 41).Value = Sheets("Nupud").Cells(T + z, 41).Value
                Sheets("Nupud").Cells(T - 1 + z, 42).Value = Sheets("Nupud").Cells(T + z, 42).Value
        Next
                      
    End If
          
    kui_palju_playereid_alles = kui_palju_playereid_alles - 1
              
Next


End Function
Function mitmes_asi(mis_numbrile As Long, Optional Language As Integer = 1) As String
Dim temp_nr As Integer
Dim x As Integer
Dim control As Integer

    mitmes_asi = "Error in mitmes_asi"
    
    If (Abs(mis_numbrile) > 10) Then
    
            For x = Abs(mis_numbrile) To 1 Step -10
                    If x >= 1 And x < 11 Then
                            temp_nr = x
                    End If
            Next
    Else
            temp_nr = Abs(mis_numbrile)
    End If
    
    If temp_nr = 0 Then
    
            If Language = 1 Then
                    mitmes_asi = "Zero"
            End If
            
            If Language = 2 Then
                    mitmes_asi = "Null"
            End If
            
    End If
    
    
    If temp_nr = 1 Then
    
            If Language = 1 Then
                    mitmes_asi = mis_numbrile & "st"
            End If
            
            If Language = 2 Then
                    mitmes_asi = mis_numbrile & "ne"
            End If
    End If
    
    If temp_nr = 2 Then
    
            If Language = 1 Then
                    mitmes_asi = mis_numbrile & "nd"
            End If
            
            If Language = 2 Then
                    mitmes_asi = mis_numbrile & "ne"
            End If
            
    End If
    
    If temp_nr = 3 Then
            
            If Language = 1 Then
                    mitmes_asi = mis_numbrile & "rd"
            End If
            
            If Language = 2 Then
                    mitmes_asi = mis_numbrile & "mas"
            End If
    End If
    
    If temp_nr = 4 Then
    
            If Language = 1 Then
                    mitmes_asi = mis_numbrile & "th"
            End If
            
            If Language = 2 Then
                    mitmes_asi = mis_numbrile & "jas"
            End If
    End If
    
    If temp_nr > 4 And temp_nr < 11 Then
    
            If Language = 1 Then
                    mitmes_asi = mis_numbrile & "th"
            End If
            
            If Language = 2 Then
                    mitmes_asi = mis_numbrile & "es"
            End If
            
    End If

End Function

Sub end_game()

Dim x As Integer
Dim y As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

'vilgutamise lõpetamine
Sheets("Game_data1").Cells(102, 2).Value = 0
Sheets("Game_data1").Cells(103, 2).Value = 0

Rem teen logi tühjaks
do_it = text_Output("", 3)

do_it = display_status(1)



Rem KUSTUTAN igasugu graafikat, kõik puhtaks

Sheets("Game").Cells(6, 18).Value = ""

For x = 1 To 34
do_it = Joonista_asukoht(x, 0, 8)
Next




Rem lets clean everything up- remove all buttons


For x = 1 To Sheets("Game_data1").Cells(3, 2).Value

        If (Sheets("Game_data1").Cells(3, 2).Value >= 1) Then
                
                On Error Resume Next
                Sheets("Game").Buttons(Sheets("Nupud").Cells(x, 2).Value).Delete

                Rem nupulisti tyhjendamine
                Sheets("Nupud").Cells(x, 2).Value = ""
                
        End If

Next x

Sheets("Game_data1").Cells(3, 2).Value = 0 'moment pole meil ülse nuppe
Sheets("Game_data1").Cells(129, 2).Value = 0
Sheets("Game_data1").Cells(19, 2).Value = 0
Sheets("Game_data1").Cells(251, 2).Value = 1


do_it = mobs_display(1)
Rem kustutame playerite staatuse
do_it = display_status(0)

'Sheets("Lan"& language).Cells(1, 1).Value

Rem and we make start game button

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(1, 1).Value, "start_game", 0, 3)
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(2, 1).Value, "options", 0, 4)


End Sub
  
Sub Armor_check()
Dim x As Integer
Dim armor_must_be_at_least As Integer
Dim str As Integer

armor_must_be_at_least = 0

For x = 1 To 98
        str = Sheets("Mobs").Cells(x, 7).Value
        If str > 0 Then
                armor_must_be_at_least = Int(str / 4)
        End If
        If Sheets("Mobs").Cells(x, 10).Value < armor_must_be_at_least Then
                Sheets("Mobs").Cells(x, 10).Value = armor_must_be_at_least
        End If
Next

End Sub

Sub Extra_rounds_check()

Dim x As Integer
Dim attack_must_be_at_least As Integer
Dim dex As Integer

For x = 1 To 98
        dex = Sheets("Mobs").Cells(x, 8).Value
        If dex > 0 Then
                attack_must_be_at_least = Int(dex / 5) + 1
        End If
        If Sheets("Mobs").Cells(x, 3).Value < attack_must_be_at_least Then
                Sheets("Mobs").Cells(x, 3).Value = attack_must_be_at_least
        End If
Next

End Sub

Sub Mobide_värvija()
Dim mob_name As String

For x = 2 To 20 + Sheets("Game_data1").Cells(173, 2).Value
        For y = 1 To 4
                mob_name = Sheets("Map_defaults").Cells(x, 8 + y).Value
                Sheets("Mobs").Cells(find_mob_by_name(mob_name), 1).Interior.Color = Sheets("Game_Map").Cells(x, 10).Interior.Color
        Next
Next
End Sub


Function remove_Koer2(milline_koer_vaja_removida As Integer, Itemite_arv_listis As Integer)
Dim y As Integer
Dim z As Integer


        If (milline_koer_vaja_removida < Itemite_arv_listis) Then
            
                y = Itemite_arv_listis - milline_koer_vaja_removida
                              
                For z = 1 To y
                        Sheets("Koerad").Cells(milline_koer_vaja_removida - 1 + z, 1).Value = Sheets("Koerad").Cells(milline_koer_vaja_removida + z, 1).Value
                        Sheets("Koerad").Cells(milline_koer_vaja_removida - 1 + z, 2).Value = Sheets("Koerad").Cells(milline_koer_vaja_removida + z, 2).Value
                        Sheets("Koerad").Cells(milline_koer_vaja_removida - 1 + z, 3).Value = Sheets("Koerad").Cells(milline_koer_vaja_removida + z, 3).Value
                Next
                      
        End If
        
        Itemite_arv_listis = Itemite_arv_listis - 1


End Function
-------------------------------------------------------------------------------
VBA MACRO Module6.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module6'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Function check_spell_knowledge(what_player As Integer, Optional what_to_do As Integer = 0) As Integer

Dim combat_spell As Integer
Dim adventure_spell As Integer

combat_spell = 0
adventure_spell = 0
check_spell_knowledge = 0

If (what_to_do = 0) Then

        For x = 1 To Sheets("Game_data1").Cells(186, 2).Value
        
               
                If (Sheets("Spells").Cells(x, 2 + what_player).Value > 0) Then
                
                        If (Sheets("Spells").Cells(x, 2).Value = 1) Then
                                combat_spell = 1
                        End If
                        
                        If (Sheets("Spells").Cells(x, 2).Value = 2) Then
                                adventure_spell = 1
                        End If
                        
                        If (Sheets("Spells").Cells(x, 2).Value = 3) Then
                                combat_spell = 1
                                adventure_spell = 1
                        End If
                
                End If
                
        Next
        
        If (combat_spell = 1 And adventure_spell = 1) Then
                check_spell_knowledge = 3
        
        End If
        
        If (combat_spell = 1 And adventure_spell = 0) Then
                check_spell_knowledge = 1
        
        End If
        
        If (combat_spell = 0 And adventure_spell = 1) Then
                check_spell_knowledge = 2
        
        End If
End If

End Function
Function spell_list()
Dim x As Integer
    Dim what_player As Integer
    Dim dot_needed As Integer
    Dim comma_Needed As Integer
    Dim Language As Integer
    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value
    
    do_it = valiknuppude_Kustutamine()

    If Sheets("Game_data1").Cells(87, 2).Value = 0 Then
    
            what_player = Sheets("Game_data1").Cells(10, 2).Value
    Else
            what_player = Sheets("Fight").Cells(Sheets("Game_data1").Cells(37, 2).Value, 6).Value
    
    End If
    
    Sheets("Game_data1").Cells(98, 2).Value = what_player
    
    comma_Needed = 0
    dot_needed = 0
    
    do_it = text_Output("", 3)
    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_spell_menu", 0, 1)
   
   
If (Sheets("Game_data1").Cells(36, 2).Value = 0) Then

        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(685, 1).Value, "combat_spell_menu", 0, 1)
        
        For x = 1 To Sheets("Game_data1").Cells(186, 2).Value
                       
                If Sheets("Spells").Cells(x, 2 + what_player).Value > 0 Then
                    
                        If Sheets("Spells").Cells(x, 2).Value = 2 Or Sheets("Spells").Cells(x, 2).Value = 3 Then
                               
                               If dot_needed = 0 Then
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(686, 1).Value, 1)
                               End If
                               
                               If comma_Needed = 1 Then
                                    do_it = text_Output(",  ", 0)
                               End If
                               
                               If comma_Needed = 2 Then
                                    do_it = text_Output(",", 1)
                                    comma_Needed = 0
                               End If
                               
                                dot_needed = dot_needed + 1
                                comma_Needed = comma_Needed + 1
                                
                                do_it = text_Output(Chr(34), 0)
                                do_it = text_Output(Sheets("Spells").Cells(x, 1).Value, 0)
                                do_it = text_Output(Chr(34), 0)
                        
                               
                                do_it = text_Output(Sheets("Lan" & Language).Cells(687, 1).Value, 0)
                                do_it = text_Output(Sheets("Spells").Cells(x, 9).Value, 0)
                                do_it = text_Output(" ", 0)
                                
                                do_it = text_Output(what_damage_type(Sheets("Spells").Cells(x, 7).Value, 0), 0, Sheets("Game_data1").Cells(21, 2).Value)
                                Sheets("Spells").Cells(x, 1).Font.ColorIndex = Sheets("Game_data1").Cells(21, 2).Value
                                do_it = text_Output(" mana", 0)
                                
                                
                                
                                do_it = Nuppudega_tegeleja(Sheets("Spells").Cells(x, 1).Value, "Spell_" & x, 0, 1)
                                
                        End If
                        
                End If
                        
        Next
        
        If (dot_needed = 0) Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(688, 1).Value, 1)
        End If
        
        

Else
        'combat spell menu
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(689, 1).Value, "adventure_spell_menu", 0, 1)
        
        For x = 1 To Sheets("Game_data1").Cells(186, 2).Value
                       
                If (Sheets("Spells").Cells(x, 2 + what_player).Value > 0) Then
                        
                        If (Sheets("Spells").Cells(x, 2).Value = 1 Or Sheets("Spells").Cells(x, 2).Value = 3) Then
                                
                                If (dot_needed = 0) Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(690, 1).Value, 1)
                                End If
                                
                                dot_needed = dot_needed + 1
                                
                                If comma_Needed = 1 Then
                                    do_it = text_Output(",  ", 0)
                                End If
                               
                                If comma_Needed = 2 Then
                                    do_it = text_Output(",", 1)
                                    comma_Needed = 0
                                End If
                                
                                 comma_Needed = comma_Needed + 1
                                
                                do_it = text_Output(Chr(34), 0)
                                do_it = text_Output(Sheets("Spells").Cells(x, 1).Value, 0)
                                do_it = text_Output(Chr(34), 0)
                                
                                 
                                do_it = text_Output(Sheets("Lan" & Language).Cells(687, 1).Value, 0)
                                do_it = text_Output(Sheets("Spells").Cells(x, 9).Value, 0)
                                do_it = text_Output(" ", 0)
                                do_it = text_Output(what_damage_type(Sheets("Spells").Cells(x, 7).Value, 0), 0, Sheets("Game_data1").Cells(21, 2).Value)
                                Sheets("Spells").Cells(x, 1).Font.ColorIndex = Sheets("Game_data1").Cells(21, 2).Value
                                do_it = text_Output(" mana", 0)
                                
                                do_it = Nuppudega_tegeleja(Sheets("Spells").Cells(x, 1).Value, "Spell_" & x, 0, 1)
                             
                        End If
                        
                End If
        
        Next
        
        If (dot_needed = 0) Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(691, 1).Value, 1)
        End If
        
End If

If (dot_needed > 0) Then
        do_it = text_Output(".", 1)
End If

End Function
Function cast_spell(mitmes_spell As Integer, Optional true_cast As Integer = 0)
Dim what_side As Integer
Dim can_cast As Integer
Dim enemy_Side As Integer
Dim who As Integer

Dim is_spell_Aggressive As Integer
Dim can_target_Single_unit As Integer
Dim can_target_Group As Integer
Dim can_target_Land As Integer
Dim can_target_Friendly As Integer
Dim can_target_Hostile As Integer
Dim has_global_Range As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

If Sheets("Game_data1").Cells(87, 2).Value = 0 Then
            what_side = Sheets("Game_data1").Cells(10, 2).Value
        Else
            what_side = Sheets("Fight").Cells(Sheets("Game_data1").Cells(37, 2).Value, 6).Value
End If

who = Sheets("Game_data1").Cells(51 + what_side, 2).Value

do_it = valiknuppude_Kustutamine()
can_cast = 0
cast_on_something = 0
neutral_spell_in_combat = 0

do_it = text_Output("", 3)


If (mitmes_spell <> 0) Then

        Sheets("Game_data1").Cells(167, 2).Value = mitmes_spell
        
        'just in case but we probably
        If Sheets("Spells").Cells(mitmes_spell, 22).Value = 1 Then
                is_spell_Aggressive = 1
        Else
                is_spell_Aggressive = 0
        End If
        
        If Sheets("Spells").Cells(mitmes_spell, 23).Value = 1 Then
                can_target_Friendly = 1
        Else
                can_target_Friendly = 0
        End If
        
        If Sheets("Spells").Cells(mitmes_spell, 24).Value = 1 Then
                can_target_Hostile = 1
        Else
                can_target_Hostile = 0
        End If
        
        If Sheets("Spells").Cells(mitmes_spell, 25).Value = 1 Then
                can_target_Group = 1
        Else
                can_target_Group = 0
        End If
        
        
        If Sheets("Spells").Cells(mitmes_spell, 26).Value = 1 Then
                can_target_Single_unit = 1
        Else
                can_target_Single_unit = 0
        End If
        
        
        If Sheets("Spells").Cells(mitmes_spell, 27).Value = 1 Then
                can_target_Land = 1
        Else
                can_target_Land = 0
        End If
        
        If Sheets("Spells").Cells(mitmes_spell, 29).Value = 1 Then
                can_target_Player = 1
        Else
                can_target_Player = 0
        End If
        
        If Sheets("Spells").Cells(mitmes_spell, 30).Value = 1 Then
                has_global_Range = 1
        Else
                has_global_Range = 0
        End If
        
        If (true_cast = 1) Then
                 
                If Sheets("Game_data1").Cells(87, 2).Value = 0 Then
                
                do_it = what_damage_type(Sheets("Spells").Cells(mitmes_spell, 7).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(692, 1).Value, 0)
                do_it = text_Output(Chr(34), 0, Sheets("Game_data1").Cells(21, 2).Value)
                do_it = text_Output(Sheets("Spells").Cells(mitmes_spell, 1).Value, 0, Sheets("Game_data1").Cells(21, 2).Value)
                do_it = text_Output(Chr(34), 0, Sheets("Game_data1").Cells(21, 2).Value)
                do_it = text_Output(Sheets("Lan" & Language).Cells(693, 1).Value, 0)
                'knowledge
                do_it = text_Output(Sheets("Spells").Cells(mitmes_spell, 2 + what_side).Value + Sheets("Side" & what_side).Cells(who, 68).Value, 0, 5)
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(694, 1).Value, 1)
                Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(51 + what_side, 2).Value, 12 + Sheets("Spells").Cells(mitmes_spell, 7).Value).Value = Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(51 + what_side, 2).Value, 12 + Sheets("Spells").Cells(mitmes_spell, 7).Value).Value - Sheets("Spells").Cells(mitmes_spell, 9).Value
                do_it = text_Output(Sheets("Lan" & Language).Cells(695, 1).Value, 0)
                do_it = text_Output(Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(51 + what_side, 2).Value, 12 + Sheets("Spells").Cells(mitmes_spell, 7).Value).Value, 0)
                do_it = text_Output(" ", 0)
                do_it = text_Output(what_damage_type(Sheets("Spells").Cells(mitmes_spell, 7).Value, 0), 0, Sheets("Game_data1").Cells(21, 2).Value)
                do_it = text_Output(Sheets("Lan" & Language).Cells(696, 1).Value, 1)
                
                
                
                        do_it = spell_effect(mitmes_spell, what_side, Sheets("Game_data1").Cells(51 + what_side, 2).Value)
                
                        If Sheets("Game_data1").Cells(15, 2).Value <> 1 Then 'debugmode
                                Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
                        End If
                Else
                        Sheets("Side" & what_side).Cells(who, 30).Value = 10
                        Sheets("Side" & what_side).Cells(who, 31).Value = Sheets("Side" & what_side).Cells(who, 35).Value
                        Sheets("Side" & what_side).Cells(who, 36).Value = mitmes_spell
                        neutral_spell_in_combat = 1
                End If
                
        Else
                do_it = text_Output(Chr(34), 0)
                do_it = text_Output(Sheets("Spells").Cells(mitmes_spell, 1).Value, 0)
                do_it = text_Output(Chr(34), 0)
                
                'siin näitame nõiduse taset
                knowledge = Sheets("Spells").Cells(mitmes_spell, 2 + what_side).Value + Sheets("Side" & what_side).Cells(who, 68).Value
                do_it = text_Output(Sheets("Lan" & Language).Cells(706, 1).Value, 0)
                do_it = text_Output(" " & knowledge, 0, 5)
                If Sheets("Side" & what_side).Cells(who, 68).Value > 0 Then
                        do_it = text_Output("*", 0, 5)
                End If
                do_it = text_Output(Sheets("Lan" & Language).Cells(707, 1).Value, 0)
                               
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(687, 1).Value, 0)
                do_it = text_Output(Sheets("Spells").Cells(mitmes_spell, 9).Value, 0)
                do_it = text_Output(" ", 0)
                do_it = text_Output(what_damage_type(Sheets("Spells").Cells(mitmes_spell, 7).Value, 0), 0, Sheets("Game_data1").Cells(21, 2).Value)
                Sheets("Spells").Cells(mitmes_spell, 1).Font.ColorIndex = Sheets("Game_data1").Cells(21, 2).Value
                do_it = text_Output(Sheets("Lan" & Language).Cells(697, 1).Value, 0)
                do_it = text_Output(Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(51 + what_side, 2).Value, 12 + Sheets("Spells").Cells(mitmes_spell, 7).Value).Value & " ", 0)
                do_it = text_Output(what_damage_type(Sheets("Spells").Cells(mitmes_spell, 7).Value, 0), 0, Sheets("Game_data1").Cells(21, 2).Value)
                do_it = text_Output(Sheets("Lan" & Language).Cells(698, 1).Value, 1)
                
                
                'description
                do_it = text_Output(Sheets("Lan" & Language).Cells(742, 1).Value & Sheets("Spells").Cells(mitmes_spell, 10).Value, 1)
                                    
                do_it = spell_effect(mitmes_spell, what_side, Sheets("Game_data1").Cells(51 + what_side, 2).Value, , , 1)
                
                If Sheets("Side" & what_side).Cells(who, 68).Value > 0 Then
                        do_it = text_Output("*", 0, 5)
                        do_it = text_Output(" - " & Sheets("Lan" & Language).Cells(944, 1).Value, 1)
                End If
                
                'mana check
                If Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(51 + what_side, 2).Value, 12 + Sheets("Spells").Cells(mitmes_spell, 7).Value).Value >= Sheets("Spells").Cells(mitmes_spell, 9).Value Then
                        
                        mana_ok_to_cast = 1
                        
                End If
                            
                If mana_ok_to_cast = 1 Then 'nupud vastavalt kas saab castida või mitte
                        
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_truecast", 0, 1)
                        
                        'ifs (vaja selgitada millisesse alam_spell_menyysse suunata ja vastav sub
                        'vaja vaadata vastavalt flagidele legaalsete targetite olemasolu)
                        If can_target_Single_unit = 1 Or can_target_Group = 1 Then
                                
                                If has_global_Range = 0 Then
                                
                                        If can_target_Hostile = 1 Then
                                                '(TODO) kas on keegi vastane samal ruudul näha- olemas
                                                'kui on siis cast_on_someting = 1
                                                cast_on_something = 1
                                        
                                                
                                        End If
                                        
                                        If can_target_Friendly = 1 Then
                                                cast_on_something = 1
                                        End If
                                
                                Else
                                        cast_on_something = 1
                                
                                End If
                        
                        End If
                        
                        
                        
                        If cast_on_something = 1 Then
                        
                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(699, 1).Value & eesti_nimi(Sheets("Spells").Cells(mitmes_spell, 1).Value, 1) & Sheets("Lan" & Language).Cells(736, 1).Value, "spell_target_menu", 0, 1)
                 
                        Else
                        
                                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(737, 1).Value & eesti_nimi(Sheets("Spells").Cells(mitmes_spell, 1).Value, 1) & Sheets("Lan" & Language).Cells(738, 1).Value, "ok_truecast", 0, 1)
                        
                        End If
                        
                Else
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(700, 1).Value, 1)
                        do_it = Nuppudega_tegeleja("Ok", "cancel_with_ok_truecast", 0, 1)
                            
                End If
                    
        End If

End If

If (Sheets("Game_data1").Cells(44, 2).Value = 0) Then

'viskab pärast casti mainturni
        If Sheets("Game_data1").Cells(87, 2).Value = 0 Then
                If (mitmes_spell = 0 Or true_cast = 1) Then
                        do_it = Main_turn()
                End If
        End If
End If

If (Sheets("Game_data1").Cells(44, 2).Value = 1) Then

what_side = Sheets("Fight").Cells(Sheets("Game_data1").Cells(37, 2).Value, 6).Value
'Targeting_side
        If neutral_spell_in_combat = 0 Then
        
                If mitmes_spell = 0 Or true_cast = 1 Then
                        do_it = targeting_side_submenu(what_side)
                End If
        
        Else
                do_it = pick_targets_for_side2(what_side, 1)
        End If
End If

If (Sheets("Game_data1").Cells(44, 2).Value = 2) Then

        what_side = Sheets("Fight").Cells(Sheets("Game_data1").Cells(37, 2).Value, 6).Value
        enemy_Side = Sheets("Game_data1").Cells(43, 2).Value

        If (mitmes_spell = 0 Or true_cast = 1) Then
                do_it = targeting_party_members(what_side, enemy_Side)
        End If
        
End If

End Function

Function spell_effect(mitmes_spell As Integer, what_side As Integer, who As Integer, Optional target_side As Integer = 0, Optional target_mob As Integer = 0, Optional just_display = 0)
Dim x As Long
Dim power As Integer
'Dim who As Integer
Dim knowledge As Integer
Dim item_min_Value As Integer
Dim item_max_Value As Integer
Dim summons_Level As Integer
Dim Summons_name As String
Dim number_to_be_summoned As Integer
Dim healvalue As Integer
Dim mob_spell_slot As Integer
Dim duration As Integer
Dim Stat_Bonus As Integer
Dim old_stat As Integer
Dim mitmes_effect As Integer
Dim caster_id As Integer
Dim target_id As Integer
Dim replace_Stat As Integer
Dim replace_Duration As Integer
Dim Language As Integer
Dim player_under_str As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
Dim z As Integer

caster_id = Sheets("Side" & what_side).Cells(who, 35).Value

If target_side > 0 Then
        target_id = 100 + target_side
        If who > 0 Then
                target_id = Sheets("Side" & target_side).Cells(target_mob, 35).Value
        End If
End If

If caster_id >= 1001 And caster_id <= 1004 Then 'siis on player
        knowledge = Sheets("Spells").Cells(mitmes_spell, 2 + what_side).Value + Sheets("Side" & what_side).Cells(who, 68).Value
Else 'siis on mob

        For z = 1 To Sheets("Side" & what_side).Cells(who, 40).Value
                
                mob_spell_slot = find_spell_by_name(Sheets("Side" & what_side).Cells(who, 40 + z).Value)
                
                If mob_spell_slot = mitmes_spell Then
                        knowledge = Sheets("Side" & what_side).Cells(who, 44 + z).Value + Sheets("Side" & what_side).Cells(who, 68).Value
                End If
        Next
                
End If

power = Sheets("Side" & what_side).Cells(who, 13).Value

If just_display = 0 Then

        If Sheets("Spells").Cells(mitmes_spell, 12).Value <> 0 Then
        
        
                
                x = ((Int(Rnd * 3 + 1) * 10) + power * 20) * (knowledge * knowledge) 'power_add_gold
                Sheets("Game_data1").Cells(191, 2).Value = Sheets("Game_data1").Cells(191, 2).Value + x
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(701, 1).Value & x & Sheets("Lan" & Language).Cells(702, 1).Value, 1)
                
                
        End If

End If

If just_display = 0 Then

        If Sheets("Spells").Cells(mitmes_spell, 13).Value <> 0 Then
        
                do_it = text_Output(Sheets("Lan" & Language).Cells(703, 1).Value, 1)
                
                item_min_Value = (knowledge * 50) - 100
                If item_min_Value < 21 Then
                        item_min_Value = 21
                End If
                
                If item_min_Value > 900 Then
                        item_min_Value = 900
                End If
                
                item_max_Value = (50 + power * 20) * knowledge
                
                do_it = gen_treasure_item(1, item_min_Value, item_max_Value)
        
        End If

End If

If Sheets("Spells").Cells(mitmes_spell, 14).Value <> 0 Then
        
        summons_Level = 1

        For x = 1 To knowledge
        
                If x < 5 Then
                        
                        Summons_name = Sheets("Spells").Cells(mitmes_spell, 13 + x).Value
                        number_to_be_summoned = Sheets("Spells").Cells(mitmes_spell, 17 + x).Value
                        
                        If Summons_name = Sheets("Spells").Cells(mitmes_spell, 12 + x).Value And number_to_be_summoned = Sheets("Spells").Cells(mitmes_spell, 16 + x).Value Then
                                summons_Level = summons_Level + 1
                        Else
                                summons_Level = 1
                                
                        End If
                        
                Else
                        
                        Summons_name = Sheets("Spells").Cells(mitmes_spell, 17).Value
                        number_to_be_summoned = Sheets("Spells").Cells(mitmes_spell, 21).Value
                        summons_Level = summons_Level + 1
                End If
             
        Next
        
        do_it = what_damage_type(Sheets("Spells").Cells(mitmes_spell, 7).Value)
        
        If just_display = 0 Then
                
                
                If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                        do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value, 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(704, 1).Value, 0)
                Else
                        do_it = text_Output(Sheets("Lan" & Language).Cells(705, 1).Value, 0)
                End If
                
                do_it = text_Output(" " & number_to_be_summoned, 0)
                
                If summons_Level > 1 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(706, 1).Value, 0)
                        do_it = text_Output(" " & summons_Level, 0)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(707, 1).Value, 0)
                Else
                        do_it = text_Output(" ", 0)
                End If
                
                If number_to_be_summoned > 1 Then
                
                        If Language = 1 Then
                                do_it = text_Output(Summons_name & "s", 0, Sheets("Game_data1").Cells(21, 2).Value)
                        End If
                        
                        If Language = 2 Then
                                do_it = text_Output(eesti_nimi(Summons_name, 3), 0, Sheets("Game_data1").Cells(21, 2).Value)
                        End If
                        
                        do_it = text_Output("!", 1)
                Else
                        do_it = text_Output(eesti_nimi(Summons_name, 1), 0, Sheets("Game_data1").Cells(21, 2).Value)
                        do_it = text_Output("!", 1)
                End If
                
                say_it_once = 0
                
                For x = 1 To number_to_be_summoned
                
                        If Sheets("Game_data1").Cells(46 + what_side, 2).Value < 20 Then
                        
                        do_it = Add_new_mob(what_side, find_mob_by_name(Summons_name), 0, power * 2)
                        
                        
                        
                        If summons_Level > 1 Then
                                Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(46 + what_side, 2).Value, 2).Value = Round((Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(46 + what_side, 2).Value, 2).Value / 10) * (20 + (summons_Level - 1) * 2), 0)
                                Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(46 + what_side, 2).Value, 3).Value = Round((Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(46 + what_side, 2).Value, 3).Value / 10) * (20 + (summons_Level - 1) * 2), 0)
                                Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(46 + what_side, 2).Value, 6).Value = Round((Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(46 + what_side, 2).Value, 6).Value / 10) * (20 + (summons_Level - 1) * 2), 0)
                        End If
                        
                        If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                                do_it = insert_into_combat(Sheets("Game_data1").Cells(46 + what_side, 2).Value, what_side)
                        End If
                        
                        Else
                                If say_it_once = 0 Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(708, 1).Value, 1)
                                        say_it_once = 1
                                End If
                        
                        End If
                        
                Next
        Else 'just displaying
                do_it = text_Output(Sheets("Lan" & Language).Cells(874, 1).Value, 0)
                
                do_it = text_Output(" " & number_to_be_summoned & " ", 0)
                
                If number_to_be_summoned > 1 Then
                
                        If Language = 1 Then
                                do_it = text_Output(Summons_name & "s", 0, Sheets("Game_data1").Cells(21, 2).Value)
                        End If
                        
                        If Language = 2 Then
                                do_it = text_Output(eesti_nimi(Summons_name, 3), 0, Sheets("Game_data1").Cells(21, 2).Value)
                        End If
                        
                       
                Else
                        do_it = text_Output(eesti_nimi(Summons_name, 1), 0, Sheets("Game_data1").Cells(21, 2).Value)
                        
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(868, 1).Value, 0)
                do_it = text_Output(power * 2, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(869, 1).Value, 0)
                do_it = text_Output("!", 1)
        
        End If
End If

'heal ability
If just_display = 0 Then
        
        If Sheets("Spells").Cells(mitmes_spell, 31).Value <> 0 Then
                fully = 0
                healvalue = knowledge * (power * 3)
                healed_hp = 0
                
                previous_hp = Sheets("Side" & target_side).Cells(target_mob, 2).Value
                Sheets("Side" & target_side).Cells(target_mob, 2).Value = healvalue + Sheets("Side" & target_side).Cells(target_mob, 2).Value
                
                If Sheets("Side" & target_side).Cells(target_mob, 2).Value > Sheets("Side" & target_side).Cells(target_mob, 3).Value Then
                        Sheets("Side" & target_side).Cells(target_mob, 2).Value = Sheets("Side" & target_side).Cells(target_mob, 3).Value
                        fully = 1
                End If
                
                healed_hp = Sheets("Side" & target_side).Cells(target_mob, 2).Value - previous_hp
                
               
                do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value, 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                do_it = text_Output(Sheets("Lan" & Language).Cells(709, 1).Value, 0)
                do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                
                If fully = 1 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(710, 1).Value, 0)
                End If
                
                If healed_hp > 0 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(711, 1).Value, 0)
                        do_it = text_Output(" " & healvalue, 0, 4)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(712, 1).Value, 1)
                Else
                        do_it = text_Output(".", 1)
                End If
                
        End If
End If



If Sheets("Spells").Cells(mitmes_spell, 32).Value <> 0 Then 'armor
        Stat_Bonus = (1 * knowledge) + Int(power / 2)
        duration = 2 + power * power
        replace_effect = 0
        replace_Stat = 1
        replace_Duration = 1
        old_stat = 0
                
        If just_display = 0 Then
                'check for previous armor cast on target
                For x = 1 To Sheets("Game_data1").Cells(208, 2).Value
                        If Sheets("Effects").Cells(x, 2).Value = target_id Then
                        
                                If Sheets("Effects").Cells(x, 4).Value <> 0 Then
                                        replace_effect = 1
                                        mitmes_effect = x
                                        old_stat = Sheets("Effects").Cells(x, 4).Value
                                        
                                        If old_stat >= Stat_Bonus Then
                                                replace_Stat = 0
                                        End If
                                        
                                        If Sheets("Effects").Cells(x, 3).Value >= duration Then
                                                replace_Duration = 0
                                        End If
                                
                                End If
                                
                        End If
                Next
                
                If replace_effect = 0 Then
                
                        Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value + 1
                        mitmes_effect = Sheets("Game_data1").Cells(208, 2).Value
                        do_it = reset_all_effect_Bonuses(mitmes_effect)
                
                End If
                
                If replace_Stat = 1 Then
                        Sheets("Effects").Cells(mitmes_effect, 4).Value = Stat_Bonus
                        Sheets("Side" & target_side).Cells(target_mob, 14).Value = Sheets("Side" & target_side).Cells(target_mob, 14).Value - old_stat + Stat_Bonus
                End If
                
                If replace_Duration = 1 Then
                         Sheets("Effects").Cells(mitmes_effect, 3).Value = duration
                         Sheets("Effects").Cells(mitmes_effect, 1).Value = caster_id 'castija
                End If
                
                If replace_effect = 0 Then
                        do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value, 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(713, 1).Value, 0)
                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(718, 1).Value, 1)
                        
                Else
                        If Language = 1 Then
                                do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                        End If
                
                        If Language = 2 Then
                                do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(who, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                        End If
                        
                        If replace_Stat = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(714, 1).Value, 0)
                                do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(719, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(715, 1).Value, 0)
                                
                                If Language = 1 Then
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                If Language = 2 Then
                                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(716, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 0 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(717, 1).Value, 1)
                        End If
                End If
                
                Sheets("Effects").Cells(mitmes_effect, 2).Value = target_id 'target
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(881, 1).Value, 0)
                do_it = text_Output(" " & Stat_Bonus, 0, 9)
                do_it = text_Output(Sheets("Lan" & Language).Cells(882, 1).Value, 0)
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(868, 1).Value, 0)
                do_it = text_Output(" " & duration, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(869, 1).Value, 0)
                do_it = text_Output("!", 1)
        End If
End If



If Sheets("Spells").Cells(mitmes_spell, 33).Value <> 0 Then

        Stat_Bonus = (1 * knowledge) + Int(power / 8)
        duration = 2 + power
        replace_effect = 0
        replace_Stat = 1
        replace_Duration = 1
        old_stat = 0
                
                
        If just_display = 0 Then
                'check for previous haste cast on target
                For x = 1 To Sheets("Game_data1").Cells(208, 2).Value
                        If Sheets("Effects").Cells(x, 2).Value = target_id Then
                        
                                If Sheets("Effects").Cells(x, 5).Value <> 0 Then
                                        replace_effect = 1
                                        mitmes_effect = x
                                        old_stat = Sheets("Effects").Cells(x, 5).Value
                                        
                                        If old_stat >= Stat_Bonus Then
                                                replace_Stat = 0
                                        End If
                                        
                                        If Sheets("Effects").Cells(x, 3).Value >= duration Then
                                                replace_Duration = 0
                                        End If
                                
                                End If
                                
                        End If
                Next
                
                If replace_effect = 0 Then
                
                        Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value + 1
                        mitmes_effect = Sheets("Game_data1").Cells(208, 2).Value
                        do_it = reset_all_effect_Bonuses(mitmes_effect)
                End If
                
                If replace_Stat = 1 Then
                        Sheets("Effects").Cells(mitmes_effect, 5).Value = Stat_Bonus
                        Sheets("Side" & target_side).Cells(target_mob, 4).Value = Sheets("Side" & target_side).Cells(target_mob, 4).Value - old_stat + Stat_Bonus
                        do_it = add_stat(-old_stat + Stat_Bonus, 12, target_side, target_mob)
                End If
                
                If replace_Duration = 1 Then
                         Sheets("Effects").Cells(mitmes_effect, 3).Value = duration
                         Sheets("Effects").Cells(mitmes_effect, 1).Value = caster_id 'castija
                End If
                
                If Language = 1 Then
                        do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                End If
                
                If Language = 2 Then
                        do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(who, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                End If
                
                If replace_effect = 0 Then
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(720, 1).Value, 0)
                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(721, 1).Value, 1)
                
                Else
                        
                        
                        If replace_Stat = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(722, 1).Value, 0)
                                
                                If Language = 1 Then
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                If Language = 2 Then
                                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(723, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(724, 1).Value, 0)
                                
                                If Language = 1 Then
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                If Language = 2 Then
                                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(725, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 0 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(717, 1).Value, 1)
                        End If
                End If
                
                Sheets("Effects").Cells(mitmes_effect, 2).Value = target_id 'target
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(879, 1).Value, 0)
                do_it = text_Output(" " & Stat_Bonus, 0, 3)
                do_it = text_Output(Sheets("Lan" & Language).Cells(880, 1).Value, 0)
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(868, 1).Value, 0)
                do_it = text_Output(" " & duration, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(869, 1).Value, 0)
                do_it = text_Output("!", 1)
        End If
End If


        
If Sheets("Spells").Cells(mitmes_spell, 34).Value <> 0 Then
        Stat_Bonus = 2 * knowledge + Int(power / 10)
        duration = 2 + power * power
        replace_effect = 0
        replace_Stat = 1
        replace_Duration = 1
        old_stat = 0
                
        If just_display = 0 Then
        
                'check for previous strength cast on target
                For x = 1 To Sheets("Game_data1").Cells(208, 2).Value
                        If Sheets("Effects").Cells(x, 2).Value = target_id Then
                        
                                If Sheets("Effects").Cells(x, 6).Value <> 0 Then
                                        replace_effect = 1
                                        mitmes_effect = x
                                        old_stat = Sheets("Effects").Cells(x, 6).Value
                                        
                                        If old_stat >= Stat_Bonus Then
                                                replace_Stat = 0
                                        End If
                                        
                                        If Sheets("Effects").Cells(x, 3).Value >= duration Then
                                                replace_Duration = 0
                                        End If
                                
                                End If
                                
                        End If
                Next
                
                If replace_effect = 0 Then
                
                        Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value + 1
                        mitmes_effect = Sheets("Game_data1").Cells(208, 2).Value
                        do_it = reset_all_effect_Bonuses(mitmes_effect)
                
                End If
                
                If replace_Stat = 1 Then
                        Sheets("Effects").Cells(mitmes_effect, 6).Value = Stat_Bonus
                        do_it = add_stat(-old_stat + Stat_Bonus, 11, target_side, target_mob)
                End If
                
                If replace_Duration = 1 Then
                         Sheets("Effects").Cells(mitmes_effect, 3).Value = duration
                         Sheets("Effects").Cells(mitmes_effect, 1).Value = caster_id 'castija
                End If
                
                If Language = 1 Then
                        do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                End If
                
                If Language = 2 Then
                        do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(who, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                End If
                
                If replace_effect = 0 Then
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(726, 1).Value, 0)
                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(727, 1).Value, 1)
                Else
                        
                        
                        If replace_Stat = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(728, 1).Value, 0)
                                If Language = 1 Then
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                If Language = 2 Then
                                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                do_it = text_Output(Sheets("Lan" & Language).Cells(729, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(730, 1).Value, 0)
                                If Language = 1 Then
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                If Language = 2 Then
                                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                End If
                                do_it = text_Output(Sheets("Lan" & Language).Cells(731, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 0 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(717, 1).Value, 1)
                        End If
                End If
                
                player_under_str = 0
                
                If target_side <> 5 Then
                        If Sheets("Game_data1").Cells(51 + target_side, 2).Value = target_mob Then
                                do_it = recalculate_damage(target_side, 0)
                                player_under_str = 1
                        End If
                End If
                
                If player_under_str = 0 Then
                        If replace_Stat = 1 Then
                                do_it = add_stat((-old_stat + Stat_Bonus) * 5, 3, target_side, target_mob)
                                do_it = add_stat((-old_stat + Stat_Bonus), 6, target_side, target_mob)
                        End If
                End If
                
                
                Sheets("Effects").Cells(mitmes_effect, 2).Value = target_id 'target
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(875, 1).Value, 0)
                do_it = text_Output(" " & Stat_Bonus, 0, 10)
                do_it = text_Output(Sheets("Lan" & Language).Cells(876, 1).Value, 0)
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(868, 1).Value, 0)
                do_it = text_Output(" " & duration, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(869, 1).Value, 0)
                do_it = text_Output("!", 1)
        End If

End If


        
If Sheets("Spells").Cells(mitmes_spell, 36).Value <> 0 Then 'manipulate winds

        Stat_Bonus = (1 * knowledge) + Int(power / 2)
        duration = power - 1
        replace_effect = 0
        replace_Stat = 1
        replace_Duration = 1
        old_stat = 0
                
        If just_display = 0 Then
  
                For x = 1 To Sheets("Game_data1").Cells(208, 2).Value
                        
                        If Sheets("Effects").Cells(x, 7).Value <> 0 Then
                                If Sheets("Effects").Cells(x, 1).Value = caster_id Then
                                        replace_effect = 1
                                        mitmes_effect = x
                                        old_stat = Sheets("Effects").Cells(x, 7).Value
                                        
                                        If old_stat >= Stat_Bonus Then
                                                replace_Stat = 0
                                        End If
                                        
                                        If Sheets("Effects").Cells(x, 3).Value >= duration Then
                                                replace_Duration = 0
                                        End If
                                End If
                        End If
                        
                Next
                
                If replace_effect = 0 Then
                
                        Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value + 1
                        mitmes_effect = Sheets("Game_data1").Cells(208, 2).Value
                        do_it = reset_all_effect_Bonuses(mitmes_effect)
                End If
                
                If replace_Stat = 1 Then
                        Sheets("Effects").Cells(mitmes_effect, 1).Value = caster_id
                        Sheets("Effects").Cells(mitmes_effect, 2).Value = 0
                        Sheets("Effects").Cells(mitmes_effect, 7).Value = Stat_Bonus
                End If
                
                If replace_Duration = 1 Then
                         Sheets("Effects").Cells(mitmes_effect, 3).Value = duration
                End If
                
                If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                        If Language = 1 Then
                                do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                        End If
                
                        If Language = 2 Then
                                do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(who, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                        End If
                        
                Else
                        do_it = text_Output(Sheets("Lan" & Language).Cells(732, 1).Value, 0)
                End If
                
                If replace_effect = 0 Then
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(733, 1).Value, 1)
                        
                Else
                        
                        
                        If replace_Stat = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(734, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(735, 1).Value, 1)
                        End If
                        
                        If replace_Stat = 0 And replace_Duration = 0 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(717, 1).Value, 1)
                        End If
                End If
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(877, 1).Value, 0)
                do_it = text_Output(" " & Stat_Bonus, 0, 33)
                do_it = text_Output(Sheets("Lan" & Language).Cells(878, 1).Value, 0)
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(868, 1).Value, 0)
                do_it = text_Output(" " & duration, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(869, 1).Value, 0)
                do_it = text_Output("", 1)
        End If
        
End If

If just_display = 0 Then
        do_it = display_status(2)
End If

End Function
Function reset_all_effect_Bonuses(mitmes_effect As Integer)
    Sheets("Effects").Cells(mitmes_effect, 4).Value = 0
    Sheets("Effects").Cells(mitmes_effect, 5).Value = 0
    Sheets("Effects").Cells(mitmes_effect, 6).Value = 0
    Sheets("Effects").Cells(mitmes_effect, 7).Value = 0
    Sheets("Effects").Cells(mitmes_effect, 9).Value = 0
    Sheets("Effects").Cells(mitmes_effect, 10).Value = 0
    Sheets("Effects").Cells(mitmes_effect, 11).Value = 0
End Function

-------------------------------------------------------------------------------
VBA MACRO Sheet5.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet5'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet6.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet6'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet13.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet13'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module2.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module2'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Function mobs_display(Optional kas_vaja_kustudada_kyik = 0)
Dim X_alg As Integer
Dim Y_alg As Integer
Dim max_mobs_to_display As Integer
Dim active_ruut As Integer
Dim active_player As Integer
Dim output_Final As String
Dim output_Hitpoints As String
Dim output_mana As Integer
Dim x As Integer
Dim y As Integer

active_player = Sheets("Game_data1").Cells(10, 2).Value
active_ruut = Sheets("Game_data1").Cells(5 + active_player, 2).Value

X_alg = Sheets("Game_data1").Cells(111, 2).Value
Y_alg = Sheets("Game_data1").Cells(112, 2).Value

If kas_vaja_kustudada_kyik <> 0 Then
  'siin kontrollime kas mingi comment on ees, kui on siis kustutame
For x = 1 To 5
        For y = 1 To 8
                If Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value <> "" Then
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value = ""
                End If
                
                Set mycomment = Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment
                
                If mycomment Is Nothing Then
                        'do nothing
                       
                Else 'kustuda
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Delete
                End If
                
                
        Next
Next

Else

'commenti tekitamine
        For x = 1 To 5
                
                If Sheets("Game_data1").Cells(5 + x, 2).Value = active_ruut Or x = 5 Then
                            If Sheets("Game_data1").Cells(87, 2).Value = 0 Then
                                max_mobs_to_display = Sheets("Game_data1").Cells(46 + x, 2).Value
                            Else
                                max_mobs_to_display = Sheets("Game_data1").Cells(55 + x, 2).Value
                            End If
                            
                            For y = 1 To 8
                                    
                                    If y <= max_mobs_to_display Then
                                            'Textiline nimi ka
                                            If Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value <> Sheets("Side" & x).Cells(y, 1).Value Then
                                                    Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value = Sheets("Side" & x).Cells(y, 1).Value
                                            End If
                                            If Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Font.ColorIndex <> Sheets("Game_data1").Cells(105 + x, 2).Value Then
                                                    Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Font.ColorIndex = Sheets("Game_data1").Cells(105 + x, 2).Value
                                            End If
                                            'commenti tekitamine
                                            Set mycomment = Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment
                
                                            If mycomment Is Nothing Then
                                                    Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).AddComment
                                            
                                            End If
                                            
                                           do_it = display_final_stats(x, y)
                                           
                                                                                
                                    Else
                                    
                                            If Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value <> "" Then
                                                    Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value = ""
                                            End If
                        
                                            Set mycomment = Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment
                                            If mycomment Is Nothing Then
                                                'do nothing
                                            Else 'kustuda
                                                    Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Delete
                                            End If
                                    
                                    End If
                                    
                            Next
                Else
                
                        For y = 1 To 8
                                If Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value <> "" Then
                                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Value = ""
                                End If
                                
                                Set mycomment = Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment
                                
                                If mycomment Is Nothing Then
                                        'do nothing
                                       
                                Else 'kustuda
                                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Delete
                                End If
                        
                        
                        Next
                End If
                
        Next

End If

End Function
Function display_final_stats(what_side As Integer, who As Integer)
Dim X_alg As Integer
Dim Y_alg As Integer
Dim max_mobs_to_display As Integer
Dim active_ruut As Integer
Dim active_player As Integer
Dim output_Final As String
Dim output_Hitpoints As String
Dim output_Building As String
Dim is_it_player As Integer
Dim counter_mana(7) As Integer
Dim counter_mana_color(7) As Integer
Dim counter_mana_how_many_chars(7) As Integer
Dim how_many_manas As Integer
Dim mana_is As Integer
Dim counter_hitpoints_how_many_chars As Integer
Dim elemental_damage_to_display(4) As String
Dim elemental_damage_char(4) As Integer
Dim if_elemental_damage As Integer
Dim elemental_damage_counter(4) As Integer
Dim elemental_Damage_amount(4) As Integer
Dim elemental_Color(4) As Integer
Dim counter_elemental As Integer
Dim pos_in_elemental As Integer
Dim is_coma_needed As Integer
Dim attack_round_output As Integer
Dim display_strength As Integer
Dim display_winds As Integer
Dim display_haste As Integer
Dim display_armor As Integer
Dim display_armor_how_many_chars As Integer
Dim display_armor_counter As Integer
Dim display_armor_days_chars As Integer
Dim display_armor_days_counter As Integer
Dim display_haste_how_many_chars As Integer
Dim display_haste_counter As Integer
Dim display_haste_days_chars As Integer
Dim display_haste_days_counter As Integer
Dim display_strength_how_many_chars As Integer
Dim display_strength_counter As Integer
Dim display_strength_days_chars As Integer
Dim display_strength_days_counter As Integer
Dim display_winds_how_many_chars As Integer
Dim display_winds_counter As Integer
Dim display_winds_days_chars As Integer
Dim display_winds_days_counter As Integer

Dim width_increase As Integer
Dim a As Integer
Dim x As Integer
Dim y As Integer
Dim comment_Counter As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

active_player = Sheets("Game_data1").Cells(10, 2).Value
active_ruut = Sheets("Game_data1").Cells(5 + active_player, 2).Value

comment_Counter = 0
width_increase = 0

X_alg = Sheets("Game_data1").Cells(111, 2).Value
Y_alg = Sheets("Game_data1").Cells(112, 2).Value

output_Hitpoints = ""
  output_Final = ""

x = what_side
y = who

is_it_player = 0

If x <> 5 Then
        If y = Sheets("Game_data1").Cells(51 + x, 2).Value Then
                is_it_player = 1
        End If
End If

mobi_nr = y
counter_elemental = 0

For a = 1 To 4
    If Sheets("Side" & x).Cells(y, 49 + a).Value > 0 Then

        counter_elemental = counter_elemental + 1
        is_coma_needed = counter_elemental

        elemental_damage_to_display(counter_elemental) = what_damage_type(3 + a, 5)
        elemental_Color(counter_elemental) = Sheets("game_data1").Cells(21, 2).Value
        elemental_Damage_amount(counter_elemental) = Sheets("Side" & x).Cells(y, 49 + a).Value
        elemental_damage_char(counter_elemental) = Len(elemental_Damage_amount(counter_elemental))

    End If
Next


If is_it_player = 1 Then
        
         output_Hitpoints = output_Hitpoints & Sheets("Side" & x).Cells(y, 1).Value & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(475, 1).Value
         hitpointsi_pikkus = Len(output_Hitpoints) + 1 ' enne hitpointi display
          
         output_Hitpoints = output_Hitpoints & Sheets("Side" & x).Cells(y, 2).Value
         
         counter_hitpoints_how_many_chars = Len(Sheets("Side" & x).Cells(y, 2).Value)
            
 Else
        
        output_Hitpoints = output_Hitpoints & Sheets("Side" & x).Cells(y, 1).Value & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(475, 1).Value
         hitpointsi_pikkus = Len(output_Hitpoints) + 1
         output_Hitpoints = output_Hitpoints & Sheets("Side" & x).Cells(y, 2).Value & "/" & Sheets("Side" & x).Cells(y, 3).Value
         counter_hitpoints_how_many_chars = Len(Sheets("Side" & x).Cells(y, 2).Value)
 
            
 End If
      
 If Sheets("Side" & x).Cells(y, 37).Value = 0 Then
 
                                output_Final = output_Hitpoints & Chr(10) & Chr(10)
                                
                                damage_first = Len(output_Final) + 1
                                                                
 output_Final = output_Final & Sheets("Side" & x).Cells(y, 5).Value & "d" & Sheets("Side" & x).Cells(y, 6).Value & " " & what_damage_type(Sheets("Side" & x).Cells(y, 7).Value, 1) & Sheets("Lan" & Language).Cells(476, 1).Value & Chr(10)
                                attack_pikkus = Len(output_Final) + 1
                                attack_round_output = Sheets("Side" & x).Cells(y, 4).Value
                         
                         
                         If attack_round_output = 1 Then
                            output_Final = output_Final & Sheets("Side" & x).Cells(y, 4).Value & Sheets("Lan" & Language).Cells(513, 1).Value
                         Else
                            output_Final = output_Final & Sheets("Side" & x).Cells(y, 4).Value & Sheets("Lan" & Language).Cells(515, 1).Value
                         End If
                         
                    If counter_elemental > 0 Then

                            comment_Counter = comment_Counter + counter_elemental + 2

                            output_Final = output_Final & Chr(10) & Chr(10) & Sheets("Side" & x).Cells(y, 1).Value & Sheets("Lan" & Language).Cells(517, 1).Value

                                For pos_in_elemental = 1 To counter_elemental
                                        elemental_damage_counter(pos_in_elemental) = Len(output_Final)
                                        If is_coma_needed > 1 Then
                                            output_Final = output_Final & elemental_Damage_amount(pos_in_elemental) & " " & LCase(elemental_damage_to_display(pos_in_elemental)) & ", "
                                             is_coma_needed = is_coma_needed - 1
                                        Else
                                            output_Final = output_Final & elemental_Damage_amount(pos_in_elemental) & " " & LCase(elemental_damage_to_display(pos_in_elemental))
                                        End If
                                Next

                            output_Final = output_Final & Sheets("Lan" & Language).Cells(518, 1).Value
                    Else
                            output_Final = output_Final
                    End If

                
                             output_Final = output_Final & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(478, 1).Value & Sheets("Side" & x).Cells(y, 11).Value & " (" & Sheets("Side" & x).Cells(y, 8).Value & ")" _
                             & Chr(10) & Sheets("Lan" & Language).Cells(479, 1).Value & Sheets("Side" & x).Cells(y, 12).Value & " (" & Sheets("Side" & x).Cells(y, 9).Value & ")" _
                             & Chr(10) & Sheets("Lan" & Language).Cells(480, 1).Value & Sheets("Side" & x).Cells(y, 13).Value & " (" & Sheets("Side" & x).Cells(y, 10).Value & ")" & Chr(10) _
                             & Chr(10) & Sheets("Lan" & Language).Cells(481, 1).Value & Sheets("Side" & x).Cells(y, 14).Value
                                armori_pikkus = Len(output_Final) - 1 '
                                
                                output_Final = output_Final & Chr(10) & Chr(10)
                                
  Else 'castle display
         output_Final = output_Hitpoints & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(481, 1).Value & Sheets("Side" & x).Cells(y, 14).Value
                armori_pikkus = Len(output_Final) - 1 '
                output_Final = output_Final & Chr(10) & Chr(10)
         
  End If
  

mana_is = 0
how_many_manas = 0
  
 For z = 1 To 7 ' mana displaymine
 
         If Sheets("Side" & x).Cells(y, 15 + z).Value > 0 Then
         
                 If mana_is = 0 Then
                    output_Final = output_Final & Sheets("Lan" & Language).Cells(482, 1).Value & Chr(10)
                    mana_is = 1
                    comment_Counter = comment_Counter + 2
                 End If
                                 
                how_many_manas = how_many_manas + 1
                 
                counter_mana(how_many_manas) = Len(output_Final)
                 
                output_Final = output_Final & " " & Sheets("Side" & x).Cells(y, 15 + z).Value & " " & "(+" & Sheets("Side" & x).Cells(y, 22 + z).Value & ")" & "   " & what_damage_type(z + 3) & Chr(10)
                 
                counter_mana_how_many_chars(how_many_manas) = Len(Sheets("Side" & x).Cells(y, 15 + z).Value)
                 
                counter_mana_color(how_many_manas) = Sheets("game_data1").Cells(21, 2).Value
                
                comment_Counter = comment_Counter + 1
                
         End If

 Next
 
 'displayme mobide spellid
 If is_it_player = 0 Then
 
        If Sheets("Side" & x).Cells(y, 40).Value > 0 Then 'kas teab mõnda spelli
               For z = 1 To Sheets("Side" & x).Cells(y, 40).Value
        
                output_Final = output_Final & Sheets("Lan" & Language).Cells(483, 1).Value & eesti_nimi(Sheets("Side" & x).Cells(y, 40 + z).Value, 1) & Sheets("Lan" & Language).Cells(484, 1).Value & Chr(10)
                
                 comment_Counter = comment_Counter + Sheets("Side" & x).Cells(y, 40).Value
                
               Next
        End If
        
End If

'displayme mercenaride ja summonite counteri
If is_it_player = 0 Then
        
        If Sheets("Side" & x).Cells(y, 39).Value > 0 Then
            output_Final = output_Final & Sheets("Side" & x).Cells(y, 39).Value & Sheets("Lan" & Language).Cells(485, 1).Value
        
        comment_Counter = comment_Counter + 2
        
        End If
        
        If Sheets("Side" & x).Cells(y, 65).Value > 0 And Sheets("Side" & x).Cells(y, 66).Value <> 0 Then
                
            output_Final = output_Final & Chr(10) & (10 - Sheets("Side" & x).Cells(y, 65).Value) & Sheets("Lan" & Language).Cells(883, 1).Value & Sheets("Side" & x).Cells(y, 66).Value
            comment_Counter = comment_Counter + 4
        
        End If
        
End If

display_armor = is_effect_on_target(Sheets("Side" & x).Cells(y, 35).Value, 4)

If display_armor = 1 Then
        output_Final = output_Final & Chr(10) & Sheets("Lan" & Language).Cells(866, 1).Value
        display_armor_counter = Len(output_Final)
        display_armor_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        output_Final = output_Final & Sheets("Game_data1").Cells(269, 2).Value & Sheets("Lan" & Language).Cells(867, 1).Value
        output_Final = output_Final & Sheets("Lan" & Language).Cells(868, 1).Value
        display_armor_days_counter = Len(output_Final)
        display_armor_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        
        output_Final = output_Final & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        comment_Counter = comment_Counter + 2
End If

display_strength = is_effect_on_target(Sheets("Side" & x).Cells(y, 35).Value, 6)

If display_strength = 1 Then
        output_Final = output_Final & Chr(10) & Sheets("Lan" & Language).Cells(866, 1).Value
        display_strength_counter = Len(output_Final)
        display_strength_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        output_Final = output_Final & Sheets("Game_data1").Cells(269, 2).Value & Sheets("Lan" & Language).Cells(870, 1).Value
        output_Final = output_Final & Sheets("Lan" & Language).Cells(868, 1).Value
        display_strength_days_counter = Len(output_Final)
        display_strength_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        output_Final = output_Final & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        comment_Counter = comment_Counter + 2
End If



display_winds = is_effect_on_target(Sheets("Side" & x).Cells(y, 35).Value, 7)

If display_winds = 1 Then
        output_Final = output_Final & Chr(10) & Sheets("Lan" & Language).Cells(871, 1).Value
        display_winds_counter = Len(output_Final)
        display_winds_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        
        output_Final = output_Final & Sheets("Game_data1").Cells(269, 2).Value & Sheets("Lan" & Language).Cells(872, 1).Value
        
        output_Final = output_Final & Sheets("Lan" & Language).Cells(868, 1).Value
        display_winds_days_counter = Len(output_Final)
        display_winds_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        output_Final = output_Final & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        
        comment_Counter = comment_Counter + 2
End If
 
display_haste = is_effect_on_target(Sheets("Side" & x).Cells(y, 35).Value, 5)

If display_haste = 1 Then
        output_Final = output_Final & Chr(10) & Sheets("Lan" & Language).Cells(866, 1).Value
        display_haste_counter = Len(output_Final)
        display_haste_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        
        output_Final = output_Final & Sheets("Game_data1").Cells(269, 2).Value
        output_Final = output_Final & Sheets("Lan" & Language).Cells(873, 1).Value
        
        output_Final = output_Final & Sheets("Lan" & Language).Cells(868, 1).Value
        
        display_haste_days_counter = Len(output_Final)
        display_haste_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        output_Final = output_Final & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        
        comment_Counter = comment_Counter + 3
End If

If display_winds = 1 Or display_strength = 1 Or display_armor = 1 Or display_haste = 1 Then
        width_increase = width_increase + 12
        comment_Counter = comment_Counter + 1
End If
 
Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Text Text:=output_Final

 'commenti värvimine kui valmis
 'Sheets("Game").Cells(X_alg + (X - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(eelmise_pikkus, 2).Font.ColorIndex = 16

 'commenti laius ja pikkus
 
 If Sheets("Side" & x).Cells(y, 37).Value = 0 Then 'not a building
        
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.Width = 125 + width_increase * 10
        
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.Height = 175 + comment_Counter * 12
 Else
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.Width = 100
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.Height = 100
 End If
 
 With Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters.Font
         .Name = "system"
         .Size = 10
         .Bold = True
 End With
 
 'värvimine
 
If is_it_player = 1 Then

        If Sheets("Side" & x).Cells(y, 2).Value > 0 Then
        
                If 100 / Sheets("Side" & x).Cells(y, 2).Value < 2 Then
                        'värvime roheliseks
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 10
                End If
                
                If 100 / Sheets("Side" & x).Cells(y, 2).Value < 4 And 100 / Sheets("Side" & x).Cells(y, 2).Value >= 2 Then
                ' värvime kollaseks
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 9
                End If
        
                If 100 / Sheets("Side" & x).Cells(y, 2).Value >= 4 Then
                'värvime punaseks
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 3
                End If
        Else
                Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 3
        End If
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.Name = Arial
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.Size = 18
End If

If is_it_player = 0 Then

        If Sheets("Side" & x).Cells(y, 2).Value > 0 Then
        
                If Sheets("Side" & x).Cells(y, 3).Value / Sheets("Side" & x).Cells(y, 2).Value < 2 Then
                        'värvime roheliseks
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 10
                End If
                
                If Sheets("Side" & x).Cells(y, 3).Value / Sheets("Side" & x).Cells(y, 2).Value < 4 And Sheets("Side" & x).Cells(y, 3).Value / Sheets("Side" & x).Cells(y, 2).Value >= 2 Then
                ' värvime kollaseks
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 9
                End If
        
                If Sheets("Side" & x).Cells(y, 3).Value / Sheets("Side" & x).Cells(y, 2).Value > 4 Then
                'värvime punaseks
                        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 3
                End If
        Else
                Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, counter_hitpoints_how_many_chars).Font.ColorIndex = 3
        
        End If
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, 2).Font.Name = Arial
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus, 2).Font.Size = 10
End If

'damage värvimine
Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(damage_first, 1).Font.ColorIndex = 23
Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(damage_first + 2, 2).Font.ColorIndex = 23
'attacks
Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(attack_pikkus, 1).Font.ColorIndex = 23
'värvime elemental_damage
For pos_in_elemental = 1 To counter_elemental
       Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(elemental_damage_counter(pos_in_elemental) + 1, elemental_damage_char(pos_in_elemental)).Font.ColorIndex = elemental_Color(pos_in_elemental)
Next
'armor värvimine
Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(armori_pikkus, 2).Font.ColorIndex = 18
'mana värvimine

For z = 1 To how_many_manas
        
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(counter_mana(z) + 2, counter_mana_how_many_chars(z)).Font.ColorIndex = counter_mana_color(z)

Next

If display_armor = 1 Then
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_armor_counter + 1, display_armor_how_many_chars).Font.ColorIndex = 18
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_armor_days_counter + 1, display_armor_days_chars).Font.ColorIndex = 5
End If

If display_strength = 1 Then
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_strength_counter + 1, display_strength_how_many_chars).Font.ColorIndex = 18
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_strength_days_counter + 1, display_strength_days_chars).Font.ColorIndex = 5
End If

If display_winds = 1 Then
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_winds_counter + 1, display_winds_how_many_chars).Font.ColorIndex = 18
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_winds_days_counter + 1, display_winds_days_chars).Font.ColorIndex = 5
End If

If display_haste = 1 Then
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_haste_counter + 1, display_haste_how_many_chars).Font.ColorIndex = 18
        Sheets("Game").Cells(X_alg + (x - 1), Y_alg + (y - 1) * 4).Comment.Shape.TextFrame.Characters(display_haste_days_counter + 1, display_haste_days_chars).Font.ColorIndex = 5
End If

End Function

Function Joonista_asukoht(uus_asukoht As Integer, vana_asukoht As Integer, current_Player As Integer, Optional what As String = "")
Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim c As Integer
Dim a As Integer
Dim what_player As Integer
Dim How_many_chars_to_color As Integer
Dim counter1 As Integer
Dim ruudu_omanik As Integer
Dim mana_to_display As String
Dim player_appearance As String
Dim Language As Integer
Dim mana_how_many_chars As Integer
Dim mana_color As Integer
Dim output_Final As String
Dim counter_mana_chars As Integer
Dim if_mana_land As Integer
Dim counter_land_defender_chars As Integer
Dim counter_land_defender As Integer
Dim counter_land_tax As Integer
Dim counter_land_tax_chars As Integer
Dim land_owner As Integer
Dim land_owner_chars As Integer
Dim Rounds As Integer
Dim rounds_char As Integer
Dim elemental_damage_to_display(4) As String
Dim elemental_damage_char(4) As Integer
Dim if_elemental_damage As Integer
Dim elemental_damage_counter(4) As Integer
Dim elemental_Damage_amount(4) As Integer
Dim elemental_Color(4) As Integer
Dim counter_elemental As Integer
Dim pos_in_elemental As Integer
Dim armor As Integer
Dim armor_char As Integer
Dim output_Final2 As String
Dim total_lands_char As Integer
Dim total_player_chars As Integer
Dim total_income_chars As Integer
Dim income_chars As Integer
Dim total_gold_chars As Integer
Dim gold_chars As Integer

Dim B As Integer
                                'display_final_stats copy
Dim output_Hitpoints As String
Dim output_Building As String
Dim counter_mana(7) As Integer
Dim counter_mana_color(7) As Integer
Dim counter_mana_how_many_chars(7) As Integer
Dim how_many_manas As Integer
Dim mana_is As Integer
Dim counter_hitpoints_how_many_chars As Integer
Dim elemental_damage_to_display2(4) As String
Dim elemental_damage_char2(4) As Integer
Dim if_elemental_damage2 As Integer
Dim elemental_damage_counter2(4) As Integer
Dim elemental_Damage_amount2(4) As Integer
Dim elemental_Color2(4) As Integer
Dim counter_elemental2 As Integer
Dim pos_in_elemental2 As Integer
Dim is_coma_needed2 As Integer
Dim attack_round_output As Integer
Dim comment_Counter As Integer

Dim who As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(x, 1).Value
output_Final = ""

If (current_Player = 12) Then 'Tax
    x = 2
    y = 2
player_appearance = "+" & Sheets("Game_map").Cells(uus_asukoht, 6).Value & "$"
End If

If (current_Player = 13) Then 'Castle Building add level number
    x = 2
    y = 0
    player_appearance = what
End If


If (current_Player = 11) Then 'Castle Building add color
    x = 2
    y = 1
    player_appearance = ""
End If


If (current_Player = 10) Then 'Maaladele commentite tekitamine
    x = 3
    y = 0
    player_appearance = ""
End If

If (current_Player = 8) Then ' Totaalne kustutamine ja ülevärvimine (AEGLANE)
    x = 0
    y = 0
player_appearance = ""
End If

If (current_Player = 9) Then 'Land Cost
    x = 2
    y = 2
player_appearance = Sheets("Game_map").Cells(uus_asukoht, 3).Value & "$"
End If




If (current_Player = 7) Then 'Omaniku värvikese ülevärvimine valgeks
    x = 2
    y = 0
player_appearance = Sheets("Game_data1").Cells(21, 2).Value
End If


If (current_Player = 6) Then 'Omaniku_värvike
    x = 2
    y = 0
player_appearance = Sheets("Game_data1").Cells(21, 2).Value
End If


If (current_Player = 5) Then 'maalade nimetamine
    x = 3
    y = 0
    player_appearance = Sheets("Game_data1").Cells(21, 2).Value
End If

If (current_Player = 1) Then 'player 1
    x = 0
    y = 0
    If what = "" Then
            player_appearance = Sheets("Game_data1").Cells(11, 2).Value
    Else
            If what = "V1" Or what = "V2" Then
                    player_appearance = Sheets("Game_data1").Cells(11, 2).Value
            Else
                    player_appearance = what
            End If
    End If
End If

If (current_Player = 2) Then 'player 2
    x = 0
    y = 2
    If what = "" Then
            player_appearance = Sheets("Game_data1").Cells(12, 2).Value
    Else
            If what = "V1" Or what = "V2" Then
                    player_appearance = Sheets("Game_data1").Cells(12, 2).Value
            Else
                    player_appearance = what
            End If
    End If
End If

If (current_Player = 3) Then 'player 3
    x = 1
    y = 0
    If what = "" Then
            player_appearance = Sheets("Game_data1").Cells(13, 2).Value
    Else
            If what = "V1" Or what = "V2" Then
                    player_appearance = Sheets("Game_data1").Cells(13, 2).Value
            Else
                    player_appearance = what
            End If
    End If
End If

If (current_Player = 4) Then 'player 4
    x = 1
    y = 2
    If what = V1 Or what = V2 Then
            player_appearance = Sheets("Game_data1").Cells(14, 2).Value
    Else
            If what = "V1" Or what = "V2" Then
                    player_appearance = Sheets("Game_data1").Cells(14, 2).Value
            Else
                    player_appearance = what
            End If
    End If
    
End If

Rem Siin me siis joonistame kaardile mida vaja

For z = 1 To 34
        If (uus_asukoht = z) Then
                If (current_Player = 6 Or current_Player = 7 Or current_Player = 10 Or current_Player = 11) Then
                        
                        If (current_Player = 6) Then
                            ruudu_omanik = Sheets("Game_map").Cells(uus_asukoht, 2).Value
                            If ruudu_omanik = 0 Then
                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.ColorIndex = 2
                            Else
                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.Color = Sheets("Game_data1").Cells(10 + Sheets("Game_data1").Cells(10, 2).Value, 2).Font.Color
                            End If
                        End If
                        
                        
                        
                        If (current_Player = 11) Then
                            ruudu_omanik = Sheets("Game_map").Cells(uus_asukoht, 2).Value
                            If ruudu_omanik = 0 Then
                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.ColorIndex = 2
                            Else
                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.Color = Sheets("Game_data1").Cells(10 + Sheets("Game_data1").Cells(10, 2).Value, 2).Font.Color
                            End If
                        End If
                        
                        If (current_Player = 7) Then
                                If (Sheets("Game_map").Cells(z, 1).Value > 20) Then
                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.Color = Sheets("Game").Cells(1, 1).Interior.Color
                                End If
                        End If
                        If (current_Player = 10) Then 'commentite panemine maaladele
                               
                               'siin kontrollime kas mingi comment on ees, kui on siis kustutame
                               Set mycomment = Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment
                                If mycomment Is Nothing Then
                                 'do nothing
                                 Else 'kustuda
                                 Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + 3, Sheets("Game_map").Cells(z, 9).Value).Comment.Delete
                                End If
                                
                                If (Sheets("Game_map").Cells(z, 1).Value > 20) Then
                                'kood commentite panemiseks ostetavatele basic maaladele
                                      
                                        Rem Sheets("Game").Cells(Sheets("Game_map").Cells(Z, 8).Value + 3, Sheets("Game_map").Cells(Z, 9).Value).Comment.Delete
                                        If (Sheets("Game_map").Cells(z, 2).Value > 0) Then
                                                Sheets("Game_data1").Cells(22, 2).Value = Sheets("Game_data1").Cells(10 + Sheets("Game_map").Cells(z, 2).Value, 2).Value
                                        Else
                                                Sheets("Game_data1").Cells(22, 2).Value = Sheets("Lan" & Language).Cells(498, 1).Value
                                        End If
                                        
                                        If (Sheets("Game_map").Cells(z, 12).Value = 0) Then
                                                Sheets("Game_data1").Cells(23, 2).Value = Sheets("Lan" & Language).Cells(499, 1).Value
                                        End If
                                        If (Sheets("Game_map").Cells(z, 12).Value = 1) Then
                                                Sheets("Game_data1").Cells(23, 2).Value = Sheets("Lan" & Language).Cells(500, 1).Value
                                        End If
                                        If (Sheets("Game_map").Cells(z, 12).Value = 2) Then
                                                Sheets("Game_data1").Cells(23, 2).Value = Sheets("Lan" & Language).Cells(501, 1).Value
                                        End If
                                        If (Sheets("Game_map").Cells(z, 12).Value = 3) Then
                                                Sheets("Game_data1").Cells(23, 2).Value = Sheets("Lan" & Language).Cells(502, 1).Value
                                        End If
                                        
                                        mana_to_display = ""
                                        mana_how_many_chars = 1
                                        if_mana_land = 0
                                        
                                        For c = 1 To 7
                                            If Sheets("Game_map").Cells(35, 47 + c).Value = "Fire mana" _
                                            Or Sheets("Game_map").Cells(35, 47 + c).Value = "Earth mana" _
                                            Or Sheets("Game_map").Cells(35, 47 + c).Value = "Water mana" _
                                            Or Sheets("Game_map").Cells(35, 47 + c).Value = "Air mana" _
                                            Or Sheets("Game_map").Cells(35, 47 + c).Value = "Life mana" _
                                            Or Sheets("Game_map").Cells(35, 47 + c).Value = "Death mana" _
                                            Or Sheets("Game_map").Cells(35, 47 + c).Value = "Arcane mana" Then
                                                    
                                                    If Sheets("Game_map").Cells(z, 47 + c).Value > 0 Then
                                                        if_mana_land = 1
                                                        mana_to_display = what_damage_type(3 + c)
                                                        mana_how_many_chars = Len(mana_to_display)
                                                        mana_color = Sheets("game_data1").Cells(21, 2).Value
                                                        
                                                    End If
                                            End If
                                        Next
                                        
                                        mobi_nr = Sheets("Game_map").Cells(z, 5).Value
                                        counter_elemental = 0
                                        
                                        For a = 1 To 4
                                            If Sheets("Mobs").Cells(mobi_nr, 40 + a).Value > 0 Then
                                                         
                                                         counter_elemental = counter_elemental + 1
                                                         
                                                         elemental_damage_to_display(counter_elemental) = what_damage_type(3 + a, 5)
                                                         elemental_Color(counter_elemental) = Sheets("game_data1").Cells(21, 2).Value
                                                         elemental_Damage_amount(counter_elemental) = Sheets("Mobs").Cells(mobi_nr, 40 + a).Value
                                                         elemental_damage_char(counter_elemental) = Len(elemental_Damage_amount(counter_elemental)) + Len(elemental_damage_to_display(counter_elemental))
                                                         
                                            End If
                                        Next
                                        
                                        output_Final = output_Final & z & "# " & Sheets("Lan" & Language).Cells(516, 1).Value
                                            land_Name = Len(output_Final)
                                            land_name_char = Len(Sheets("Game_map").Cells(z, 4).Value)
                                            
                                        output_Final = output_Final & Sheets("Game_map").Cells(z, 4).Value & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(488, 1).Value
                                            land_owner = Len(output_Final)
                                            land_owner_chars = Len(Sheets("Game_data1").Cells(22, 2).Value)
                                            
                                        output_Final = output_Final & Sheets("Game_data1").Cells(22, 2).Value & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(486, 1).Value
                                            counter_land_defender = Len(output_Final)
                                            counter_land_defender_chars = Len(Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 1))
                                        
                                        output_Final = output_Final & Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 1) & Chr(10) & eesti_nimi(Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 1), 7) & Sheets("Lan" & Language).Cells(489, 1).Value & Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 2) & Sheets("Lan" & Language).Cells(490, 1).Value & Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 4) & "d" & Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 5) & Sheets("Lan" & Language).Cells(491, 1).Value & Sheets("Lan" & Language).Cells(514, 1).Value
                                            Rounds = Len(output_Final)
                                            rounds_char = Len(Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 3))
                                            
                                        output_Final = output_Final & Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 3) & Sheets("Lan" & Language).Cells(513, 1).Value
                                            
                                        If counter_elemental > 0 Then
                                        
                                            output_Final = output_Final & Chr(10) & Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 1) & Sheets("Lan" & Language).Cells(517, 1).Value
                                        
                                                For pos_in_elemental = 1 To counter_elemental
                                                        elemental_damage_counter(pos_in_elemental) = Len(output_Final)
                                                        output_Final = output_Final & elemental_Damage_amount(pos_in_elemental) & " " & elemental_damage_to_display(pos_in_elemental) & ", "
                                                Next
                                                
                                            output_Final = output_Final & Sheets("Lan" & Language).Cells(518, 1).Value
                                        Else
                                            output_Final = output_Final
                                        End If
                                        
                                        output_Final = output_Final & Chr(10) & Sheets("Lan" & Language).Cells(519, 1).Value
                                            armor = Len(output_Final)
                                            armor_char = Len(Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 10))
                                        
                                        output_Final = output_Final & Sheets("Mobs").Cells(Sheets("Game_map").Cells(z, 5).Value, 10)
                                        
                                        output_Final = output_Final & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(492, 1).Value
                                            counter_land_tax = Len(output_Final)
                                            counter_land_tax_chars = Len(Sheets("Game_map").Cells(z, 6).Value)
                                        
                                         output_Final = output_Final & Sheets("Game_map").Cells(z, 6).Value & Sheets("Lan" & Language).Cells(493, 1).Value & Chr(10) & Sheets("Lan" & Language).Cells(494, 1).Value & Sheets("Game_map").Cells(z, 11).Value & Sheets("Lan" & Language).Cells(495, 1).Value & Chr(10) & Sheets("Lan" & Language).Cells(496, 1).Value & Sheets("Game_map").Cells(z, 7).Value
                                         
                                        
                                        If if_mana_land = 1 Then
                                            output_Final = output_Final & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(510, 1).Value
                                            counter_mana_chars = Len(output_Final)
                                            output_Final = output_Final & mana_to_display & Sheets("Lan" & Language).Cells(511, 1).Value & Chr(10) & Chr(10) & Sheets("Game_data1").Cells(23, 2).Value & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(497, 1).Value & Sheets("Game_map").Cells(z, 3).Value
                                        Else
                                            output_Final = output_Final & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(512, 1).Value & Chr(10) & Chr(10) & Sheets("Game_data1").Cells(23, 2).Value & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(497, 1).Value & Sheets("Game_map").Cells(z, 3).Value
                                        End If
                                        
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).AddComment
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Text Text:=output_Final
        
                                        'commenti laius ja pikkus
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.Width = 150
                                        If counter_elemental > 0 Then
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.Height = 300
                                        Else
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.Height = 250
                                        End If
                                        
                                        ' ja komment seest valgeks
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.Fill.ForeColor.RGB = RGB(255, 255, 255)
                                        With Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters.Font
                                                .Name = "system"
                                                .Size = 10
                                                .Bold = True
                                        End With
                                
                                        'maa nime värvimine
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(land_Name + 1, land_name_char).Font.Color = Sheets("Game_map").Cells(Sheets("Game_map").Cells(z, 1).Value, 10).Interior.Color
                                        'siin värvime omaniku värvi
                                        If (Sheets("Game_map").Cells(z, 2).Value > 0) Then
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(land_owner, land_owner_chars + 1).Font.Color = Sheets("Game_data1").Cells(10 + Sheets("Game_map").Cells(z, 2).Value, 2).Font.Color
                                        Else 'neutraalse maala värvi (pruun) Gamedata_1 1.1 font color
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(land_owner + 1, land_owner_chars + 1).Font.Color = Sheets("Game_data1").Cells(1, 1).Font.Color
                                        End If
                                        'värvime land defenderi
                                         Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(counter_land_defender, counter_land_defender_chars + 1).Font.Color = Sheets("Game_data1").Cells(1, 1).Font.Color
                                        'värvime attacks per round
                                         Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(Rounds + 1, rounds_char + 1).Font.ColorIndex = 5
                                        'värvime armor
                                         Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(armor + 1, armor_char + 1).Font.ColorIndex = 18
                                        'värvime elemental_damage
                                        For pos_in_elemental = 1 To counter_elemental
                                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(elemental_damage_counter(pos_in_elemental) + 1, elemental_damage_char(pos_in_elemental) + 1).Font.ColorIndex = elemental_Color(pos_in_elemental)
                                        Next
                                        'värvime kulla
                                         Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(counter_land_tax + 1, counter_land_tax_chars + 1).Font.ColorIndex = 45
                                        'mana värvimine
                                         Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(counter_mana_chars + 1, mana_how_many_chars + 1).Font.ColorIndex = mana_color

                                End If
                        
                        End If
                Else
                        If (current_Player = 12) Then
                            ruudu_omanik = Sheets("Game_map").Cells(uus_asukoht, 2).Value

                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Font.Color = Sheets("Game_data1").Cells(10 + ruudu_omanik, 2).Font.Color
                            'arcane tower exception
                            If Sheets("Game_map").Cells(z, 1).Value = 20 Then
                                    player_appearance = ""
                            End If
                        End If
                        
                        If (current_Player = 13) Then
                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Font.ColorIndex = 1
                        End If
                        
                        If (current_Player = 9) Then
                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Font.ColorIndex = 1
                        
                        End If
                        
                        If (current_Player = 5) Then 'maa-alade värvimine kui nad on ostetavad
                                    If (Sheets("Game_map").Cells(z, 1).Value >= 20) Then
                                        
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.Color = Sheets("Game_map").Cells(Sheets("Game_map").Cells(z, 1).Value, 10).Interior.Color
                                    
                                    Else
                                                
                                            do_it = Paint_land(z, x - 3, y, Sheets("Game_map").Cells(z, 1).Value)
                                        
                                    End If
                                
                        End If
                        
                        If (current_Player = 8) Then ' totaalne ruutude puhastamine (Kirjad maha ja valgeks)
                                
                                do_it = Paint_land(z, x, y, 0)
                                
                                Rem maaalade kommentite kustuamine
                                On Error Resume Next
                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + 3, Sheets("Game_map").Cells(z, 9).Value).Comment.Delete                     'commentid kõik minema!!!
                                On Error Resume Next
                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value, Sheets("Game_map").Cells(z, 9).Value).Comment.Delete 'player 1 commentid
                                On Error Resume Next
                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value, Sheets("Game_map").Cells(z, 9).Value + 2).Comment.Delete 'player 2 commentid
                                On Error Resume Next
                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + 1, Sheets("Game_map").Cells(z, 9).Value).Comment.Delete 'player 3 commentid
                                On Error Resume Next
                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + 1, Sheets("Game_map").Cells(z, 9).Value + 2).Comment.Delete 'player 4 commentid
                        End If
                        
                        If (current_Player >= 1 And current_Player <= 4) Then 'playeri commentite tekitamine
                                
                              who = Sheets("Game_data1").Cells(51 + current_Player, 2).Value
                                
                                If what = "" Then
                                            do_it = titles_check(3, 1)
                                            do_it = Check_add_taxes(current_Player)
                                            
                                            'siin kontrollime kas mingi comment on ees, kui on siis kustutame
                                                Set mycomment = Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment
                                                 If mycomment Is Nothing Then
                                                  'do nothing
                                                  Else 'kustuda
                                                  Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Delete
                                                 End If
                                            'Sheets("Side" & current_player).Cells(Sheets("Game_data1").Cells(51 + current_player, 2).Value, 15).Value
                                            'check add taxes
                                            
                                            output_Final2 = output_Final2 & title_name(current_Player) & " " & Sheets("Game_data1").Cells(10 + current_Player, 2).Value ' title and name
                                                total_player_chars = Len(output_Final2)
                                            output_Final2 = output_Final2 & Chr(10) & Chr(10) & Sheets("Lan" & Language).Cells(537, 1).Value
                                                total_lands_char = Len(output_Final2)
                                            output_Final2 = output_Final2 & Sheets("Game_data1").Cells(63 + current_Player, 2).Value & Chr(10)
                                            output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(538, 1).Value
                                                total_income_chars = Len(output_Final2)
                                                income_chars = Len(Sheets("Game_data1").Cells(262, 2).Value)
                                            output_Final2 = output_Final2 & Sheets("Game_data1").Cells(262, 2).Value & Chr(10) & Sheets("Lan" & Language).Cells(539, 1).Value
                                                total_gold_chars = Len(output_Final2)
                                                gold_chars = Len(Sheets("Game_data1").Cells(24 + current_Player, 2).Value)
                                            output_Final2 = output_Final2 & Sheets("Game_data1").Cells(24 + current_Player, 2).Value & Chr(10) & Sheets("Lan" & Language).Cells(540, 1).Value & Sheets("Game_data1").Cells(46 + current_Player, 2).Value - 1 & Chr(10)
                                            output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(541, 1).Value & Sheets("Side" & current_Player).Cells(Sheets("Game_data1").Cells(51 + current_Player, 2).Value, 15).Value & Chr(10) & Chr(10)


counter_elemental2 = 0

For a = 1 To 4
    If Sheets("Side" & current_Player).Cells(who, 49 + a).Value > 0 Then

        counter_elemental2 = counter_elemental2 + 1
        is_coma_needed2 = counter_elemental2

        elemental_damage_to_display2(counter_elemental2) = what_damage_type(3 + a, 5)
        elemental_Color2(counter_elemental2) = Sheets("game_data1").Cells(21, 2).Value
        elemental_Damage_amount2(counter_elemental2) = Sheets("Side" & current_Player).Cells(who, 49 + a).Value
        elemental_damage_char2(counter_elemental2) = Len(elemental_Damage_amount2(counter_elemental2))

    End If
Next

         output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(475, 1).Value
            counter_hitpoints_how_many_chars = Len(Sheets("Side" & current_Player).Cells(who, 2).Value)
            hitpointsi_pikkus = Len(output_Final2)
         output_Final2 = output_Final2 & Sheets("Side" & current_Player).Cells(who, 2).Value & Chr(10)
            
        If Sheets("Side" & current_Player).Cells(who, 37).Value = 0 Then
        
                                damage_first = Len(output_Final2) + 1
                                                                
                                output_Final2 = output_Final2 & Sheets("Side" & current_Player).Cells(who, 5).Value & "d" & Sheets("Side" & current_Player).Cells(who, 6).Value & " " & what_damage_type(Sheets("Side" & current_Player).Cells(who, 7).Value, 1) & Sheets("Lan" & Language).Cells(476, 1).Value & Chr(10)
                                attack_pikkus = Len(output_Final2) + 1
                                attack_round_output = Sheets("Side" & current_Player).Cells(who, 4).Value
                         
                         If attack_round_output = 1 Then
                            output_Final2 = output_Final2 & Sheets("Side" & current_Player).Cells(who, 4).Value & Sheets("Lan" & Language).Cells(513, 1).Value
                         Else
                            output_Final2 = output_Final2 & Sheets("Side" & current_Player).Cells(who, 4).Value & Sheets("Lan" & Language).Cells(515, 1).Value
                         End If
                         
                    If counter_elemental2 > 0 Then
        
                            comment_Counter = comment_Counter + counter_elemental2
        
                            output_Final2 = output_Final2 & Chr(10) & Sheets("Side" & current_Player).Cells(who, 1).Value & Sheets("Lan" & Language).Cells(517, 1).Value
        
                                For pos_in_elemental2 = 1 To counter_elemental2
                                        elemental_damage_counter2(pos_in_elemental2) = Len(output_Final2)
                                        
                                        If is_coma_needed2 > 1 Then
                                            output_Final2 = output_Final2 & elemental_Damage_amount2(pos_in_elemental2) & " " & LCase(elemental_damage_to_display2(pos_in_elemental2)) & ", "
                                             is_coma_needed2 = is_coma_needed2 - 1
                                        Else
                                            output_Final2 = output_Final2 & elemental_Damage_amount2(pos_in_elemental2) & " " & LCase(elemental_damage_to_display2(pos_in_elemental2))
                                        End If
                                Next
        
                            output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(518, 1).Value
                    Else
                            output_Final2 = output_Final2
                    End If
                
                             output_Final2 = output_Final2 & Chr(10) & Sheets("Lan" & Language).Cells(478, 1).Value & Sheets("Side" & current_Player).Cells(who, 11).Value & " (" & Sheets("Side" & current_Player).Cells(who, 8).Value & ")" _
                             & Chr(10) & Sheets("Lan" & Language).Cells(479, 1).Value & Sheets("Side" & current_Player).Cells(who, 12).Value & " (" & Sheets("Side" & current_Player).Cells(who, 9).Value & ")" _
                             & Chr(10) & Sheets("Lan" & Language).Cells(480, 1).Value & Sheets("Side" & current_Player).Cells(who, 13).Value & " (" & Sheets("Side" & current_Player).Cells(who, 10).Value & ")" _
                             & Chr(10) & Sheets("Lan" & Language).Cells(481, 1).Value & Sheets("Side" & current_Player).Cells(who, 14).Value
                                armori_pikkus = Len(output_Final2) - 1 '
                                
                                output_Final2 = output_Final2 & Chr(10)
        End If
  

mana_is = 0
how_many_manas = 0
  
 For B = 1 To 7 ' mana displaymine
 
         If Sheets("Side" & current_Player).Cells(who, 15 + B).Value > 0 Then
         
                 If mana_is = 0 Then
                    output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(482, 1).Value & Chr(10)
                    mana_is = 1
                    comment_Counter = comment_Counter + 1
                 End If
                                 
                how_many_manas = how_many_manas + 1
                 
                counter_mana(how_many_manas) = Len(output_Final2)
                 
                output_Final2 = output_Final2 & " " & Sheets("Side" & current_Player).Cells(who, 15 + B).Value & " " & "(+" & Sheets("Side" & current_Player).Cells(who, 22 + B).Value & ")" & "   " & what_damage_type(B + 3) & Chr(10)
                 
                counter_mana_how_many_chars(how_many_manas) = Len(Sheets("Side" & current_Player).Cells(who, 15 + B).Value)
                 
                counter_mana_color(how_many_manas) = Sheets("game_data1").Cells(21, 2).Value
                
                comment_Counter = comment_Counter + 1
                
         End If

 Next
 
 display_armor = is_effect_on_target(Sheets("Side" & current_Player).Cells(who, 35).Value, 4)

If display_armor = 1 Then
        output_Final2 = output_Final2 & Chr(10) & Sheets("Lan" & Language).Cells(866, 1).Value
        display_armor_counter = Len(output_Final2)
        display_armor_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(269, 2).Value & Sheets("Lan" & Language).Cells(867, 1).Value
        output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(868, 1).Value
        display_armor_days_counter = Len(output_Final2)
        display_armor_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        comment_Counter = comment_Counter + 2
End If

display_strength = is_effect_on_target(Sheets("Side" & current_Player).Cells(who, 35).Value, 6)

If display_strength = 1 Then
        output_Final2 = output_Final2 & Chr(10) & Sheets("Lan" & Language).Cells(866, 1).Value
        display_strength_counter = Len(output_Final2)
        display_strength_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(269, 2).Value & Sheets("Lan" & Language).Cells(870, 1).Value
        output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(868, 1).Value
        display_strength_days_counter = Len(output_Final2)
        display_strength_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        comment_Counter = comment_Counter + 2
End If



display_winds = is_effect_on_target(Sheets("Side" & current_Player).Cells(who, 35).Value, 7)

If display_winds = 1 Then
        output_Final2 = output_Final2 & Chr(10) & Sheets("Lan" & Language).Cells(871, 1).Value
        display_winds_counter = Len(output_Final2)
        display_winds_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(269, 2).Value & Sheets("Lan" & Language).Cells(872, 1).Value
        
        output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(868, 1).Value
        display_winds_days_counter = Len(output_Final2)
        display_winds_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        
        comment_Counter = comment_Counter + 2
End If
 
display_haste = is_effect_on_target(Sheets("Side" & current_Player).Cells(who, 35).Value, 5)

If display_haste = 1 Then

        output_Final2 = output_Final2 & Chr(10) & Sheets("Lan" & Language).Cells(866, 1).Value
        display_haste_counter = Len(output_Final2)
        display_haste_how_many_chars = Len(Sheets("Game_data1").Cells(269, 2).Value)
        
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(269, 2).Value
        output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(873, 1).Value
        
        output_Final2 = output_Final2 & Sheets("Lan" & Language).Cells(868, 1).Value
        
        display_haste_days_counter = Len(output_Final2)
        display_haste_days_chars = Len(Sheets("Game_data1").Cells(268, 2).Value)
        output_Final2 = output_Final2 & Sheets("Game_data1").Cells(268, 2).Value & Sheets("Lan" & Language).Cells(869, 1).Value & Chr(10)
        
        comment_Counter = comment_Counter + 3
End If

If display_winds = 1 Or display_strength = 1 Or display_armor = 1 Or display_haste = 1 Then
        width_increase = width_increase + 12
        comment_Counter = comment_Counter + 1
End If
                                            Set mycomment = Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment
                                                 If mycomment Is Nothing Then
                                                  Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).AddComment
                                                 
                                                 End If
                                            
                    
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Text Text:=output_Final2
                                            
                                            'commenti laius ja pikkus
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.Width = 140
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.Height = 225 + comment_Counter * 10
                                            
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.Fill.ForeColor.RGB = RGB(255, 255, 255)
                                            With Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters.Font
                                                .Name = "system"
                                                .Size = 10
                                                .Bold = True
                                                .ColorIndex = 1
                                        
                                            End With
                                            
                                            'commenti värvimine: current player
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(1, total_player_chars).Font.ColorIndex = Sheets("Game_data1").Cells(105 + current_Player, 2).Value
                                            'total_lands värvimine
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(total_lands_char + 1, 2).Font.ColorIndex = 18
                                            'total_income värvimine
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(total_income_chars + 1, income_chars).Font.ColorIndex = 45
                                            'total_gold värvimine
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(total_gold_chars + 1, gold_chars).Font.ColorIndex = 45
                                            
                                            'hitpointsi värvimine
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(hitpointsi_pikkus + 1, counter_hitpoints_how_many_chars).Font.ColorIndex = 9
                                            'damage värvimine
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(damage_first, 1).Font.ColorIndex = 23
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(damage_first + 2, 2).Font.ColorIndex = 23
                                            'attacks
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(attack_pikkus, 1).Font.ColorIndex = 23
                                            'värvime elemental_damage
                                            For pos_in_elemental2 = 1 To counter_elemental2
                                                   Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(elemental_damage_counter2(pos_in_elemental2) + 1, elemental_damage_char2(pos_in_elemental2)).Font.ColorIndex = elemental_Color2(pos_in_elemental2)
                                            Next
                                            'armor värvimine
                                            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(armori_pikkus, 2).Font.ColorIndex = 18
                                            
                                            'mana värvimine
                                            For B = 1 To how_many_manas
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(counter_mana(B) + 2, counter_mana_how_many_chars(B)).Font.ColorIndex = counter_mana_color(B)
                                            Next
                                            
                                            If display_armor = 1 Then
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_armor_counter + 1, display_armor_how_many_chars).Font.ColorIndex = 18
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_armor_days_counter + 1, display_armor_days_chars).Font.ColorIndex = 5
                                            End If
                                            
                                            If display_strength = 1 Then
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_strength_counter + 1, display_strength_how_many_chars).Font.ColorIndex = 18
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_strength_days_counter + 1, display_strength_days_chars).Font.ColorIndex = 5
                                            End If
                                            
                                            If display_winds = 1 Then
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_winds_counter + 1, display_winds_how_many_chars).Font.ColorIndex = 18
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_winds_days_counter + 1, display_winds_days_chars).Font.ColorIndex = 5
                                            End If
                                            
                                            If display_haste = 1 Then
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_haste_counter + 1, display_haste_how_many_chars).Font.ColorIndex = 18
                                                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Shape.TextFrame.Characters(display_haste_days_counter + 1, display_haste_days_chars).Font.ColorIndex = 5
                                            End If


                                End If
                                
                                If what = "V1" Then
                                        Sheets("Game_data1").Cells(1, 1).Interior.Color = Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.Color
                                        Sheets("Game_data1").Cells(2, 1).Interior.Color = Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y + 1).Interior.Color
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.ColorIndex = 1
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y + 1).Interior.ColorIndex = 1
                                End If
                                
                                If what = "V2" Then
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Interior.Color = Sheets("Game_data1").Cells(1, 1).Interior.Color
                                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y + 1).Interior.Color = Sheets("Game_data1").Cells(2, 1).Interior.Color
                                End If
                        End If
                        
                        If (current_Player >= 1 And current_Player <= 4) Then
                                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Font.ColorIndex = Sheets("Game_data1").Cells(105 + current_Player, 2).Value
                        End If
                        
                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Value = player_appearance
                        
                End If

        End If
Next

   
    
Rem Playeri liikumine (kustutan vana positsiooni)

For z = 1 To 34
        If (vana_asukoht = z) Then
            If Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Value <> "" Then
                    Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Value = ""
            End If
            On Error Resume Next
            Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x, Sheets("Game_map").Cells(z, 9).Value + y).Comment.Delete
        End If
Next
   
End Function
Function clean_worm_tail(what_side As Integer)
Dim x As Integer

        For x = 1 To 34
                If x <> Sheets("Game_data1").Cells(5 + what_side, 2).Value Then
                        do_it = Joonista_asukoht(0, x, what_side)
                End If
        Next

End Function
Function Paint_land(z As Integer, x As Integer, y As Integer, what_color As Integer)
Dim K As Integer
Dim S As Integer

If (what_color = 0) Then
    what_color = 50
End If

For K = 0 To 3
                                        
        For S = 0 To 3
                
                If (Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x + K, Sheets("Game_map").Cells(z, 9).Value + y + S).Interior.Color <> Sheets("Game_map").Cells(what_color, 10).Interior.Color) Then
                        
                        Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x + K, Sheets("Game_map").Cells(z, 9).Value + y + S).Interior.Color = Sheets("Game_map").Cells(what_color, 10).Interior.Color
                End If
                
                If (Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x + K, Sheets("Game_map").Cells(z, 9).Value + y + S).Value <> "") Then
                        
                       Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x + K, Sheets("Game_map").Cells(z, 9).Value + y + S).Value = ""
                
                End If
        
        Next

Next


If (what_color = 1) Then 'royal chambri ruudustamine
        For K = 0 To 1
                For S = 0 To 1
                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x + K * 2, Sheets("Game_map").Cells(z, 9).Value + y + S * 2).Interior.Color = Sheets("Game_map").Cells(2, 9).Interior.Color
                Next
        Next
        For K = 0 To 1
                For S = 0 To 1
                Sheets("Game").Cells(Sheets("Game_map").Cells(z, 8).Value + x + K * 2 + 1, Sheets("Game_map").Cells(z, 9).Value + y + S * 2 + 1).Interior.Color = Sheets("Game_map").Cells(2, 9).Interior.Color
                Next
        Next
End If


End Function
Function display_status(mida_vaja_teha As Integer)
Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
                       
If (mida_vaja_teha = 0 Or mida_vaja_teha = 1) Then
    For x = 1 To 4
      Rem player 1-4 data kordinaadid
               If (x = 1) Then
                    z = 26
                    y = 11
               End If
                If (x = 2) Then
                    z = 26
                    y = 21
               End If
                If (x = 3) Then
                    z = 26
                    y = 31
                End If
                If (x = 4) Then
                    z = 26
                    y = 41
                End If
                
        
                
                
                If (mida_vaja_teha = 0) Then
                
                        If Sheets("Game").Cells(z, y - 1).Value <> "" Then
                                Sheets("Game").Cells(z, y - 1).Value = ""
                        End If
                        
                        If Sheets("Game").Cells(z + 1, y).Value <> "" Then
                                Sheets("Game").Cells(z + 1, y).Value = ""
                        End If
                        
                        If Sheets("Game").Cells(z + 2, y).Value <> "" Then
                                Sheets("Game").Cells(z + 2, y).Value = ""
                        End If
                        
                        If Sheets("Game").Cells(z + 2, y - 1).Value <> "" Then
                                Sheets("Game").Cells(z + 2, y - 1).Value = ""
                        End If
                        
                        If Sheets("Game").Cells(z + 1, y - 2).Value <> "" Then
                                Sheets("Game").Cells(z + 1, y - 2).Value = ""
                        End If
                        
                Else
                        If Sheets("Game_data1").Cells(112 + x, 2).Value = 0 Then
                                If Sheets("Game").Cells(z, y - 1).Value <> Sheets("Game_data1").Cells(10 + x, 2).Value Then
                                        Sheets("Game").Cells(z, y - 1).Value = Sheets("Game_data1").Cells(10 + x, 2).Value
                                End If
                                
                                If Sheets("Game").Cells(z, y - 1).Font.Color <> Sheets("Game_data1").Cells(10 + x, 2).Font.Color Then
                                        Sheets("Game").Cells(z, y - 1).Font.Color = Sheets("Game_data1").Cells(10 + x, 2).Font.Color
                                End If
                                
                                Sheets("Game").Cells(z, y - 1).Font.Bold = True
                                
                                If Sheets("Game").Cells(z + 1, y).Value <> Sheets("Side" & x).Cells(Sheets("Game_data1").Cells(51 + x, 2).Value, 2).Value Then
                                        Sheets("Game").Cells(z + 1, y).Value = Sheets("Side" & x).Cells(Sheets("Game_data1").Cells(51 + x, 2).Value, 2).Value
                                End If
                                
                                If Sheets("Game").Cells(z + 2, y).Value <> Sheets("Game_data1").Cells(24 + x, 2).Value Then
                                        Sheets("Game").Cells(z + 2, y).Value = Sheets("Game_data1").Cells(24 + x, 2).Value
                                End If
                                
                                If Sheets("Game").Cells(z + 2, y - 1).Value <> "$" Then
                                        Sheets("Game").Cells(z + 2, y - 1).Value = "$"
                                End If
                                
                                If Sheets("Game").Cells(z + 1, y - 2).Value <> "Life" Then
                                        Sheets("Game").Cells(z + 1, y - 2).Value = Sheets("Lan" & Language).Cells(865, 1).Value
                                End If
                                
                        End If
                        
                End If
        
        Next
End If
 

            
  
If (mida_vaja_teha = 2) Then
    
    For x = 1 To Sheets("Game_data1").Cells(2, 2).Value
        
        do_it = Joonista_asukoht(Sheets("Game_data1").Cells(5 + Sheets("Nupud").Cells(x, 4).Value, 2).Value, 0, Sheets("Nupud").Cells(x, 4).Value)
   
    Next

End If

End Function
Function text_Output(mess As String, mess_type As Integer, Optional mess_color As Integer = 1)
Dim log_last_line As Integer

Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim T As Integer

Rem Kuhukohta kirjutada
x = Sheets("game_data1").Cells(72, 2).Value
y = Sheets("game_data1").Cells(73, 2).Value

log_last_line = Sheets("game_data1").Cells(71, 2).Value

If (mess_type = 3) Then
Rem logi totaalne puhastamine
    For z = 1 To 5
    Sheets("Game").Cells(z * 2 + Sheets("game_data1").Cells(72, 2).Value - 2, y).Value = ""
    Next
    log_last_line = 0
End If

If (log_last_line = 1) Then
    x = x + 2
End If

If (log_last_line = 2) Then
    x = x + 4
End If

If (log_last_line = 3) Then
    x = x + 6
End If

If (log_last_line = 4) Then
    x = x + 8
End If

If (log_last_line = 5) Then
    
    MsgBox "Press OK"
    For z = 1 To 5
    Sheets("Game").Cells(z * 2 + Sheets("game_data1").Cells(72, 2).Value - 2, y).Value = ""
    Next
    
    log_last_line = 0

End If

If (mess_color > 1) Then 'kui peab juppi värvima siis
            If (Sheets("game_data1").Cells(130, 2).Value < 8) Then
                    Sheets("game_data1").Cells(130, 2).Value = Sheets("game_data1").Cells(130, 2).Value + 1
            End If
            Sheets("game_data1").Cells(130 + Sheets("game_data1").Cells(130, 2).Value, 2).Value = mess_color
            Sheets("game_data1").Cells(138 + Sheets("game_data1").Cells(130, 2).Value, 2).Value = Len(Sheets("game_data1").Cells(20, 2).Value)
            Sheets("game_data1").Cells(146 + Sheets("game_data1").Cells(130, 2).Value, 2).Value = Len(mess)
 
End If

If (mess_type = 0) Then
        
    
    
    Sheets("game_data1").Cells(20, 2).Value = Sheets("game_data1").Cells(20, 2).Value & mess
    
End If

If (mess_type = 1) Then

               
        Sheets("Game").Cells(x, y).Value = Sheets("game_data1").Cells(20, 2).Value & mess
        Sheets("Game").Cells(x, y).Font.ColorIndex = 1
        
        If (Sheets("game_data1").Cells(130, 2).Value > 0) Then
                For T = 1 To Sheets("game_data1").Cells(130, 2).Value
                Sheets("Game").Cells(x, y).Characters(Sheets("game_data1").Cells(138 + T, 2).Value + 1, Sheets("game_data1").Cells(146 + T, 2).Value).Font.ColorIndex = Sheets("game_data1").Cells(130 + T, 2).Value
                Next
                Sheets("game_data1").Cells(130, 2).Value = 0
        End If
        
        Sheets("game_data1").Cells(20, 2).Value = ""
        log_last_line = log_last_line + 1
        
End If

If (mess_type = 2) Then
        Sheets("Game").Cells(x, y).Font.ColorIndex = mess_color
        Sheets("Game").Cells(x, y).Value = mess
        log_last_line = log_last_line + 1
        Sheets("game_data1").Cells(20, 2).Value = ""
End If


Sheets("game_data1").Cells(71, 2).Value = log_last_line

End Function

Function Nupu_Tekitaja(nupu_pealkiri As String, nupu_command As String, nuputyyp As Integer)
Dim x As Integer
Dim double_button_warning As Integer
Dim counter_times As Integer
Dim counter_Kyrgus As Integer
Dim counter_Koht As Integer

Dim nuppude_id_counter As String

double_button_warning = 0
counter_times = 0
counter_Kyrgus = 0
    Rem Valiknupp
    
    Sheets("Game_data1").Cells(251, 2).Value = Sheets("Game_data1").Cells(251, 2).Value + 1 'nupu listicounter
    nuppude_id_counter = "nupp" & Sheets("Game_data1").Cells(251, 2).Value
    
    If (nuputyyp = 1) Then
    
            
            
            
                
                    Sheets("Game_data1").Cells(19, 2).Value = Sheets("Game_data1").Cells(19, 2).Value + 1
                    Valikunuppude_arv = Sheets("Game_data1").Cells(19, 2).Value
                    Sheets("Game_data1").Cells(129, 2).Value = Sheets("Game_data1").Cells(129, 2).Value + 1 'nupu listicounter
                    Sheets("Nupud").Cells(Sheets("Game_data1").Cells(129, 2).Value, 3).Value = nuppude_id_counter
                    
                     
                     For x = 1 To Sheets("Game_data1").Cells(19, 2).Value
                            counter_times = counter_times + 1
                            If counter_times > 5 Then
                                    counter_times = 1
                                    counter_Kyrgus = counter_Kyrgus + 1
                            End If
                            
                            counter_Koht = counter_times
                            
                     Next
                     
                        With Sheets("Game").Buttons.Add(counter_times * 95 + 15, 280 + (counter_Kyrgus * 30), 85, 25)
                                .Name = nuppude_id_counter
                                .OnAction = nupu_command
                                .Characters.Text = nupu_pealkiri
                        End With
            
            
    End If
    
    If (nuputyyp = 2) Then 'Quit nupp
            
            With Sheets("Game").Buttons.Add(680, 13, 50, 50)
                    .Name = nupu_pealkiri
                    .OnAction = nupu_command
                    .Characters.Text = nupu_pealkiri
            End With
            
    End If
    
    If (nuputyyp = 3) Then 'startgame nupp
            
            With Sheets("Game").Buttons.Add(250, 100, 200, 50)
                    .Name = nupu_pealkiri
                    .OnAction = nupu_command
                    .Characters.Text = nupu_pealkiri
            End With
    
    End If
    
    If (nuputyyp = 4) Then 'options nupp
            
            With Sheets("Game").Buttons.Add(500, 100, 100, 50)
                    .Name = nupu_pealkiri
                    .OnAction = nupu_command
                    .Characters.Text = nupu_pealkiri
            End With
    
    End If
    
    Rem nupucounterid ja listinimi
    
    Sheets("Game_data1").Cells(3, 2).Value = Sheets("Game_data1").Cells(3, 2).Value + 1
    If (nuputyyp = 1) Then
            Sheets("Nupud").Cells(Sheets("Game_data1").Cells(3, 2).Value, 2) = nuppude_id_counter
    Else
            Sheets("Nupud").Cells(Sheets("Game_data1").Cells(3, 2).Value, 2) = nupu_pealkiri
    End If
    
    
End Function
Function clean_equip_buttons()
Dim x As Integer

If (Sheets("Game_data1").Cells(129, 2).Value > 0) Then
        For x = 1 To Sheets("Game_data1").Cells(129, 2).Value
                do_it = Nuppudega_tegeleja(Sheets("Nupud").Cells(x, 3).Value, "Doesntmatter", 1, 1)
        Next
End If

Sheets("Game_data1").Cells(129, 2).Value = 0

End Function

Function Nupu_Kustutaja(nupu_pealkiri As String, nuputyyp As Integer)

Dim x As Integer
Dim y As Integer
Dim z As Integer
  
Rem ketrame meie nupulisti olemasolevad nimed läbi et leida sobiv nimeline match
  
For x = 1 To Sheets("Game_data1").Cells(3, 2).Value

         Rem kui selle nimeline nupp eksisteerib, kustutame
        
         Rem ja nihutame listi kui vaja
         If (Sheets("Nupud").Cells(x, 2).Value = nupu_pealkiri) Then
                
                Rem On Error Resume Next
                
                Sheets("Game").Buttons(nupu_pealkiri).Delete
    
                If (x < Sheets("Game_data1").Cells(3, 2).Value) Then
    
                      y = Sheets("Game_data1").Cells(3, 2).Value - x
                      
                      For z = 1 To y
                   
                            Sheets("Nupud").Cells(x - 1 + z, 2).Value = Sheets("Nupud").Cells(x + z, 2).Value
                   
                      Next
    
              
                End If
    
                Rem peame playeri valikunuppude üle eraldi arvestust, sellest syltub
                Rem kuhu neid tekitatakse
                 
                If (nuputyyp = 1) Then
                
                    Sheets("Game_data1").Cells(19, 2).Value = Sheets("Game_data1").Cells(19, 2).Value - 1
            
                End If
            
                Rem pärast edukat kustutamist võtame viimase nupu nupulistist maha, kuna nad on nihkunud
                Rem samuti vähendame nuppude üldarvu
                
                Sheets("Nupud").Cells(Sheets("Game_data1").Cells(3, 2).Value, 2) = ""
                Sheets("Game_data1").Cells(3, 2).Value = Sheets("Game_data1").Cells(3, 2).Value - 1
        
        End If

Next
End Function
Function Nuppudega_tegeleja(nupu_pealkiri As String, nupu_command As String, kas_kustudada As Integer, nuputyyp As Integer)

If (kas_kustudada = 0) Then
    
    do_it = Nupu_Tekitaja(nupu_pealkiri, nupu_command, nuputyyp)
    
    Else
   
    do_it = Nupu_Kustutaja(nupu_pealkiri, nuputyyp)

End If

Rem hiir suvalisse kohta
Range("G15").Select

End Function















-------------------------------------------------------------------------------
VBA MACRO Leht1.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet8.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet8'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Leht2.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht2'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Leht3.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht3'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Leht4.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht4'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Leht6.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht6'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Leht7.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht7'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet9.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet9'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module3.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module3'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Sub rest_and_heal()
    do_it = rest_and_heal_True()
End Sub
Sub Improve_Income()
    do_it = improve_income_true
End Sub
Sub improve_weapon()
    do_it = improve_weapons()
End Sub
Sub Buy_place()
    do_it = buy_land()
End Sub
Sub move_around()
    do_it = move_player()
End Sub
Sub cancel_spell_targeting_menu()

        Sheets("Game_data1").Cells(45, 2).Value = 0

If (Sheets("Game_data1").Cells(87, 2).Value = 0) Then
        
        Sheets("Game_data1").Cells(36, 2).Value = 0
    Else
        Sheets("Game_data1").Cells(36, 2).Value = 1
End If

        do_it = spell_list()

End Sub
Sub buy_pet()
        do_it = buy_pet_menu()
End Sub
Sub ok_pet_buy()
        do_it = buy_pet_menu(1)
End Sub
Sub hire_caravan()
        do_it = hire_caravan_menu()
End Sub
Sub hire_caravan_1()
        do_it = buy_caravan(1)
End Sub
Sub hire_caravan_2()
        do_it = buy_caravan(2)
End Sub
Sub ok_caravan_buy()
        do_it = buy_caravan(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub train_pet()
        do_it = train_pet_menu()
End Sub
Sub ok_train_pet()
        do_it = train_pet_menu(1)
End Sub

Sub options()
        do_it = options_main_menu()
End Sub
Sub options_ok()
Dim Language As Integer

    Language = Sheets("Game_data1").Cells(100, 2).Value
    
    do_it = valiknuppude_Kustutamine()
    do_it = text_Output("", 3)
    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(1, 1).Value, "start_game", 0, 3)
    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(2, 1).Value, "options", 0, 4)

End Sub
Sub send_Stuff()
        do_it = send_stuff_menu()
End Sub
Sub cancel_true_send()
        do_it = send_stuff_menu()
End Sub
Sub cancel_send_land()
        do_it = send_stuff_menu()
End Sub
Sub ok_send_land()
do_it = sending_land(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub send_land_nr_1()
do_it = sending_land(1)
End Sub
Sub send_land_nr_2()
do_it = sending_land(2)
End Sub
Sub send_land_nr_3()
do_it = sending_land(3)
End Sub
Sub send_land_nr_4()
do_it = sending_land(4)
End Sub
Sub send_land_nr_5()
do_it = sending_land(5)
End Sub
Sub send_land_nr_6()
do_it = sending_land(6)
End Sub
Sub send_land_nr_7()
do_it = sending_land(7)
End Sub
Sub send_land_nr_8()
do_it = sending_land(8)
End Sub
Sub send_land_nr_9()
do_it = sending_land(9)
End Sub
Sub send_land_nr_10()
do_it = sending_land(10)
End Sub
Sub send_land_nr_11()
do_it = sending_land(11)
End Sub
Sub send_land_nr_12()
do_it = sending_land(12)
End Sub
Sub send_land_nr_13()
do_it = sending_land(13)
End Sub
Sub send_land_nr_14()
do_it = sending_land(14)
End Sub
Sub send_land_nr_15()
do_it = sending_land(15)
End Sub
Sub send_land_nr_16()
do_it = sending_land(16)
End Sub
Sub send_land_nr_17()
do_it = sending_land(17)
End Sub
Sub send_land_nr_18()
do_it = sending_land(18)
End Sub
Sub send_land_nr_19()
do_it = sending_land(19)
End Sub
Sub send_land_nr_20()
do_it = sending_land(20)
End Sub
Sub send_land_nr_21()
do_it = sending_land(21)
End Sub
Sub send_land_nr_22()
do_it = sending_land(22)
End Sub
Sub send_land_nr_23()
do_it = sending_land(23)
End Sub
Sub send_land_nr_24()
do_it = sending_land(24)
End Sub
Sub send_land_nr_25()
do_it = sending_land(25)
End Sub
Sub send_land_nr_26()
do_it = sending_land(26)
End Sub
Sub send_land_nr_27()
do_it = sending_land(27)
End Sub
Sub send_land_nr_28()
do_it = sending_land(28)
End Sub
Sub send_land_nr_29()
do_it = sending_land(29)
End Sub
Sub send_land_nr_30()
do_it = sending_land(30)
End Sub
Sub send_land_nr_31()
do_it = sending_land(31)
End Sub
Sub send_land_nr_32()
do_it = sending_land(32)
End Sub
Sub send_land_nr_33()
do_it = sending_land(33)
End Sub
Sub send_land_nr_34()
do_it = sending_land(34)
End Sub
Sub send_gold_to_1()
        do_it = send_gold_to(1)
End Sub
Sub send_gold_to_2()
        do_it = send_gold_to(2)
End Sub
Sub send_gold_to_3()
        do_it = send_gold_to(3)
End Sub
Sub send_gold_to_4()
        do_it = send_gold_to(4)
End Sub
Sub send_item_to_1()
        do_it = send_item_to(1)
End Sub
Sub send_item_to_2()
        do_it = send_item_to(2)
End Sub
Sub send_item_to_3()
        do_it = send_item_to(3)
End Sub
Sub send_item_to_4()
        do_it = send_item_to(4)
End Sub
Sub send_land_to_1()
        do_it = send_land_to(1)
End Sub
Sub send_land_to_2()
        do_it = send_land_to(2)
End Sub
Sub send_land_to_3()
        do_it = send_land_to(3)
End Sub
Sub send_land_to_4()
        do_it = send_land_to(4)
End Sub
Sub send_item_1()
        do_it = Sell_item(1, 0, 1)
End Sub
Sub send_item_2()
        do_it = Sell_item(2, 0, 1)
End Sub
Sub send_item_3()
        do_it = Sell_item(3, 0, 1)
End Sub
Sub send_item_4()
        do_it = Sell_item(4, 0, 1)
End Sub
Sub send_item_5()
        do_it = Sell_item(5, 0, 1)
End Sub
Sub send_item_6()
        do_it = Sell_item(6, 0, 1)
End Sub
Sub send_item_7()
        do_it = Sell_item(7, 0, 1)
End Sub
Sub send_item_8()
        do_it = Sell_item(8, 0, 1)
End Sub
Sub send_item_9()
        do_it = Sell_item(9, 0, 1)
End Sub
Sub send_item_10()
        do_it = Sell_item(10, 0, 1)
End Sub
Sub send_item_11()
        do_it = Sell_item(11, 0, 1)
End Sub
Sub send_item_12()
        do_it = Sell_item(12, 0, 1)
End Sub
Sub send_item_13()
        do_it = Sell_item(13, 0, 1)
End Sub
Sub send_item_14()
        do_it = Sell_item(14, 0, 1)
End Sub
Sub send_item_15()
        do_it = Sell_item(15, 0, 1)
End Sub
Sub send_item_16()
        do_it = Sell_item(16, 0, 1)
End Sub
Sub send_item_17()
        do_it = Sell_item(17, 0, 1)
End Sub
Sub send_item_18()
        do_it = Sell_item(18, 0, 1)
End Sub
Sub send_item_19()
        do_it = Sell_item(19, 0, 1)
End Sub
Sub send_item_20()
        do_it = Sell_item(20, 0, 1)
End Sub
Sub ok_true_send()
        do_it = Sell_item(Sheets("Game_data1").Cells(167, 2).Value, 1, 1)
End Sub
Sub send_gold()
        do_it = send_menu(1)
End Sub
Sub send_item()
        do_it = send_menu(2)
End Sub
Sub send_land()
        do_it = send_menu(3)
End Sub

Sub true_train_spell()
        do_it = train_spell(Sheets("Game_data1").Cells(23, 2).Value, 1)
End Sub
Sub true_train_spell_f()
        do_it = train_spell(Sheets("Game_data1").Cells(23, 2).Value, 1, 1)
End Sub

Sub cancel_to_train_spell()
        do_it = train_knowledge_menu()
End Sub

Sub train_knowledge()
        do_it = train_knowledge_menu()
End Sub
Sub attack_1()
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 1)
End Sub
Sub attack_2()
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 2)
End Sub
Sub attack_3()
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 3)
End Sub
Sub attack_4()
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 4)
End Sub
Sub port_1()
        do_it = port_in(1)
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 1)
End Sub
Sub port_2()
        do_it = port_in(2)
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 2)
End Sub
Sub port_3()
        do_it = port_in(3)
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 3)
End Sub
Sub port_4()
        do_it = port_in(4)
        do_it = attack_player(Sheets("Game_data1").Cells(10, 2).Value, 4)
End Sub

Sub do_not_port()
        do_it = execute_Combat_with_do_not_port()
End Sub
Sub move_away_1()
        do_it = execute_Combat_with_move_away(1)
End Sub
Sub move_away_2()
        do_it = execute_Combat_with_move_away(2)
End Sub
Sub move_away_3()
        do_it = execute_Combat_with_move_away(3)
End Sub
Sub move_away_4()
        do_it = execute_Combat_with_move_away(4)
End Sub
Sub do_not_join_1()
        do_it = execute_Combat_with_do_not_join(1)
End Sub
Sub do_not_join_2()
        do_it = execute_Combat_with_do_not_join(2)
End Sub
Sub do_not_join_3()
        do_it = execute_Combat_with_do_not_join(3)
End Sub
Sub do_not_join_4()
        do_it = execute_Combat_with_do_not_join(4)
End Sub
Sub engage_side1()
        do_it = another_player_joins_fight(Sheets("Game_data1").Cells(98, 2).Value, 1)
End Sub
Sub engage_side2()
        do_it = another_player_joins_fight(Sheets("Game_data1").Cells(98, 2).Value, 2)
End Sub
Sub engage_side3()
        do_it = another_player_joins_fight(Sheets("Game_data1").Cells(98, 2).Value, 3)
End Sub
Sub engage_side4()
        do_it = another_player_joins_fight(Sheets("Game_data1").Cells(98, 2).Value, 4)
End Sub
Sub engage_side5()
        do_it = another_player_joins_fight(Sheets("Game_data1").Cells(98, 2).Value, 5)
End Sub

Sub u_defender()
        do_it = upgrade_defender()
End Sub
Sub l_recruit()
        do_it = land_recruit()
End Sub
Sub cancel_l_defender()
do_it = text_Output("", 3)
do_it = Main_turn
End Sub
Sub cancel_l_recruit()
do_it = text_Output("", 3)
do_it = Main_turn
End Sub
Sub ok_l_recruit()
do_it = land_recruit(1)
End Sub
Sub Do_not_Attack()
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

do_it = valiknuppude_Kustutamine()

MsgBox (Sheets("Game_data1").Cells(10 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value & Sheets("Lan" & Language).Cells(46, 1).Value)
do_it = text_Output("", 3)
do_it = Main_turn

End Sub

Sub cancel_u_defender()
do_it = text_Output("", 3)
do_it = Main_turn
End Sub
Sub ok_u_defender()
do_it = upgrade_defender(1)
End Sub

Sub roll_move_again()
        do_it = roll_again()
End Sub
Sub keep_move_roll()
        do_it = keep_after_double()
End Sub
Sub cancel_to_main()
        do_it = text_Output("", 3)
        do_it = Main_turn()
End Sub
Sub fight_ok_guardian()
        do_it = valiknuppude_Kustutamine()
        do_it = battle_with_guardian()
End Sub
Sub take_treasure_gold()
        do_it = take_gold()
End Sub
Sub jump_try()
        do_it = jump_for_treasure
End Sub
Sub clear_path()
        do_it = str_event
End Sub
Sub solve_riddle()
        do_it = power_event
End Sub
Sub mana_fountain()
do_it = mana_event
End Sub
Sub ok_drink()
do_it = mana_drink(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub drink_1()
do_it = mana_drink(1)
End Sub
Sub drink_2()
do_it = mana_drink(2)
End Sub
Sub drink_3()
do_it = mana_drink(3)
End Sub

Sub Spell_target_menu()

        Sheets("Game_data1").Cells(45, 2).Value = 1
        do_it = targeting_side_submenu(Sheets("Game_data1").Cells(98, 2).Value)
        
End Sub
Sub Keep_fighting()
        do_it = valiknuppude_Kustutamine()
        do_it = Fight()
End Sub
Sub cancel_targeting_party_members()
        do_it = targeting_side_submenu(Sheets("Game_data1").Cells(98, 2).Value)
End Sub
Sub spell_menu()

If (Sheets("Game_data1").Cells(87, 2).Value = 0) Then

        Sheets("Game_data1").Cells(36, 2).Value = 0
    Else
        Sheets("Game_data1").Cells(36, 2).Value = 1

End If

        do_it = spell_list()

End Sub
Sub attack_playerland()
        do_it = Fight_player_land()
End Sub
Sub Combat_spell_menu()
    Sheets("Game_data1").Cells(36, 2).Value = 1
    do_it = spell_list()
End Sub
Sub Adventure_spell_menu()
    Sheets("Game_data1").Cells(36, 2).Value = 0
    do_it = spell_list()
End Sub
Sub cancel_spell_menu()
    do_it = cast_spell(0)
End Sub
Sub ok_truecast()
    do_it = cast_spell(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub cancel_with_ok_truecast()
do_it = valiknuppude_Kustutamine()
do_it = spell_list()
End Sub
Sub cancel_truecast()
do_it = valiknuppude_Kustutamine()
do_it = spell_list()
End Sub

Sub cancel_truesell()
    do_it = text_Output("", 3)
    do_it = valiknuppude_Kustutamine()
    do_it = sell_list()
End Sub
Sub cancel_truebuy()
    do_it = valiknuppude_Kustutamine()
    do_it = buy_list()
End Sub
Sub cancel_truetake()
    do_it = text_Output("", 3)
    do_it = Main_turn()
End Sub
Sub ok_truetake()
    do_it = valiknuppude_Kustutamine()
    do_it = Take_item(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub ok_truebuy()
    do_it = valiknuppude_Kustutamine()
    do_it = Buy_item(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub ok_truesell()
    do_it = valiknuppude_Kustutamine()
    do_it = Sell_item(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub cancel_trueequip()
    do_it = equipment_list()
End Sub
Sub ok_trueequip()
    do_it = valiknuppude_Kustutamine()
    do_it = Equip_item(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub global_attack()
    do_it = global_commands(2)
End Sub
Sub global_flee()
    do_it = global_commands(1)
End Sub
Sub wind_affect_minus_1()
        do_it = valiknuppude_Kustutamine
        do_it = execute_winds_to_move(-1)
End Sub
Sub wind_affect_0()
        do_it = valiknuppude_Kustutamine
        do_it = execute_winds_to_move(0)
End Sub
Sub wind_affect_1()
        do_it = valiknuppude_Kustutamine
        do_it = execute_winds_to_move(1)
End Sub
Sub wind_affect_2()
        do_it = valiknuppude_Kustutamine
        do_it = execute_winds_to_move(2)
End Sub
Sub wind_affect_3()
        do_it = valiknuppude_Kustutamine
        do_it = execute_winds_to_move(3)
End Sub
Sub wind_affect_4()
        do_it = valiknuppude_Kustutamine
        do_it = execute_winds_to_move(4)
End Sub
Sub target_side1()
    do_it = targeting_party_members(Sheets("Game_data1").Cells(98, 2).Value, 1)
End Sub
Sub target_side2()
    do_it = targeting_party_members(Sheets("Game_data1").Cells(98, 2).Value, 2)
End Sub
Sub target_side3()
    do_it = targeting_party_members(Sheets("Game_data1").Cells(98, 2).Value, 3)
End Sub
Sub target_side4()
    do_it = targeting_party_members(Sheets("Game_data1").Cells(98, 2).Value, 4)
End Sub
Sub target_side5()
    do_it = targeting_party_members(Sheets("Game_data1").Cells(98, 2).Value, 5)
End Sub
Sub cancel_true_dip()
        do_it = text_Output("", 3)
        do_it = Main_turn()
End Sub
Sub cancel_true_impw()
        do_it = text_Output("", 3)
        do_it = Main_turn()
End Sub
Sub ok_true_impw()
        do_it = Sell_item(Sheets("Game_data1").Cells(167, 2).Value, 1, 0, 0, 1)
End Sub

Sub ok_true_dip()
        do_it = Sell_item(Sheets("Game_data1").Cells(167, 2).Value, 1, 0, 1)
End Sub
Sub dip_weapon1()
        do_it = Sell_item(1, 0, 0, 1)
End Sub
Sub imp_weapon1()
        do_it = Sell_item(1, 0, 0, 0, 1)
End Sub
Sub imp_weapon2()
        do_it = Sell_item(2, 0, 0, 0, 1)
End Sub
Sub imp_weapon3()
        do_it = Sell_item(3, 0, 0, 0, 1)
End Sub
Sub imp_weapon4()
        do_it = Sell_item(4, 0, 0, 0, 1)
End Sub
Sub imp_weapon5()
        do_it = Sell_item(5, 0, 0, 0, 1)
End Sub
Sub imp_weapon6()
        do_it = Sell_item(6, 0, 0, 0, 1)
End Sub
Sub imp_weapon7()
        do_it = Sell_item(7, 0, 0, 0, 1)
End Sub
Sub imp_weapon8()
        do_it = Sell_item(8, 0, 0, 0, 1)
End Sub
Sub imp_weapon9()
        do_it = Sell_item(9, 0, 0, 0, 1)
End Sub
Sub imp_weapon10()
        do_it = Sell_item(10, 0, 0, 0, 1)
End Sub
Sub imp_weapon11()
        do_it = Sell_item(11, 0, 0, 0, 1)
End Sub
Sub imp_weapon12()
        do_it = Sell_item(12, 0, 0, 0, 1)
End Sub
Sub imp_weapon13()
        do_it = Sell_item(13, 0, 0, 0, 1)
End Sub
Sub imp_weapon14()
        do_it = Sell_item(14, 0, 0, 0, 1)
End Sub
Sub imp_weapon15()
        do_it = Sell_item(15, 0, 0, 0, 1)
End Sub
Sub imp_weapon16()
        do_it = Sell_item(16, 0, 0, 0, 1)
End Sub
Sub imp_weapon17()
        do_it = Sell_item(17, 0, 0, 0, 1)
End Sub
Sub imp_weapon18()
        do_it = Sell_item(18, 0, 0, 0, 1)
End Sub
Sub imp_weapon19()
        do_it = Sell_item(19, 0, 0, 0, 1)
End Sub
Sub imp_weapon20()
        do_it = Sell_item(20, 0, 0, 0, 1)
End Sub
Sub dip_weapon2()
        do_it = Sell_item(2, 0, 0, 1)
End Sub
Sub dip_weapon3()
        do_it = Sell_item(3, 0, 0, 1)
End Sub
Sub dip_weapon4()
        do_it = Sell_item(4, 0, 0, 1)
End Sub
Sub dip_weapon5()
        do_it = Sell_item(5, 0, 0, 1)
End Sub
Sub dip_weapon6()
        do_it = Sell_item(6, 0, 0, 1)
End Sub
Sub dip_weapon7()
        do_it = Sell_item(7, 0, 0, 1)
End Sub
Sub dip_weapon8()
        do_it = Sell_item(8, 0, 0, 1)
End Sub
Sub dip_weapon9()
        do_it = Sell_item(9, 0, 0, 1)
End Sub
Sub dip_weapon10()
        do_it = Sell_item(10, 0, 0, 1)
End Sub

Sub dip_weapon11()
        do_it = Sell_item(11, 0, 0, 1)
End Sub
Sub dip_weapon12()
        do_it = Sell_item(12, 0, 0, 1)
End Sub
Sub dip_weapon13()
        do_it = Sell_item(13, 0, 0, 1)
End Sub
Sub dip_weapon14()
        do_it = Sell_item(14, 0, 0, 1)
End Sub
Sub dip_weapon15()
        do_it = Sell_item(15, 0, 0, 1)
End Sub
Sub dip_weapon16()
        do_it = Sell_item(16, 0, 0, 1)
End Sub
Sub dip_weapon17()
        do_it = Sell_item(17, 0, 0, 1)
End Sub
Sub dip_weapon18()
        do_it = Sell_item(18, 0, 0, 1)
End Sub
Sub dip_weapon19()
        do_it = Sell_item(19, 0, 0, 1)
End Sub
Sub dip_weapon20()
        do_it = Sell_item(20, 0, 0, 1)
End Sub

Sub cancel_inventory()
    do_it = Equip_item(0)
End Sub
Sub cancel_sale()
    do_it = Sell_item(0)
End Sub
Sub cancel_buy()
    do_it = Buy_item(0)
End Sub
Sub sell_menu()
    do_it = valiknuppude_Kustutamine()
    do_it = sell_list()
End Sub
Sub buy_menu()
    
    do_it = buy_list()
End Sub
Sub inventory_menu()
    
    do_it = equipment_list()
End Sub
Sub Build_Menu()
    do_it = valiknuppude_Kustutamine()
    do_it = check_build(2)
End Sub
Sub cancel_build()
    do_it = text_Output("", 3)
    do_it = build_fortification(Sheets("Game_data1").Cells(231, 2).Value)
End Sub
Sub flee()
do_it = target_member_selected(0, 0)
End Sub
Sub build_building1()
        do_it = build_building(1)
End Sub
Sub build_building2()
        do_it = build_building(2)
End Sub
Sub build_building3()
        do_it = build_building(3)
End Sub
Sub build_building4()
        do_it = build_building(4)
End Sub
Sub build_building5()
        do_it = build_building(5)
End Sub
Sub build_building6()
        do_it = build_building(6)
End Sub
Sub build_building7()
        do_it = build_building(7)
End Sub
Sub build_building8()
        do_it = build_building(8)
End Sub
Sub build_building9()
        do_it = build_building(9)
End Sub
Sub build_building10()
        do_it = build_building(10)
End Sub
Sub build_building11()
        do_it = build_building(11)
End Sub
Sub build_building12()
        do_it = build_building(12)
End Sub

Sub target_side1_mob1()
do_it = target_member_selected(1, 1)
End Sub
Sub target_side1_mob2()
do_it = target_member_selected(2, 1)
End Sub
Sub target_side1_mob3()
do_it = target_member_selected(3, 1)
End Sub
Sub target_side1_mob4()
do_it = target_member_selected(4, 1)
End Sub
Sub target_side1_mob5()
do_it = target_member_selected(5, 1)
End Sub
Sub target_side1_mob6()
do_it = target_member_selected(6, 1)
End Sub
Sub target_side1_mob7()
do_it = target_member_selected(7, 1)
End Sub
Sub target_side1_mob8()
do_it = target_member_selected(8, 1)
End Sub
Sub target_side1_mob9()
do_it = target_member_selected(9, 1)
End Sub
Sub target_side1_mob10()
do_it = target_member_selected(10, 1)
End Sub
Sub target_side1_mob11()
do_it = target_member_selected(11, 1)
End Sub
Sub target_side1_mob12()
do_it = target_member_selected(12, 1)
End Sub
Sub target_side1_mob13()
do_it = target_member_selected(13, 1)
End Sub
Sub target_side1_mob14()
do_it = target_member_selected(14, 1)
End Sub
Sub target_side1_mob15()
do_it = target_member_selected(15, 1)
End Sub
Sub target_side1_mob16()
do_it = target_member_selected(16, 1)
End Sub
Sub target_side1_mob17()
do_it = target_member_selected(17, 1)
End Sub
Sub target_side1_mob18()
do_it = target_member_selected(18, 1)
End Sub
Sub target_side1_mob19()
do_it = target_member_selected(19, 1)
End Sub
Sub target_side1_mob20()
do_it = target_member_selected(20, 1)
End Sub
Sub target_side5_mob1()
do_it = target_member_selected(1, 5)
End Sub
Sub target_side5_mob2()
do_it = target_member_selected(2, 5)
End Sub
Sub target_side5_mob3()
do_it = target_member_selected(3, 5)
End Sub
Sub target_side5_mob4()
do_it = target_member_selected(4, 5)
End Sub
Sub target_side5_mob5()
do_it = target_member_selected(5, 5)
End Sub
Sub target_side5_mob6()
do_it = target_member_selected(6, 5)
End Sub
Sub target_side5_mob7()
do_it = target_member_selected(7, 5)
End Sub
Sub target_side5_mob8()
do_it = target_member_selected(8, 5)
End Sub
Sub target_side5_mob9()
do_it = target_member_selected(9, 5)
End Sub
Sub target_side5_mob10()
do_it = target_member_selected(10, 5)
End Sub
Sub target_side5_mob11()
do_it = target_member_selected(11, 5)
End Sub
Sub target_side5_mob12()
do_it = target_member_selected(12, 5)
End Sub
Sub target_side5_mob13()
do_it = target_member_selected(13, 5)
End Sub
Sub target_side5_mob14()
do_it = target_member_selected(14, 5)
End Sub
Sub target_side5_mob15()
do_it = target_member_selected(15, 5)
End Sub
Sub target_side5_mob16()
do_it = target_member_selected(16, 5)
End Sub
Sub target_side5_mob17()
do_it = target_member_selected(17, 5)
End Sub
Sub target_side5_mob18()
do_it = target_member_selected(18, 5)
End Sub
Sub target_side5_mob19()
do_it = target_member_selected(19, 5)
End Sub
Sub target_side5_mob20()
do_it = target_member_selected(20, 5)
End Sub

Sub target_side2_mob1()
do_it = target_member_selected(1, 2)
End Sub
Sub target_side2_mob2()
do_it = target_member_selected(2, 2)
End Sub
Sub target_side2_mob3()
do_it = target_member_selected(3, 2)
End Sub
Sub target_side2_mob4()
do_it = target_member_selected(4, 2)
End Sub
Sub target_side2_mob5()
do_it = target_member_selected(5, 2)
End Sub
Sub target_side2_mob6()
do_it = target_member_selected(6, 2)
End Sub
Sub target_side2_mob7()
do_it = target_member_selected(7, 2)
End Sub
Sub target_side2_mob8()
do_it = target_member_selected(8, 2)
End Sub
Sub target_side2_mob9()
do_it = target_member_selected(9, 2)
End Sub
Sub target_side2_mob10()
do_it = target_member_selected(10, 2)
End Sub
Sub target_side2_mob11()
do_it = target_member_selected(11, 2)
End Sub
Sub target_side2_mob12()
do_it = target_member_selected(12, 2)
End Sub
Sub target_side2_mob13()
do_it = target_member_selected(13, 2)
End Sub
Sub target_side2_mob14()
do_it = target_member_selected(14, 2)
End Sub
Sub target_side2_mob15()
do_it = target_member_selected(15, 2)
End Sub
Sub target_side2_mob16()
do_it = target_member_selected(16, 2)
End Sub
Sub target_side2_mob17()
do_it = target_member_selected(17, 2)
End Sub
Sub target_side2_mob18()
do_it = target_member_selected(18, 2)
End Sub
Sub target_side2_mob19()
do_it = target_member_selected(19, 2)
End Sub
Sub target_side2_mob20()
do_it = target_member_selected(20, 2)
End Sub

Sub target_side4_mob1()
do_it = target_member_selected(1, 4)
End Sub
Sub target_side4_mob2()
do_it = target_member_selected(2, 4)
End Sub
Sub target_side4_mob3()
do_it = target_member_selected(3, 4)
End Sub
Sub target_side4_mob4()
do_it = target_member_selected(4, 4)
End Sub
Sub target_side4_mob5()
do_it = target_member_selected(5, 4)
End Sub
Sub target_side4_mob6()
do_it = target_member_selected(6, 4)
End Sub
Sub target_side4_mob7()
do_it = target_member_selected(7, 4)
End Sub
Sub target_side4_mob8()
do_it = target_member_selected(8, 4)
End Sub
Sub target_side4_mob9()
do_it = target_member_selected(9, 4)
End Sub
Sub target_side4_mob10()
do_it = target_member_selected(10, 4)
End Sub
Sub target_side4_mob11()
do_it = target_member_selected(11, 4)
End Sub
Sub target_side4_mob12()
do_it = target_member_selected(12, 4)
End Sub
Sub target_side4_mob13()
do_it = target_member_selected(13, 4)
End Sub
Sub target_side4_mob14()
do_it = target_member_selected(14, 4)
End Sub
Sub target_side4_mob15()
do_it = target_member_selected(15, 4)
End Sub
Sub target_side4_mob16()
do_it = target_member_selected(16, 4)
End Sub
Sub target_side4_mob17()
do_it = target_member_selected(17, 4)
End Sub
Sub target_side4_mob18()
do_it = target_member_selected(18, 4)
End Sub
Sub target_side4_mob19()
do_it = target_member_selected(19, 4)
End Sub
Sub target_side4_mob20()
do_it = target_member_selected(20, 4)
End Sub

Sub target_side3_mob1()
do_it = target_member_selected(1, 3)
End Sub
Sub target_side3_mob2()
do_it = target_member_selected(2, 3)
End Sub
Sub target_side3_mob3()
do_it = target_member_selected(3, 3)
End Sub
Sub target_side3_mob4()
do_it = target_member_selected(4, 3)
End Sub
Sub target_side3_mob5()
do_it = target_member_selected(5, 3)
End Sub
Sub target_side3_mob6()
do_it = target_member_selected(6, 3)
End Sub
Sub target_side3_mob7()
do_it = target_member_selected(7, 3)
End Sub
Sub target_side3_mob8()
do_it = target_member_selected(8, 3)
End Sub
Sub target_side3_mob9()
do_it = target_member_selected(9, 3)
End Sub
Sub target_side3_mob10()
do_it = target_member_selected(10, 3)
End Sub
Sub target_side3_mob11()
do_it = target_member_selected(11, 3)
End Sub
Sub target_side3_mob12()
do_it = target_member_selected(12, 3)
End Sub
Sub target_side3_mob13()
do_it = target_member_selected(13, 3)
End Sub
Sub target_side3_mob14()
do_it = target_member_selected(14, 3)
End Sub
Sub target_side3_mob15()
do_it = target_member_selected(15, 3)
End Sub
Sub target_side3_mob16()
do_it = target_member_selected(16, 3)
End Sub
Sub target_side3_mob17()
do_it = target_member_selected(17, 3)
End Sub
Sub target_side3_mob18()
do_it = target_member_selected(18, 3)
End Sub
Sub target_side3_mob19()
do_it = target_member_selected(19, 3)
End Sub
Sub target_side3_mob20()
do_it = target_member_selected(20, 3)
End Sub
Sub hire_1()
do_it = hire_mercenary(1)
End Sub
Sub hire_2()
do_it = hire_mercenary(2)
End Sub
Sub hire_3()
do_it = hire_mercenary(3)
End Sub
Sub hire_4()
do_it = hire_mercenary(4)
End Sub
Sub hire_5()
do_it = hire_mercenary(5)
End Sub
Sub hire_6()
do_it = hire_mercenary(6)
End Sub
Sub hire_7()
do_it = hire_mercenary(7)
End Sub
Sub hire_8()
do_it = hire_mercenary(8)
End Sub
Sub hire_9()
do_it = hire_mercenary(9)
End Sub
Sub hire_10()
do_it = hire_mercenary(10)
End Sub
Sub ok_hire()
do_it = hire_mercenary(Sheets("Game_data1").Cells(167, 2).Value, 1)
End Sub
Sub cancel_hire()
do_it = text_Output("", 3)
do_it = Main_turn()
End Sub
Sub ok_train_1()
do_it = train_stat(1, 1)
End Sub
Sub ok_train_2()
do_it = train_stat(2, 1)
End Sub
Sub ok_train_3()
do_it = train_stat(3, 1)
End Sub

Sub train_str()
do_it = train_stat(1)
End Sub
Sub train_dex()
do_it = train_stat(2)
End Sub
Sub train_power()
do_it = train_stat(3)
End Sub
Sub ok_build()
        do_it = build_building(Sheets("Game_data1").Cells(155, 2).Value, 1)
End Sub

Sub shrine_nupp()
do_it = shrine_heal
End Sub
Sub ok_heal()
do_it = shrine_heal(1)
End Sub
Sub cancel_heal()
do_it = text_Output("", 3)
do_it = Main_turn()
End Sub

Sub spell_1()
do_it = cast_spell(1)
End Sub
Sub spell_2()
do_it = cast_spell(2)
End Sub
Sub spell_3()
do_it = cast_spell(3)
End Sub
Sub spell_4()
do_it = cast_spell(4)
End Sub
Sub spell_5()
do_it = cast_spell(5)
End Sub
Sub spell_6()
do_it = cast_spell(6)
End Sub
Sub spell_7()
do_it = cast_spell(7)
End Sub
Sub spell_8()
do_it = cast_spell(8)
End Sub
Sub spell_9()
do_it = cast_spell(9)
End Sub
Sub spell_10()
do_it = cast_spell(10)
End Sub
Sub spell_11()
do_it = cast_spell(11)
End Sub
Sub spell_12()
do_it = cast_spell(12)
End Sub
Sub spell_13()
do_it = cast_spell(13)
End Sub
Sub spell_14()
do_it = cast_spell(14)
End Sub
Sub spell_15()
do_it = cast_spell(15)
End Sub
Sub spell_16()
do_it = cast_spell(16)
End Sub
Sub spell_17()
do_it = cast_spell(17)
End Sub
Sub spell_18()
do_it = cast_spell(18)
End Sub
Sub spell_19()
do_it = cast_spell(19)
End Sub
Sub spell_20()
do_it = cast_spell(20)
End Sub
Sub spell_21()
do_it = cast_spell(21)
End Sub
Sub spell_22()
do_it = cast_spell(22)
End Sub
Sub spell_23()
do_it = cast_spell(23)
End Sub
Sub spell_24()
do_it = cast_spell(24)
End Sub
Sub spell_25()
do_it = cast_spell(25)
End Sub
Sub spell_26()
do_it = cast_spell(26)
End Sub
Sub spell_27()
do_it = cast_spell(27)
End Sub
Sub spell_28()
do_it = cast_spell(28)
End Sub
Sub spell_29()
do_it = cast_spell(29)
End Sub
Sub spell_30()
do_it = cast_spell(30)
End Sub
Sub spell_31()
do_it = cast_spell(31)
End Sub
Sub spell_32()
do_it = cast_spell(32)
End Sub
Sub spell_33()
do_it = cast_spell(33)
End Sub
Sub spell_34()
do_it = cast_spell(34)
End Sub
Sub spell_35()
do_it = cast_spell(35)
End Sub
Sub spell_36()
do_it = cast_spell(36)
End Sub
Sub spell_37()
do_it = cast_spell(37)
End Sub
Sub spell_38()
do_it = cast_spell(38)
End Sub
Sub spell_39()
do_it = cast_spell(39)
End Sub
Sub spell_40()
do_it = cast_spell(40)
End Sub
Sub spell_41()
do_it = cast_spell(41)
End Sub
Sub spell_42()
do_it = cast_spell(42)
End Sub
Sub spell_43()
do_it = cast_spell(43)
End Sub
Sub spell_44()
do_it = cast_spell(44)
End Sub
Sub spell_45()
do_it = cast_spell(45)
End Sub
Sub train_spell_1()
do_it = train_spell(1)
End Sub
Sub train_spell_2()
do_it = train_spell(2)
End Sub
Sub train_spell_3()
do_it = train_spell(3)
End Sub
Sub train_spell_4()
do_it = train_spell(4)
End Sub
Sub train_spell_5()
do_it = train_spell(5)
End Sub
Sub train_spell_6()
do_it = train_spell(6)
End Sub
Sub train_spell_7()
do_it = train_spell(7)
End Sub
Sub train_spell_8()
do_it = train_spell(8)
End Sub
Sub train_spell_9()
do_it = train_spell(9)
End Sub
Sub train_spell_10()
do_it = train_spell(10)
End Sub
Sub train_spell_11()
do_it = train_spell(11)
End Sub
Sub train_spell_12()
do_it = train_spell(12)
End Sub
Sub train_spell_13()
do_it = train_spell(13)
End Sub
Sub train_spell_14()
do_it = train_spell(14)
End Sub
Sub train_spell_15()
do_it = train_spell(15)
End Sub
Sub train_spell_16()
do_it = train_spell(16)
End Sub
Sub train_spell_17()
do_it = train_spell(17)
End Sub
Sub train_spell_18()
do_it = train_spell(18)
End Sub
Sub train_spell_19()
do_it = train_spell(19)
End Sub
Sub train_spell_20()
do_it = train_spell(20)
End Sub
Sub train_spell_21()
do_it = train_spell(21)
End Sub
Sub train_spell_22()
do_it = train_spell(22)
End Sub
Sub train_spell_23()
do_it = train_spell(23)
End Sub
Sub train_spell_24()
do_it = train_spell(24)
End Sub
Sub train_spell_25()
do_it = train_spell(25)
End Sub
Sub train_spell_26()
do_it = train_spell(26)
End Sub
Sub train_spell_27()
do_it = train_spell(27)
End Sub
Sub train_spell_28()
do_it = train_spell(28)
End Sub
Sub train_spell_29()
do_it = train_spell(29)
End Sub
Sub train_spell_30()
do_it = train_spell(30)
End Sub
Sub train_spell_31()
do_it = train_spell(31)
End Sub
Sub train_spell_32()
do_it = train_spell(32)
End Sub
Sub train_spell_33()
do_it = train_spell(33)
End Sub
Sub train_spell_34()
do_it = train_spell(34)
End Sub
Sub train_spell_35()
do_it = train_spell(35)
End Sub
Sub train_spell_36()
do_it = train_spell(36)
End Sub
Sub train_spell_37()
do_it = train_spell(37)
End Sub
Sub train_spell_38()
do_it = train_spell(38)
End Sub
Sub train_spell_39()
do_it = train_spell(39)
End Sub
Sub train_spell_40()
do_it = train_spell(40)
End Sub
Sub train_spell_41()
do_it = train_spell(41)
End Sub
Sub train_spell_42()
do_it = train_spell(42)
End Sub
Sub train_spell_43()
do_it = train_spell(43)
End Sub
Sub train_spell_44()
do_it = train_spell(44)
End Sub
Sub train_spell_45()
do_it = train_spell(45)
End Sub
Sub train_spell_f_1()
do_it = train_spell(1, 0, 1)
End Sub
Sub train_spell_f_2()
do_it = train_spell(2, 0, 1)
End Sub
Sub train_spell_f_3()
do_it = train_spell(3, 0, 1)
End Sub
Sub train_spell_f_4()
do_it = train_spell(4, 0, 1)
End Sub
Sub train_spell_f_5()
do_it = train_spell(5, 0, 1)
End Sub
Sub train_spell_f_6()
do_it = train_spell(6, 0, 1)
End Sub
Sub train_spell_f_7()
do_it = train_spell(7, 0, 1)
End Sub
Sub train_spell_f_8()
do_it = train_spell(8, 0, 1)
End Sub
Sub train_spell_f_9()
do_it = train_spell(9, 0, 1)
End Sub
Sub train_spell_f_10()
do_it = train_spell(10, 0, 1)
End Sub
Sub train_spell_f_11()
do_it = train_spell(11, 0, 1)
End Sub
Sub train_spell_f_12()
do_it = train_spell(12, 0, 1)
End Sub
Sub train_spell_f_13()
do_it = train_spell(13, 0, 1)
End Sub
Sub train_spell_f_14()
do_it = train_spell(14, 0, 1)
End Sub
Sub train_spell_f_15()
do_it = train_spell(15, 0, 1)
End Sub
Sub train_spell_f_16()
do_it = train_spell(16, 0, 1)
End Sub
Sub train_spell_f_17()
do_it = train_spell(17, 0, 1)
End Sub
Sub train_spell_f_18()
do_it = train_spell(18, 0, 1)
End Sub
Sub train_spell_f_19()
do_it = train_spell(19, 0, 1)
End Sub
Sub train_spell_f_20()
do_it = train_spell(20, 0, 1)
End Sub
Sub train_spell_f_21()
do_it = train_spell(21, 0, 1)
End Sub
Sub train_spell_f_22()
do_it = train_spell(22, 0, 1)
End Sub
Sub train_spell_f_23()
do_it = train_spell(23, 0, 1)
End Sub
Sub train_spell_f_24()
do_it = train_spell(24, 0, 1)
End Sub
Sub train_spell_f_25()
do_it = train_spell(25, 0, 1)
End Sub
Sub train_spell_f_26()
do_it = train_spell(26, 0, 1)
End Sub
Sub train_spell_f_27()
do_it = train_spell(27, 0, 1)
End Sub
Sub train_spell_f_28()
do_it = train_spell(28, 0, 1)
End Sub
Sub train_spell_f_29()
do_it = train_spell(29, 0, 1)
End Sub
Sub train_spell_f_30()
do_it = train_spell(30, 0, 1)
End Sub
Sub train_spell_f_31()
do_it = train_spell(31, 0, 1)
End Sub
Sub train_spell_f_32()
do_it = train_spell(32, 0, 1)
End Sub
Sub train_spell_f_33()
do_it = train_spell(33, 0, 1)
End Sub
Sub train_spell_f_34()
do_it = train_spell(34, 0, 1)
End Sub
Sub train_spell_f_35()
do_it = train_spell(35, 0, 1)
End Sub
Sub train_spell_f_36()
do_it = train_spell(36, 0, 1)
End Sub
Sub train_spell_f_37()
do_it = train_spell(37, 0, 1)
End Sub
Sub train_spell_f_38()
do_it = train_spell(38, 0, 1)
End Sub
Sub train_spell_f_39()
do_it = train_spell(39, 0, 1)
End Sub
Sub train_spell_f_40()
do_it = train_spell(40, 0, 1)
End Sub
Sub train_spell_f_41()
do_it = train_spell(41, 0, 1)
End Sub
Sub train_spell_f_42()
do_it = train_spell(42, 0, 1)
End Sub
Sub train_spell_f_43()
do_it = train_spell(43, 0, 1)
End Sub
Sub train_spell_f_44()
do_it = train_spell(44, 0, 1)
End Sub
Sub train_spell_f_45()
do_it = train_spell(45, 0, 1)
End Sub
Sub buy_1()
do_it = Buy_item(1)
End Sub
Sub buy_2()
do_it = Buy_item(2)
End Sub
Sub buy_3()
do_it = Buy_item(3)
End Sub
Sub buy_4()
do_it = Buy_item(4)
End Sub
Sub buy_5()
do_it = Buy_item(5)
End Sub
Sub buy_6()
do_it = Buy_item(6)
End Sub
Sub buy_7()
do_it = Buy_item(7)
End Sub
Sub buy_8()
do_it = Buy_item(8)
End Sub
Sub buy_9()
do_it = Buy_item(9)
End Sub
Sub buy_10()
do_it = Buy_item(10)
End Sub
Sub buy_11()
do_it = Buy_item(11)
End Sub
Sub buy_12()
do_it = Buy_item(12)
End Sub
Sub buy_13()
do_it = Buy_item(13)
End Sub
Sub buy_14()
do_it = Buy_item(14)
End Sub
Sub buy_15()
do_it = Buy_item(15)
End Sub
Sub buy_16()
do_it = Buy_item(16)
End Sub
Sub buy_17()
do_it = Buy_item(17)
End Sub
Sub buy_18()
do_it = Buy_item(18)
End Sub
Sub buy_19()
do_it = Buy_item(19)
End Sub
Sub buy_20()
do_it = Buy_item(20)
End Sub
Sub take_1()
do_it = Take_item(1)
End Sub
Sub take_2()
do_it = Take_item(2)
End Sub
Sub take_3()
do_it = Take_item(3)
End Sub
Sub take_4()
do_it = Take_item(4)
End Sub
Sub take_5()
do_it = Take_item(5)
End Sub
Sub take_6()
do_it = Take_item(6)
End Sub
Sub take_7()
do_it = Take_item(7)
End Sub
Sub take_8()
do_it = Take_item(8)
End Sub
Sub take_9()
do_it = Take_item(9)
End Sub
Sub take_10()
do_it = Take_item(10)
End Sub

Sub sell_1()
do_it = Sell_item(1)
End Sub
Sub sell_2()
do_it = Sell_item(2)
End Sub
Sub sell_3()
do_it = Sell_item(3)
End Sub
Sub sell_4()
do_it = Sell_item(4)
End Sub
Sub sell_5()
do_it = Sell_item(5)
End Sub
Sub sell_6()
do_it = Sell_item(6)
End Sub
Sub sell_7()
do_it = Sell_item(7)
End Sub
Sub sell_8()
do_it = Sell_item(8)
End Sub
Sub sell_9()
do_it = Sell_item(9)
End Sub
Sub sell_10()
do_it = Sell_item(10)
End Sub
Sub sell_11()
do_it = Sell_item(11)
End Sub
Sub sell_20()
do_it = Sell_item(20)
End Sub
Sub sell_12()
do_it = Sell_item(12)
End Sub
Sub sell_13()
do_it = Sell_item(13)
End Sub
Sub sell_14()
do_it = Sell_item(14)
End Sub
Sub sell_15()
do_it = Sell_item(15)
End Sub
Sub sell_16()
do_it = Sell_item(16)
End Sub
Sub sell_17()
do_it = Sell_item(17)
End Sub
Sub sell_18()
do_it = Sell_item(18)
End Sub
Sub sell_19()
do_it = Sell_item(19)
End Sub
Sub equip_1()
do_it = Equip_item(1)
End Sub
Sub equip_2()
do_it = Equip_item(2)
End Sub
Sub equip_3()
do_it = Equip_item(3)
End Sub
Sub equip_4()
do_it = Equip_item(4)
End Sub
Sub equip_5()
do_it = Equip_item(5)
End Sub
Sub equip_6()
do_it = Equip_item(6)
End Sub
Sub equip_7()
do_it = Equip_item(7)
End Sub
Sub equip_8()
do_it = Equip_item(8)
End Sub
Sub equip_9()
do_it = Equip_item(9)
End Sub
Sub equip_10()
do_it = Equip_item(10)
End Sub
Sub equip_11()
do_it = Equip_item(11)
End Sub
Sub equip_12()
do_it = Equip_item(12)
End Sub
Sub equip_13()
do_it = Equip_item(13)
End Sub
Sub equip_14()
do_it = Equip_item(14)
End Sub
Sub equip_15()
do_it = Equip_item(15)
End Sub
Sub equip_16()
do_it = Equip_item(16)
End Sub
Sub equip_17()
do_it = Equip_item(17)
End Sub
Sub equip_18()
do_it = Equip_item(18)
End Sub
Sub equip_19()
do_it = Equip_item(19)
End Sub
Sub equip_20()
do_it = Equip_item(20)
End Sub
Sub Build_1()
do_it = build_fortification(1)
End Sub
Sub Build_2()
do_it = build_fortification(2)
End Sub
Sub Build_3()
do_it = build_fortification(3)
End Sub
Sub Build_4()
do_it = build_fortification(4)
End Sub
Sub Build_5()
do_it = build_fortification(5)
End Sub
Sub Build_6()
do_it = build_fortification(6)
End Sub
Sub Build_7()
do_it = build_fortification(7)
End Sub
Sub Build_8()
do_it = build_fortification(8)
End Sub
Sub Build_9()
do_it = build_fortification(9)
End Sub
Sub Build_10()
do_it = build_fortification(10)
End Sub
Sub Build_11()
do_it = build_fortification(11)
End Sub
Sub Build_12()
do_it = build_fortification(12)
End Sub
Sub teleport_1()
do_it = teleport_to(1)
End Sub
Sub teleport_2()
do_it = teleport_to(2)
End Sub
Sub teleport_3()
do_it = teleport_to(3)
End Sub
Sub teleport_4()
do_it = teleport_to(4)
End Sub
Sub teleport_5()
do_it = teleport_to(5)
End Sub
Sub teleport_6()
do_it = teleport_to(6)
End Sub
Sub teleport_7()
do_it = teleport_to(7)
End Sub
Sub teleport_8()
do_it = teleport_to(8)
End Sub
Sub teleport_9()
do_it = teleport_to(9)
End Sub
Sub teleport_10()
do_it = teleport_to(10)
End Sub
Sub teleport_11()
do_it = teleport_to(11)
End Sub
Sub teleport_12()
do_it = teleport_to(12)
End Sub
Sub teleport_13()
do_it = teleport_to(13)
End Sub
Sub teleport_14()
do_it = teleport_to(14)
End Sub
Sub teleport_15()
do_it = teleport_to(15)
End Sub
Sub teleport_16()
do_it = teleport_to(16)
End Sub
Sub teleport_17()
do_it = teleport_to(17)
End Sub
Sub teleport_18()
do_it = teleport_to(18)
End Sub
Sub teleport_19()
do_it = teleport_to(19)
End Sub
Sub teleport_20()
do_it = teleport_to(20)
End Sub
Sub teleport_21()
do_it = teleport_to(21)
End Sub
Sub teleport_22()
do_it = teleport_to(22)
End Sub
Sub teleport_23()
do_it = teleport_to(23)
End Sub
Sub teleport_24()
do_it = teleport_to(24)
End Sub
Sub teleport_25()
do_it = teleport_to(25)
End Sub
Sub teleport_26()
do_it = teleport_to(26)
End Sub
Sub teleport_27()
do_it = teleport_to(27)
End Sub
Sub teleport_28()
do_it = teleport_to(28)
End Sub
Sub teleport_29()
do_it = teleport_to(29)
End Sub
Sub teleport_30()
do_it = teleport_to(30)
End Sub
Sub teleport_31()
do_it = teleport_to(31)
End Sub
Sub teleport_32()
do_it = teleport_to(32)
End Sub
Sub teleport_33()
do_it = teleport_to(33)
End Sub
Sub teleport_34()
do_it = teleport_to(34)
End Sub
Function valiknuppude_Kustutamine()
        do_it = clean_equip_buttons()
End Function

-------------------------------------------------------------------------------
VBA MACRO Module4.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module4'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Function insert_into_combat(who As Integer, what_side As Integer)
Dim y As Integer
Dim z As Integer
Dim T As Integer
Dim mitu_lahtrit_vaja_copyda As Integer
mitu_lahtrit_vaja_copyda = 100

'tekitame talle vaba koha pärast viimast aktiivset võitlejat
For z = Sheets("Game_data1").Cells(46 + what_side, 2).Value To 1 Step -1

        If z = Sheets("Game_data1").Cells(55 + what_side, 2).Value Then
                Exit For
        End If
        
        
        For T = 1 To mitu_lahtrit_vaja_copyda 'copytavate itemite arv
                Sheets("Side" & what_side).Cells(1 + z, T).Value = Sheets("Side" & what_side).Cells(z, T).Value
        Next

Next

'ja õige mees viimaseks aktiivseks võitlejaks
For T = 1 To mitu_lahtrit_vaja_copyda 'copytavate itemite arv
                
        Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(55 + what_side, 2).Value + 1, T).Value = Sheets("Side" & what_side).Cells(who + 1, T).Value
        
Next

'is doing nothing in ongoing combat round
Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(55 + what_side, 2).Value + 1, 30).Value = 20

'active combatant juurde
Sheets("Game_data1").Cells(55 + what_side, 2).Value = Sheets("Game_data1").Cells(55 + what_side, 2).Value + 1

do_it = check_players_new_location(what_side)

End Function
Function flee_from_combat(who As Integer, what_side As Integer)
Dim y As Integer
Dim z As Integer
Dim T As Integer
Dim mitu_lahtrit_vaja_copyda As Integer
mitu_lahtrit_vaja_copyda = 100

'kui combatist flees player siis playercharide arv combatis vähenes
If Sheets("Side" & what_side).Cells(who, 35).Value < 1005 Then
        Sheets("Game_data1").Cells(35, 2).Value = Sheets("Game_data1").Cells(35, 2).Value - 1
End If


Sheets("Game_data1").Cells(46 + what_side, 2).Value = Sheets("Game_data1").Cells(46 + what_side, 2).Value + 1



For T = 1 To mitu_lahtrit_vaja_copyda 'copytavate itemite arv
        Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(46 + what_side, 2).Value, T).Value = Sheets("Side" & what_side).Cells(who, T).Value
Next


If who < Sheets("Game_data1").Cells(46 + what_side, 2).Value Then

                y = Sheets("Game_data1").Cells(46 + what_side, 2).Value - who

                For z = 1 To y
                        For T = 1 To mitu_lahtrit_vaja_copyda 'copytavate itemite arv
                                Sheets("Side" & what_side).Cells(who - 1 + z, T).Value = Sheets("Side" & what_side).Cells(who + z, T).Value
                        Next
                Next

End If



Sheets("Game_data1").Cells(46 + what_side, 2).Value = Sheets("Game_data1").Cells(46 + what_side, 2).Value - 1
Sheets("Game_data1").Cells(55 + what_side, 2).Value = Sheets("Game_data1").Cells(55 + what_side, 2).Value - 1

do_it = check_players_new_location(what_side)

End Function
Function check_players_new_location(what_side As Integer)
Dim x As Integer
Dim is_not_dead As Integer

is_not_dead = 0

If what_side <> 5 Then
        For x = 1 To Sheets("Game_data1").Cells(46 + what_side, 2).Value
        
                If Sheets("Side" & what_side).Cells(x, 35).Value <= 1004 Then
                
                        Sheets("Game_data1").Cells(51 + what_side, 2).Value = x
                        is_not_dead = 1
                End If
        
        Next
End If

If what_side <> 5 Then
        If is_not_dead = 0 Then
                Sheets("Game_data1").Cells(51 + what_side, 2).Value = 22
        End If
End If
End Function

Function death_from_combat(who As Integer, what_side As Integer)
Dim y As Integer
Dim z As Integer
Dim T As Integer
Dim mitu_lahtrit_vaja_copyda As Integer
mitu_lahtrit_vaja_copyda = 100

If (who < Sheets("Game_data1").Cells(46 + what_side, 2).Value) Then

                y = Sheets("Game_data1").Cells(46 + what_side, 2).Value - who

                For z = 1 To y
                        For T = 1 To mitu_lahtrit_vaja_copyda
                                Sheets("Side" & what_side).Cells(who - 1 + z, T).Value = Sheets("Side" & what_side).Cells(who + z, T).Value
                        Next
                Next

End If

Sheets("Game_data1").Cells(46 + what_side, 2).Value = Sheets("Game_data1").Cells(46 + what_side, 2).Value - 1
Sheets("Game_data1").Cells(55 + what_side, 2).Value = Sheets("Game_data1").Cells(55 + what_side, 2).Value - 1
do_it = check_players_new_location(what_side)
End Function
Function check_for_mob_spells(who As Integer, what_side As Integer, enemy_Side As Integer)
Dim x As Integer
Dim spell_nr As Integer
Dim spell_element As Integer
Dim spell_type As Integer
Dim spell_mana_Needed As Integer
Dim base_Damage As Integer
Dim legal_list_control As Integer
Dim vastaste_arv As Integer
Dim last_base_dam As Integer
Dim last_spell_type As Integer
Dim over_ride As Integer

check_for_mob_spells = 0
legal_list_control = 0


If Sheets("Side" & what_side).Cells(who, 40).Value > 0 And Sheets("Side" & what_side).Cells(who, 35).Value > 1004 Then
        
        For x = 1 To Sheets("Side" & what_side).Cells(who, 40).Value
                'legal offensive spells to cast
                spell_nr = find_spell_by_name(Sheets("Side" & what_side).Cells(who, 40 + x).Value)
                spell_type = Sheets("Spells").Cells(spell_nr, 8).Value
                base_Damage = Sheets("Spells").Cells(spell_nr, 11).Value
                spell_element = Sheets("Spells").Cells(spell_nr, 7).Value
                spell_mana_Needed = Sheets("Spells").Cells(spell_nr, 9).Value
                
                ' kui on piisavalt mana spelli castimiseks
                If Sheets("Side" & what_side).Cells(who, 12 + spell_element).Value >= spell_mana_Needed Then
                        'If spell_type > 10 Then
                                legal_list_control = legal_list_control + 1
                                Sheets("Nupud").Cells(legal_list_control, 26).Value = spell_nr
                        'End If
                End If
        Next
End If

last_base_dam = 0
last_spell_type = 0
vastaste_arv = Sheets("Game_data1").Cells(55 + enemy_Side, 2).Value

'offensive spell AI - nüüd jääb miski sõelale - selleks võrdleme current spelli statse eelmisega
For x = 1 To legal_list_control

        over_ride = 1
        
        spell_nr = Sheets("Nupud").Cells(x, 26).Value
        base_Damage = Sheets("Spells").Cells(spell_nr, 11).Value
        spell_type = Sheets("Spells").Cells(spell_nr, 8).Value
        
        If vastaste_arv > 1 Then
                If last_spell_type > spell_type Then
                        over_ride = 0
                End If
        End If
        
        If last_base_dam > base_Damage Then
                over_ride = 0
        End If
        
        If over_ride = 1 Then
                check_for_mob_spells = spell_nr
        End If
        
        last_base_dam = base_Damage
        last_spell_type = spell_type
Next

End Function

Function pick_target_for_invidual(who As Integer, what_side As Integer, enemy_Side As Integer, Optional No_casting_allowed As Integer = 0)
Dim x As Integer
Dim is_target_Legal As Integer
Dim wants_to_cast_this_Spell As Integer
Dim control As Integer
Dim invidual_target_needed As Integer
Dim pick_target_for_offensive_single_target_spell As Integer

pick_target_for_offensive_single_target_spell = 0
wants_to_cast_this_Spell = 0
invidual_target_needed = 1

If Sheets("Side" & what_side).Cells(who, 37).Value > 0 Then 'asi on ehitis
        Sheets("Side" & what_side).Cells(who, 30).Value = 20 'siis ta ei tee lahingus midagi
        Sheets("Side" & what_side).Cells(who, 31).Value = 0
Else
        
        do_it = check_for_defensive_building(enemy_Side)
        
        wants_to_cast_this_Spell = check_for_mob_spells(who, what_side, enemy_Side)
        
        If wants_to_cast_this_Spell > 0 And No_casting_allowed = 0 Then
        
                If Sheets("Spells").Cells(wants_to_cast_this_Spell, 8).Value <> 11 Then
                        invidual_target_needed = 0
                        Sheets("Side" & what_side).Cells(who, 30).Value = 10
                        Sheets("Side" & what_side).Cells(who, 31).Value = Sheets("Side" & what_side).Cells(who, 35).Value
                        Sheets("Side" & what_side).Cells(who, 36).Value = wants_to_cast_this_Spell
                End If
                'kontrollime kas on mass damage spell
                If Sheets("Spells").Cells(wants_to_cast_this_Spell, 8).Value = 12 Then
                        invidual_target_needed = 0
                        
                        Sheets("Side" & what_side).Cells(who, 30).Value = 12 'type of action (mass spell offensive)
                        Sheets("Side" & what_side).Cells(who, 31).Value = 100 + enemy_Side
                        Sheets("Side" & what_side).Cells(who, 36).Value = wants_to_cast_this_Spell
                        
                End If
                
                If Sheets("Spells").Cells(wants_to_cast_this_Spell, 8).Value = 11 Then
                
                        pick_target_for_offensive_single_target_spell = 1
                End If
                
        End If
        
        If invidual_target_needed = 1 Then
                'we build legal list here
                control = 0
                For x = 1 To Sheets("Game_data1").Cells(55 + enemy_Side, 2).Value
                        
                        is_target_Legal = 1
                        
                        'kui on fortification ja vastane on müüri taga
                        If Sheets("Game_data1").Cells(68, 2).Value = 1 And Sheets("Side" & enemy_Side).Cells(x, 38).Value = 1 Then
                                
                                'ja kui mob ei shoodi ega ei casti
                                If Sheets("Side" & what_side).Cells(who, 7).Value <> 11 Or pick_target_for_offensive_single_target_spell <> 1 Then
                                        is_target_Legal = 0
                                End If
                                
                        End If
                        
                        If is_target_Legal = 1 Then
                                control = control + 1
                                Sheets("Nupud").Cells(control, 5).Value = x
                        End If
                
                Next
                
                      
                x = Int(Rnd * control + 1)
                
                Sheets("Side" & what_side).Cells(who, 30).Value = 1
                
                If Sheets("Side" & what_side).Cells(who, 7).Value = 11 Then 'if damage type is shoot then
                        Sheets("Side" & what_side).Cells(who, 30).Value = 2
                End If
                
                If pick_target_for_offensive_single_target_spell = 1 Then 'single target spell
                        Sheets("Side" & what_side).Cells(who, 30).Value = 11
                        Sheets("Side" & what_side).Cells(who, 36).Value = wants_to_cast_this_Spell
                End If
                
                Sheets("Side" & what_side).Cells(who, 31).Value = Sheets("Side" & enemy_Side).Cells(Sheets("Nupud").Cells(x, 5).Value, 35).Value
                
        End If
End If

End Function

Function add_combat(side1 As Integer, side2 As Integer)
Dim x As Integer
Dim what_player As Integer

Sheets("Game_data1").Cells(16, 2).Value = 0

do_it = set_Detection(side1, side2, 2)
do_it = set_Detection(side2, side1, 2)

If (Sheets("Game_data1").Cells(87, 2).Value = 0) Then 'kui combatit pole veel peal
        
        
        Sheets("Game_data1").Cells(87, 2).Value = 1 'siis nüüd ta on
        Sheets("Game_data1").Cells(29, 2).Value = 0 'number of sides fighting
        Sheets("Game_data1").Cells(35, 2).Value = 0 'playericharide arv
        
        For x = 1 To 5
        'and all men are able to fight
                Sheets("Game_data1").Cells(55 + x, 2).Value = Sheets("Game_data1").Cells(46 + x, 2).Value
        Next
        
        For x = 1 To 4 'kõikidele human pooltele, global flee not ordered
                Sheets("Game_data1").Cells(38 + x, 2).Value = 0
        Next
        
        Sheets("Game_data1").Cells(29 + side1, 2).Value = 0 'vastaste arv reset igaksjuhuks
        Sheets("Game_data1").Cells(29 + side2, 2).Value = 0
        
End If

        do_it = add_if_not_combatant(side1)
        do_it = add_if_not_combatant(side2)
        
        'vastaste addimine ykseteise enemy listi
        do_it = make_them_enemies(side1, side2)

        do_it = make_shadow_list_of_combatants
 
        Sheets("Game_data1").Cells(44, 2).Value = 0 'menyyde reset, set to MAIN
        Sheets("Game_data1").Cells(37, 2).Value = 1 'and active side is 1st
        Sheets("Game_data1").Cells(38, 2).Value = 1 'and targeting is ON
        
End Function
Function make_shadow_list_of_combatants()
Dim x As Integer

'shadow list of combatants
For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        Sheets("Nupud").Cells(x, 44).Value = Sheets("Fight").Cells(x, 6).Value
Next

Sheets("Game_data1").Cells(156, 2).Value = Sheets("Game_data1").Cells(29, 2).Value
Sheets("Game_data1").Cells(157, 2).Value = 1

End Function


Function add_if_not_combatant(what_side As Integer)
Dim x As Integer
Dim counter As Integer
counter = 0

If Sheets("Game_data1").Cells(29, 2).Value > 0 Then

        For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
           If what_side = Sheets("Fight").Cells(x, 6).Value Then
                counter = 1
           End If
        Next

End If

        If counter = 0 Then
        
                Sheets("Game_data1").Cells(29, 2).Value = Sheets("Game_data1").Cells(29, 2).Value + 1
                Sheets("Fight").Cells(Sheets("Game_data1").Cells(29, 2).Value, 6).Value = what_side
                
                If what_side <> 5 Then
                        Sheets("Game_data1").Cells(35, 2).Value = Sheets("Game_data1").Cells(35, 2).Value + 1
                        'here we start monitoring players hp loss
                        Sheets("Game_data1").Cells(92 + what_side, 2).Value = Sheets("Side" & what_side).Cells(Sheets("Game_data1").Cells(51 + what_side, 2).Value, 2).Value
                End If
        
        End If

End Function


Function make_them_enemies(what_side As Integer, what_target_side As Integer)
Dim attacking_neutral As Integer

attacking_neutral = check_if_attacking_neutral(what_side, what_target_side)

If attacking_neutral = 1 Then 'neutral vastaseks
        
        'kas vaja kahepoolset viha
        attacking_neutral = check_if_attacking_neutral(what_target_side, what_side)
        
        If attacking_neutral = 1 Then
                do_it = add_conflict(what_side, what_target_side, 1)
        Else
                do_it = add_conflict(what_side, what_target_side)
        End If
        
End If

End Function
Function check_if_attacking_neutral(what_side As Integer, enemy_Side As Integer) As Integer
check_if_attacking_neutral = 1
Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(29 + what_side, 2).Value 'what_sides enemy list
        
        If Sheets("Fight").Cells(x, what_side).Value = enemy_Side Then
        
                check_if_attacking_neutral = 0
                
        End If
Next

End Function
Function add_conflict(what_side As Integer, enemy_Side As Integer, Optional what_to_do As Integer = 0)
'what_to_do 0 ühepoolne, what_to_do 1 kahepoolne

If what_to_do = 0 Or what_to_do = 1 Then
        
        Sheets("Game_data1").Cells(29 + what_side, 2).Value = Sheets("Game_data1").Cells(29 + what_side, 2).Value + 1
        Sheets("Fight").Cells(Sheets("Game_data1").Cells(29 + what_side, 2).Value, what_side).Value = enemy_Side

End If

If what_to_do = 1 Then
        
        Sheets("Game_data1").Cells(29 + enemy_Side, 2).Value = Sheets("Game_data1").Cells(29 + enemy_Side, 2).Value + 1
        Sheets("Fight").Cells(Sheets("Game_data1").Cells(29 + enemy_Side, 2).Value, enemy_Side).Value = what_side

End If

End Function
Function Fight_player_land()

Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim mob As Integer
Dim what_player As Integer
Dim ruut As Integer
Dim land_owner As Integer
Dim player_name As String
Dim targeting_needed As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
player_name = Sheets("Game_data1").Cells(10 + what_player, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
land_owner = Sheets("Game_map").Cells(ruut, 2).Value


Sheets("Game_data1").Cells(89, 2).Value = 0 'Sellise asja peale küll land enam ostetav pole
Sheets("Game_data1").Cells(88, 2).Value = 2 'Pigem neutraalne_vaenulik

targeting_needed = 1

do_it = valiknuppude_Kustutamine()
do_it = mobs_display()

If Sheets("Game_map").Cells(ruut, 1).Value > 19 Then
        Sheets("Game_data1").Cells(80, 2).Value = 1 'active player vs land
End If

If Sheets("Game_data1").Cells(190, 2).Value = 2 Or Sheets("Game_data1").Cells(190, 2).Value = 3 Then
        Sheets("Game_data1").Cells(207, 2).Value = 1 'battle for treasure is ON
End If

do_it = add_combat(what_player, 5)
               
If land_owner > 0 Then

        If Sheets("Fight").Cells(30, land_owner).Value > 0 Then
                
                MsgBox (Sheets("Game_data1").Cells(10 + land_owner, 2).Value & Sheets("Lan" & Language).Cells(612, 1).Value)
                
                do_it = text_Output("", 3)
                do_it = text_Output(Sheets("Game_data1").Cells(10 + land_owner, 2).Value & Sheets("Lan" & Language).Cells(613, 1).Value & player_name & Sheets("Lan" & Language).Cells(617, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(614, 1).Value, 1)
                
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(615, 1).Value, "attack_" & land_owner, 0, 1)
                
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(616, 1).Value, "move_away_" & land_owner, 0, 1)
                
                targeting_needed = 0
        Else
                If Sheets("Game_map").Cells(ruut, find_building_slot_in_map(Sheets("Lan" & Language).Cells(859, 1).Value)).Value = 1 Then
                 'portal exists
                        MsgBox (Sheets("Game_data1").Cells(10 + land_owner, 2).Value & Sheets("Lan" & Language).Cells(612, 1).Value)
                        do_it = text_Output("", 3)
                        do_it = text_Output(Sheets("Game_data1").Cells(10 + land_owner, 2).Value & Sheets("Lan" & Language).Cells(860, 1).Value & player_name & Sheets("Lan" & Language).Cells(864, 1).Value, 1)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(861, 1).Value, 1)
                        
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(862, 1).Value, "port_" & land_owner, 0, 1)
                
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(863, 1).Value, "do_not_port", 0, 1)
                        
                        targeting_needed = 0
                        
                End If
                       
        End If

End If

If targeting_needed = 1 Then
        
        do_it = recalculate_combat_order()
        do_it = make_shadow_list_of_combatants
        do_it = targeting_global()
End If

End Function
Function Add_new_mob(Optional what_side As Integer = 5, Optional mob As Integer = 0, Optional behind_Wall As Integer = 0, Optional merc As Integer = 0, Optional very_brave As Integer = 0, Optional evolve As Integer = 0, Optional pet As Integer = 0)
Dim mitmes_mob As Integer
Dim what_player As Integer
Dim aktiivne_Land As Integer


aktiivne_Land = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value


Sheets("Game_data1").Cells(46 + what_side, 2).Value = Sheets("Game_data1").Cells(46 + what_side, 2).Value + 1
mitmes_tabelis = Sheets("Game_data1").Cells(46 + what_side, 2).Value

'if error or something
If (mob <= 0) Then
        mob = 20
End If



'nr
Sheets("Game_data1").Cells(46, 2).Value = Sheets("Game_data1").Cells(46, 2).Value + 1
Sheets("Side" & what_side).Cells(mitmes_tabelis, 35).Value = Sheets("Game_data1").Cells(46, 2).Value

'name
Sheets("Side" & what_side).Cells(mitmes_tabelis, 1).Value = Sheets("Mobs").Cells(mob, 1).Value
'current life
Sheets("Side" & what_side).Cells(mitmes_tabelis, 2).Value = Sheets("Mobs").Cells(mob, 2).Value
'Max life
Sheets("Side" & what_side).Cells(mitmes_tabelis, 3).Value = Sheets("Mobs").Cells(mob, 2).Value
'number of attacks
Sheets("Side" & what_side).Cells(mitmes_tabelis, 4).Value = Sheets("Mobs").Cells(mob, 3).Value
'd1
Sheets("Side" & what_side).Cells(mitmes_tabelis, 5).Value = Sheets("Mobs").Cells(mob, 4).Value
'd2
Sheets("Side" & what_side).Cells(mitmes_tabelis, 6).Value = Sheets("Mobs").Cells(mob, 5).Value
'damage type
Sheets("Side" & what_side).Cells(mitmes_tabelis, 7).Value = Sheets("Mobs").Cells(mob, 6).Value
'str, dex, power
Sheets("Side" & what_side).Cells(mitmes_tabelis, 8).Value = Sheets("Mobs").Cells(mob, 7).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 9).Value = Sheets("Mobs").Cells(mob, 8).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 10).Value = Sheets("Mobs").Cells(mob, 9).Value
'modified str, dex, power
Sheets("Side" & what_side).Cells(mitmes_tabelis, 11).Value = Sheets("Mobs").Cells(mob, 7).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 12).Value = Sheets("Mobs").Cells(mob, 8).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 13).Value = Sheets("Mobs").Cells(mob, 9).Value
'armor
Sheets("Side" & what_side).Cells(mitmes_tabelis, 14).Value = Sheets("Mobs").Cells(mob, 10).Value

'mob or building_type
Sheets("Side" & what_side).Cells(mitmes_tabelis, 37).Value = Sheets("Mobs").Cells(mob, 30).Value


'AI
Sheets("Side" & what_side).Cells(mitmes_tabelis, 32).Value = Sheets("Mobs").Cells(mob, 11).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 33).Value = Sheets("Mobs").Cells(mob, 12).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 34).Value = Sheets("Mobs").Cells(mob, 13).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 39).Value = merc

'mob spells

Sheets("Side" & what_side).Cells(mitmes_tabelis, 40).Value = Sheets("Mobs").Cells(mob, 32).Value 'mobi spellicontroll
Sheets("Side" & what_side).Cells(mitmes_tabelis, 41).Value = Sheets("Mobs").Cells(mob, 33).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 42).Value = Sheets("Mobs").Cells(mob, 34).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 43).Value = Sheets("Mobs").Cells(mob, 35).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 44).Value = Sheets("Mobs").Cells(mob, 36).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 45).Value = Sheets("Mobs").Cells(mob, 37).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 46).Value = Sheets("Mobs").Cells(mob, 38).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 47).Value = Sheets("Mobs").Cells(mob, 39).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 48).Value = Sheets("Mobs").Cells(mob, 40).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 49).Value = 0

'fire, cold etc, bleeding extra dam,
Sheets("Side" & what_side).Cells(mitmes_tabelis, 50).Value = Sheets("Mobs").Cells(mob, 41).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 51).Value = Sheets("Mobs").Cells(mob, 42).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 52).Value = Sheets("Mobs").Cells(mob, 43).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 53).Value = Sheets("Mobs").Cells(mob, 44).Value

'negative effects like poison, bleeding, stun
Sheets("Side" & what_side).Cells(mitmes_tabelis, 54).Value = 0 'bleeding
Sheets("Side" & what_side).Cells(mitmes_tabelis, 55).Value = 0 'stun
Sheets("Side" & what_side).Cells(mitmes_tabelis, 56).Value = 0 'poison
Sheets("Side" & what_side).Cells(mitmes_tabelis, 57).Value = 0 'frozen
Sheets("Side" & what_side).Cells(mitmes_tabelis, 58).Value = 0 'burning

'immunities
Sheets("Side" & what_side).Cells(mitmes_tabelis, 59).Value = Sheets("Mobs").Cells(mob, 45).Value 'fire
Sheets("Side" & what_side).Cells(mitmes_tabelis, 60).Value = Sheets("Mobs").Cells(mob, 48).Value 'poison
Sheets("Side" & what_side).Cells(mitmes_tabelis, 61).Value = Sheets("Mobs").Cells(mob, 46).Value 'lightning
Sheets("Side" & what_side).Cells(mitmes_tabelis, 62).Value = Sheets("Mobs").Cells(mob, 47).Value 'cold
Sheets("Side" & what_side).Cells(mitmes_tabelis, 63).Value = Sheets("Mobs").Cells(mob, 49).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 64).Value = Sheets("Mobs").Cells(mob, 50).Value

'pet
Sheets("Side" & what_side).Cells(mitmes_tabelis, 65).Value = evolve
Sheets("Side" & what_side).Cells(mitmes_tabelis, 66).Value = Sheets("Mobs").Cells(mob, 51).Value
Sheets("Side" & what_side).Cells(mitmes_tabelis, 67).Value = pet

Sheets("Side" & what_side).Cells(mitmes_tabelis, 68).Value = Sheets("Mobs").Cells(mob, 53).Value 'spelllevel extra


For x = 16 To 29 'mana + manaregen
        Sheets("Side" & what_side).Cells(mitmes_tabelis, x).Value = Sheets("Mobs").Cells(mob, x).Value
Next

If behind_Wall = 0 Then
        Sheets("Side" & what_side).Cells(mitmes_tabelis, 38).Value = 0
Else
        Sheets("Side" & what_side).Cells(mitmes_tabelis, 38).Value = 1
End If

If aktiivne_Land = 0 Then
        aktiivne_Land = 1
End If

'neutral mobs dont flee
If what_side = 5 And Sheets("Game_map").Cells(aktiivne_Land, 2).Value = 0 Then
        Sheets("Side" & what_side).Cells(mitmes_tabelis, 34).Value = 10
End If

'braver override for castles and such - so defenders wont flee
If very_brave = 1 Then
        Sheets("Side" & what_side).Cells(mitmes_tabelis, 34).Value = 10
End If

End Function


Function recalculate_combat_order()
Dim x As Integer
Dim what_player As Integer
what_player = Sheets("Game_data1").Cells(10, 2).Value
Dim players(5) As Integer
Dim mitmes As Integer
mitmes = 0

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        
        If (Sheets("Fight").Cells(x, 6).Value = 5) Then
                'all ai, no prompt (We do side without a player first as a bonus to the side)
                mitmes = mitmes + 1
                players(mitmes) = 5
        End If

Next

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        
        If (Sheets("Fight").Cells(x, 6).Value = what_player) Then
                'active player
                mitmes = mitmes + 1
                players(mitmes) = what_player
        End If
        
Next

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        
        If (Sheets("Fight").Cells(x, 6).Value <> what_player And Sheets("Fight").Cells(x, 6).Value <> 5) Then
                'other players
                mitmes = mitmes + 1
                players(mitmes) = Sheets("Fight").Cells(x, 6).Value
        End If

Next

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value 'siin muudamegi järjekorda
        Sheets("Fight").Cells(x, 6).Value = players(x)
Next

End Function

Function targeting_global()
Dim x As Integer

Dim active_combat_side As Integer

do_it = mobs_display() 'ajutine

active_combat_side = Sheets("Game_data1").Cells(37, 2).Value

do_it = pick_targets_for_side(Sheets("Fight").Cells(active_combat_side, 6).Value)


End Function

Function pick_targets_for_side(what_side As Integer)
                
Dim player_in_battle As Integer
Dim who As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

player_in_battle = 0

do_it = day_output()

If (what_side <> 5) Then

        If (Sheets("Game_data1").Cells(51 + what_side, 2).Value <= Sheets("Game_data1").Cells(55 + what_side, 2).Value) Then
                player_in_battle = 1
        Else
                player_in_battle = 0
        End If

End If

If (player_in_battle = 1) Then
        
        who = Sheets("Game_data1").Cells(51 + what_side, 2).Value
        
        If Sheets("Game_data1").Cells(116 + what_side, 2).Value = 0 Then
                'stun
                If Sheets("Side" & what_side).Cells(who, 55).Value > 0 Or Sheets("Side" & what_side).Cells(who, 57).Value > 0 Then
                                                
                        If Sheets("Side" & what_side).Cells(who, 57).Value = 0 Then
                                MsgBox (Sheets("Game_data1").Cells(10 + what_side, 2).Value & Sheets("Lan" & Language).Cells(618, 1).Value)
                        Else
                                If Sheets("Side" & what_side).Cells(who, 55).Value = 0 Then
                                        MsgBox (Sheets("Game_data1").Cells(10 + what_side, 2).Value & Sheets("Lan" & Language).Cells(619, 1).Value)
                                Else
                                        MsgBox (Sheets("Game_data1").Cells(10 + what_side, 2).Value & Sheets("Lan" & Language).Cells(620, 1).Value)
                                End If
                        End If
                        
                        do_it = pick_targets_for_side2(what_side, 1)
                Else
                        If (Sheets("Game_data1").Cells(35, 2).Value > 1) Then
                                'do_it = text_Output("", 3)
                                MsgBox (Sheets("Game_data1").Cells(10 + what_side, 2).Value & Sheets("Lan" & Language).Cells(621, 1).Value)
                                do_it = text_Output(Sheets("Game_data1").Cells(10 + what_side, 2).Value & Sheets("Lan" & Language).Cells(621, 1).Value, 1)
                        End If
                        
                        do_it = targeting_menu(what_side)
                End If
        Else
        
                Sheets("Game_data1").Cells(116 + what_side, 2).Value = 0
                do_it = pick_targets_for_side2(what_side, 1)
        End If
        
Else
    
    do_it = pick_targets_for_side2(what_side, 0)

End If

End Function

Function global_commands(command As Integer)

Dim what_side As Integer
Dim enemy_Side As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

do_it = valiknuppude_Kustutamine()

what_side = Sheets("Fight").Cells(Sheets("Game_data1").Cells(37, 2).Value, 6).Value
enemy_Side = Sheets("Game_data1").Cells(43, 2).Value

If (command = 1) Then
        Sheets("Game_data1").Cells(38 + what_side, 2).Value = 1
        do_it = text_Output("", 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(622, 1).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(623, 1).Value, 0, 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(624, 1).Value, 1)
End If

If (command = 2) Then
        Sheets("Game_data1").Cells(38 + what_side, 2).Value = 0
        do_it = text_Output("", 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(622, 1).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(625, 1).Value, 0, 5)
        do_it = text_Output(Sheets("Lan" & Language).Cells(626, 1).Value, 1)
End If

If (Sheets("Game_data1").Cells(44, 2).Value = 1) Then
        do_it = targeting_side_submenu(what_side)
End If

If (Sheets("Game_data1").Cells(44, 2).Value = 2) Then
        do_it = targeting_party_members(what_side, enemy_Side)
End If

End Function

Function targeting_side_submenu(what_side As Integer, Optional Attack_buttons_only As Integer = 0)
    
    Dim side_name As String
    Dim to_do_what As String
    Dim mitmes_spell As Integer
    Dim is_target_in_combat As Integer
    Dim target_side As Integer
    Dim party_button_needed As Integer
    Dim ruut As Integer 'active land
    Dim is_spell_Aggressive As Integer
    Dim visibility As Integer
    Dim Language As Integer
    Dim cast_on As Integer
    
    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value
    cast_on = 0
    ruut = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
    
    Sheets("Game_data1").Cells(98, 2).Value = what_side
    
    do_it = valiknuppude_Kustutamine()
    mitmes_spell = 100
    is_spell_Aggressive = 0
    
    If Attack_buttons_only = 1 Then
            Sheets("Game_data1").Cells(45, 2).Value = 0
    End If
    
    If (Sheets("Game_data1").Cells(45, 2).Value <> 1) Then
            
            'attack
            to_do_what = Sheets("Lan" & Language).Cells(627, 1).Value
            
            If Attack_buttons_only = 0 Then
            
                    Sheets("Game_data1").Cells(44, 2).Value = 1 'menu type set to targeting side
                    
                    If is_player_ai(what_side) = 0 Then
                            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(628, 1).Value, "flee", 0, 1)
                    Else
                            do_it = add_ai_choice(16)
                    End If
                    
                    
                    cast_on = 1
                    
                    do_it = other_buttons_in_combat_menu(what_side)
            
            End If
    Else
            
            mitmes_spell = Sheets("Game_data1").Cells(167, 2).Value
            'cast on
            to_do_what = Sheets("Lan" & Language).Cells(629, 1).Value
            
            
            
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_spell_targeting_menu", 0, 1)
    
    End If
    
    
     For x = 1 To Sheets("Fight").Cells(30, what_side).Value
    
            target_side = Sheets("Fight").Cells(30 + x, what_side).Value
            
            visibility = 0
            
            If Sheets("Fight").Cells(30 + x, what_side + 5).Value = 2 And Sheets("Fight").Cells(30, target_side + 5).Value = 0 Then
                    visibility = 2
            End If
            
            If Sheets("Game_data1").Cells(45, 2).Value = 1 Then
                   If Sheets("Spells").Cells(mitmes_spell, 22).Value = 1 Then
                        is_spell_Aggressive = 1
                   End If
            End If
            
            If target_side = 5 Then
                    'defenders of land_name
                    side_name = Sheets("Lan" & Language).Cells(630, 1).Value & eesti_nimi(Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 4).Value, 1) & Sheets("Lan" & Language).Cells(632, 1).Value
                    
            Else
                    
                    If Sheets("Game_data1").Cells(46 + target_side, 2).Value > 1 Then
                        
                            side_name = Sheets("Game_data1").Cells(10 + target_side, 2).Value & Sheets("Lan" & Language).Cells(850, 1).Value
                            
                    Else
                            side_name = Sheets("Game_data1").Cells(10 + target_side, 2).Value
                        
                    End If
                            
            End If
                    
            party_button_needed = 1
                    
            If is_spell_Aggressive = 1 Or Attack_buttons_only = 1 Or cast_on = 1 Then
            
                    If target_side = 5 Then
                            If Sheets("Game_map").Cells(ruut, 2).Value = what_side Then
                                    party_button_needed = 0
                            End If
                    End If
                    
                    If target_side = what_side Then
                            party_button_needed = 0
                    End If
            
            End If
                    
            If visibility = 2 Then
            
                    If Sheets("Game_data1").Cells(87, 2).Value = 1 Then 'kui combat on peal
                            
                         
                             
                                    If Sheets("Game_data1").Cells(55 + target_side, 2).Value = 1 Then
                                            If party_button_needed <> 0 Then
                                                    do_it = targeting_party_members(what_side, target_side, 1, Attack_buttons_only)
                                                    party_button_needed = 0
                                            End If
                                    End If
                            
                           
                    Else
                            
                                    If Sheets("Game_data1").Cells(46 + target_side, 2).Value = 1 Then
                                            'invidual to do
                                            If party_button_needed <> 0 Then
                                                    do_it = targeting_party_members(what_side, target_side, 1, Attack_buttons_only)
                                            End If
                                    End If
                                    
                                    If Sheets("Game_data1").Cells(46 + target_side, 2).Value < 2 Then
                                            party_button_needed = 0
                                    End If
                            
                            
                    End If
                    
            End If
            
            If visibility = 2 Then
                    
                    If party_button_needed = 1 Then
                            
                            If Attack_buttons_only = 0 Then
                                    do_it = Nuppudega_tegeleja(to_do_what & side_name, "target_side" & Sheets("Fight").Cells(30 + x, what_side).Value, 0, 1)
                            Else
                                    do_it = Nuppudega_tegeleja(to_do_what & side_name, "engage_side" & Sheets("Fight").Cells(30 + x, what_side).Value, 0, 1)
                            End If
                            
                    End If
            
            End If
    Next

'
If is_player_ai(what_side) = 1 Then
        do_it = Ai_commands(what_side)
End If
    
End Function

Function target_member_selected(what_mob As Integer, what_target_side As Integer)
Dim what_side As Integer
Dim who As Integer
Dim attacking_neutral As Integer
Dim mitmes_spell As Integer
Dim check_for_combat_Start As Integer
Dim Start_combat As Integer
Dim agressive As Integer
Dim ruut As Integer
ruut = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()


check_for_combat_Start = 0
Start_combat = 0

what_side = Sheets("Game_data1").Cells(98, 2).Value
        

who = Sheets("Game_data1").Cells(51 + what_side, 2).Value

If (what_mob <> 0) Then

        If Sheets("Game_data1").Cells(45, 2).Value = 1 Then 'kui see oli spell
                
                mitmes_spell = Sheets("Game_data1").Cells(167, 2).Value
                agressive = 0
                
                If Sheets("Spells").Cells(mitmes_spell, 22).Value = 1 Then
                        agressive = 1
                End If
                
                Sheets("Side" & what_side).Cells(who, 30).Value = 10 'default peaceful spell
                
                If Sheets("Spells").Cells(mitmes_spell, 25).Value = 1 Then 'targets group
                        'mass damage spell
                        If agressive = 1 Then
                                Sheets("Side" & what_side).Cells(who, 30).Value = 12 'type of action (mass spell offensive spell)
                        End If
                        Sheets("Side" & what_side).Cells(who, 31).Value = 100 + what_target_side
                        
                Else
                        If Sheets("Spells").Cells(mitmes_spell, 26).Value = 1 Then 'targets single unit
                                If agressive = 1 Then
                                        Sheets("Side" & what_side).Cells(who, 30).Value = 11
                                End If
                                Sheets("Side" & what_side).Cells(who, 31).Value = Sheets("Side" & what_target_side).Cells(what_mob, 35).Value
                        End If
                End If
                
                Sheets("Side" & what_side).Cells(who, 36).Value = mitmes_spell 'mis spell castitud
                
                If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                        
                        If agressive = 1 Then
                                If what_target_side = 5 And Sheets("Game_map").Cells(ruut, 2).Value = what_side Then
                                        'do nothing and give error output
                                        do_it = text_Output("ERROR: Conflict situation with your own defender unit", 1)
                                Else
                                
                                        do_it = make_them_enemies(what_side, what_target_side)
                                End If
                        
                        End If
                        
                Else
                        If agressive = 1 Then
                                check_for_combat_Start = 1
                                Start_combat = 1
                        Else
                                check_for_combat_Start = 1
                        End If
                        
                End If
                
                
                
                
        Else
        
              
                Sheets("Side" & what_side).Cells(who, 30).Value = 1 'hitting
                Sheets("Side" & what_side).Cells(who, 31).Value = Sheets("Side" & what_target_side).Cells(what_mob, 35).Value
                
                If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                        If what_target_side = 5 And Sheets("Game_map").Cells(ruut, 2).Value = what_side Then
                                        'do nothing and give error output
                                        do_it = text_Output("ERROR: Conflict situation with your own defender unit", 1)
                                Else
                                
                                        do_it = make_them_enemies(what_side, what_target_side)
                                End If
                Else
                        check_for_combat_Start = 1
                End If
        End If
        
Else 'flee

        Sheets("Side" & what_side).Cells(who, 30).Value = 0
        Sheets("Side" & what_side).Cells(who, 31).Value = 0

End If



If check_for_combat_Start = 1 Then
        
        If Start_combat = 1 Then
                
                Sheets("Game_data1").Cells(116 + what_side, 2).Value = 1
                
                If what_target_side = 5 Then
                        'POOLELI - TODO tingimused, mis siis saab kui see polnud aktiivne player
                        do_it = Fight_player_land()
                Else
                        do_it = attack_player(what_side, what_target_side)
                
                End If
        Else
                If (Sheets("Game_data1").Cells(45, 2).Value = 1) Then
                        'mana maha
                        Sheets("Side" & what_side).Cells(who, 12 + Sheets("Spells").Cells(mitmes_spell, 7).Value).Value = Sheets("Side" & what_side).Cells(who, 12 + Sheets("Spells").Cells(mitmes_spell, 7).Value).Value - Sheets("Spells").Cells(mitmes_spell, 9).Value
                        do_it = spell_effect(mitmes_spell, what_side, who, what_target_side, what_mob)
                        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
                End If
                
                do_it = Main_turn()
               
        End If
        
        If (Sheets("Game_data1").Cells(45, 2).Value = 1) Then 'spell castitud
              
              Sheets("Game_data1").Cells(45, 2).Value = 0
        End If
        
Else
        If (Sheets("Game_data1").Cells(45, 2).Value = 1) Then 'spell castitud
              
              Sheets("Game_data1").Cells(45, 2).Value = 0
        End If
        
        do_it = pick_targets_for_side2(what_side, 1)
        
End If



End Function


Function targeting_menu(what_side As Integer)

Sheets("Game_data1").Cells(45, 2).Value = 0
do_it = targeting_side_submenu(what_side)

End Function
Function other_buttons_in_combat_menu(what_side As Integer)
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value

'Spellmenu tekitamine
    
    Sheets("Game_data1").Cells(187, 2).Value = check_spell_knowledge(Sheets("Fight").Cells(Sheets("Game_data1").Cells(37, 2).Value, 6).Value)
                
    If Sheets("Game_data1").Cells(187, 2).Value > 0 Then
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(24, 1).Value, "spell_menu", 0, 1)
    End If 'spellnupu tekitamise lõpp

If (Sheets("Game_data1").Cells(55 + what_side, 2).Value > 1) Then 'kattuv menyy
            
        If (Sheets("Game_data1").Cells(38 + what_side, 2).Value = 1) Then
                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(633, 1).Value, "global_attack", 0, 1)
                Else
                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(634, 1).Value, "global_flee", 0, 1)
        End If

End If

End Function
Function check_for_defensive_building(what_side As Integer)
Dim x As Integer

Sheets("Game_data1").Cells(68, 2).Value = 0

For x = 1 To Sheets("Game_data1").Cells(55 + what_side, 2).Value

        If Sheets("Side" & what_side).Cells(x, 37).Value = 1 Then
                Sheets("Game_data1").Cells(68, 2).Value = 1
        End If

Next


End Function


Function targeting_party_members(what_side As Integer, target_side As Integer, Optional one_time_Call As Integer = 0, Optional Attack_buttons_only As Integer = 0)
Dim x As Integer
Dim z As Integer
Dim counter As Long
Dim to_do_what As String
Dim mitmes_spell As Integer
Dim who As Integer
Dim is_target_Legal As Integer
Dim how_many_persons_in_target_side As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

Sheets("Game_data1").Cells(98, 2).Value = what_side

who = Sheets("Game_data1").Cells(51 + what_side, 2).Value
mitmes_spell = Sheets("Game_data1").Cells(167, 2).Value

If one_time_Call = 0 Then
        do_it = valiknuppude_Kustutamine()
End If

If (Sheets("Game_data1").Cells(45, 2).Value <> 1) Then 'if its not spell-targeting
        
        to_do_what = Sheets("Lan" & Language).Cells(627, 1).Value
        
        If one_time_Call = 0 Then
        
                If Sheets("Game_data1").Cells(29, 2).Value > 2 Then 'cancel nupp
                
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_targeting_party_members", 0, 1)
                
                End If
                
                Sheets("Game_data1").Cells(44, 2).Value = 2 'menu type set to targeting invidual party member
                
                If is_player_ai(what_side) = 0 Then
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(628, 1).Value, "flee", 0, 1)
                Else
                        do_it = add_ai_choice(16)
                End If
                
                do_it = other_buttons_in_combat_menu(what_side)
        
        End If
Else
        to_do_what = Sheets("Lan" & Language).Cells(629, 1).Value
        
        If one_time_Call = 0 Then
                If (Sheets("Spells").Cells(mitmes_spell, 8).Value <> 12) Then
                       do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_spell_targeting_menu", 0, 1)
                End If
        End If
         
End If

continue_to_invidual_Targeting = 1

Sheets("Game_data1").Cells(43, 2).Value = target_side

       
If one_time_Call = 0 Then
        If Sheets("Game_data1").Cells(45, 2).Value = 1 Then
                If Sheets("Spells").Cells(mitmes_spell, 25).Value = 1 Then 'targets group
                        continue_to_invidual_Targeting = 0
                        'mass damage spell
                        Sheets("Side" & what_side).Cells(who, 30).Value = 12 'type of action (mass spell offensive spell)
                        Sheets("Side" & what_side).Cells(who, 31).Value = 100 + target_side
                        Sheets("Side" & what_side).Cells(who, 36).Value = mitmes_spell 'mis spell castitud
                End If
        End If
End If

If continue_to_invidual_Targeting = 1 Then
        If one_time_Call = 0 Then
                If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                        how_many_persons_in_target_side = Sheets("Game_data1").Cells(55 + target_side, 2).Value
                Else
                        how_many_persons_in_target_side = Sheets("Game_data1").Cells(46 + target_side, 2).Value
                End If
        Else
                how_many_persons_in_target_side = 1
        End If
        
        For x = 1 To how_many_persons_in_target_side
                
                do_it = check_for_defensive_building(target_side)
                
                counter = 0
                is_target_Legal = 1
                
                'kui seal on defence building ja vastase mees istub müüri taga, siis
                If Sheets("Game_data1").Cells(68, 2).Value = 1 And Sheets("Side" & target_side).Cells(x, 38).Value = 1 Then
                        'kui player ei lase spelli ega pole ta weapon ka missile
                        If Sheets("Game_data1").Cells(45, 2).Value <> 1 And Sheets("Side" & what_side).Cells(who, 7).Value <> 11 Then
                                is_target_Legal = 0
                        End If
                End If
                
                If is_target_Legal = 1 Then
                
                        For z = 1 To x
                                If Sheets("Side" & target_side).Cells(z, 1).Value = Sheets("Side" & target_side).Cells(x, 1).Value Then
                                        counter = counter + 1
                                End If
                        Next
                        
                        
                        
                        If counter > 1 Then
                                If Attack_buttons_only = 0 Then
                                        do_it = Nuppudega_tegeleja(to_do_what & mitmes_asi(counter) & " " & eesti_nimi(Sheets("Side" & target_side).Cells(x, 1).Value, 3), "target_side" & target_side & "_mob" & x, 0, 1)
                                Else
                                        do_it = Nuppudega_tegeleja(to_do_what & mitmes_asi(counter) & " " & eesti_nimi(Sheets("Side" & target_side).Cells(x, 1).Value, 3), "engage_side" & target_side, 0, 1)
                                End If
                                
                            
                        Else
                                
                                If Attack_buttons_only = 0 Then
                                        If is_player_ai(what_side) = 0 Then
                                                do_it = Nuppudega_tegeleja(to_do_what & eesti_nimi(Sheets("Side" & target_side).Cells(x, 1).Value, 3), "target_side" & target_side & "_mob" & x, 0, 1)
                                        Else
                                                'target_member_selected(20, 4)
                                                do_it = add_ai_choice(100 * target_side + x)
                                        End If
                                Else
                                        do_it = Nuppudega_tegeleja(to_do_what & eesti_nimi(Sheets("Side" & target_side).Cells(x, 1).Value, 3), "engage_side" & target_side, 0, 1)
                                End If
                                
                        
                        End If
                
                End If
        
        Next

                
End If

If Sheets("Game_data1").Cells(45, 2).Value = 1 Then

        If Sheets("Spells").Cells(mitmes_spell, 25).Value = 1 Then 'kui on mass spell
                If one_time_Call = 0 Then
                        If Sheets("Game_data1").Cells(45, 2).Value = 1 Then
                                'spell castitud
                                Sheets("Game_data1").Cells(45, 2).Value = 0
                        End If
                        do_it = pick_targets_for_side2(what_side, 1)
                End If
        End If
        
End If

End Function

Function pick_targets_for_side2(what_side As Integer, player_in_battle As Integer)

Dim x As Integer
Dim random_nr As Integer
Dim opt_nr As Integer
Dim will_flee As Integer
opt_nr = 55
will_flee = 0

For x = 1 To Sheets("Game_data1").Cells(opt_nr + what_side, 2).Value 'mobide arv sides
                
        If (player_in_battle = 1 And Sheets("Game_data1").Cells(51 + what_side, 2).Value = x) Then
                 'skipime playeri enda
        Else
                'TO DO kui player on andnud oma käsu fleeda või mis iganes, siis kas mob kuuletub
                ' AI! AI! AI mobide AI algab siin
                If what_side <> 5 Then
                        If (Sheets("Game_data1").Cells(38 + what_side, 2).Value = 1) Then
                        'global flee ordered, what will mob do?
                               
                                will_flee = check_AI_flee(x, what_side, 1)
                                
                        Else
                                will_flee = check_AI_flee(x, what_side, 0)
                        End If
                Else
                                will_flee = check_AI_flee(x, what_side, 0)
                End If
                
                If will_flee = 0 Then
                
                        If (Sheets("Game_data1").Cells(29 + what_side, 2).Value > 1) Then
                        
                                random_nr = Int(Rnd * Sheets("Game_data1").Cells(29 + what_side, 2).Value + 1)
                                
                        Else
                                random_nr = 1
                        
                        End If
                        
                        do_it = pick_target_for_invidual(x, what_side, Sheets("Fight").Cells(random_nr, what_side).Value)
                Else
                        Sheets("Side" & what_side).Cells(x, 30).Value = 0
                        Sheets("Side" & what_side).Cells(x, 31).Value = 0
                End If
        
        End If
        
        'viimane mob listis, järelikult tuleb kas combat või jargmine targetiv pool
        If x = Sheets("Game_data1").Cells(opt_nr + what_side, 2).Value Then
                
                do_it = switch_combat_side()
                
                If (Sheets("Game_data1").Cells(38, 2).Value = 0) Then
                        
                        'execute fighting
                        do_it = combat_global()
                Else
                        
                        do_it = targeting_global()
                
                End If
                
        End If
Next


End Function
Function check_AI_flee(who As Integer, what_side As Integer, global_flee_ordered As Integer) As Integer
Dim hp_protsent_left As Integer

hp_protsent_left = Sheets("Side" & what_side).Cells(who, 2).Value / (Sheets("Side" & what_side).Cells(who, 3).Value / 100)

check_AI_flee = 0

If Sheets("Side" & what_side).Cells(who, 33).Value = 10 Then
        'with max obidience mob will always bid his masters will
        If global_flee_ordered = 1 Then
        
                check_AI_flee = 1
                
        End If
        
Else
        'with less then max obidience, mob might do masters will, unless he is utterly brave, then he never flees
        If Sheets("Side" & what_side).Cells(who, 34).Value = 10 Then
                
        Else
        
                If global_flee_ordered = 1 Then
        
                        check_AI_flee = 1
                
                End If
        
                'ajutine lihtne enda hapsu vaatamine
                If hp_protsent_left < (100 - Sheets("Side" & what_side).Cells(who, 34).Value * 10) Then
                        check_AI_flee = 1
                End If
                
        End If
        
End If

End Function
Function switch_combat_side()

Dim active_combat_side As Integer
Dim number_of_players As Integer
Dim x As Integer

Sheets("Game_data1").Cells(18, 2).Value = 1 'active combatant is first one in side



If (Sheets("Game_data1").Cells(157, 2).Value >= Sheets("Game_data1").Cells(156, 2).Value) Then

            do_it = make_shadow_list_of_combatants
'If (Sheets("Game_data1").Cells(37, 2).Value >= Sheets("Game_data1").Cells(29, 2).Value) Then
            
            
            Sheets("Game_data1").Cells(157, 2).Value = 1
            
            If (Sheets("Game_data1").Cells(38, 2).Value = 1) Then
            
                    Sheets("Game_data1").Cells(38, 2).Value = 0
            Else
                    Sheets("Game_data1").Cells(38, 2).Value = 1
                    
            End If
           
            
    
Else
    
    Sheets("Game_data1").Cells(157, 2).Value = 1 + Sheets("Game_data1").Cells(157, 2).Value
    
End If


For x = Sheets("Game_data1").Cells(157, 2).Value To Sheets("Game_data1").Cells(156, 2).Value
            
        If find_is_side_active(Sheets("Nupud").Cells(x, 44).Value) > 0 Then
                Sheets("Game_data1").Cells(37, 2).Value = find_is_side_active(Sheets("Nupud").Cells(x, 44).Value)
                Exit For
        End If
Next


End Function
Function find_is_side_active(what_side As Integer) As Integer
Dim x As Integer

find_is_side_active = 0

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        If Sheets("Fight").Cells(x, 6).Value = what_side Then
                find_is_side_active = x
        End If
Next

End Function

Function combat_global()

Dim active_combat_side As Integer

active_combat_side = Sheets("Game_data1").Cells(37, 2).Value

do_it = execute_combat_for_invidual(Sheets("Game_data1").Cells(18, 2).Value, Sheets("Fight").Cells(active_combat_side, 6).Value)

End Function
Function execute_combat_for_invidual(who As Integer, what_side As Integer)
Dim z As Integer
Dim die_roll As Integer
Dim target_side As Integer
Dim target_mob As Integer
Dim what_to_do As Integer
what_to_do = 0

If Sheets("Side" & what_side).Cells(who, 55).Value > 0 Or Sheets("Side" & what_side).Cells(who, 57).Value > 0 Then
        what_to_do = 1 'stunned or frozen
Else

        If Sheets("Side" & what_side).Cells(who, 30).Value = 20 Then
                'is doing nothing, prob building
                what_to_do = 1
        End If
        
        If Sheets("Side" & what_side).Cells(who, 30).Value = 0 Then 'is trying to flee
                
               what_to_do = 1
        End If
        
        If Sheets("Side" & what_side).Cells(who, 30).Value = 1 Then 'is hitting enemy
        
                what_to_do = 2
        
        End If
        
        If Sheets("Side" & what_side).Cells(who, 30).Value = 2 Then 'is shooting enemy
        
                what_to_do = 2
        
        End If
        
        If Sheets("Side" & what_side).Cells(who, 30).Value >= 10 And Sheets("Side" & what_side).Cells(who, 30).Value < 20 Then 'casting a spell
        
                what_to_do = 3
        End If

End If

If what_to_do = 1 Then
        do_it = switch_combatant(what_side)
Else
        If what_to_do = 2 Then
                do_it = hitting_enemy(who, what_side)
        Else
                If what_to_do = 3 Then
                        do_it = casting_spell_in_combat(who, what_side)
                End If
        End If
End If


End Function
Function casting_spell_in_combat(who As Integer, what_side As Integer)
Dim single_target As Integer
single_target = 1


If Sheets("Side" & what_side).Cells(who, 30).Value = 12 Then
        single_target = 0
End If

If single_target = 1 Then
        do_it = cast_single_target_spell_in_combat(who, what_side)
Else
        do_it = cast_group_spell_in_combat(who, what_side)
End If

End Function
Function cast_group_spell_in_combat(who As Integer, what_side As Integer)

Dim life_loss As Integer
Dim x As Integer
Dim target_side As Integer
Dim counter As Integer
Dim target_legal As Integer
Dim spell_nr As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

counter = 0
target_legal = 0
target_side = Sheets("Side" & what_side).Cells(who, 31).Value - 100

target_legal = is_Side_in_Combat(target_side)

If target_legal = 1 Then

        For x = 1 To Sheets("Game_data1").Cells(55 + target_side, 2).Value
                Sheets("Nupud").Cells(x, 27).Value = Sheets("Side" & target_side).Cells(x, 35).Value
                counter = counter + 1
        Next
        
        For x = 1 To counter
                If x = counter Then
                        do_it = cast_single_target_spell_in_combat(who, what_side, 0, Sheets("Nupud").Cells(x, 27).Value)
                Else
                        do_it = cast_single_target_spell_in_combat(who, what_side, 1, Sheets("Nupud").Cells(x, 27).Value)
                End If
        Next

Else
        do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(who, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
        do_it = text_Output(Sheets("Lan" & Language).Cells(635, 1).Value, 1)
        do_it = pick_target_for_invidual(who, what_side, Sheets("Fight").Cells(1, what_side).Value, 1)
        do_it = hitting_enemy(who, what_side)

End If

End Function
Function is_Side_in_Combat(target_side As Integer) As Integer
Dim x As Integer

is_Side_in_Combat = 0

        For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
                If Sheets("Fight").Cells(x, 6).Value = target_side Then
                        is_Side_in_Combat = 1
                End If
        Next
        
End Function

Function cast_single_target_spell_in_combat(who As Integer, what_side As Integer, Optional mass_spell_Underway As Integer = 0, Optional Mob_id As Integer = 0)
Dim life_loss As Integer
Dim target_side As Integer
Dim target_mob As Integer
Dim power As Integer
Dim enemy_Power As Integer
Dim base_Damage As Integer
Dim spell_nr As Integer
Dim spell_element As Integer
Dim bonus_Damage As Integer
Dim spell_Name As String
Dim spell_Knowledge As Integer
Dim mob_spell_slot As Integer
Dim spell_is_Damage_spell As Integer
Dim z As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

life_loss = 0
spell_is_Damage_spell = 0

If Mob_id <> 0 Then
        is_there = is_ID_Target_in_combat(Mob_id)
Else
        is_there = is_ID_Target_in_combat(Sheets("Side" & what_side).Cells(who, 31).Value)
End If

If is_there = 1 Then

        target_side = Sheets("Game_data1").Cells(61, 2).Value
        target_mob = Sheets("Game_data1").Cells(62, 2).Value
        power = Sheets("Side" & what_side).Cells(who, 13).Value
        enemy_Power = Sheets("Side" & target_side).Cells(target_mob, 13).Value
        
        spell_nr = Sheets("Side" & what_side).Cells(who, 36).Value
        spell_Name = Sheets("Spells").Cells(spell_nr, 1).Value
        base_Damage = Sheets("Spells").Cells(spell_nr, 11).Value
        spell_element = Sheets("Spells").Cells(spell_nr, 7).Value
        
        
        If Sheets("Side" & what_side).Cells(who, 35).Value < 1005 Then
                spell_Knowledge = Sheets("Spells").Cells(spell_nr, 2 + what_side).Value + Sheets("Side" & what_side).Cells(who, 68).Value
        Else
                For z = 1 To Sheets("Side" & what_side).Cells(who, 40).Value
                        
                        mob_spell_slot = find_spell_by_name(Sheets("Side" & what_side).Cells(who, 40 + z).Value)
                        
                        If mob_spell_slot = spell_nr Then
                                spell_Knowledge = Sheets("Side" & what_side).Cells(who, 44 + z).Value + Sheets("Side" & what_side).Cells(who, 68).Value
                        End If
                Next
                
        End If
        
        If base_Damage > 0 And Sheets("Spells").Cells(spell_nr, 22).Value = 1 Then
                spell_is_Damage_spell = 1
        End If
        
        If spell_is_Damage_spell = 1 Then
        
                bonus_Damage = Sheets("Side" & what_side).Cells(who, 13).Value / 2
                        
                life_loss = Int((spell_Knowledge * base_Damage + Int(Rnd * bonus_Damage)) * power / enemy_Power - Int(Rnd * enemy_Power))
                
                'criticalid ja resitanced
                
                'fire
                If spell_element = 4 And Sheets("Side" & target_side).Cells(target_mob, 59).Value > 0 Then
                        life_loss = 0
                End If
                
                'lightning
                If spell_element = 6 And Sheets("Side" & target_side).Cells(target_mob, 61).Value > 0 Then
                        life_loss = 0
                End If
                
                'cold
                If spell_element = 7 And Sheets("Side" & target_side).Cells(target_mob, 62).Value > 0 Then
                        life_loss = 0
                End If
                
                If Language = 1 Then
                            do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value & Chr(39) & "s", 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                End If
                
                If Language = 2 Then
                    do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(who, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
                End If
                        
                do_it = text_Output(" " & Chr(34) & spell_Name & Chr(34) & Sheets("Lan" & Language).Cells(640, 1).Value & spell_Knowledge & ") ", 0)
                        
                
                If life_loss > 0 Then
                        
                        do_it = text_Output(what_damage_type(spell_element, 3), 0)
                        do_it = text_Output(" ", 0)
                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 3), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                        
                        If Sheets("Side" & target_side).Cells(target_mob, 37).Value <> 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(636, 1).Value, 0)
                        Else
                                do_it = text_Output(Sheets("Lan" & Language).Cells(641, 1).Value, 0)
                        End If
                        
                        do_it = text_Output(" " & life_loss, 0, Sheets("Game_data1").Cells(21, 2).Value) 'damage värv
                        
                        If Sheets("Side" & target_side).Cells(target_mob, 37).Value <> 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(637, 1).Value, 1)
                        Else
                                do_it = text_Output(Sheets("Lan" & Language).Cells(642, 1).Value, 1)
                        End If
                        
                        
                        Sheets("Side" & target_side).Cells(target_mob, 2).Value = Sheets("Side" & target_side).Cells(target_mob, 2).Value - life_loss
                        
                        'for vampiric
                        If Sheets("Side" & target_side).Cells(target_mob, 2).Value < 0 Then
                                lifeloss = lifeloss + Sheets("Side" & target_side).Cells(target_mob, 2).Value
                        End If
                        
                        'vampiric
                        If Sheets("Spells").Cells(spell_nr, 35).Value > 0 And Sheets("Side" & target_side).Cells(target_mob, 37).Value <> 1 Then 'vampriric
                                Sheets("Side" & what_side).Cells(who, 2).Value = Sheets("Side" & what_side).Cells(who, 2).Value + Int(((Sheets("Spells").Cells(spell_nr, 35).Value + 25 * spell_Knowledge) / 100) * life_loss)
                                
                                If Sheets("Side" & what_side).Cells(who, 2).Value > Sheets("Side" & what_side).Cells(who, 3).Value Then
                                        Sheets("Side" & what_side).Cells(who, 2).Value = Sheets("Side" & what_side).Cells(who, 3).Value
                                End If
                        End If
                Else
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(638, 1).Value, 0)
                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 3), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(639, 1).Value, 1)
                        
                End If
                
                
                
        Else
                do_it = spell_effect(spell_nr, what_side, who, target_side, target_mob)
        End If
        
        do_it = mobs_display()
        do_it = display_status(1)
        
        'lahutame mana
        If mass_spell_Underway = 0 Then
                Sheets("Side" & what_side).Cells(who, 12 + Sheets("Spells").Cells(spell_nr, 7).Value).Value = Sheets("Side" & what_side).Cells(who, 12 + Sheets("Spells").Cells(spell_nr, 7).Value).Value - Sheets("Spells").Cells(spell_nr, 9).Value
        End If
        
        'TO DO duubel strike ei tohiks tulla nüüd
        Sheets("Game_data1").Cells(17, 2).Value = Sheets("Side" & what_side).Cells(who, 4).Value
        
        'ja kontrollime surma
        do_it = checking_death_in_combat(who, what_side, target_side, target_mob, mass_spell_Underway)

        Else
        do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value, 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
        do_it = text_Output(Sheets("Lan" & Language).Cells(635, 1).Value, 1)
        do_it = pick_target_for_invidual(who, what_side, Sheets("Fight").Cells(1, what_side).Value, 1)
        do_it = hitting_enemy(who, what_side)
End If

End Function
Function one_hit_round(who As Integer, what_side As Integer, target_side As Integer, target_mob As Integer, Optional display_Option As Integer = 0, Optional not_its_first_Round As Integer = 0)
Dim life_loss As Integer
Dim d1 As Integer
Dim die_roll As Integer
Dim absorbed_Damage As Integer
Dim pierce_Critical As Integer
Dim elemental_Damage As Integer
Dim slash_Critical As Integer
Dim crush_Critical As Integer
Dim elemental_damage_color As Integer
Dim fire_Critical As Integer
Dim cold_Critical As Integer
Dim poison_Critical As Integer
Dim lightning_Critical As Integer
Dim elemental_damage_end_dot_needed As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

die_roll = 0
life_loss = 0
pierce_Critical = 0
fire_Critical = 0

For d1 = 1 To Sheets("Side" & what_side).Cells(who, 5).Value 'how may rolls (D1)
        
        If Sheets("Side" & what_side).Cells(who, 6).Value > 0 Then 'damage roll (D2)
        
               
                die_roll = Int(Rnd * Sheets("Side" & what_side).Cells(who, 6).Value + 1) 'D2
                
                life_loss = life_loss + die_roll
        
        End If

Next

If not_its_first_Round = 1 Then 'more than 1 attacks per round
        display_Option = 1
        do_it = text_Output(Sheets("Lan" & Language).Cells(643, 1).Value, 0)
End If


If display_Option <> 1 Then
        do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value, 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
        do_it = text_Output(" ", 0)
End If

do_it = text_Output(what_damage_type(Sheets("Side" & what_side).Cells(who, 7).Value, 3), 0)
do_it = text_Output(" ", 0)
do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 3), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)

'pierce critical
If Sheets("Side" & what_side).Cells(who, 7).Value = 1 Or Sheets("Side" & what_side).Cells(who, 7).Value = 11 Then
        
        Sheets("nupud").Cells(1, 24).Value = Sheets("Side" & what_side).Cells(who, 12).Value
        Sheets("nupud").Cells(2, 24).Value = Sheets("Side" & target_side).Cells(target_mob, 12).Value + 5
        
        pierce_Critical = rolling_odds(2, 24)
            
End If

'slash critical
If Sheets("Side" & what_side).Cells(who, 7).Value = 2 Then
        
        Sheets("nupud").Cells(1, 24).Value = Int(Sheets("Side" & what_side).Cells(who, 11).Value + Sheets("Side" & what_side).Cells(who, 12).Value / 2)
        Sheets("nupud").Cells(2, 24).Value = Sheets("Side" & target_side).Cells(target_mob, 12).Value + 3
        
        slash_Critical = rolling_odds(2, 24)
            
End If

'crush critical
If Sheets("Side" & what_side).Cells(who, 7).Value = 3 Then
        '2x str vs vastase str kuubis + 2
        Sheets("nupud").Cells(1, 24).Value = Sheets("Side" & what_side).Cells(who, 11).Value * 2
        Sheets("nupud").Cells(2, 24).Value = Sheets("Side" & target_side).Cells(target_mob, 12).Value * Sheets("Side" & target_side).Cells(target_mob, 12).Value * Sheets("Side" & target_side).Cells(target_mob, 12).Value + 2
        
        crush_Critical = rolling_odds(2, 24)
            
End If


'Sheets("Game_data1").Cells(105 + what_side, 2).Value
If (Sheets("Side" & target_side).Cells(target_mob, 14).Value = 0) Then 'tsekime armorit
        
        
        
        If Sheets("Side" & target_side).Cells(target_mob, 37).Value <> 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(636, 1).Value, 0)
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(641, 1).Value, 0)
        End If
                        
        do_it = text_Output(" " & life_loss, 0, 45) 'damage värv
        
        If Sheets("Side" & target_side).Cells(target_mob, 37).Value <> 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(637, 1).Value, 1)
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(642, 1).Value, 1)
        End If

Else
        'buildingud pierce criticalile immuunsed
        If Sheets("Side" & target_side).Cells(target_mob, 37).Value = 1 Then
                pierce_Critical = 0
        End If
        
        If pierce_Critical = 1 Then
                
                do_it = text_Output(text_Output(Sheets("Lan" & Language).Cells(644, 1).Value, 0), 0)
                do_it = text_Output(" " & life_loss, 0, 45) 'damage värv
                do_it = text_Output(Sheets("Lan" & Language).Cells(637, 1).Value, 1)
        
        Else
        
        
                If life_loss - Sheets("Side" & target_side).Cells(target_mob, 14).Value > 0 Then
                        absorbed_Damage = Sheets("Side" & target_side).Cells(target_mob, 14).Value
                Else
                        absorbed_Damage = life_loss
                End If
                        
                life_loss = life_loss - Sheets("Side" & target_side).Cells(target_mob, 14).Value '
                
                If life_loss < 0 Then
                        life_loss = 0
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(636, 1).Value, 0)
                do_it = text_Output(" " & life_loss, 0, 45) 'damage värv
                
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(645, 1).Value, 0)
                do_it = text_Output(absorbed_Damage & Sheets("Lan" & Language).Cells(646, 1).Value, 1)
        
        End If
End If

If slash_Critical = 1 And life_loss > 3 And Sheets("Side" & target_side).Cells(target_mob, 63).Value = 0 Then
        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
        do_it = text_Output(Sheets("Lan" & Language).Cells(647, 1).Value, 1)
        'bleeding
        Sheets("Side" & target_side).Cells(target_mob, 54).Value = Sheets("Side" & target_side).Cells(target_mob, 54).Value + Int(life_loss / 2)
End If

If crush_Critical = 1 And life_loss > 5 And Sheets("Side" & target_side).Cells(target_mob, 64).Value = 0 Then
        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
        do_it = text_Output(Sheets("Lan" & Language).Cells(648, 1).Value, 1)
        Sheets("Side" & target_side).Cells(target_mob, 55).Value = 2
End If
        
'elemental damage
If life_loss > 0 Then
        
        For x = 1 To 4
        
                If Sheets("Side" & what_side).Cells(who, 49 + x).Value > 0 Then
                        
                        If x = 1 Or x = 3 Then 'fire or lightning (resists with int+dex/2)
                                elemental_Damage = Sheets("Side" & what_side).Cells(who, 49 + x).Value - Int(Rnd * Sheets("Side" & target_side).Cells(target_mob, 13).Value) - Int(Rnd * Sheets("Side" & target_side).Cells(target_mob, 12).Value / 2)
                        End If
                        
                        If x = 4 Then 'cold (resists with str+dex/2)
                                elemental_Damage = Sheets("Side" & what_side).Cells(who, 49 + x).Value - Int(Rnd * Sheets("Side" & target_side).Cells(target_mob, 11).Value) - Int(Rnd * Sheets("Side" & target_side).Cells(target_mob, 12).Value / 2)
                        End If
                        If x = 2 Then 'poison (resists with str*2)
                                elemental_Damage = Sheets("Side" & what_side).Cells(who, 49 + x).Value - Int(Rnd * (Sheets("Side" & target_side).Cells(target_mob, 11).Value * 2))
                        End If
                        
                        If Sheets("Side" & target_side).Cells(target_mob, 58 + x).Value > 0 Then
                                elemental_Damage = 0
                        End If
                                
                        If elemental_Damage > 0 Then
                                Sheets("nupud").Cells(2, 24).Value = Sheets("Side" & target_side).Cells(target_mob, 12).Value + 3
                                do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 3), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                If x = 1 Then 'fire
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(649, 1).Value, 0)
                                        elemental_damage_color = 3
                                        
                                        'fire crit 2 vs 3+str
                                        Sheets("nupud").Cells(1, 24).Value = 2
                                        Sheets("nupud").Cells(2, 24).Value = Sheets("Side" & target_side).Cells(target_mob, 11).Value + 3
                        
                                        fire_Critical = rolling_odds(2, 24)
                                        
                                        If elemental_Damage > 4 And fire_Critical = 1 Then
                                                fire_Critical = 1
                                        Else
                                                fire_Critical = 0
                                        End If
                                End If
                                
                                If x = 3 Then 'lighting
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(650, 1).Value, 0)
                                        elemental_damage_color = 33
                                End If
                                
                                If x = 4 Then 'cold
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(651, 1).Value, 0)
                                        elemental_damage_color = 17
                                        
                                        'cold crit 2 vs 3+str
                                        Sheets("nupud").Cells(1, 24).Value = 2
                                        Sheets("nupud").Cells(2, 24).Value = Sheets("Side" & target_side).Cells(target_mob, 11).Value + 3
                        
                                        cold_Critical = rolling_odds(2, 24)
                                        
                                        If elemental_Damage > 4 And cold_Critical = 1 Then
                                                cold_Critical = 1
                                        Else
                                                cold_Critical = 0
                                        End If
                                        
                                End If
                                
                                If x = 2 Then 'poison
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(652, 1).Value, 0)
                                        elemental_damage_color = 10
                                        
                                        If elemental_Damage > 2 Then
                                                Sheets("Side" & target_side).Cells(target_mob, 56).Value = Sheets("Side" & target_side).Cells(target_mob, 56).Value + Int(Rnd * elemental_Damage)
                                        End If
                                        
                                End If
                                
                                do_it = text_Output(elemental_Damage & " ", 0, elemental_damage_color)
                                
                                If Sheets("Side" & target_side).Cells(target_mob, 37).Value <> 1 Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(653, 1).Value, 0)
                                Else
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(662, 1).Value, 0)
                                End If
                                
                                If fire_Critical = 1 Then
                                
                                        If Sheets("Side" & target_side).Cells(target_mob, 58).Value > 0 Then
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(654, 1).Value, 0)
                                        Else
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(655, 1).Value, 0)
                                        End If
                                        Sheets("Side" & target_side).Cells(target_mob, 58).Value = Sheets("Side" & target_side).Cells(target_mob, 58).Value + Int(2 + Rnd * elemental_Damage)
                                        
                                End If
                                
                                If cold_Critical = 1 Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(656, 1).Value, 0)
                                        Sheets("Side" & target_side).Cells(target_mob, 57).Value = 2
                                End If
                                
                                
                                do_it = text_Output("!", 1)
                                
                        Else
                                elemental_Damage = 0
                                do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                
                                If x = 1 Then 'fire
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(658, 1).Value, 1)
                                End If
                                If x = 3 Then 'electricity
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(659, 1).Value, 1)
                                End If
                                
                                If x = 4 Then 'cold
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(660, 1).Value, 1)
                                End If
                                
                                If x = 2 Then 'poison
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(661, 1).Value, 1)
                                End If
                                
                        End If
                
        
        
                        life_loss = life_loss + elemental_Damage
                
                
        
                End If
        
        Next

End If
'ja võtame elu vähemaks
Sheets("Side" & target_side).Cells(target_mob, 2).Value = Sheets("Side" & target_side).Cells(target_mob, 2).Value - life_loss

do_it = mobs_display()
do_it = display_status(1)

'ja kontrollime surma
do_it = checking_death_in_combat(who, what_side, target_side, target_mob)
End Function


Function hitting_enemy(who As Integer, what_side As Integer, Optional not_its_first_Round As Integer = 0)
Dim z As Integer
Dim target_side As Integer
Dim target_mob As Integer
Dim is_there As Integer
Dim caught_Fleeing As Integer

caught_Fleeing = 0

is_there = is_ID_Target_in_combat(Sheets("Side" & what_side).Cells(who, 31).Value)

        
        If is_there = 1 Then
                If Sheets("Game_data1").Cells(69, 2).Value = 1 And Sheets("Side" & what_side).Cells(who, 31).Value = Sheets("Game_data1").Cells(70, 2).Value Then
                        caught_Fleeing = 1
                End If
        
        Else
                'ajutine?, võtab vaenlase grupi nr üks uueks targetiks
                do_it = pick_target_for_invidual(who, what_side, Sheets("Fight").Cells(1, what_side).Value)
                is_there = is_ID_Target_in_combat(Sheets("Side" & what_side).Cells(who, 31).Value)

        End If
        
        
        target_side = Sheets("Game_data1").Cells(61, 2).Value
        target_mob = Sheets("Game_data1").Cells(62, 2).Value
        
        'kui vastane üritab põgeneda ja targetija on meleetaja (peab olema ka freezematta ja stunnimatta)
        If Sheets("Side" & target_side).Cells(target_mob, 30).Value = 0 And Sheets("Side" & target_side).Cells(target_mob, 55).Value = 0 And Sheets("Side" & target_side).Cells(target_mob, 57).Value = 0 And Sheets("Side" & what_side).Cells(who, 30).Value = 1 Then
                'vastane üritab põgeneda, dexi valem
                do_it = hit_fleeing(who, what_side, target_side, target_mob, caught_Fleeing)
                
        Else
        
        'normal hit
                
                do_it = one_hit_round(who, what_side, target_side, target_mob, 0, not_its_first_Round)
                
        End If

              
        
End Function
Function hit_fleeing(who As Integer, what_side As Integer, target_side As Integer, target_mob As Integer, Optional caught_Fleeing As Integer = 0)
Dim fleeja_Bonus As Integer
Dim chasija_Bonus As Integer
Dim kas_flees As Integer
Dim flee_vahe As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

fleeja_Bonus = 2 'base
chasija_Bonus = 1

If Sheets("Side" & target_side).Cells(target_mob, 12).Value <> Sheets("Side" & what_side).Cells(who, 12).Value Then

        flee_vahe = Sheets("Side" & target_side).Cells(target_mob, 12).Value - Sheets("Side" & what_side).Cells(who, 12).Value
        
        If flee_vahe > 0 Then
                fleeja_Bonus = fleeja_Bonus + (1 + flee_vahe) * (1 + flee_vahe)
        Else
                flee_vahe = Abs(flee_vahe)
                chasija_Bonus = chasija_Bonus + (1 + flee_vahe) * (1 + flee_vahe)
        End If

End If

If Sheets("Game_data1").Cells(15, 2).Value <> 0 Then
        do_it = text_Output("Flee odds are (Chaser " & chasija_Bonus & ")   (Runner " & fleeja_Bonus & ")", 1)
End If


kas_flees = Int(Rnd * (fleeja_Bonus + chasija_Bonus) + 1)



If caught_Fleeing = 0 Then

        do_it = text_Output(Sheets("Side" & what_side).Cells(who, 1).Value, 0, Sheets("Game_data1").Cells(105 + what_side, 2).Value)
        do_it = text_Output(Sheets("Lan" & Language).Cells(663, 1).Value, 0)
        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 3), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)

        If kas_flees > chasija_Bonus Then
                'flees
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(664, 1).Value, 0)
                do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 3), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                do_it = text_Output(Sheets("Lan" & Language).Cells(665, 1).Value, 1)
               
                
                do_it = switch_combatant(what_side)
        
        Else
                'sai pihta
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(666, 1).Value, 0)
                
                Sheets("Game_data1").Cells(69, 2).Value = 1 'successfully caught fleeing target
                Sheets("Game_data1").Cells(70, 2).Value = Sheets("Side" & target_side).Cells(target_mob, 35).Value
                
                'siin kirjutame et ei suutnud ära fleeda- järelikult jääb combatisse
                Sheets("Side" & target_side).Cells(target_mob, 31).Value = 1
                do_it = one_hit_round(who, what_side, target_side, target_mob, 1)
        End If
Else
      
        do_it = one_hit_round(who, what_side, target_side, target_mob, 1, 1)
        
End If



End Function

Function switch_active_combatants_combat_round(who As Integer, what_side As Integer)

If Sheets("Game_data1").Cells(17, 2).Value >= Sheets("Side" & what_side).Cells(who, 4).Value Then
        
        'it was the last attack
        do_it = switch_combatant(what_side)
        
Else
        
        Sheets("Game_data1").Cells(17, 2).Value = Sheets("Game_data1").Cells(17, 2).Value + 1
        do_it = hitting_enemy(who, what_side, 1)
  
End If

End Function


Function checking_death_in_combat(who As Integer, what_side As Integer, target_side As Integer, target_mob As Integer, Optional Mass_spell_on As Integer = 0)
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

If Sheets("Side" & target_side).Cells(target_mob, 2).Value <= 0 Then
        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
        
        If Sheets("Side" & target_side).Cells(target_mob, 37).Value = 0 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(667, 1).Value, 1)
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(668, 1).Value, 1)
        End If
        
        If Sheets("Side" & target_side).Cells(target_mob, 35).Value <= 1004 Then
                'player char dies
                
                'combatis commande andmas 1 player vähem
                Sheets("game_data1").Cells(35, 2).Value = Sheets("game_data1").Cells(35, 2).Value - 1
                do_it = player_char_dies(target_side)
                
        End If
        
        do_it = death_from_combat(target_mob, target_side)
        
        If Mass_spell_on <> 1 Then
                do_it = check_battle_status_after_kill(who, what_side, target_side)
        End If
Else
        If Mass_spell_on <> 1 Then
                do_it = switch_active_combatants_combat_round(who, what_side)
        End If
End If



End Function
Function player_char_dies(target_side As Integer)
Dim Old_location As Integer

        Old_location = Sheets("game_data1").Cells(5 + target_side, 2).Value
        
        Sheets("game_data1").Cells(112 + target_side, 2).Value = 1
        do_it = Joonista_asukoht(0, Old_location, target_side)
        do_it = display_status(0)
        do_it = display_status(1)
        do_it = mobs_display()

End Function


Function check_battle_status_global()
Dim x As Integer
Dim what_side As Integer
Dim battle_status As Integer
Dim y As Integer
Dim z As Integer
Dim break_needed As Integer

For z = 1 To Sheets("Game_data1").Cells(29, 2).Value

        break_needed = 0

        For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        
                what_side = Sheets("Fight").Cells(x, 6).Value
                
                
                If Sheets("Game_data1").Cells(55 + what_side, 2).Value = 0 Then
                
                break_needed = 1
                        
                Sheets("Fight").Cells(30, what_side + 5).Value = 1
                        
                        'side removimine combatist ja tema vastaste enemy listidest
                        For y = 1 To Sheets("Game_data1").Cells(29, 2).Value
                        
                                If Sheets("Fight").Cells(y, 6).Value = what_side Then
                                        do_it = remove_fighting_side_from_list(y)
                                End If
                        
                        Next
                        
                        do_it = remove_target_side_from_enemy_lists(what_side)
                        
                End If
                 
                If break_needed = 1 Then
                        
                        Exit For
                
                End If
                
        Next
Next

battle_status = check_if_battle_continues()

If battle_status = 0 Then
        
                    Sheets("Game_data1").Cells(87, 2).Value = 0

End If


End Function


Function check_battle_status_after_kill(who As Integer, what_side As Integer, target_side As Integer)
Dim x As Integer
Dim battle_status As Integer
        'kui järgijäänud aktiivsete võitlejate arv on null
        If Sheets("Game_data1").Cells(55 + target_side, 2).Value = 0 Then
                
                Sheets("Fight").Cells(30, target_side + 5).Value = 1
                
                For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
                
                        If Sheets("Fight").Cells(x, 6).Value = target_side Then
                                do_it = remove_fighting_side_from_list(x)
                                Exit For
                        End If
                
                Next
                
                
                do_it = remove_target_side_from_enemy_lists(target_side)
                battle_status = check_if_battle_continues()
                
                If battle_status = 0 Then
                        'combat round juures
                        Sheets("Game_data1").Cells(84, 2).Value = 1 + Sheets("Game_data1").Cells(84, 2).Value
                        'TO DO, TODO POOLELI- siin on kui liitlased tapavad defenderi, siis peaks functioon optionina minema et 2+ võitjat
                        If Sheets("Game_data1").Cells(29, 2).Value > 1 Then
                                do_it = exit_combat_with_side_victory(what_side, 1)
                        Else
                                do_it = exit_combat_with_side_victory(what_side)
                        End If
                        
                        
                Else
                        do_it = switch_active_combatants_combat_round(who, what_side)
                        
                End If
                
                
        Else
        'kui on veel saidis võitlejaid...
                'siis võitlus jätkub sama combatanti järgmise roundiga
                do_it = switch_active_combatants_combat_round(who, what_side)
        End If

End Function
Function exit_combat_with_side_victory(what_side As Integer, Optional allied_victory As Integer = 0)
Dim x As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

If allied_victory = 1 Then
        'kontrollime kas aktiivne player on võitjate nimekirjas
        'ja kui on, määrame ta võitjaks
        For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
               If Sheets("Fight").Cells(x, 6).Value = Sheets("Game_data1").Cells(10, 2).Value Then
                    what_side = Sheets("Game_data1").Cells(10, 2).Value
               End If
        Next
End If

Sheets("Game_data1").Cells(87, 2).Value = 0 'combat is off

do_it = check_player_hp_loss()

If what_side <> 5 Then
        If what_side = Sheets("Game_data1").Cells(10, 2).Value Then
            Sheets("Game_data1").Cells(16, 2).Value = 1
        Else
            Sheets("Game_data1").Cells(207, 2).Value = 0
        End If
        
        If Sheets("Game_data1").Cells(80, 2).Value = 1 Then
                
                If Sheets("Game_data1").Cells(51, 2).Value = 0 Then
                
                        do_it = give_active_land_ownership_to_player(what_side)
                        do_it = neutrals_reset()
                Else
                    
                    If Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 7).Value > 0 Then
                    
                            do_it = text_Output(Sheets("Lan" & Language).Cells(669, 1).Value, 1)
                    
                   
                            If Sheets("Game_data1").Cells(84, 2).Value < 4 Then
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(670, 1).Value, 1)
                            Else
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(671, 1).Value, 1)
                                    
                            End If
                    Else
                            do_it = text_Output(Sheets("Lan" & Language).Cells(672, 1).Value, 1)
                    
                    End If
                    
                End If
        End If
        
        
        
     
Else
        do_it = neutrals_reset()
        Sheets("Game_data1").Cells(80, 2).Value = 0 'land was engaged by active player
        Sheets("Game_data1").Cells(84, 2).Value = 4

End If
'combat ends
do_it = remove_combat_effects_globally()

do_it = Main_turn()


End Function
Function remove_combat_effects_globally()
Dim x As Integer
Dim y As Integer
Dim what_side As Integer

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value

        what_side = Sheets("Fight").Cells(x, 6).Value
                
                For y = 1 To Sheets("Game_data1").Cells(46 + what_side, 2).Value
                       
                        Sheets("Side" & what_side).Cells(y, 54).Value = 0
                        Sheets("Side" & what_side).Cells(y, 55).Value = 0
                        Sheets("Side" & what_side).Cells(y, 57).Value = 0
                        Sheets("Side" & what_side).Cells(y, 58).Value = 0
                        
                Next

Next

'enemy lists reset
For x = 1 To 5
        Sheets("Game_data1").Cells(29 + x, 2).Value = 0
Next



End Function




Function check_player_hp_loss()
Dim hp_lost As Integer
Dim what_player As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

For what_player = 1 To 4
        
        If Sheets("Game_data1").Cells(92 + what_player, 2).Value <> 0 And Sheets("Game_data1").Cells(112 + what_player, 2).Value = 0 Then
        
                hp_lost = Sheets("Game_data1").Cells(92 + what_player, 2).Value - Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value
                        
                do_it = text_Output(title_name(what_player) & " " & Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 1).Value, 0, Sheets("Game_data1").Cells(105 + what_player, 2).Value)
                do_it = text_Output(", ", 0)
                
                If hp_lost = 0 Then
                
                        do_it = text_Output(Sheets("Lan" & Language).Cells(673, 1).Value, 0)
                        do_it = text_Output("0 ", 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(674, 1).Value, 1)
                        
                Else
                        
                        If hp_lost > 0 Then
                        
                                do_it = text_Output(Sheets("Lan" & Language).Cells(673, 1).Value, 0)
                                do_it = text_Output(hp_lost & " ", 0, 3)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(674, 1).Value, 1)
                        Else
                                do_it = text_Output(Sheets("Lan" & Language).Cells(675, 1).Value, 0)
                                do_it = text_Output(Abs(hp_lost) & " ", 0, 4)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(674, 1).Value, 1)
                        
                        End If
                
                
                
                End If
                
                
                Sheets("Game_data1").Cells(92 + what_player, 2).Value = 0
        
        End If

Next

End Function


Function check_if_battle_continues() As Integer
Dim x As Integer

check_if_battle_continues = 0

If Sheets("Game_data1").Cells(29, 2).Value > 1 Then
        check_if_battle_continues = 1
End If

If check_if_battle_continues = 1 Then

        check_if_battle_continues = 0
        
        For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
                what_side = Sheets("Fight").Cells(x, 6).Value
                
                If Sheets("Game_data1").Cells(29 + what_side, 2).Value > 0 Then
                        check_if_battle_continues = 1
                        Exit For
                End If
        Next
End If

End Function

Function remove_target_side_from_enemy_lists(target_side As Integer)
Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        
        do_it = remove_target_side_from_others_list(Sheets("Fight").Cells(x, 6).Value, target_side)
        
Next

End Function
Function remove_target_side_from_others_list(what_side As Integer, target_side As Integer)
Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(29 + what_side, 2).Value

        If Sheets("Fight").Cells(x, what_side).Value = target_side Then
                do_it = remove_target_side_from_enemy_list(what_side, x)
        End If
        
Next

End Function
Function remove_target_side_from_enemy_list(what_side As Integer, mitmes As Integer)

Dim y As Integer
Dim z As Integer

        If (mitmes < Sheets("Game_data1").Cells(29 + what_side, 2).Value) Then
            
                y = Sheets("Game_data1").Cells(29 + what_side, 2).Value - mitmes
                              
                For z = 1 To y
                
                        Sheets("Fight").Cells(mitmes - 1 + z, what_side).Value = Sheets("Fight").Cells(mitmes + z, what_side).Value
                        
                Next
                      
        End If
        
        Sheets("Game_data1").Cells(29 + what_side, 2).Value = Sheets("Game_data1").Cells(29 + what_side, 2).Value - 1
        
End Function


Function remove_fighting_side_from_list(mitmes As Integer)

Dim y As Integer
Dim z As Integer

        'enemy list reset
        Sheets("Game_data1").Cells(29 + Sheets("Fight").Cells(mitmes, 6).Value, 2).Value = 0

        If (mitmes < Sheets("Game_data1").Cells(29, 2).Value) Then
            
                y = Sheets("Game_data1").Cells(29, 2).Value - mitmes
                              
                For z = 1 To y
                
                        Sheets("Fight").Cells(mitmes - 1 + z, 6).Value = Sheets("Fight").Cells(mitmes + z, 6).Value
                        
                Next
                      
        End If
       
        Sheets("Game_data1").Cells(29, 2).Value = Sheets("Game_data1").Cells(29, 2).Value - 1
        
End Function

Function is_ID_Target_in_combat(id_number As Integer) As Integer
Dim what_side As Integer
Dim z As Integer
Dim x As Integer

is_ID_Target_in_combat = 0

For z = 1 To Sheets("Game_data1").Cells(29, 2).Value

        what_side = Sheets("Fight").Cells(z, 6).Value
        
        For x = 1 To Sheets("Game_data1").Cells(55 + what_side, 2).Value
        
                If Sheets("Side" & what_side).Cells(x, 35).Value = id_number Then
                
                        Sheets("Game_data1").Cells(61, 2).Value = what_side
                        Sheets("Game_data1").Cells(62, 2).Value = x
                        is_ID_Target_in_combat = 1
                        
                End If
        Next

Next

End Function
Function switch_combatant(what_side As Integer)

Sheets("Game_data1").Cells(69, 2).Value = 0 'has not cought any fleeing targets
Sheets("Game_data1").Cells(17, 2).Value = 1 'number of attacks (1.st)

If (Sheets("Game_data1").Cells(18, 2).Value >= Sheets("Game_data1").Cells(55 + what_side, 2).Value) Then
    
        'kõik tehtud
        
        do_it = last_combatant(what_side)
                
    
Else
    
    Sheets("Game_data1").Cells(18, 2).Value = Sheets("Game_data1").Cells(18, 2).Value + 1
  do_it = execute_combat_for_invidual(Sheets("Game_data1").Cells(18, 2).Value, what_side)
  
End If
End Function
Function check_bleeding_etc_effects_globally()

Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim what_side As Integer
Dim life_loss As Integer
Dim counter As Integer

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        counter = 0
        what_side = Sheets("Fight").Cells(x, 6).Value
                
        For y = 1 To Sheets("Game_data1").Cells(55 + what_side, 2).Value
                Sheets("Nupud").Cells(y, 27).Value = Sheets("Side" & what_side).Cells(y, 35).Value
                               
                counter = counter + 1
                
        Next
        
        For y = 1 To counter
                do_it = check_bleeding_etc_effects_by_id(Sheets("Nupud").Cells(y, 27).Value)
        Next
Next


End Function
Function check_bleeding_etc_effects_by_id(Mob_id As Integer)
Dim is_there As Integer
Dim target_side As Integer
Dim target_mob As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

is_there = is_ID_Target_in_combat(Mob_id)

If is_there = 1 Then
        target_side = Sheets("Game_data1").Cells(61, 2).Value
        target_mob = Sheets("Game_data1").Cells(62, 2).Value
        
        'burning
        
        If Sheets("Side" & target_side).Cells(target_mob, 58).Value > 0 Then
                life_loss = Sheets("Side" & target_side).Cells(target_mob, 58).Value
                
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(676, 1).Value, 0)
                                        do_it = text_Output(life_loss & " ", 0, 3)
                                        
                                        If Sheets("Side" & target_side).Cells(target_mob, 37).Value <> 1 Then
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(677, 1).Value, 1)
                                        Else
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(679, 1).Value, 1)
                                        End If
                                        
                Sheets("Side" & target_side).Cells(target_mob, 58).Value = Sheets("Side" & target_side).Cells(target_mob, 58).Value - Int(Rnd * Sheets("Side" & target_side).Cells(target_mob, 11).Value / 2 + 1)
                If Sheets("Side" & target_side).Cells(target_mob, 58).Value < 0 Then
                        Sheets("Side" & target_side).Cells(target_mob, 58).Value = 0
                End If
        
                Sheets("Side" & target_side).Cells(target_mob, 2).Value = Sheets("Side" & target_side).Cells(target_mob, 2).Value - life_loss
                
        End If
        
        
        'bleeding
        If Sheets("Side" & target_side).Cells(target_mob, 54).Value > 0 Then
                life_loss = Sheets("Side" & target_side).Cells(target_mob, 54).Value
                                        do_it = text_Output(eesti_nimi(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 1), 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(678, 1).Value, 0)
                                        do_it = text_Output(life_loss & " " & Sheets("Lan" & Language).Cells(677, 1).Value, 1)
                Sheets("Side" & target_side).Cells(target_mob, 54).Value = Sheets("Side" & target_side).Cells(target_mob, 54).Value - Int(Rnd * Sheets("Side" & target_side).Cells(target_mob, 54).Value / 2 + 1)
                If Sheets("Side" & target_side).Cells(target_mob, 54).Value < 0 Then
                        Sheets("Side" & target_side).Cells(target_mob, 54).Value = 0
                End If
        
                Sheets("Side" & target_side).Cells(target_mob, 2).Value = Sheets("Side" & target_side).Cells(target_mob, 2).Value - life_loss
                
        End If
        
        'stun
        If Sheets("Side" & target_side).Cells(target_mob, 55).Value > 0 Then
                Sheets("Side" & target_side).Cells(target_mob, 55).Value = Sheets("Side" & target_side).Cells(target_mob, 55).Value - 1
        End If
        
        'frozen
        If Sheets("Side" & target_side).Cells(target_mob, 57).Value > 0 Then
                Sheets("Side" & target_side).Cells(target_mob, 57).Value = Sheets("Side" & target_side).Cells(target_mob, 57).Value - 1
        End If
        
        
        do_it = mobs_display()
        do_it = display_status(1)
        
        do_it = checking_death_in_combat(0, 0, target_side, target_mob, 1)
End If
End Function
Function check_flees_by_Id(Mob_id As Integer)

Dim is_there As Integer
Dim target_side As Integer
Dim target_mob As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

is_there = is_ID_Target_in_combat(Mob_id)

If is_there = 1 Then

        target_side = Sheets("Game_data1").Cells(61, 2).Value
        target_mob = Sheets("Game_data1").Cells(62, 2).Value
        
        If Sheets("Side" & target_side).Cells(target_mob, 30).Value = 0 Then
                        
                If Sheets("Side" & target_side).Cells(target_mob, 31).Value = 0 Then
                        
                        'if the ones who tries to flee is not frozen or stunned
                        If Sheets("Side" & target_side).Cells(target_mob, 55).Value <= 0 And Sheets("Side" & target_side).Cells(target_mob, 57).Value <= 0 Then
                                
                                do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(680, 1).Value, 1)
                                
                                'we remove all wounds also here
                                Sheets("Side" & target_side).Cells(target_mob, 54).Value = 0
                                
                                do_it = flee_from_combat(target_mob, target_side)
                                
                        Else
                                If Sheets("Side" & target_side).Cells(target_mob, 55).Value > 0 Then
                                
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(681, 1).Value, 1)
                                Else
                                        do_it = text_Output(Sheets("Side" & target_side).Cells(target_mob, 1).Value, 0, Sheets("Game_data1").Cells(105 + target_side, 2).Value)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(682, 1).Value, 1)
                                
                                End If
                        
                        End If
                        
                End If
                        
        End If
        
End If

End Function

Function check_flees()
Dim x As Integer
Dim y As Integer
Dim what_side As Integer

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value

        counter = 0
        
        what_side = Sheets("Fight").Cells(x, 6).Value
                
        For y = 1 To Sheets("Game_data1").Cells(55 + what_side, 2).Value
        
                Sheets("Nupud").Cells(y, 27).Value = Sheets("Side" & what_side).Cells(y, 35).Value
                               
                counter = counter + 1
                
        Next
        
        For y = 1 To counter
                do_it = check_flees_by_Id(Sheets("Nupud").Cells(y, 27).Value)
        Next
        
Next


End Function

Function map_edges_control(mapi_coordinaat As Integer, liituja As Integer) As Integer
Dim uusvalue As Integer


uusvalue = mapi_coordinaat + liituja


If uusvalue < 1 Or uusvalue > 34 Then
        map_edges_control = mapi_coordinaat
        Else
        map_edges_control = uusvalue
End If

End Function
Function check_neighbourland_assistance()
Dim aktiivne_Land As Integer
Dim kontrollitav_Land As Integer
Dim x As Integer
Dim a As Integer
Dim B As Integer

Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

aktiivne_Land = Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value

a = map_edges_control(aktiivne_Land, -1)
B = map_edges_control(aktiivne_Land, 1)

For x = 1 To 2
        If x = 1 Then
                kontrollitav_Land = a
        Else
                kontrollitav_Land = B
        End If
        'kas maa_ala tüüp on sama
        If Sheets("game_map").Cells(aktiivne_Land, 1).Value = Sheets("game_map").Cells(kontrollitav_Land, 1).Value Then
                'kas isand on sama
                If Sheets("game_map").Cells(aktiivne_Land, 2).Value = Sheets("game_map").Cells(kontrollitav_Land, 2).Value And Sheets("game_map").Cells(kontrollitav_Land, 2).Value <> 0 Then
                        If Sheets("game_map").Cells(kontrollitav_Land, 17).Value = 1 Then
                        
                                Sheets("game_map").Cells(kontrollitav_Land, 17).Value = 0
                                If Sheets("game_map").Cells(aktiivne_Land, 12).Value > 0 Then
                                        'kui on castle, siis vend berserki
                                        do_it = Add_new_mob(5, Sheets("game_map").Cells(kontrollitav_Land, 5).Value, 0, 0, 1)
                                Else
                                        do_it = Add_new_mob(5, Sheets("game_map").Cells(kontrollitav_Land, 5).Value)
                                End If
                                do_it = insert_into_combat(Sheets("Game_data1").Cells(51, 2).Value, 5)
                                do_it = text_Output(Sheets("mobs").Cells(Sheets("game_map").Cells(kontrollitav_Land, 5).Value, 1).Value & Sheets("Lan" & Language).Cells(683, 1).Value & eesti_nimi(Sheets("game_map").Cells(kontrollitav_Land, 4).Value, 1) & Sheets("Lan" & Language).Cells(684, 1).Value, 1)
                        End If
                        
                End If
                
        End If
        
Next

' 1 tüüp
' 2 kelle oma
' 17 on kaitsja võetav


End Function
Function last_combatant(what_side As Integer)

do_it = switch_combat_side()

If (Sheets("Game_data1").Cells(38, 2).Value = 0) Then
                        
        do_it = combat_global()

Else
        'we check for end combat turn actions- like flee and fractions joining
        do_it = check_flees()
        do_it = check_bleeding_etc_effects_globally()
        do_it = check_battle_status_global()
        
        If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                do_it = check_neighbourland_assistance()
        
        End If
        'we add combat round
        Sheets("Game_data1").Cells(84, 2).Value = 1 + Sheets("Game_data1").Cells(84, 2).Value
        
    
                
        If Sheets("Game_data1").Cells(87, 2).Value = 1 Then
                
                do_it = player_joins_ongoing_combat_check(1)
                
                
        Else
              
                do_it = exit_combat_with_side_victory(Sheets("Fight").Cells(1, 6).Value)

        End If
                
End If

End Function
Function player_joins_ongoing_combat_check(Player_slot_in_nupud As Integer)
Dim x As Integer
Dim what_player As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
 
what_player = Sheets("Nupud").Cells(Player_slot_in_nupud, 4).Value

already_in_fight = 0
ask_question = 0

Sheets("Game_data1").Cells(97, 2).Value = Player_slot_in_nupud

For x = 1 To Sheets("Game_data1").Cells(29, 2).Value

       If Sheets("Fight").Cells(x, 6).Value = what_player Then
            already_in_fight = 1
       End If
       
Next

If already_in_fight = 0 Then
        If Sheets("Fight").Cells(30, what_player).Value > 0 And Sheets("Fight").Cells(30, what_player + 5).Value = 0 Then
                ask_question = 1
        End If
End If

If ask_question = 1 Then
        
        
        MsgBox (Sheets("Game_data1").Cells(10 + what_player, 2).Value & Sheets("Lan" & Language).Cells(847, 1).Value)
        
        For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
                do_it = set_Detection(what_player, Sheets("Fight").Cells(x, 6).Value, 2)
        Next
        
        do_it = text_Output(Sheets("Game_data1").Cells(10 + what_player, 2).Value & Sheets("Lan" & Language).Cells(849, 1).Value, 1)
        
        do_it = targeting_side_submenu(what_player, 1)

        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(848, 1).Value, "do_not_join_" & what_player, 0, 1)
        
Else
        do_it = next_player_in_player_joins_ongoing_Combat()
End If

End Function
Function execute_Combat_with_move_away(who_is_moving_away As Integer)
Dim what_player As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = set_Detection(what_player, who_is_moving_away, 0)

'player has moved away
Sheets("Fight").Cells(30, who_is_moving_away + 5).Value = 1


MsgBox (Sheets("Game_data1").Cells(10 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value & ", your turn continues.")

do_it = text_Output("", 3)

do_it = recalculate_combat_order()
do_it = make_shadow_list_of_combatants
do_it = targeting_global()

End Function
Function execute_Combat_with_do_not_port()

Dim what_player As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value

MsgBox (Sheets("Game_data1").Cells(10 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value & ", your turn continues.")

do_it = text_Output("", 3)

do_it = recalculate_combat_order()
do_it = make_shadow_list_of_combatants
do_it = targeting_global()

End Function









Function execute_Combat_with_do_not_join(who_is_moving_away As Integer)

Sheets("Game_data1").Cells(263, 2).Value = 1

do_it = valiknuppude_Kustutamine()

'player has moved away
Sheets("Fight").Cells(30, who_is_moving_away + 5).Value = 1

do_it = next_player_in_player_joins_ongoing_Combat


End Function
Function another_player_joins_fight(what_side As Integer, target_side As Integer)
Dim x As Integer
do_it = valiknuppude_Kustutamine()

'uustulnukat nähakse
For x = 1 To Sheets("Game_data1").Cells(29, 2).Value
        do_it = set_Detection(Sheets("Fight").Cells(x, 6).Value, what_side, 2)
Next

do_it = add_combat(what_side, target_side)
do_it = recalculate_combat_order()
do_it = make_shadow_list_of_combatants
do_it = next_player_in_player_joins_ongoing_Combat()

End Function

Function next_player_in_player_joins_ongoing_Combat()

Dim what_player As Integer
what_player = Sheets("Game_data1").Cells(10, 2).Value

Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

If Sheets("Game_data1").Cells(97, 2).Value >= Sheets("Game_data1").Cells(2, 2).Value Then
            
        If Sheets("Game_data1").Cells(84, 2).Value < 4 Then
            
                If Sheets("Game_data1").Cells(263, 2).Value = 1 Then
                        do_it = text_Output("", 3)
                        MsgBox (Sheets("Game_data1").Cells(10 + what_player, 2).Value & Sheets("Lan" & Language).Cells(46, 1).Value)
                        Sheets("Game_data1").Cells(263, 2).Value = 0
                End If
        
                do_it = targeting_global()
        Else
                Sheets("Game_map").Cells(Sheets("Game_data1").Cells(5 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value, 17).Value = 1
                do_it = check_player_hp_loss()
                do_it = Main_turn()
        End If
                
Else
        do_it = player_joins_ongoing_combat_check(Sheets("Game_data1").Cells(97, 2).Value + 1)

End If

End Function

-------------------------------------------------------------------------------
VBA MACRO Module5.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module5'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Function level_up_mob(what_side As Integer, mob As Integer)
Dim into_what As Integer
Dim Language As Integer
Dim knowledge As Integer
Dim x As Integer
Dim spell_already_known As Integer
Dim z As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

'milleks teeme peti... mis slotti kasutame level_upis
into_what = find_level_up_by_name(Sheets("Side" & what_side).Cells(mob, 66).Value)


'extra attacks
Sheets("Side" & what_side).Cells(mob, 4).Value = Sheets("Side" & what_side).Cells(mob, 4).Value + Sheets("Levelup").Cells(into_what, 3).Value

'd1 d2
Sheets("Side" & what_side).Cells(mob, 5).Value = Sheets("Side" & what_side).Cells(mob, 5).Value + Sheets("Levelup").Cells(into_what, 4).Value
Sheets("Side" & what_side).Cells(mob, 6).Value = Sheets("Side" & what_side).Cells(mob, 6).Value + Sheets("Levelup").Cells(into_what, 5).Value

If Sheets("Levelup").Cells(into_what, 6).Value <> 0 Then
        Sheets("Side" & what_side).Cells(mob, 7).Value = Sheets("Levelup").Cells(into_what, 6).Value
End If

do_it = add_stat(Sheets("Levelup").Cells(into_what, 7).Value, 8, what_side, mob)
do_it = add_stat(Sheets("Levelup").Cells(into_what, 8).Value, 9, what_side, mob)
do_it = add_stat(Sheets("Levelup").Cells(into_what, 9).Value, 10, what_side, mob)

do_it = add_stat(Sheets("Levelup").Cells(into_what, 7).Value, 11, what_side, mob)
do_it = add_stat(Sheets("Levelup").Cells(into_what, 8).Value, 12, what_side, mob)
do_it = add_stat(Sheets("Levelup").Cells(into_what, 9).Value, 13, what_side, mob)

do_it = add_stat(Sheets("Levelup").Cells(into_what, 10).Value, 14, what_side, mob)

'relative str ei tehta moment midagi

'+mana regen
For x = 1 To 7
        do_it = add_stat(Sheets("Levelup").Cells(into_what, 11 + x).Value, 22 + x, what_side, mob)
Next

'+ elemental damages
For x = 1 To 4
        do_it = add_stat(Sheets("Levelup").Cells(into_what, 28 + x).Value, 49 + x, what_side, mob)
Next

'elemental resistances
For x = 1 To 6
        do_it = add_stat(Sheets("Levelup").Cells(into_what, 32 + x).Value, 58 + x, what_side, mob)
Next

'spells
For x = 1 To Sheets("Levelup").Cells(into_what, 20).Value
        spell_already_known = 0
        
        For z = 1 To 4
                If Sheets("Levelup").Cells(into_what, 20 + x).Value = Sheets("Side" & what_side).Cells(mob, 40 + z).Value Then
                        spell_already_known = 1
                        Sheets("Side" & what_side).Cells(mob, 44 + z).Value = Sheets("Side" & what_side).Cells(mob, 44 + z).Value + Sheets("Levelup").Cells(into_what, 24 + x).Value
                End If
        Next
            
        If spell_already_known = 0 Then
            
        'mahub aint neli spelli
                If Sheets("Side" & what_side).Cells(mob, 40).Value < 4 Then
                        Sheets("Side" & what_side).Cells(mob, 40).Value = Sheets("Side" & what_side).Cells(mob, 40).Value + 1
                        knowledge = Sheets("Side" & what_side).Cells(mob, 40).Value
                        Sheets("Side" & what_side).Cells(mob, 40 + knowledge).Value = Sheets("Levelup").Cells(into_what, 20 + x).Value
                        Sheets("Side" & what_side).Cells(mob, 44 + knowledge).Value = Sheets("Side" & what_side).Cells(mob, 44 + knowledge).Value + Sheets("Levelup").Cells(into_what, 24 + x).Value
                End If
    
        End If
        
Next



'hp
Sheets("Side" & what_side).Cells(mob, 2).Value = Sheets("Side" & what_side).Cells(mob, 2).Value + Sheets("Levelup").Cells(into_what, 2).Value
Sheets("Side" & what_side).Cells(mob, 3).Value = Sheets("Side" & what_side).Cells(mob, 3).Value + Sheets("Levelup").Cells(into_what, 2).Value

Sheets("Side" & what_side).Cells(mob, 66).Value = Sheets("Levelup").Cells(into_what, 47).Value

If Sheets("Side" & what_side).Cells(mob, 67).Value = 1 Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(156, 1).Value, 0)
End If

If Language = 1 Then
        If Sheets("Side" & what_side).Cells(mob, 67).Value = 1 Then
                do_it = text_Output(LCase(Sheets("Side" & what_side).Cells(mob, 1).Value), 0, 10)
        Else
                do_it = text_Output(Sheets("Side" & what_side).Cells(mob, 1).Value, 0, 10)
        End If
End If

If Language = 2 Then
        If Sheets("Side" & what_side).Cells(mob, 67).Value = 1 Then
                do_it = text_Output(LCase(eesti_nimi(Sheets("Side" & what_side).Cells(mob, 1).Value, 4)), 0, 10)
        Else
                do_it = text_Output(eesti_nimi(Sheets("Side" & what_side).Cells(mob, 1).Value, 4), 0, 10)
        End If
End If

'name
Sheets("Side" & what_side).Cells(mob, 1).Value = Sheets("Levelup").Cells(into_what, 1).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(155, 1).Value, 0)

do_it = text_Output(LCase(Sheets("Side" & what_side).Cells(mob, 1).Value), 0, 10)
do_it = text_Output(".", 1)

End Function
Function caravan_has_arrived(what_player As Integer)
Dim Language As Integer
Dim x As Integer
Dim y As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value


If Sheets("Game_data1").Cells(243 + what_player, 2).Value = 1 Then

        do_it = text_Output(Sheets("Lan" & Language).Cells(157, 1).Value, 1)

        do_it = gen_treasure_item(1, 80, 401)

End If

If Sheets("Game_data1").Cells(243 + what_player, 2).Value = 2 Then
        
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(159, 1).Value, 1)
        
        y = Int(Rnd * 3 + 1)
        
        If y = 1 Then
                For x = 1 To 4
                        do_it = gen_treasure_item(1, 80, 401)
                Next
        End If
        
        If y = 2 Then
                For x = 1 To 3
                        do_it = gen_treasure_item(1, 150, 600)
                Next
        End If
        
        If y = 3 Then
        
                For x = 1 To 2
                        do_it = gen_treasure_item(1, 200, 1000)
                Next
        
        End If
        
End If


Sheets("Game_data1").Cells(243 + what_player, 2).Value = 0

End Function
Function hire_caravan_menu()
Dim Language As Integer
Dim what_player As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

do_it = text_Output(Sheets("Lan" & Language).Cells(162, 1).Value, 0)
do_it = text_Output(Sheets("Game_data1").Cells(249, 2).Value, 0, 45)
do_it = text_Output(Sheets("Lan" & Language).Cells(51, 1).Value, 1)


do_it = text_Output(Sheets("Lan" & Language).Cells(163, 1).Value, 0)
do_it = text_Output(Sheets("Game_data1").Cells(248, 2).Value, 0, 45)
do_it = text_Output(Sheets("Lan" & Language).Cells(51, 1).Value, 1)

do_it = text_Output(Sheets("Lan" & Language).Cells(164, 1).Value, 1)

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_to_main", 0, 1)
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(160, 1).Value, "hire_caravan_1", 0, 1)
do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(161, 1).Value, "hire_caravan_2", 0, 1)


End Function
Function level_up_check(what_side As Integer, who As Integer)

If Sheets("Side" & what_side).Cells(who, 65).Value > 9 Then
                        
     do_it = level_up_mob(what_side, who)
     
     Sheets("Side" & what_side).Cells(who, 65).Value = Sheets("Side" & what_side).Cells(who, 65).Value - 9

End If

End Function

Function train_pet_menu(Optional true_train As Integer = 0)

Dim Language As Integer
Dim what_player As Integer
Dim who As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value



do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

If true_train = 1 Then

        do_it = text_Output(Sheets("Lan" & Language).Cells(148, 1).Value, 1)
        do_it = text_Output(Sheets("Lan" & Language).Cells(154, 1).Value, 1)
        who = check_for_pet(what_player)
        
        'siin treenimegi
        Sheets("Side" & what_player).Cells(who, 65).Value = Sheets("Side" & what_player).Cells(who, 65).Value + (4 - Sheets("Game_data1").Cells(84, 2).Value) * 3
        Sheets("Game_data1").Cells(84, 2).Value = 4
        
        do_it = level_up_check(what_player, who)
        
        do_it = Main_turn()
Else
        do_it = text_Output(Sheets("Lan" & Language).Cells(153, 1).Value, 1)

        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_to_main", 0, 1)
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_train_pet", 0, 1)
End If





End Function


Function add_pet(what_side As Integer, pet As Integer)

        do_it = Add_new_mob(what_side, pet, 0, 0, 0, 1, 1)

End Function
Function check_for_pet(what_side As Integer) As Integer
Dim x As Integer

check_for_pet = 0

For x = 1 To Sheets("Game_data1").Cells(46 + what_side, 2).Value
        
        If Sheets("Side" & what_side).Cells(x, 67).Value > 0 Then
                check_for_pet = x
        End If

Next

End Function
Function buy_caravan(mitmes As Integer, Optional true_buy As Integer = 0)
Dim Language As Integer
Dim what_player As Integer
Dim cost As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

Sheets("Game_data1").Cells(167, 2).Value = mitmes

do_it = text_Output("", 3)

do_it = valiknuppude_Kustutamine()

cost = 0

If mitmes = 1 Then
        cost = Sheets("Game_data1").Cells(248, 2).Value
End If

If mitmes = 2 Then
        cost = Sheets("Game_data1").Cells(249, 2).Value
End If

If true_buy = 1 Then

        If Sheets("Game_data1").Cells(24 + what_player, 2).Value < cost Then
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(70, 1).Value, 1)
                do_it = Main_turn
                
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(165, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(922, 1).Value, 1)
                
                Sheets("Game_data1").Cells(243 + what_player, 2).Value = mitmes
                Sheets("Game_data1").Cells(84, 2).Value = 4
                Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - cost
                do_it = Main_turn
        End If
        
Else
        do_it = text_Output(Sheets("Lan" & Language).Cells(166, 1).Value, 0)
        do_it = text_Output(cost & " ", 0, 45)
        do_it = text_Output(Sheets("Lan" & Language).Cells(74, 1).Value, 1)
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_to_main", 0, 1)
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_caravan_buy", 0, 1)

End If


End Function


Function buy_pet_menu(Optional true_buy As Integer = 0)
Dim Language As Integer
Dim what_player As Integer
Dim pet_nr As Integer
Dim pet_cost As Integer
Dim commaneeded As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()
'


what_player = Sheets("Game_data1").Cells(10, 2).Value

If Sheets("Game_data1").Cells(243, 2).Value = 0 Then
        'select pet for user
       Sheets("Game_data1").Cells(243, 2).Value = pick_a_pet_for_player(what_player)
End If

pet_nr = Sheets("Game_data1").Cells(243, 2).Value
pet_cost = Sheets("Mobs").Cells(pet_nr, 31).Value * 10

If true_buy = 1 Then
        
        If (Sheets("Game_data1").Cells(46 + what_player, 2).Value >= 20) Then
        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(145, 1).Value, 1)
                        do_it = Main_turn
        
        Else
                If Sheets("Game_data1").Cells(24 + what_player, 2).Value < pet_cost Then
                
                        do_it = text_Output(Sheets("Lan" & Language).Cells(70, 1).Value, 1)
                        do_it = Main_turn
                
                Else
                        do_it = add_pet(what_player, pet_nr)
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(147, 1).Value, 0)
                        
                       
                        do_it = text_Output(LCase(eesti_nimi(Sheets("Mobs").Cells(pet_nr, 1).Value, 1)), 0, 10)
                        
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(146, 1).Value, 1)
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(148, 1).Value, 1)
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(149, 1).Value, 0)
                        
                       
                        do_it = text_Output(LCase(eesti_nimi(Sheets("Mobs").Cells(pet_nr, 1).Value, 3)), 0, 10)
                        
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(150, 1).Value, 1)
                        
                        
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(151, 1).Value, 0)
                        do_it = text_Output(LCase(Sheets("Mobs").Cells(pet_nr, 1).Value), 0, 10)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(152, 1).Value, 1)
                        
                        'raha vähemaks
                        Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - pet_cost
                        
                        Sheets("Game_data1").Cells(84, 2).Value = 4
                        do_it = Main_turn
                
                End If
                
        End If
        
Else

        do_it = text_Output(Sheets("Lan" & Language).Cells(137, 1).Value, 0)
        do_it = text_Output(LCase(Sheets("Mobs").Cells(pet_nr, 1).Value), 0, 10)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(144, 1).Value, 1)
        
        
        If Sheets("Mobs").Cells(pet_nr, 52).Value = 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(138, 1).Value, 1)
        End If
        
        If Sheets("Mobs").Cells(pet_nr, 52).Value = 2 Or Sheets("Mobs").Cells(pet_nr, 52).Value = 6 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(143, 1).Value, 1)
        End If
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(139, 1).Value, 0)
        
        
        
        do_it = text_Output(pet_cost & " ", 0, 45)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(140, 1).Value, 1)
        do_it = text_Output(Sheets("Lan" & Language).Cells(141, 1).Value, 0)
        
        
        do_it = text_Output(LCase(eesti_nimi(Sheets("Mobs").Cells(pet_nr, 1).Value, 3)), 0, 10)
        
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(142, 1).Value, 1)
        
        
        
        
        'checking if pet offered is special or "common" one.
        commaneeded = 0
        
        If Sheets("Game_data1").Cells(233, 2).Value = 0 And Sheets("Game_data1").Cells(234, 2).Value = 0 And Sheets("Game_data1").Cells(235, 2).Value = 0 And Sheets("Game_data1").Cells(236, 2).Value = 0 Then
                do_it = do_it = text_Output(Sheets("Lan" & Language).Cells(548, 1).Value, 1)
        Else
                do_it = text_Output(Sheets("Lan" & Language).Cells(543, 1).Value, 0)
                
                If Sheets("Game_data1").Cells(233, 2).Value > 0 Then 'Arm
                        do_it = text_Output(" " & Sheets("Game_data1").Cells(233, 2).Value, 0, 3)
                        do_it = text_Output(" " & Sheets("Lan" & Language).Cells(547, 1).Value, 0)
                        commaneeded = 1
                End If
                
                If Sheets("Game_data1").Cells(234, 2).Value > 0 Then 'Str
                        If commaneeded = 1 Then
                            do_it = text_Output(",", 0)
                        End If
                        do_it = text_Output(" " & Sheets("Game_data1").Cells(234, 2).Value, 0, 3)
                        do_it = text_Output(" " & Sheets("Lan" & Language).Cells(544, 1).Value, 0)
                        commaneeded = 1
                End If
                If Sheets("Game_data1").Cells(235, 2).Value > 0 Then 'Dex
                        If commaneeded = 1 Then
                            do_it = text_Output(",", 0)
                        End If
                        do_it = text_Output(" " & Sheets("Game_data1").Cells(235, 2).Value, 0, 3)
                        do_it = text_Output(" " & Sheets("Lan" & Language).Cells(545, 1).Value, 0)
                        commaneeded = 1
                End If
                If Sheets("Game_data1").Cells(236, 2).Value > 0 Then 'Power
                        If commaneeded = 1 Then
                            do_it = text_Output(",", 0)
                        End If
                        do_it = text_Output(" " & Sheets("Game_data1").Cells(236, 2).Value, 0, 3)
                        do_it = text_Output(" " & Sheets("Lan" & Language).Cells(546, 1).Value, 0)
                End If
                do_it = text_Output(Sheets("Lan" & Language).Cells(549, 1).Value, 1)
                
        
        End If
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_to_main", 0, 1)
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_pet_buy", 0, 1)

End If





End Function



Function pick_a_pet_for_player(what_side As Integer) As Integer
Dim x As Integer
Dim who As Integer
Dim counter As Integer
Dim mitmes_pet As Integer
counter = 0

who = Sheets("Game_data1").Cells(51 + what_side, 2).Value

For x = 1 To Sheets("Game_data1").Cells(185, 2).Value

        If Sheets("mobs").Cells(x, 52).Value > 0 Then
                If Sheets("mobs").Cells(x, 52).Value = 1 Then
                        counter = counter + 1 'cat or dog pet
                        Sheets("nupud").Cells(counter, 38).Value = x
                        Sheets("nupud").Cells(counter, 39).Value = 5
                        Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                        Sheets("nupud").Cells(counter, 46).Value = 0 'str
                        Sheets("nupud").Cells(counter, 47).Value = 0 'dex
                        Sheets("nupud").Cells(counter, 48).Value = 0 'pwr
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 7 Then
                        If Sheets("Side" & what_side).Cells(who, 14).Value >= 1 Then
                                counter = counter + 1 'armor 1+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 30
                                Sheets("nupud").Cells(counter, 43).Value = 2
                                Sheets("nupud").Cells(counter, 45).Value = 1 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 0 'str
                                Sheets("nupud").Cells(counter, 47).Value = 0 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 0 'pwr
                        End If
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 8 Then
                        If Sheets("Side" & what_side).Cells(who, 14).Value >= 2 Then
                                counter = counter + 1 'armor 2+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 150
                                Sheets("nupud").Cells(counter, 45).Value = 2 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 0 'str
                                Sheets("nupud").Cells(counter, 47).Value = 0 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 0 'pwr
                        End If
                End If
                
                
                If Sheets("mobs").Cells(x, 52).Value = 2 Then
                        If Sheets("Side" & what_side).Cells(who, 11).Value >= 3 Then
                                counter = counter + 1 'str 3+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 30
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 3 'str
                                Sheets("nupud").Cells(counter, 47).Value = 0 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 0 'pwr
                        End If
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 20 Then
                        If Sheets("Side" & what_side).Cells(who, 11).Value >= 4 Then
                                counter = counter + 1 'str 4+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 150
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 4 'str
                                Sheets("nupud").Cells(counter, 47).Value = 0 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 0 'pwr
                        End If
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 3 Then
                        If Sheets("Side" & what_side).Cells(who, 12).Value >= 3 Then
                                counter = counter + 1 'dex 3+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 30
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 0 'str
                                Sheets("nupud").Cells(counter, 47).Value = 3 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 0 'pwr
                        End If
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 30 Then
                        If Sheets("Side" & what_side).Cells(who, 12).Value >= 4 Then
                                counter = counter + 1 'dex 4+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 150
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 0 'str
                                Sheets("nupud").Cells(counter, 47).Value = 4 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 0 'pwr
                        End If
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 4 Then
                        If Sheets("Side" & what_side).Cells(who, 13).Value >= 3 Then
                                counter = counter + 1 'power 3+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 30
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 0 'str
                                Sheets("nupud").Cells(counter, 47).Value = 0 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 3 'pwr
                        End If
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 40 Then
                        If Sheets("Side" & what_side).Cells(who, 13).Value >= 4 Then
                                counter = counter + 1 'power 4+ pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 150
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 0 'str
                                Sheets("nupud").Cells(counter, 47).Value = 0 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 4 'pwr
                        End If
                End If
                
                
                
                
                If Sheets("mobs").Cells(x, 52).Value = 5 Then
                        If Sheets("Side" & what_side).Cells(who, 13).Value >= 5 And Sheets("Side" & what_side).Cells(who, 11).Value >= 3 And Sheets("Side" & what_side).Cells(who, 12).Value >= 3 Then
                                
                                counter = counter + 1 'power 5+, str 3+, dex 3+ Pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 500
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 3 'str
                                Sheets("nupud").Cells(counter, 47).Value = 3 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 5 'pwr
                                       
                        End If
                End If
                
                If Sheets("mobs").Cells(x, 52).Value = 6 Then
                        If Sheets("Side" & what_side).Cells(who, 13).Value >= 3 And Sheets("Side" & what_side).Cells(who, 11).Value >= 4 And Sheets("Side" & what_side).Cells(who, 12).Value >= 4 Then
                                
                                counter = counter + 1 'power 3+, str 4+, dex 4+ Pet
                                Sheets("nupud").Cells(counter, 38).Value = x
                                Sheets("nupud").Cells(counter, 39).Value = 500
                                Sheets("nupud").Cells(counter, 45).Value = 0 'arm
                                Sheets("nupud").Cells(counter, 46).Value = 4 'str
                                Sheets("nupud").Cells(counter, 47).Value = 4 'dex
                                Sheets("nupud").Cells(counter, 48).Value = 3 'pwr
                                       
                        End If
                End If
                
        End If
        
Next


mitmes_pet = rolling_odds(counter, 39)
Sheets("Game_data1").Cells(233, 2).Value = Sheets("nupud").Cells(mitmes_pet, 45).Value
Sheets("Game_data1").Cells(234, 2).Value = Sheets("nupud").Cells(mitmes_pet, 46).Value
Sheets("Game_data1").Cells(235, 2).Value = Sheets("nupud").Cells(mitmes_pet, 47).Value
Sheets("Game_data1").Cells(236, 2).Value = Sheets("nupud").Cells(mitmes_pet, 48).Value


pick_a_pet_for_player = Sheets("nupud").Cells(mitmes_pet, 38).Value


End Function
Function improve_weapons()
Dim Language As Integer

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_to_main", 0, 1)
do_it = sell_list(0, 0, 1)

End Function

Function Sell_item(mitmes_item As Integer, Optional true_sell As Integer = 0, Optional send As Integer = 0, Optional dip_weapon As Integer = 0, Optional improve_weapon As Integer = 0)
Dim item_tyyp As Integer
Dim what_player As Integer
Dim ruut As Integer
Dim target_side As Integer
Dim mitmes_effect As Integer
Dim what_weapon As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

If send = 1 Then
        target_side = Sheets("Game_data1").Cells(228, 2).Value
End If

If (mitmes_item <> 0) Then
        
        Sheets("Game_data1").Cells(167, 2).Value = mitmes_item
        
        If (true_sell = 1) Then
        
                item_tyyp = Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value
        
                If (Sheets("Game_data1").Cells(mitmes_item, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 6) Then
                
                        do_it = remove_weapon(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                                            
                End If
                
                If (Sheets("Game_data1").Cells(mitmes_item, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value >= 1 And Sheets("Game_data1").Cells(mitmes_item, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value <= 5) Then
                                                            
                        do_it = remove_armor(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                                           
                End If
                
                If dip_weapon = 1 Then
                
                        do_it = text_Output(Sheets("Lan" & Language).Cells(183, 1).Value, 0)
                        
                        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 1), 0)
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(184, 1).Value, 1)
                        
                        what_weapon = Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value
                        do_it = enchant_weapon(what_weapon)
                        'weapon uueks itemiks
                
                Else
                
                
                        If send = 0 Then
                                If improve_weapon = 1 Then
                                
                                        what_weapon = Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value
                                        do_it = enchant_weapon(what_weapon, 2)
                                Else
                        
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(186, 1).Value, 0)
                                        
                                        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 1), 0)
                                        
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(187, 1).Value, 0)
                                    
                                        Sheets("Game_data1").Cells(22, 2).Value = Round(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 5).Value / 2, 0)
                                        
                                        do_it = text_Output(Sheets("Game_data1").Cells(22, 2).Value, 0, 5)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(51, 1).Value, 1)
                                        
                                        Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value + Round(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 5).Value / 2, 0)
                                End If
                        End If
                        
                        If send = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(189, 1).Value, 0)
                                
                                do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 1), 0)
                                
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(188, 1).Value, 0)
                                'kellele saata
                                
                                do_it = text_Output(eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5) & ".", 1)
                                
                                
                                Sheets("Game_data1").Cells(208, 2).Value = Sheets("Game_data1").Cells(208, 2).Value + 1
                                mitmes_effect = Sheets("Game_data1").Cells(208, 2).Value
                                do_it = reset_all_effect_Bonuses(mitmes_effect)
        
                                'kelle poolt (siin on asi veidi segadusseajav- mõlemasse panen target_id
                                Sheets("Effects").Cells(mitmes_effect, 1).Value = Sheets("Side" & target_side).Cells(Sheets("Game_data1").Cells(51 + target_side, 2).Value, 35).Value
                                Sheets("Effects").Cells(mitmes_effect, 2).Value = Sheets("Side" & target_side).Cells(Sheets("Game_data1").Cells(51 + target_side, 2).Value, 35).Value
                                
                                
                                'duration
                                If Sheets("Game_data1").Cells(5 + target_side, 2).Value = ruut Then
                                        Sheets("Effects").Cells(mitmes_effect, 3).Value = 1
                                Else
                                        Sheets("Effects").Cells(mitmes_effect, 3).Value = 3
                                End If
                                
                                Sheets("Effects").Cells(mitmes_effect, 10).Value = Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value
                        
                        End If
                
                        
                End If
                
                do_it = remove_item(what_player, mitmes_item)
                 
                Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
                
        Else
            
            If dip_weapon = 1 Then
                                'dip text
                    do_it = text_Output(Sheets("Lan" & Language).Cells(178, 1).Value, 0)
            Else
                
                    If send = 0 Then
                            If improve_weapon = 1 Then
                                    'smithy improve text
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(928, 1).Value, 0)
                            Else
                                    'send text
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(176, 1).Value, 0)
                            End If
                    Else            'sell text
                            do_it = text_Output(Sheets("Lan" & Language).Cells(177, 1).Value, 0)
                    End If
                
            End If
            
            
            do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 1), 0, 14)
            
            If dip_weapon = 1 Then
                    do_it = text_Output(Sheets("Lan" & Language).Cells(185, 1).Value, 1)
            Else
                    If improve_weapon = 1 Then
                                    'improve weapon confirmation
                                    do_it = text_Output("?", 1)
                                    what_weapon = Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value
                                    do_it = enchant_weapon(what_weapon, 1)
                                    
                                    
                                    
                                    
                    Else
                            If send = 0 Then
                                    
                                    
                                            'sell confirmation question
                                            If Language = 1 Then
                                                    do_it = text_Output(Sheets("Lan" & Language).Cells(50, 1).Value, 0)
                                            End If
                                            
                                            If Language = 2 Then
                                                    do_it = text_Output(" ", 0)
                                            End If
                                            
                                            Sheets("Game_data1").Cells(22, 2).Value = Round(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 5).Value / 2, 0)
                                                
                                            do_it = text_Output(Sheets("Game_data1").Cells(22, 2).Value, 0, 45)
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(74, 1).Value, 1)
                                   
                            Else
                                    
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(188, 1).Value, 0)
                                    
                                    
                                    'kellele saata
                                    
                                    do_it = text_Output(eesti_nimi(Sheets("Game_data1").Cells(10 + target_side, 2).Value, 5) & "?", 1)
                                    
                                    
                            End If
                    
                            do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 0)
                            do_it = text_Output(": ", 0)
                        
                            do_it = change_stats(what_player, mitmes_item, 3)
                    End If
                    
            End If
            
            
            If dip_weapon = 1 Then
                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_true_dip", 0, 1)
                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_true_dip", 0, 1)
                    
            
            Else
            
                    If improve_weapon = 1 Then
                            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_true_impw", 0, 1)
                            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_true_impw", 0, 1)
                    Else
                            If send = 0 Then
                                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_truesell", 0, 1)
                                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_truesell", 0, 1)
                            Else
                                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_true_send", 0, 1)
                                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_true_send", 0, 1)
                            End If
                    End If
            End If
        
        End If

End If

If (mitmes_item = 0) Then
        do_it = Main_turn()
End If

If (true_sell = 1) Then
        do_it = Main_turn()
End If
End Function

Function Buy_item(mitmes_item As Integer, Optional true_buy As Integer = 0)
Dim item_tyyp As Integer
Dim what_player As Integer
Dim what_shop As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
what_shop = Sheets("Game_data1").Cells(175, 2).Value

If is_player_ai(what_player) = 0 Then
        do_it = text_Output("", 3)
End If

do_it = valiknuppude_Kustutamine()

If (mitmes_item <> 0) Then
        
        Sheets("Game_data1").Cells(167, 2).Value = mitmes_item
        
        If (true_buy = 1) Then
                
                If (Sheets("Game_data1").Cells(120 + what_player, 2).Value < 20) Then
                        
                        
                        If (Sheets("Game_data1").Cells(24 + what_player, 2).Value < Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 5).Value) Then
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(70, 1).Value, 1)
                                
                        Else
                        
                                If is_player_ai(what_player) = 0 Then
                                        'sa ostsid asja
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(71, 1).Value, 0)
                                        
                                        
                                        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 1).Value, 1), 0)
                                       
                                        
                                        If Language = 1 Then
                                                do_it = text_Output(" for", 0)
                                        End If
                                        
                                        
                                        do_it = text_Output(" " & Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 5).Value, 0, 45)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(51, 1).Value, 1)
                                End If
                                
                                Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 5).Value
                                
                                
                                ' add item into player inventory
                                 Sheets("Game_data1").Cells(120 + what_player, 2).Value = Sheets("Game_data1").Cells(120 + what_player, 2).Value + 1
                                 Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(120 + what_player, 2).Value, 2 + what_player).Value = Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value
                                
                                ' and put it right to usable slot when consumable
                                        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 2).Value = 7) Then
                                                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(120 + what_player, 2).Value, 7 + what_player).Value = 7
                                        Else
                                                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(120 + what_player, 2).Value, 7 + what_player).Value = 0
                                        End If
                                
                                'remove item from shop inventory
                                do_it = remove_item(5, mitmes_item)
                                
                                
                                Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
                                
                        End If
                Else
                        'AI AI AI tuleb võtta nii kui asju on juba 20, siis ta ei üritaks osta
                        do_it = text_Output(Sheets("Lan" & Language).Cells(72, 1).Value, 1)
                
                End If
                
                
                
        Else
        
                do_it = text_Output(Sheets("Lan" & Language).Cells(73, 1).Value, 0)
                
                
                do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 1).Value, 1), 0)
                
                
                If Language = 1 Then
                        do_it = text_Output(" for", 0)
                End If
                
                do_it = text_Output(" " & Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 5).Value, 0, 45)
                do_it = text_Output(Sheets("Lan" & Language).Cells(74, 1).Value, 1)
            
                do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 13 + what_shop).Value, 1).Value, 0)
                do_it = text_Output(": ", 0)
            
                do_it = change_stats(11 + what_shop, mitmes_item, 3)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_truebuy", 0, 1)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_truebuy", 0, 1)
                
        End If

End If

If (mitmes_item = 0) Then
        do_it = Main_turn()
End If

If (true_buy = 1) Then
        do_it = Main_turn()
End If
End Function

Function buy_list()

Dim x As Integer
Dim what_player As Integer
Dim what_place As Integer
Dim button_string As String
Dim dot_needed As Integer
Dim price As Integer
Dim Language As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value

If is_player_ai(what_player) = 0 Then
    do_it = text_Output("", 3)
End If

do_it = valiknuppude_Kustutamine()
    
Language = Sheets("Game_data1").Cells(100, 2).Value
'
dot_needed = 0

what_place = Sheets("Game_data1").Cells(175, 2).Value

button_string = Sheets("Lan" & Language).Cells(69, 1).Value
    
    
    If is_player_ai(what_player) = 0 Then
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_buy", 0, 1)
    End If
    
    If (Sheets("Game_data1").Cells(168 + what_place, 2).Value > 0) Then
            
            If is_player_ai(what_player) = 0 Then
                    do_it = text_Output(Sheets("Lan" & Language).Cells(68, 1).Value, 0)
            End If
            
            For x = 1 To Sheets("Game_data1").Cells(168 + what_place, 2).Value
                    
                    dot_needed = dot_needed + 1
                    
                    If is_player_ai(what_player) = 0 Then
                    
                            If (dot_needed = 2) Then
                                        do_it = text_Output(", ", 0)
                            End If
                            
                            If (dot_needed = 3) Then
                                        do_it = text_Output(", ", 1)
                                        dot_needed = 1
                            End If
                    
                    End If
                
                    
                    If is_player_ai(what_player) = 0 Then
                            do_it = Nuppudega_tegeleja(button_string & eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 1).Value, 3), "Buy_" & x, 0, 1)
                    Else
                            ' if AI has enough money to buy this item
                            If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 5).Value <= Sheets("Game_data1").Cells(24 + what_player, 2).Value Then
                                    do_it = add_ai_choice(1100 + x)
                            Else
                                    do_it = add_ai_choice(1200 + x, 0)
                            End If
                            
                    End If
                    
                    
                    If is_player_ai(what_player) = 0 Then
                            ' if its a scroll
                            If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 2).Value = 7 And _
                            Sheets("Game_data1").Cells(x, 13 + what_place).Value >= Sheets("Game_data1").Cells(184, 2).Value Then
                                    do_it = what_damage_type(Sheets("Spells").Cells(find_spell_by_name(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 14).Value), 7).Value, 0)
                                    
                                    
                                    do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 1).Value, 1), 0, Sheets("Game_data1").Cells(21, 2).Value)
                                   
                            Else
                                    If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 5).Value >= 500 Then
                                            do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 1).Value, 1), 0, 13)
                                    Else
                                            do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 1).Value, 1), 0)
                                    End If
                                    
                            End If
                                
                            do_it = text_Output(Sheets("Lan" & Language).Cells(174, 1).Value, 0)
                            do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 13 + what_place).Value, 5).Value, 0, 14)
                            do_it = text_Output(Sheets("Lan" & Language).Cells(175, 1).Value, 0)
                    End If
            Next
            
                    If is_player_ai(what_player) = 0 Then
                            do_it = text_Output(".", 1)
                    End If
            
            Else
                    'no items in shop
                    If is_player_ai(what_player) = 0 Then
                            do_it = text_Output(Sheets("Lan" & Language).Cells(179, 1).Value, 1)
                    End If
            
    End If
End Function
Function Equip_item(mitmes_item As Integer, Optional true_equip As Integer = 0)
    
    Dim x As Integer
    Dim counter As Integer
    Dim item_tyyp As Integer
    Dim what_player As Integer
    Dim Language As Integer

    Language = Sheets("Game_data1").Cells(100, 2).Value
    what_player = Sheets("Game_data1").Cells(10, 2).Value
    
    If is_player_ai(what_player) = 0 Then
            do_it = text_Output("", 3)
    End If
    
    do_it = valiknuppude_Kustutamine()
    
If (mitmes_item <> 0) Then
        
        Sheets("Game_data1").Cells(167, 2).Value = mitmes_item
        item_tyyp = Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value
        
        If (true_equip = 1) Then
            
                    If (Sheets("Game_data1").Cells(mitmes_item, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 0) Then
                    
                                    If (item_tyyp = 6) Then
                                            'check if any weapons, if yes, remove it
                                            For x = 1 To Sheets("Game_data1").Cells(120 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
                                                    
                                                    If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 6) Then
                                                            do_it = remove_weapon(Sheets("Game_data1").Cells(10, 2).Value, x)
                                            
                                                    End If
                                            Next
                                            do_it = equip_weapon(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                                            
                                    End If
                                    
                                    If (item_tyyp >= 1 And item_tyyp < 4) Then
                                            'check if any removable helm, armor,boots
                                            For x = 1 To Sheets("Game_data1").Cells(120 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
                                                    
                                                    If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = item_tyyp) Then
                                                            
                                                            do_it = remove_armor(Sheets("Game_data1").Cells(10, 2).Value, x, 1)
                                            
                                                    End If
                                            
                                            Next
                                            
                                            do_it = equip_armor(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                                                     
                                    End If
                                    
                                    If (item_tyyp = 4) Then 'check if both ring slots are occupied
                                            counter = 0
                                            For x = 1 To Sheets("Game_data1").Cells(120 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
                                                    If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 4) Then
                                                    counter = counter + 1
                                                    End If
                                                    If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 5) Then
                                                    counter = counter + 1
                                                    End If
                                            Next
                                            If (counter = 2) Then
                                                    For x = 1 To Sheets("Game_data1").Cells(120 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
                                                            If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 5) Then
                                                                    do_it = remove_armor(Sheets("Game_data1").Cells(10, 2).Value, x, 1)
                                                            End If
                                                    Next
                                            End If
                                            
                                            do_it = equip_armor(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                                    
                                    End If
                                    If (item_tyyp = 7) Then
                                            Sheets("Game_data1").Cells(mitmes_item, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 7
                                    End If
                                    
                    Else
                            
                            ' remove weapon
                            If (Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value = 6) Then
                                    do_it = remove_weapon(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                            End If
                            
                            'kyik armor, kaasaarvatud ringid
                            If (Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value >= 1 And Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value < 5) Then
                                    do_it = remove_armor(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                            End If
                            
                            If (Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value = 7) Then
                                    do_it = use_item(Sheets("Game_data1").Cells(10, 2).Value, mitmes_item, 1)
                            End If
                            
                            
                    End If
                    
                    'round juurde
                    Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
                    
            Else
            
            'truequip kood
            do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 0)
            do_it = text_Output(": ", 0)
            
            do_it = change_stats(what_player, mitmes_item, 3)
            If (Sheets("Game_data1").Cells(mitmes_item, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 0) Then
            'Sheets("Lan" & language).Cells(174, 1).Value
            
                                    If item_tyyp >= 1 And item_tyyp <= 4 Then
                                            'helm
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(190, 1).Value, 0)
                                    End If
                                    
                                    If (item_tyyp = 6) Then
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(194, 1).Value, 0)
                                    End If
                                    
                                    If (item_tyyp = 7) Then
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(196, 1).Value, 0)
                                    End If
                                    
                                    'item ise
                                    
                                    do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 1), 0, 14)
                                    
                                    
                                    If (item_tyyp = 6) Then
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(195, 1).Value, 0)
                                    End If
                                    
                                    If item_tyyp = 1 Then
                                            'helm
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(191, 1).Value, 0)
                                    End If
                                    
                                    If item_tyyp = 2 Then
                                            'armor
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(192, 1).Value, 0)
                                    End If
                                    
                                    If item_tyyp = 3 Then
                                            ' boots
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(193, 1).Value, 0)
                                    End If
                                    
                                    If item_tyyp = 4 Then
                                            'ring
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(198, 1).Value, 0)
                                    End If
                                    
                                    If (item_tyyp = 7) Then
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(197, 1).Value, 0)
                                    End If
                                    do_it = text_Output("?", 1)
                                    
            Else                'ELSE
                                'remove item or use item
                                
                    If (item_tyyp = 7) Then
                    
                            do_it = text_Output(Sheets("Lan" & Language).Cells(199, 1).Value, 0)
                                    
                            
                            do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 1), 0, 14)
                            
                                    
                            If Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value >= Sheets("Game_data1").Cells(184, 2).Value Then
                                 do_it = text_Output(Sheets("Lan" & Language).Cells(201, 1).Value, 1)
                            Else
                                 do_it = text_Output(Sheets("Lan" & Language).Cells(200, 1).Value, 1)
                            End If
                               
                    Else
                            do_it = text_Output(Sheets("Lan" & Language).Cells(202, 1).Value, 0)
                            
                            'item ise
                            
                            do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 2 + what_player).Value, 1).Value, 1), 0, 14)
                            
                                
                            If (item_tyyp = 6) Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(207, 1).Value, 1)
                            End If
                                
                            If item_tyyp = 1 Then
                                    'helm
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(203, 1).Value, 1)
                            End If
                            
                            If item_tyyp = 2 Then
                                    'armor
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(204, 1).Value, 1)
                            End If
                            
                            If item_tyyp = 3 Then
                                    ' boots
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(205, 1).Value, 1)
                            End If
                            
                            If item_tyyp = 4 Then
                                    'ring
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(206, 1).Value, 1)
                            End If
                                    
                    End If
            
            End If
            
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_trueequip", 0, 1)
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_trueequip", 0, 1)
                
        End If

End If

If (mitmes_item = 0) Then
        do_it = Main_turn()
End If

If (true_equip = 1) Then
        do_it = Main_turn()
End If

End Function

Function sell_list(Optional send_item As Integer = 0, Optional dip_weapon As Integer = 0, Optional improve_weapon As Integer = 0)
Dim x As Integer
Dim z As Integer

Dim what_player As Integer
Dim button_string As String
Dim button_string2 As String
Dim dot_needed As Integer
Dim price As Integer
Dim counter As Long
Dim equipped As String
Dim Language As Integer
Dim item_color As Integer
Dim weapon_counter As Integer

item_color = 1

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value
dot_needed = 0

If dip_weapon = 0 Or is_player_ai(what_player) = 0 Then
        do_it = text_Output("", 3)
End If

    
    
    
    
    
    
    If send_item = 0 And dip_weapon = 0 And improve_weapon = 0 Then
            button_string = Sheets("Lan" & Language).Cells(168, 1).Value
            button_string2 = "Sell_"
    End If
    
    If send_item = 1 Then
            button_string = Sheets("Lan" & Language).Cells(169, 1).Value
            button_string2 = "Send_item_"
    End If
    
    If dip_weapon = 1 Then
            button_string = Sheets("Lan" & Language).Cells(170, 1).Value
            button_string2 = "Dip_weapon"
    End If
    
    If improve_weapon = 1 Then
            button_string = Sheets("Lan" & Language).Cells(925, 1).Value
            button_string2 = "Imp_weapon"
    End If
    
        
    If send_item = 0 And dip_weapon = 0 And improve_weapon = 0 Then
            If is_player_ai(what_player) = 0 Then
                    'cancel sale nupp
                    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_sale", 0, 1)
                    do_it = text_Output(Sheets("Lan" & Language).Cells(171, 1).Value, 0)
            End If
    End If
    
    If is_player_ai(what_player) = 0 Then
            If send_item = 1 Then
                    do_it = text_Output(Sheets("Lan" & Language).Cells(172, 1).Value, 0)
            End If
        
            
    End If
    
    weapon_counter = 0
    
    For x = 1 To Sheets("Game_data1").Cells(120 + what_player, 2).Value
            
            display_item = 1
            
            If dip_weapon = 1 Or improve_weapon = 1 Then
                
                If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 2).Value <> 6 Then
                    display_item = 0
                Else
                    'this is for displaying the text (annouce before weapons)
                    'to make sure player has any weapons
                    weapon_counter = weapon_counter + 1
                    If weapon_counter = 1 Then
                            If dip_weapon = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(173, 1).Value, 0)
                            End If
                            
                            If improve_weapon = 1 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(926, 1).Value, 1)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(927, 1).Value, 0)
                            End If
                            
                    End If
                    
                End If
                
                
            
            End If
            
            If display_item = 1 Then
            
                    counter = 0
                    dot_needed = dot_needed + 1
                    
                    
                    
                    If (dot_needed = 2) Then
                                If dip_weapon = 1 Or improve_weapon = 1 Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(181, 1).Value, 0)
                                Else
                                        do_it = text_Output(", ", 0)
                                End If
                    End If
                    
                    
                    If (dot_needed = 3) Then
                                If dip_weapon = 1 Or improve_weapon = 1 Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(181, 1).Value, 1)
                                Else
                                        do_it = text_Output(", ", 1)
                                End If
                                dot_needed = 1
                    End If
                    
                    
                    For z = 1 To x 'loeb kokku ühesuguse nimega itemeid
                    
                            If Sheets("Items").Cells(Sheets("Game_data1").Cells(z, 2 + what_player).Value, 1).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 1).Value Then
                                    counter = counter + 1
                            End If
                    Next
                                
                    'equipped?
                    If Sheets("Game_data1").Cells(x, 7 + what_player).Value > 0 And Sheets("Game_data1").Cells(x, 7 + what_player).Value < 7 Then
                            equipped = "*" '* = In use
                    Else
                            equipped = ""
                    End If
                                
                                
                                
                    If counter > 1 Then
                            do_it = Nuppudega_tegeleja(button_string & mitmes_asi(counter, Language) & " " & Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 1).Value & equipped, button_string2 & x, 0, 1)
                    Else
                            do_it = Nuppudega_tegeleja(button_string & Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 1).Value & equipped, button_string2 & x, 0, 1)
                    End If
                    
                    If dip_weapon = 1 Or improve_weapon = 1 Then
                        item_color = 14
                    End If
                    
                    
                    do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 1).Value, 1), 0, item_color)
                    
                    
                    If send_item = 0 And dip_weapon = 0 And improve_weapon = 0 Then
                    
                            do_it = text_Output(Sheets("Lan" & Language).Cells(174, 1).Value, 0)
                            do_it = text_Output(Round(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 5).Value / 2), 0, 5)
                            do_it = text_Output(Sheets("Lan" & Language).Cells(175, 1).Value, 0)
                    End If
                    
            End If
    Next
    If dip_weapon = 1 Then
            If weapon_counter > 0 Then
                    do_it = text_Output(Sheets("Lan" & Language).Cells(182, 1).Value, 0)
            Else
                    do_it = text_Output(Sheets("Lan" & Language).Cells(924, 1).Value, 0)
            End If
    
    End If
    
    If improve_weapon = 1 Then
            If weapon_counter > 0 Then
                    
            Else
                    do_it = text_Output(Sheets("Lan" & Language).Cells(943, 1).Value, 0)
            End If
    
    End If
    
    do_it = text_Output(".", 1)
    
    If dip_weapon = 1 Then
          do_it = text_Output(Sheets("Lan" & Language).Cells(180, 1).Value, 1)
    End If
    
End Function
Function equipment_list()
    Dim x As Integer
    Dim backpack As Integer
    Dim dot_needed As Integer
    Dim button_string As String
    Dim any_items_before_backpack As Integer
    Dim Language As Integer
    Dim what_player As Integer
    
    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value
    
    what_player = Sheets("Game_data1").Cells(10, 2).Value
    button_string = Sheets("Game_data1").Cells(209, 2).Value
    
    do_it = valiknuppude_Kustutamine()
    
    any_items_before_backpack = 0
    
    If is_player_ai(what_player) = 0 Then
            do_it = text_Output("", 3)
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_inventory", 0, 1)
    End If
    
    For x = 1 To Sheets("Game_data1").Cells(120 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
        
        button_string = Sheets("Lan" & Language).Cells(208, 1).Value
        
        
        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value > 0) Then
                If is_player_ai(what_player) = 0 Then
                        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 6) Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(210, 1).Value, 0, 23) 'weapon
                        End If
                        
                        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 1) Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(211, 1).Value, 0, 10)
                        End If
                        
                        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 2) Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(212, 1).Value, 0, 9)
                        End If
                        
                        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 3) Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(213, 1).Value, 0, 16)
                        End If
                        
                        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 4) Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(214, 1).Value, 0, 7)
                        End If
                        
                        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 5) Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(215, 1).Value, 0, 7)
                        End If
                End If
                
                If is_player_ai(what_player) = 0 Then
                        'displaying readable and usable items
                        If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 7) Then
                                
                             button_string = Sheets("Lan" & Language).Cells(217, 1).Value
                             
                             If Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value >= Sheets("Game_data1").Cells(184, 2).Value Then
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(224, 1).Value, 0, 7) 'loetav
                                    button_string = Sheets("Lan" & Language).Cells(223, 1).Value
                             Else
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(216, 1).Value, 0, 7) 'usable
                             End If
                                
                        End If
                
                End If
            
                any_items_before_backpack = 1
                
                If is_player_ai(what_player) = 0 Then
                
                        If Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 7 Then
                                
                                do_it = Nuppudega_tegeleja(button_string & eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 1).Value, 3), "Equip_" & x, 0, 1)
                        Else
                                do_it = Nuppudega_tegeleja(button_string & Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 1).Value, "Equip_" & x, 0, 1)
                        End If
                        
                        do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 1).Value, 1)
                Else
                        do_it = add_ai_choice(1400 + x)
                End If
        
        End If
        
    Next
    
    dot_needed = 0
    backpack = 0
    
    
    For x = 1 To Sheets("Game_data1").Cells(120 + Sheets("Game_data1").Cells(10, 2).Value, 2).Value
            If (Sheets("Game_data1").Cells(x, 7 + Sheets("Game_data1").Cells(10, 2).Value).Value = 0) Then
                    If is_player_ai(what_player) = 0 Then
                            button_string = Sheets("Lan" & Language).Cells(218, 1).Value
                            
                            If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value = 6 Then
                                    button_string = Sheets("Lan" & Language).Cells(219, 1).Value
                            End If
                            
                            If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value = 1 Then
                                    button_string = Sheets("Lan" & Language).Cells(221, 1).Value
                            End If
                            
                            If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value = 4 Then
                                    button_string = Sheets("Lan" & Language).Cells(220, 1).Value
                            End If
                            
                            If Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 2).Value = 3 Then
                                    button_string = Sheets("Lan" & Language).Cells(222, 1).Value
                            End If
                            
                            do_it = Nuppudega_tegeleja(button_string & Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 1).Value, "Equip_" & x, 0, 1)
                    Else
                            do_it = add_ai_choice(1400 + x)
                    End If
                    
                    If is_player_ai(what_player) = 0 Then
                    
                            If (backpack = 0) Then
                                    
                                    If (any_items_before_backpack = 1) Then
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(225, 1).Value, 0)
                                    Else
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(226, 1).Value, 0)
                                    End If
                                    
                                    do_it = text_Output(Sheets("Lan" & Language).Cells(227, 1).Value, 0, 16)
                                    do_it = text_Output(": ", 0)
                                    backpack = 1
                                                 
                            End If
                            
                            
                            If (backpack > 1) Then
                                do_it = text_Output(", ", 0)
                            End If
                            backpack = backpack + 1
                            
                            
                            If (backpack < 4) Then
                                    do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 1).Value, 0)
                                    
                                    dot_needed = 1
                                Else
                                    do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + Sheets("Game_data1").Cells(10, 2).Value).Value, 1).Value, 1)
                                    backpack = 1
                                    dot_needed = 0
                            End If
                            
                    End If
                            
            End If
    Next
    
    If is_player_ai(what_player) = 0 Then
            If (dot_needed = 1) Then
                    do_it = text_Output(".", 1)
            End If
    End If
    
End Function
Function recalculate_damage(what_player As Integer, Optional text_Out As Integer = 0)
Dim x As Integer
Dim was_there_a_weapon As Integer
Dim damage_bonus As Integer
damage_bonus = 0
was_there_a_weapon = 0

'mod - str
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value

'd1 Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value

'd2 Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value


If (Sheets("Game_data1").Cells(120 + what_player, 2).Value > 0) Then 'kui playeril on asju, kontrollime kas on weaponit
        For x = 1 To Sheets("Game_data1").Cells(120 + what_player, 2).Value
                If (Sheets("Game_data1").Cells(x, 7 + what_player).Value = 6) Then
                        was_there_a_weapon = 1
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 3).Value
                        'damage bonus
                        If (Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value < Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 6).Value) Then
                                damage_bonus = 2 * (Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 6).Value)
                        Else
                        damage_bonus = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 6).Value
                        End If

                        ' d2
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 2 + what_player).Value, 4).Value + damage_bonus
                End If
        Next
End If


If (was_there_a_weapon = 0) Then
'no weapon, hand damage
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value = 1
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value
End If
If (text_Out = 1) Then
        do_it = display_status(2)
End If
End Function

Function equip_weapon(what_player As Integer, what_slot As Integer, Optional text_Out As Integer = 0)
Dim x As Integer
Dim what_elemental_damage As String
Dim elemental_Damage_amount As Integer
Dim damage_bonus As Integer
Dim elemental_dam_counter As Integer
Dim word_color As Integer
Dim Language As Integer
Dim dam_start As String
Dim Dam_end As String
Dim dam_middle As String
    
    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value
    
damage_bonus = 0
dam_middle = "- "
what_elemental_damage = ""
elemental_Damage_amount = 0
elemental_dam_counter = 0

'weapon on nüüd käes
Sheets("Game_data1").Cells(what_slot, 7 + what_player).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value

If (text_Out = 1) Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(228, 1).Value, 0)
        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value, 1), 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(229, 1).Value, 1)
End If

do_it = change_stats(what_player, what_slot, 1, text_Out)

'mod - str
'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value

'd1 Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value

'd2 Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value


'd1
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 3).Value
'd2 arvutamine

If (Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value < Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 6).Value) Then
        damage_bonus = 2 * (Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 6).Value)
Else
        damage_bonus = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 6).Value
End If

Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 4).Value + damage_bonus

' damage type
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 7).Value

'chekime elemental damage olemasolu

'    If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + X).Value <> 0 Then
'            what_elemental_damage = what_damage_type(3 + X)
'            elemental_Damage_amount = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + X).Value
'    End If



If (text_Out = 1) Then

        For x = 1 To 4
        
                If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value <> 0 Then
                       'kas mana damiga itemit on
                        elemental_Damage_amount = x
                        elemental_dam_counter = elemental_dam_counter + 1
                End If
        
        Next
              
              
        do_it = text_Output(Sheets("Lan" & Language).Cells(230, 1).Value, 0)
        
        If Language = 2 Then
        do_it = text_Output(what_damage_type(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7).Value, 4), 0)
        End If
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(240, 1).Value, 0)
        
        dam_start = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value
        Dam_end = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value * Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value
        
        If Dam_end = dam_start Then
                dam_start = ""
                dam_middle = ""
        End If
        
        If Dam_end <= 0 Then
                Dam_end = "0"
                dam_start = ""
                dam_middle = ""
        End If
        
        
        do_it = text_Output(dam_start & dam_middle & Dam_end, 0, 23)
       
        
        
        
        do_it = text_Output(" (", 0)
        do_it = text_Output(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value, 0)
        do_it = text_Output("d", 0)
        
        If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value <= 0 Then
                do_it = text_Output("0", 0)
        Else
                do_it = text_Output(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value, 0)
        End If
        
        do_it = text_Output(")", 0)
        
        If Language = 1 Then
        do_it = text_Output(" " & what_damage_type(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7).Value, 1), 0)
        End If
        
        If elemental_Damage_amount <> 0 Then
        
                do_it = text_Output(Sheets("Lan" & Language).Cells(231, 1).Value, 0)
                
                dot_needed = 0
                
                For x = 1 To 4
                
                        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value <> 0 Then
                                
                                dot_needed = dot_needed + 1
                                
                                
                                If dot_needed > 1 Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(242, 1).Value, 0)
                                End If
                                
                                If Language = 2 And dot_needed = 2 Then
                                        do_it = text_Output(" ", 1)
                                End If
                                
                                what_elemental_damage = LCase(what_damage_type(3 + x, 4))
                                word_color = Sheets("game_data1").Cells(21, 2).Value
                                elemental_Damage_amount = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value
                                
                                If Language = 2 Then
                                        do_it = text_Output(what_elemental_damage, 0)
                                End If
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(241, 1).Value, 0)
                                do_it = text_Output(" " & elemental_Damage_amount, 0, word_color)
                                
                                If Language = 1 Then
                                        do_it = text_Output(" " & what_elemental_damage, 0)
                                End If
                                                                
                                
                                                                                               
                                
                        End If
                
                Next
                    
        End If
                
        do_it = text_Output(Sheets("Lan" & Language).Cells(236, 1).Value, 1)
        
End If

'weaponi nimi variablesse
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 15).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value


If (text_Out = 1) Then
        do_it = display_status(2)
End If

End Function
Function remove_weapon(what_player As Integer, what_slot As Integer, Optional text_Out As Integer = 0)

Dim Language As Integer

    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value

If (text_Out = 1) Then

        do_it = text_Output(Sheets("Lan" & Language).Cells(243, 1).Value, 0)
        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value, 1), 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(244, 1).Value, 1)
End If

do_it = change_stats(what_player, what_slot, 0, text_Out)

'hand damage calculation
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7).Value = 0 'damage type
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value = 1
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value

If (text_Out = 1) Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(245, 1).Value, 0)
        do_it = text_Output(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 5).Value, 0, 23)
        do_it = text_Output("-", 0)
        do_it = text_Output(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 6).Value, 0, 23)
        do_it = text_Output(Sheets("Lan" & Language).Cells(246, 1).Value, 1)
        
End If

Sheets("Game_data1").Cells(what_slot, 7 + what_player).Value = 0
Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 15).Value = "No weapon"

If (text_Out = 1) Then
        do_it = display_status(2)
End If
End Function
Function equip_armor(what_player As Integer, what_slot As Integer, Optional text_Out As Integer = 0)
Dim What_finger As Integer
Dim x As Integer
What_finger = 0
Dim Language As Integer

    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value


If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 4) Then
        For x = 1 To Sheets("Game_data1").Cells(120 + what_player, 2).Value
                If (Sheets("Game_data1").Cells(x, 7 + what_player).Value = 4) Then
                        What_finger = 5
                End If
        Next
        
        If (What_finger = 0) Then
                What_finger = 4
        End If
        
        Sheets("Game_data1").Cells(what_slot, 7 + what_player).Value = What_finger
End If

If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value < 4) Then
        Sheets("Game_data1").Cells(what_slot, 7 + what_player).Value = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value
End If



If (text_Out = 1) Then

        If (What_finger = 0) Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(247, 1).Value, 0)
                do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value, 3), 0)
                do_it = text_Output(".", 1)
        End If
        
        If (What_finger = 4) Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(248, 1).Value, 0)
                do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value, 3), 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(249, 1).Value, 1)
        End If
        
        If (What_finger = 5) Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(248, 1).Value, 0)
                do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value, 3), 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(250, 1).Value, 1)
                
        End If
        
End If

do_it = change_stats(what_player, what_slot, 1, text_Out)

If (text_Out = 1) Then
        do_it = display_status(2)
End If

End Function
Function remove_armor(what_player As Integer, what_slot As Integer, Optional text_Out As Integer = 0)
Dim Language As Integer

    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value
    
If (text_Out = 1) Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(251, 1).Value, 0)
        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value, 1), 0)
        
        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(252, 1).Value, 1)
        End If
        
        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 2 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(253, 1).Value, 1)
        End If
        
        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 3 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(254, 1).Value, 1)
        End If
        
        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 4 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(255, 1).Value, 1)
        End If
        
        
End If
        do_it = change_stats(what_player, what_slot, 0, text_Out)
        Sheets("Game_data1").Cells(what_slot, 7 + what_player).Value = 0
        
If (text_Out = 1) Then
        do_it = display_status(2)
End If
End Function
Function remove_item(what_player As Integer, what_slot As Integer)
Dim y As Integer
Dim z As Integer

If (what_player >= 1 And what_player <= 4) Then

        If (what_slot < Sheets("Game_data1").Cells(120 + what_player, 2).Value) Then
            
                y = Sheets("Game_data1").Cells(120 + what_player, 2).Value - what_slot
                              
                For z = 1 To y
                        Sheets("Game_data1").Cells(what_slot - 1 + z, 2 + what_player).Value = Sheets("Game_data1").Cells(what_slot + z, 2 + what_player).Value
                        Sheets("Game_data1").Cells(what_slot - 1 + z, 7 + what_player).Value = Sheets("Game_data1").Cells(what_slot + z, 7 + what_player).Value
                Next
                      
        End If
        
        Sheets("Game_data1").Cells(120 + what_player, 2).Value = Sheets("Game_data1").Cells(120 + what_player, 2).Value - 1

End If

If (what_player = 5) Then 'poe kood
        
        
        what_player = Sheets("Game_data1").Cells(175, 2).Value
        
        
        
        If (what_slot < Sheets("Game_data1").Cells(168 + what_player, 2).Value) Then
            
                y = Sheets("Game_data1").Cells(168 + what_player, 2).Value - what_slot
                              
                For z = 1 To y
                        Sheets("Game_data1").Cells(what_slot - 1 + z, 13 + what_player).Value = Sheets("Game_data1").Cells(what_slot + z, 13 + what_player).Value
                Next
                      
        End If
        
        Sheets("Game_data1").Cells(168 + what_player, 2).Value = Sheets("Game_data1").Cells(168 + what_player, 2).Value - 1
Else
        If (what_player = 6) Then 'maaslamava treasure kood
        
                 If (what_slot < Sheets("Game_data1").Cells(189, 2).Value) Then
                    
                        y = Sheets("Game_data1").Cells(189, 2).Value - what_slot
                                      
                        For z = 1 To y
                                Sheets("Game_data1").Cells(what_slot - 1 + z, 18).Value = Sheets("Game_data1").Cells(what_slot + z, 18).Value
                                Sheets("Game_data1").Cells(what_slot - 1 + z, 19).Value = Sheets("Game_data1").Cells(what_slot + z, 19).Value
                        Next
                              
                End If
                
                Sheets("Game_data1").Cells(189, 2).Value = Sheets("Game_data1").Cells(189, 2).Value - 1
        
        End If
        
End If

End Function
Function use_item(what_player As Integer, what_slot As Integer, Optional text_Out As Integer = 0)
Dim Language As Integer
Dim use_string As String
Dim end_string As String
    Language = Sheets("Game_data1").Cells(100, 2).Value
    'Sheets("Lan" & Language).Cells(9, 1).Value
    
If (text_Out = 1) Then
        
        use_string = Sheets("Lan" & Language).Cells(256, 1).Value
        
        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 7 Then
                
                If Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value >= Sheets("Game_data1").Cells(184, 2).Value Then
                    'scroll
                        use_string = Sheets("Lan" & Language).Cells(258, 1).Value
                Else
                    'potion
                        use_string = Sheets("Lan" & Language).Cells(260, 1).Value
                End If
        End If
        
        do_it = text_Output(use_string, 0)
        
        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 1).Value, 1), 0, 5)
        
        end_string = Sheets("Lan" & Language).Cells(257, 1).Value
        
        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 7 Then
                
                If Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value >= Sheets("Game_data1").Cells(184, 2).Value Then
                    'scroll
                        end_string = Sheets("Lan" & Language).Cells(259, 1).Value
                Else
                    'potion
                        end_string = Sheets("Lan" & Language).Cells(257, 1).Value
                End If
                
        End If
        
        do_it = text_Output(end_string, 1)
        
End If

do_it = change_stats(what_player, what_slot, 1, text_Out)

do_it = remove_item(what_player, what_slot)

If (text_Out = 1) Then
        do_it = display_status(2)
End If

End Function
Function change_stats(what_player As Integer, what_slot As Integer, what_to_do As Integer, Optional text_Out As Integer = 0, Optional stat As Integer = 0, Optional stat_t As Integer = 0)
Dim vahe As String
Dim Total As String
Dim before As Integer
Dim word_color As Integer
Dim stat_type As String
Dim x As Integer
Dim Language As Integer
Dim stat_change As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'what_to_do 1 = lahutamine, what_to_do 2 = liitmine, what_to_do 3 = display

If (what_to_do = 0 Or what_to_do = 1) Then

        
        If stat = 0 And stat_t = 0 Then 'asi on item
        
        
                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 8).Value <> 0) Then
                        'life
                        before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value
        
                        If (what_to_do = 0) Then 'lahutame elu ära
                        
                                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 8).Value
                        
                        Else
                                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value + Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 8).Value
                        
                        End If
        
                        Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value
        
                        If (text_Out = 1) Then
        
        
        
                                If (before < Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value) Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(261, 1).Value, 0) 'parem kui enne
                                        vahe = Abs(before - Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value)
        
                                        do_it = text_Output(vahe, 0, 4)
        
                                Else 'halvem kui enne
        
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(262, 1).Value, 0)
                                        vahe = Abs(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value - before)
                                        do_it = text_Output(vahe, 0, 3)
        
                                End If
        
                                do_it = text_Output(Sheets("Lan" & Language).Cells(263, 1).Value, 1)
        
                        End If
                        
                End If

        

                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value <> 0) Then
                        'combat round
                        before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value
        
                        If (what_to_do = 0) Then 'lahutamne combat roundi ära
                                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value
                        Else
                                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value + Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value
                        End If
        
                        Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value
        
                        If (text_Out = 1) Then
        
                                If (before < Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value) Then
        
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(264, 1).Value, 0) 'parem kui enne
                                        do_it = text_Output(Total, 0, 5)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(267, 1).Value, 1)
        
                                Else 'halvem kui enne
        
                                        If (Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value = 1) Then
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(266, 1).Value, 1)
                                        Else
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(265, 1).Value, 0)
                                                do_it = text_Output(Total, 0, 3)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(267, 1).Value, 1)
                                        End If
        
                                End If
        
                        End If
        
                End If
        
        End If
        
        
        For y = 0 To 3
        
                
                x = -1
                
        
                If stat = 0 And stat_t = 0 Then
                        
                        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9 + y).Value <> 0) Then
                                x = y
                                stat_change = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9 + x).Value
                        End If
                        
                        
                
                Else
                        If y + 11 = stat_t Then
                                x = y
                                stat_change = stat
                        End If
                End If
                
                
                
                If x > -1 Then
                
                        'Str, Dex, Power, Armor
                        
        
                                If (x = 0) Then 'str
                                        stat_type = Sheets("Lan" & Language).Cells(337, 1).Value
                                        word_color = 23
                                End If
        
                                If (x = 1) Then 'dex
                                        stat_type = Sheets("Lan" & Language).Cells(338, 1).Value
                                        word_color = 17
                                End If
        
                                If (x = 2) Then 'power
                                        stat_type = Sheets("Lan" & Language).Cells(268, 1).Value
                                        word_color = 45
                                End If
        
                                If (x = 3) Then 'armor
                                        stat_type = Sheets("Lan" & Language).Cells(269, 1).Value
                                        word_color = 18
                                End If
        
        
                                before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + x).Value
        
        
                                If (what_to_do = 0) Then
                                        
                                        'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + X).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + X).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9 + X).Value
                                        do_it = add_stat(-stat_change, 11 + x, what_player, Sheets("Game_data1").Cells(51 + what_player, 2).Value)
                                        'consumable, then base stat increase/decrease
                                        If stat = 0 And stat_t = 0 Then
                                                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 7 And x < 3) Then
                                                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 8 + x).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 8 + x).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9 + x).Value
                                                End If
                                        End If
        
                                Else
                                        do_it = add_stat(stat_change, 11 + x, what_player, Sheets("Game_data1").Cells(51 + what_player, 2).Value)
                                        
                                        'consumable, then base stat increase/decrease
                                        If stat = 0 And stat_t = 0 Then
                                                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 7 And x < 3) Then
                                                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 8 + x).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 8 + x).Value + Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9 + x).Value
                                                End If
                                        End If
                                End If
        
                                If (x = 0) Then
                                        do_it = recalculate_damage(what_player, text_Out)
                                End If
        
                                If (text_Out = 1) Then
        
                                        If (before > Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + x).Value) Then
        
                                                vahe = Abs(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + x).Value - before)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(270, 1).Value, 0)
                                                do_it = text_Output(stat_type, 0, word_color)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(271, 1).Value, 0)
                                                do_it = text_Output(vahe, 0, 3)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(273, 1).Value, 0)
                                        Else
                                                vahe = Abs(before - Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + x).Value)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(270, 1).Value, 0)
                                                do_it = text_Output(stat_type, 0, word_color)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(272, 1).Value, 0)
                                                do_it = text_Output(vahe, 0, 5)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(273, 1).Value, 0)
                                        End If
        
                                        Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + x).Value
        
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(274, 1).Value, 0)
                                        do_it = text_Output(stat_type, 0)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(275, 1).Value, 0)
                                        do_it = text_Output(Total, 1)
        
                                End If
                        
                End If
        Next
        
        If stat = 0 And stat_t = 0 Then

                If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 14).Value <> 0 Then
                    'l Spell knowledge
        
                          vahe = find_spell_by_name(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 14).Value)
                          before = Sheets("Spells").Cells(vahe, 2 + what_player).Value
        
                          If (what_to_do = 0) Then
        
                                Sheets("Spells").Cells(vahe, 2 + what_player).Value = Sheets("Spells").Cells(vahe, 2 + what_player).Value - 1
        
                          Else
                                Sheets("Spells").Cells(vahe, 2 + what_player).Value = Sheets("Spells").Cells(vahe, 2 + what_player).Value + 1
        
                          End If
        
                          If (before < Sheets("Spells").Cells(vahe, 2 + what_player).Value) Then
        
                                If (text_Out = 1) Then
                                      do_it = text_Output(Sheets("Lan" & Language).Cells(276, 1).Value, 0)
                                      do_it = text_Output(eesti_nimi(Sheets("Spells").Cells(vahe, 1).Value, 1), 0, 5)
                                      do_it = text_Output(Sheets("Lan" & Language).Cells(277, 1).Value & Sheets("Spells").Cells(vahe, 2 + what_player).Value & Sheets("Lan" & Language).Cells(278, 1).Value, 1)
                                End If
        
                          Else
        
                                If (text_Out = 1) Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(276, 1).Value, 0)
                                        do_it = text_Output(eesti_nimi(Sheets("Spells").Cells(vahe, 1).Value, 1), 0, 3)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(279, 1).Value, 1)
                                End If
        
                          End If
        
                End If
        
                For x = 1 To 7
        
                    If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value <> 0) Then
                        'mana regen
                              vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value)
        
                                    If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value > 0) Then
        
                                        stat_type = what_damage_type(x + 3)
                                        word_color = Sheets("game_data1").Cells(21, 2).Value
                                        
                                    End If
        
                                    before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value
        
                                    If (what_to_do = 0) Then 'lahutamine
                                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value
        
                                           
        
                                    Else 'liidame juurde
                                            Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value + Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value
        
        
                                    End If
        
                                    If (text_Out = 1) Then 'stati vahetus nähtav
        
                                        If (before > Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value) Then
        
                                                vahe = Abs(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value - before)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(270, 1).Value, 0)
                                                do_it = text_Output(stat_type, 0, word_color)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(280, 1).Value, 0)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(271, 1).Value, 0)
                                                do_it = text_Output(vahe, 0, 3)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(273, 1).Value, 1)
                                         Else
                                                vahe = Abs(before - Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + x).Value)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(270, 1).Value, 0)
                                                do_it = text_Output(stat_type, 0, word_color)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(280, 1).Value, 0)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(272, 1).Value, 0)
                                                do_it = text_Output(vahe, 0, 5)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(273, 1).Value, 1)
                                        End If
        
                                        'Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 15 + x).Value
        
                                    End If
        
                    End If
        
                Next
        
                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16).Value <> 0) Then
                                'speed
                                before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value
                
                                If (what_to_do = 0) Then '
                                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16).Value
                                Else
                                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value + Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16).Value
                                End If
                
                                Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value
                
                                If (text_Out = 1) Then
                
                                        If (before < Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value) Then
                                                 'parem kui enne
                                                vahe = Abs(before - Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(281, 1).Value, 0)
                                                do_it = text_Output(vahe, 0, 10)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(273, 1).Value, 1)
                                                 
                                        Else 'halvem kui enne
                
                                                vahe = Abs(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49).Value - before)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(282, 1).Value, 0)
                                                do_it = text_Output(vahe, 0, 10)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(273, 1).Value, 1)
                                        
                                        End If
                
                                End If
                
                        End If
                        
                For x = 1 To 4
                
                    If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value <> 0) Then
                                   'extra elemental dam
                                    before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value
                    
                                    stat_type = what_damage_type(x + 3, 5)
                                    word_color = Sheets("game_data1").Cells(21, 2).Value
                    
                                    If (what_to_do = 0) Then
                                            Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value - Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value
                                    Else
                                            Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value + Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value
                                    End If
                    
                                    Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value
                    
                                    If (text_Out = 1) Then
                    
                                            If (before < Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value) Then
                                                     'parem kui enne
                                                    vahe = Abs(before - Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value)
                                                    do_it = text_Output("+ ", 0)
                                                    do_it = text_Output(vahe, 0, word_color)
                                                    do_it = text_Output(Sheets("Lan" & Language).Cells(283, 1).Value, 0)
                                                    do_it = text_Output(stat_type, 0, word_color)
                                                    do_it = text_Output(Sheets("Lan" & Language).Cells(284, 1).Value, 1)
                                                     
                                            Else 'halvem kui enne
                    
                                                    vahe = Abs(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value - before)
                                                    do_it = text_Output("- ", 0)
                                                    do_it = text_Output(vahe, 0, word_color)
                                                    do_it = text_Output(Sheets("Lan" & Language).Cells(289, 1).Value, 0)
                                                    do_it = text_Output(stat_type, 0, word_color)
                                                    do_it = text_Output(Sheets("Lan" & Language).Cells(284, 1).Value, 1)
                                            
                                            End If
                    
                                    End If
                    
                            End If
                        
                    Next
        End If
End If
        
        
        

If (what_to_do = 3) Then 'display stats

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 3).Value <> 0) Then
                'd1, d2
                vahe = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 3).Value
                Total = Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 4).Value
                        do_it = text_Output(" ", 0)
                        do_it = text_Output(vahe, 0, 5)
                        do_it = text_Output("d", 0)
                        do_it = text_Output(Total, 0, 5)
                        do_it = text_Output(" ", 0)
                        do_it = text_Output(what_damage_type(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 7).Value, 2), 0)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(290, 1).Value, 0)
                        do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 6).Value, 0, 16)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(291, 1).Value, 1)

        End If

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 12).Value <> 0) Then
                'armor
                vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 12).Value)

                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 12).Value > 0) Then

                        do_it = text_Output(" + ", 0, 5)
                        do_it = text_Output(vahe, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(292, 1).Value, 1, 18)

                Else

                        do_it = text_Output(" - ", 0, 3)
                        do_it = text_Output(vahe, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(292, 1).Value, 1, 18)

                End If

        End If

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value <> 0) Then
                ' strikes
                Total = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value)

                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value = 1) Then
                        do_it = text_Output(" +", 0)
                        do_it = text_Output(Total, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(293, 1).Value, 1)
                End If

                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value > 1) Then
                        do_it = text_Output(" +", 0)
                        do_it = text_Output(Total, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(294, 1).Value, 1)
                End If

                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value = -1) Then
                        do_it = text_Output(" -", 0)
                        do_it = text_Output(Total, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(293, 1).Value, 1)
                End If
                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 13).Value < -1) Then
                        do_it = text_Output(" -", 0)
                        do_it = text_Output(Total, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(294, 1).Value, 1)
                End If

        End If

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 8).Value <> 0) Then
            'Life
                  vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 8).Value)

                  If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 8).Value > 0) Then

                        do_it = text_Output(" + ", 0, 5)
                        do_it = text_Output(vahe, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(295, 1).Value, 1)

                  Else

                        do_it = text_Output(" - ", 0, 3)
                        do_it = text_Output(vahe, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(296, 1).Value, 1)

                  End If

        End If

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9).Value <> 0) Then
            'Str
                  vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9).Value)

                  If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 9).Value > 0) Then

                        do_it = text_Output(" + ", 0, 5)
                        do_it = text_Output(vahe, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(600, 1).Value, 1)

                  Else

                        do_it = text_Output(" - ", 0, 3)
                        do_it = text_Output(vahe, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(600, 1).Value, 1)

                  End If

        End If

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 10).Value <> 0) Then
            'Dex
                  vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 10).Value)

                  If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 10).Value > 0) Then

                        do_it = text_Output(" + ", 0, 5)
                        do_it = text_Output(vahe, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(601, 1).Value, 1)

                  Else

                        do_it = text_Output(" - ", 0, 3)
                        do_it = text_Output(vahe, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(601, 1).Value, 1)

                  End If

        End If

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 11).Value <> 0) Then
            'Power
                  vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 11).Value)

                  If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 11).Value > 0) Then

                        do_it = text_Output(" + ", 0, 5)
                        do_it = text_Output(vahe, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(602, 1).Value, 1)

                  Else

                        do_it = text_Output(" - ", 0, 3)
                        do_it = text_Output(vahe, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(602, 1).Value, 1)

                  End If

        End If

        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 14).Value <> 0) Then
            'Spell knowledge
                  vahe = find_spell_by_name(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 14).Value)

                        do_it = text_Output(Sheets("Lan" & Language).Cells(603, 1).Value, 0)
                        do_it = what_damage_type(Sheets("Spells").Cells(vahe, 7).Value, 0)
                        do_it = text_Output(eesti_nimi(Sheets("Spells").Cells(vahe, 1).Value, 1), 0, Sheets("Game_data1").Cells(21, 2).Value)
                        
                        If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 7 Then
                                do_it = text_Output(Sheets("Lan" & Language).Cells(604, 1).Value, 1)
                        Else
                                do_it = text_Output(Sheets("Lan" & Language).Cells(605, 1).Value, 0)
                        End If
                  
                  'Spell stats
                  
                  do_it = text_Output(Sheets("Lan" & Language).Cells(606, 1).Value, 0)
                  do_it = text_Output(Sheets("Spells").Cells(vahe, 9).Value, 0)
                  do_it = text_Output(" ", 0)
                  do_it = text_Output(what_damage_type(Sheets("Spells").Cells(vahe, 7).Value, 0), 0, Sheets("Game_data1").Cells(21, 2).Value)
                  
                  If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 7 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(607, 1).Value, 1)
                  Else
                        do_it = text_Output(Sheets("Lan" & Language).Cells(608, 1).Value, 1)
                  End If
                  
                  If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 2).Value = 7 Then
                        
                        do_it = text_Output(Sheets("Lan" & Language).Cells(66, 1).Value, 0)
                        do_it = text_Output(Sheets("Spells").Cells(vahe, 10).Value, 1)
                  
                  End If
        End If


        For x = 1 To 7

            If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value <> 0) Then


                                stat_type = what_damage_type(x + 3)
                                word_color = Sheets("game_data1").Cells(21, 2).Value

                                 vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value)

                               If Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16 + x).Value > 0 Then

                                        do_it = text_Output("+ ", 0)
                                        do_it = text_Output(vahe, 0, 5)
                                        do_it = text_Output("  ", 0, 5)
                                        do_it = text_Output(stat_type, 0, word_color)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(610, 1).Value, 1)
                                        
                                 Else
                                        do_it = text_Output("- ", 0)
                                        do_it = text_Output(vahe, 0, 5)
                                        do_it = text_Output("  ", 0, 5)
                                        do_it = text_Output(stat_type, 0, word_color)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(610, 1).Value, 1)

                              End If

               End If

        Next


        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16).Value <> 0) Then
            'speed
                  vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16).Value)

                        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 16).Value > 0) Then

                        do_it = text_Output(" + ", 0, 5)
                        do_it = text_Output(vahe, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(609, 1).Value, 1)

                  Else

                        do_it = text_Output(" - ", 0, 3)
                        do_it = text_Output(vahe, 0, 3)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(609, 1).Value, 1)

                  End If

        End If


        For x = 1 To 4
        
                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value <> 0) Then
                    'extra elemental damage
                    
                                stat_type = what_damage_type(x + 3, 5)
                                word_color = Sheets("game_data1").Cells(21, 2).Value
                                
                                 vahe = Abs(Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value)
        
                                If (Sheets("Items").Cells(Sheets("Game_data1").Cells(what_slot, 2 + what_player).Value, 23 + x).Value > 0) Then
                                do_it = text_Output("+ ", 0)
                                do_it = text_Output(vahe, 0, word_color)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(283, 1).Value, 0)
                                do_it = text_Output(stat_type, 0, word_color)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(284, 1).Value, 1)
                                
                          Else
        
                                vahe = Abs(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 49 + x).Value - before)
                              do_it = text_Output("- ", 0)
                              do_it = text_Output(vahe, 0, word_color)
                              do_it = text_Output(Sheets("Lan" & Language).Cells(289, 1).Value, 0)
                              do_it = text_Output(stat_type, 0, word_color)
                              do_it = text_Output(Sheets("Lan" & Language).Cells(284, 1).Value, 1)
                    
        
                          End If
        
                End If
        
        Next


End If
If (what_to_do = 0 Or what_to_do = 1) Then
        If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value <= 0 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(611, 1).Value, 1)
                        do_it = player_char_dies(what_player)
        End If
End If


End Function
Function add_stat(stat As Integer, stat_type As Integer, what_side As Integer, who As Integer)
Dim before As Integer
Dim attacks_before As Integer
Dim armor_before As Integer
Dim vahe As Integer
Dim Influenced_stat_bonus As Integer

before = Sheets("Side" & what_side).Cells(who, stat_type).Value
attacks_before = Sheets("Side" & what_side).Cells(who, 4).Value
armor_before = Sheets("Side" & what_side).Cells(who, 14).Value

Sheets("Side" & what_side).Cells(who, stat_type).Value = Sheets("Side" & what_side).Cells(who, stat_type).Value + stat

vahe = Sheets("Side" & what_side).Cells(who, stat_type).Value - before
        
Influenced_stat_bonus = 0

If stat_type = 11 Then 'str
        
        
        If vahe > 0 Then 'str suurenes
                        If before < 4 Then
                                If Sheets("Side" & what_side).Cells(who, stat_type).Value >= 4 Then
                                        Influenced_stat_bonus = Influenced_stat_bonus + 1
                                End If
                        End If
                        
                        If before < 8 Then
                                If Sheets("Side" & what_side).Cells(who, stat_type).Value >= 8 Then
                                        Influenced_stat_bonus = Influenced_stat_bonus + 1
                                End If
                        End If
                        
                        If before < 12 Then
                                If Sheets("Side" & what_side).Cells(who, stat_type).Value >= 12 Then
                                        Influenced_stat_bonus = Influenced_stat_bonus + 1
                                End If
                        End If
                
        Else        'checkime lahutamist
                        If before >= 4 Then
                                If Sheets("Side" & what_side).Cells(who, stat_type).Value < 4 Then
                                        Influenced_stat_bonus = Influenced_stat_bonus - 1
                                End If
                        End If
                        
                        If before >= 8 Then
                                If Sheets("Side" & what_side).Cells(who, stat_type).Value < 8 Then
                                        Influenced_stat_bonus = Influenced_stat_bonus - 1
                                End If
                        End If
                        
                        If before >= 12 Then
                                If Sheets("Side" & what_side).Cells(who, stat_type).Value < 12 Then
                                        Influenced_stat_bonus = Influenced_stat_bonus - 1
                                End If
                        End If
                
        End If
        
        'here we change armor thanks to str changes
        Sheets("Side" & what_side).Cells(who, 14).Value = Sheets("Side" & what_side).Cells(who, 14).Value + Influenced_stat_bonus
End If

If stat_type = 12 Then 'dex

        If vahe > 0 Then 'dex suurenes
                
                If before < 5 Then
                        If Sheets("Side" & what_side).Cells(who, stat_type).Value >= 5 Then
                                Influenced_stat_bonus = Influenced_stat_bonus + 1
                        End If
                End If
                        
                If before < 10 Then
                        If Sheets("Side" & what_side).Cells(who, stat_type).Value >= 10 Then
                                Influenced_stat_bonus = Influenced_stat_bonus + 1
                        End If
                End If
        Else
                 If before >= 5 Then
                                If Sheets("Side" & what_side).Cells(who, stat_type).Value < 5 Then
                                        Influenced_stat_bonus = Influenced_stat_bonus - 1
                                End If
                        End If
                        
                If before >= 10 Then
                        If Sheets("Side" & what_side).Cells(who, stat_type).Value < 5 Then
                                Influenced_stat_bonus = Influenced_stat_bonus - 1
                        End If
                End If
        End If
        'here we change nr of attacks thanks to influenced stat bonus
        Sheets("Side" & what_side).Cells(who, 4).Value = Sheets("Side" & what_side).Cells(who, 4).Value + Influenced_stat_bonus
End If


End Function


-------------------------------------------------------------------------------
VBA MACRO Leht5.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht5'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet4.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet4'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet10.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet10'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet11.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet11'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module7.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module7'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Function check_build(what_to_do As Integer)
    Dim counter As Integer
    Dim x As Integer
    Dim z As Integer
    Dim R As Integer
    Dim T As Integer
    Dim N As Integer
    Dim Language As Integer
    Dim buttoncounter As Integer
    Dim buildings_built As Integer
    
    buttoncounter = 0
    
    Language = Sheets("Game_data1").Cells(100, 2).Value
    
    counter = 0
    
    If (what_to_do = 2) Then
            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "cancel_to_main", 0, 1)
    End If
    
    Sheets("Game_data1").Cells(105, 2).Value = 0
    
    For x = 1 To 34
        
        If (Sheets("Game_map").Cells(x, 2).Value = Sheets("Game_data1").Cells(10, 2).Value) Then
                
                R = 0
                
                For z = 1 To 34
                
                        If Sheets("Game_map").Cells(x, 1).Value = Sheets("Game_map").Cells(z, 1).Value And Sheets("Game_map").Cells(x, 2).Value <> Sheets("Game_map").Cells(z, 2).Value Then
                            ' doesnt own all the same type buildings
                            R = 1
                            
                        End If
                Next
                
                If Sheets("Game_map").Cells(x, 1).Value = 20 Then
                
                        R = 1
                        
                End If
                
                If (R = 0) Then
                
                        If what_to_do = 1 Then
                                Sheets("Game_data1").Cells(104, 2).Value = 1 'can build.. at least on one street
                        End If
                        
                        If what_to_do = 2 Then
                                
                                
                                ' kood Buildimiseks
                                
                                listi_controllija = 0

                                If (Sheets("Game_data1").Cells(105, 2).Value > 0) Then
                                        For T = 1 To Sheets("Game_data1").Cells(105, 2).Value
                                                If (Sheets("Game_map").Cells(x, 4).Value = Sheets("Nupud").Cells(T, 32).Value) Then
                                                        listi_controllija = 1
                                                End If
                                        Next
                                End If
                                
                                If listi_controllija = 0 Then
                                        Sheets("Game_data1").Cells(105, 2).Value = Sheets("Game_data1").Cells(105, 2).Value + 1
                                        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(105, 2).Value, 32).Value = Sheets("Game_map").Cells(x, 4).Value
                                End If
                                    
                                    
                                    
                                button_not_needed = 0
                                
                                
                                
                                
                                For N = 1 To buttoncounter
                                        If Sheets("Nupud").Cells(N, 40).Value = eesti_nimi(Sheets("Game_map").Cells(x, 4).Value, 2) Then
                                                button_not_needed = 1
                                        End If
                                Next
                                
                                If number_of_buildings_not_built(Sheets("Game_map").Cells(x, 1).Value) = 0 Then
                                        button_not_needed = 1
                                End If
                                
                                If button_not_needed = 0 Then
                                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(441, 1).Value & eesti_nimi(Sheets("Game_map").Cells(x, 4).Value, 2), "Build_" & Sheets("Game_data1").Cells(105, 2).Value, 0, 1)
                                        buttoncounter = buttoncounter + 1
                                        Sheets("Nupud").Cells(buttoncounter, 40).Value = eesti_nimi(Sheets("Game_map").Cells(x, 4).Value, 2)
                                End If
                                
                        End If
                        
                End If
                
        End If
        
    Next
    If (what_to_do = 2) Then
            If buttoncounter = 0 Then
                    do_it = text_Output(Sheets("Lan" & Language).Cells(856, 1).Value, 1)
            End If
    End If
End Function

Function build_fortification(place_nr As Integer)
Dim x As Integer
Dim Rahakontroll As Integer
Dim Total_basic_lands As Integer
Dim y As Integer
Dim max_Buildings As Integer
Dim Land_type As Integer
Dim do_nessesary_buildings_Exist As Integer
Dim already_there As Integer
Dim row_stats_at As Integer
Dim pre_req_building_is_there As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(x, 1).Value

Land_type = find_place_by_name(Sheets("Nupud").Cells(place_nr, 32).Value)
Sheets("Game_data1").Cells(21, 2).Value = 0

Sheets("Game_data1").Cells(231, 2).Value = place_nr
Sheets("Game_data1").Cells(167, 2).Value = Land_type

row_stats_at = 13
max_Buildings = 12
Total_basic_lands = Sheets("Game_data1").Cells(173, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(67, 1).Value, "build_menu", 0, 1)


For y = 1 To max_Buildings

        If Sheets("Map_defaults").Cells(Land_type, row_stats_at + y).Value <> "" Then
                
                do_nessesary_buildings_Exist = 0
                
                'are pre-req buildings met
                
                For x = 1 To 4
                        
                        If Sheets("Buildings").Cells(find_building_by_name(Sheets("Map_defaults").Cells(Land_type, row_stats_at + y).Value), x + 1).Value <> "" Then
                                       
                                pre_req_building_is_there = is_building_built(Sheets("Buildings").Cells(find_building_by_name(Sheets("Map_defaults").Cells(Land_type, row_stats_at + y).Value), x + 1).Value, Land_type)
                                do_nessesary_buildings_Exist = do_nessesary_buildings_Exist + pre_req_building_is_there
                        Else
                                do_nessesary_buildings_Exist = do_nessesary_buildings_Exist + 1
                        End If
                
                Next
                
                If do_nessesary_buildings_Exist = 4 Then
                        already_there = is_building_built(Sheets("Map_defaults").Cells(Land_type, row_stats_at + y).Value, Land_type)
                        If already_there <> 1 Then 'already built
                        'tekitame buttoni
                                
                        Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_data1").Cells(21, 2).Value + 1
                        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(21, 2).Value, 25).Value = Sheets("Map_defaults").Cells(Land_type, row_stats_at + y).Value
                        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(25, 1).Value & " " & Sheets("Map_defaults").Cells(Land_type, row_stats_at + y).Value, "build_building" & Sheets("Game_data1").Cells(21, 2).Value, 0, 1)
                        End If
                End If
                
        End If
        
Next

End Function
Function build_building(mitmes As Integer, Optional true_build As Integer = 0)
Dim ehitatav_Building As String
Dim Land_type As Integer
Dim what_player As Integer
Dim building_cost As Integer
Dim building_succeeded As Integer
Dim one_time_bonus As Integer
Dim ehitatava_Buildingu_nr As Integer
Dim land_Name As String
Dim x As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(x, 1).Value

Sheets("Game_data1").Cells(155, 2).Value = mitmes

what_player = Sheets("Game_data1").Cells(10, 2).Value
Land_type = Sheets("Game_data1").Cells(167, 2).Value
ehitatav_Building = Sheets("Nupud").Cells(Sheets("Game_data1").Cells(155, 2).Value, 25).Value
ehitatava_Buildingu_nr = find_building_by_name(ehitatav_Building)
land_Name = Sheets("Map_defaults").Cells(Land_type, 1).Value

building_cost = Sheets("Buildings").Cells(ehitatava_Buildingu_nr, 6)

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

If true_build = 1 Then
                           
              
        If Sheets("Game_data1").Cells(24 + what_player, 2).Value < building_cost Then
                
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(311, 1).Value, 1)
                building_succeeded = 2
        Else
                                
                do_it = text_Output(Sheets("Lan" & Language).Cells(442, 1).Value, 0)
                do_it = text_Output(eesti_nimi(ehitatav_Building, 1), 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(443, 1).Value, 0)
                do_it = text_Output(" " & eesti_nimi(Sheets("Map_defaults").Cells(Land_type, 2).Value, 6) & ".", 1)
                building_succeeded = 1
                
                'raha vähemaks
                Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - building_cost
                                        
                one_time_bonus = 0
                                        
                For x = 1 To 34
        
                        If Sheets("Game_map").Cells(x, 1).Value = Land_type Then
                                
                                If one_time_bonus = 0 Then
                                        one_time_bonus = 1
                                        do_it = building_bonus_to_player(what_player, land_Name, ehitatava_Buildingu_nr, 1, 1)
                                End If
                                
                                Sheets("Game_map").Cells(x, find_building_slot_in_map(ehitatav_Building)).Value = 1
                                do_it = building_bonus_to_land(x, ehitatava_Buildingu_nr, 1)
                               
                        End If
        
                Next
                
                
        End If
        
Else
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(444, 1).Value & eesti_nimi(ehitatav_Building, 1) & Sheets("Lan" & Language).Cells(443, 1).Value & " " & eesti_nimi(Sheets("Map_defaults").Cells(Land_type, 2).Value, 6), 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(445, 1).Value, 0)
            
                do_it = text_Output(" " & building_cost, 0, 45)
                do_it = text_Output(Sheets("Lan" & Language).Cells(446, 1).Value, 1)
                
                do_it = building_bonus_to_player(what_player, land_Name, ehitatava_Buildingu_nr, 3, 1)
                do_it = building_bonus_to_land(1, ehitatava_Buildingu_nr, 3)
                
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_build", 0, 1)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_build", 0, 1)
                
End If
    
If building_succeeded = 1 Then
    If Sheets("Game_data1").Cells(15, 2).Value <> 1 Then
            Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
    End If
    do_it = Main_turn()
End If

If building_succeeded = 2 Then
    do_it = Main_turn()
End If

End Function
Function number_of_buildings_not_built(Land_type As Integer)
Dim x As Integer

number_of_buildings_not_built = 0

For x = 1 To 12
        If Sheets("Map_defaults").Cells(Land_type, 13 + x).Value <> "" Then
                If is_building_built(Sheets("Map_defaults").Cells(Land_type, 13 + x).Value, Land_type) = 0 Then
                number_of_buildings_not_built = number_of_buildings_not_built + 1
                End If
        End If
Next

a = 1


End Function


Function is_building_built(building_name As String, Land_type As Integer) As Integer
Dim x As Integer
Dim correct_Row As Integer

is_building_built = 0

correct_Row = 1
mitmes_rida_sisaldab_Nime = 35

For x = 1 To 34
        If Sheets("Game_map").Cells(x, 1).Value = Land_type Then
                correct_Row = x
        End If
Next

If Sheets("Game_map").Cells(correct_Row, find_building_slot_in_map(building_name)).Value = 1 Then
        is_building_built = 1
End If

End Function
Function find_building_slot_in_map(building_name As String) As Integer
Dim y As Integer
Dim mitmes_rida_sisaldab_Nime As Integer

mitmes_rida_sisaldab_Nime = 35

For y = 1 To 100
        If Sheets("Game_map").Cells(mitmes_rida_sisaldab_Nime, 17 + y).Value = building_name Then
                find_building_slot_in_map = 17 + y
        End If
Next

End Function
Function find_building_by_name(building_name As String) As Integer

find_building_by_name = 1

Dim x As Integer

For x = 1 To 100 'oletan ei ei tule kunagi üle 100 buildingu
        If building_name = Sheets("Buildings").Cells(x, 1).Value Then
                find_building_by_name = x
        End If
Next

End Function
Function find_place_by_name(place_name As String)
Dim x As Integer
Dim Total_basic_lands As Integer

find_place_by_name = 21
Total_basic_lands = Sheets("Game_data1").Cells(173, 2).Value

For x = 1 To 20 + Total_basic_lands
        If place_name = Sheets("Map_defaults").Cells(x, 1).Value Then
                find_place_by_name = x
        End If
Next

End Function
Function building_bonus_to_player(what_player As Integer, Land_type As String, what_slot As Integer, what_to_do As Integer, Optional text_Out As Integer = 0, Optional text_from_land As Integer = 0, Optional do_not_display_mana = 0)
Dim vahe As String
Dim Total As String
Dim before As Integer
Dim word_color As Integer
Dim stat_type As String
Dim x As Integer
Dim building_name As String
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

building_name = Sheets("Buildings").Cells(what_slot, 1).Value

If text_from_land = 1 Then
        building_name = Land_type
End If

If (what_to_do = 0 Or what_to_do = 1) Then
        'mana regens
        For y = 1 To 7
        
                If Sheets("Buildings").Cells(what_slot, 11 + y).Value <> 0 Then
                        
                        before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value
                        
                        If (what_to_do = 0) Then 'lahutame stati
                                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value - Sheets("Buildings").Cells(what_slot, 11 + y).Value
                        Else                    'liidame stati
                                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value + Sheets("Buildings").Cells(what_slot, 11 + y).Value
                        End If
                        
                        Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value
                
                        If (text_Out = 1) And do_not_display_mana = 0 Then
                                        
                                
                                 If (before > Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value) Then
                                        
                                                vahe = Abs(Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value - before)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(79, 1).Value, 0)
                                                do_it = text_Output(what_damage_type(3 + y), 0, Sheets("Game_data1").Cells(21, 2).Value)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(117, 1).Value, 0)
                                                do_it = text_Output(vahe, 0, 3)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(118, 1).Value, 0)
                                        Else
                                                vahe = Abs(before - Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(79, 1).Value & building_name & Sheets("Lan" & Language).Cells(114, 1).Value & Sheets("Buildings").Cells(what_slot, 11 + y).Value & " ", 0)
                                                do_it = text_Output(what_damage_type(3 + y), 0, Sheets("Game_data1").Cells(21, 2).Value)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(115, 1).Value, 0)
                                        End If
                                        
                                        Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 22 + y).Value
                                        
                                        If Sheets("Buildings").Cells(what_slot, 11 + y).Value <> Total Then
                                        
                                                do_it = text_Output(" (", 0)
                                                do_it = text_Output(Total & " ", 0)
                                                do_it = text_Output(what_damage_type(3 + y), 0, Sheets("Game_data1").Cells(21, 2).Value)
                                                do_it = text_Output(Sheets("Lan" & Language).Cells(116, 1).Value, 1)
                                        
                                        Else
                                                do_it = text_Output(" ", 1)
                                        
                                        End If
                                
                        End If
                
                End If
        Next
        
        For y = 1 To 2
                If Sheets("Buildings").Cells(what_slot, 7 + y).Value <> 0 And Sheets("Buildings").Cells(what_slot, 9 + y).Value = Land_type Then
                'Spell knowledge
                        
                        vahe = find_spell_by_name(Sheets("Buildings").Cells(what_slot, 7 + y).Value)
                        before = Sheets("Spells").Cells(vahe, 2 + what_player).Value
                        
                        If (what_to_do = 0) Then
                              
                              Sheets("Spells").Cells(vahe, 2 + what_player).Value = Sheets("Spells").Cells(vahe, 2 + what_player).Value - 1
                             
                        Else
                              Sheets("Spells").Cells(vahe, 2 + what_player).Value = Sheets("Spells").Cells(vahe, 2 + what_player).Value + 1
                        
                        End If
                        
                        If (text_Out = 1) Then
                        
                                If (before < Sheets("Spells").Cells(vahe, 2 + what_player).Value) Then
                                
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(447, 1).Value, 0)
                                            do_it = text_Output(eesti_nimi(Sheets("Spells").Cells(vahe, 1).Value, 1), 0, 5)
                                            do_it = text_Output(Sheets("Lan" & Language).Cells(448, 1).Value & Sheets("Spells").Cells(vahe, 2 + what_player).Value & Sheets("Lan" & Language).Cells(449, 1).Value, 1)
                                      
                                Else
                                              do_it = text_Output(Sheets("Lan" & Language).Cells(447, 1).Value, 0)
                                              do_it = text_Output(Sheets("Spells").Cells(vahe, 1).Value, 0, 3)
                                              do_it = text_Output(Sheets("Lan" & Language).Cells(450, 1).Value, 1)
                                      
                                End If
                        
                        End If
                
                
                End If
        Next
         'combat round
         If Sheets("Buildings").Cells(what_slot, 24).Value <> 0 Then
                before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value
                
                If (what_to_do = 0) Then 'lahutamne combat roundi ära
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value - Sheets("Buildings").Cells(what_slot, 24).Value
                Else
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value + Sheets("Buildings").Cells(what_slot, 24).Value
                End If
                
                Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value
                
                If (text_Out = 1) Then
                        
                        If (before < Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value) Then
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(451, 1).Value, 0) 'parem kui enne
                                do_it = text_Output(Total, 0, 5)
                                do_it = text_Output(Sheets("Lan" & Language).Cells(452, 1).Value, 1)
                        
                        Else 'halvem kui enne
                            
                                If (Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 4).Value = 1) Then
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(453, 1).Value, 1)
                                Else
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(454, 1).Value, 0)
                                        do_it = text_Output(Total, 0, 3)
                                        do_it = text_Output(Sheets("Lan" & Language).Cells(452, 1).Value, 1)
                                End If
                        
                        End If
                        
                End If
        End If
        
        For y = 0 To 2
                If Sheets("Buildings").Cells(what_slot, 29 + y).Value <> 0 Then
                        
                        before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + y).Value
                        
                        If (what_to_do = 0) Then 'lahutame stati ära
                                
                                'do_it = add_stat(-Sheets("Buildings").Cells(what_slot, 29 + y).Value, 11 + y, what_player, Sheets("Game_data1").Cells(51 + what_player, 2).Value)
                                do_it = change_stats(what_player, 1, 0, text_Out, Sheets("Buildings").Cells(what_slot, 29 + y).Value, 11 + y)
                                'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + y).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + y).Value - Sheets("Buildings").Cells(what_slot, 29 + y).Value
                        Else
                                do_it = change_stats(what_player, 1, 1, text_Out, Sheets("Buildings").Cells(what_slot, 29 + y).Value, 11 + y)
                                'do_it = add_stat(Sheets("Buildings").Cells(what_slot, 29 + y).Value, 11 + y, what_player, Sheets("Game_data1").Cells(51 + what_player, 2).Value)
                                'Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + y).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11 + y).Value + Sheets("Buildings").Cells(what_slot, 29 + y).Value
                                
                        End If
                      
                        
                    
                        
                End If
                               
                
        Next
        
        'spell level bonus
        If Sheets("Buildings").Cells(what_slot, 32).Value <> 0 Then
                before = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 68).Value
                
                If (what_to_do = 0) Then 'lahutame spell level bonus ära
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 68).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 68).Value - Sheets("Buildings").Cells(what_slot, 32).Value
                Else
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 68).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 68).Value + Sheets("Buildings").Cells(what_slot, 32).Value
                End If
                
                Total = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 68).Value
                
                If (text_Out = 1) Then
                                
                        do_it = text_Output(Sheets("Lan" & Language).Cells(945, 1).Value, 0) 'parem kui enne
                        do_it = text_Output(Total, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(946, 1).Value, 1)
                        
                End If
        
        End If
        
End If

If (what_to_do = 3) Then
        For y = 1 To 7
        
                If Sheets("Buildings").Cells(what_slot, 11 + y).Value <> 0 Then
                        do_it = text_Output(building_name & Sheets("Lan" & Language).Cells(455, 1).Value & Sheets("Buildings").Cells(what_slot, 11 + y).Value & " ", 0)
                        do_it = text_Output(what_damage_type(3 + y), 0, Sheets("Game_data1").Cells(21, 2).Value)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(456, 1).Value, 1)
                
                End If
                
        Next
        
         For y = 1 To 2
                If Sheets("Buildings").Cells(what_slot, 7 + y).Value <> 0 And Sheets("Buildings").Cells(what_slot, 9 + y).Value = Land_type Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(457, 1).Value, 0)
                        do_it = text_Output(eesti_nimi(Sheets("Buildings").Cells(what_slot, 7 + y).Value, 1), 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(458, 1).Value, 1)
                End If
        Next
        
        For y = 0 To 2
                If Sheets("Buildings").Cells(what_slot, 29 + y).Value <> 0 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(949, 1).Value, 0)
                        do_it = text_Output("+" & Sheets("Buildings").Cells(what_slot, 29 + y).Value, 0, 9)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(600 + y, 1).Value, 1)
                End If
        Next
        
        If Sheets("Buildings").Cells(what_slot, 24).Value <> 0 Then
        
                Total = Sheets("Buildings").Cells(what_slot, 24).Value
                
                If Sheets("Buildings").Cells(what_slot, 24).Value = 1 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(459, 1).Value, 0)
                        do_it = text_Output(Total, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(460, 1).Value, 1)
                End If
                
                If Sheets("Buildings").Cells(what_slot, 24).Value > 1 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(459, 1).Value, 0)
                        do_it = text_Output(Total, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(461, 1).Value, 1)
                End If
        
        End If
        
        If Sheets("Buildings").Cells(what_slot, 32).Value <> 0 Then
                Total = Sheets("Buildings").Cells(what_slot, 32).Value
                do_it = text_Output(Sheets("Lan" & Language).Cells(947, 1).Value, 0)
                do_it = text_Output(Total, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(948, 1).Value, 1)
        End If
        
End If

End Function



Function building_bonus_to_land(mapdata_Slot As Integer, building_slot As Integer, what_to_do As Integer)
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
        
        
If what_to_do = 1 Then
                
        If Sheets("Buildings").Cells(building_slot, 7).Value <> 0 Then 'fortification level and display on map
                Sheets("Game_map").Cells(mapdata_Slot, 12).Value = Sheets("Game_map").Cells(mapdata_Slot, 12).Value + Sheets("Buildings").Cells(building_slot, 7).Value
        End If
        
        If Sheets("Buildings").Cells(building_slot, 20).Value <> 0 Then 'castle defender
                Sheets("Game_map").Cells(mapdata_Slot, 13).Value = Sheets("Buildings").Cells(building_slot, 20).Value
        End If
        
        If Sheets("Buildings").Cells(building_slot, 19).Value <> 0 Then 'archery slots
                Sheets("Game_map").Cells(mapdata_Slot, 14).Value = Sheets("Game_map").Cells(mapdata_Slot, 14).Value + Sheets("Buildings").Cells(building_slot, 19).Value
        End If
        
        If Sheets("Buildings").Cells(building_slot, 22).Value <> 0 Then 'land healing value bonus
                Sheets("Game_map").Cells(mapdata_Slot, 11).Value = Sheets("Game_map").Cells(mapdata_Slot, 11).Value + Sheets("Buildings").Cells(building_slot, 22).Value
        End If
        
        If Sheets("Buildings").Cells(building_slot, 23).Value <> 0 Then 'land income value bonus
                Sheets("Game_map").Cells(mapdata_Slot, 6).Value = Sheets("Game_map").Cells(mapdata_Slot, 6).Value + Sheets("Buildings").Cells(building_slot, 23).Value
                do_it = Joonista_asukoht(mapdata_Slot, 0, 12)
                do_it = Joonista_asukoht(mapdata_Slot, 0, 10) 'commenti muutus
        End If
        
        If Sheets("Buildings").Cells(building_slot, 21).Value <> 0 Then 'gates
                Sheets("Game_map").Cells(mapdata_Slot, 15).Value = Sheets("Buildings").Cells(building_slot, 21).Value
        End If
        
        If Sheets("Buildings").Cells(building_slot, 25).Value <> 0 Then 'recruitable
                Sheets("Game_map").Cells(mapdata_Slot, 46).Value = Sheets("Buildings").Cells(building_slot, 25).Value
                'how many recruitable at start
                Sheets("Game_map").Cells(mapdata_Slot, 47).Value = Sheets("Game_map").Cells(mapdata_Slot, 47).Value + Sheets("Buildings").Cells(building_slot, 26).Value
        End If
        
'        do_it = Joonista_asukoht(X, 0, 11)
'        Sheets("Game_map").Cells(X, 12).Value = Sheets("Game_map").Cells(X, 12).Value + 1
'        do_it = Joonista_asukoht(X, 0, 12, Sheets("Game_map").Cells(X, 12).Value)
'        do_it = Joonista_asukoht(X, 0, 10)
        
       
        do_it = Joonista_asukoht(mapdata_Slot, 0, 11)
        do_it = Joonista_asukoht(mapdata_Slot, 0, 13, Sheets("Game_map").Cells(mapdata_Slot, 12).Value)
        do_it = Joonista_asukoht(mapdata_Slot, 0, 10)
                
End If

If what_to_do = 3 Then
        
        If Sheets("Buildings").Cells(building_slot, 7).Value <> 0 Then 'fortification level
                do_it = text_Output(Sheets("Lan" & Language).Cells(462, 1).Value, 1)
        End If
        
        If Sheets("Buildings").Cells(building_slot, 19).Value <> 0 Then 'archery slots
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(459, 1).Value & Sheets("Buildings").Cells(building_slot, 19).Value & Sheets("Lan" & Language).Cells(463, 1).Value, 0)
                
                If Sheets("Buildings").Cells(building_slot, 19).Value > 1 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(464, 1).Value, 0)
                Else
                        do_it = text_Output(Sheets("Lan" & Language).Cells(465, 1).Value, 0)
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(466, 1).Value, 1)
        End If
        
        If Sheets("Buildings").Cells(building_slot, 20).Value <> 0 Then 'castle defender
                do_it = text_Output(Sheets("Lan" & Language).Cells(467, 1).Value & Chr(34) & Sheets("Buildings").Cells(building_slot, 20).Value & Chr(34) & ".", 1)
        End If
        
        If Sheets("Buildings").Cells(building_slot, 22).Value <> 0 Then 'land healing value bonus
                do_it = text_Output(Sheets("Lan" & Language).Cells(468, 1).Value & Sheets("Buildings").Cells(building_slot, 22).Value & Sheets("Lan" & Language).Cells(469, 1).Value, 1)
        End If
        
        If Sheets("Buildings").Cells(building_slot, 23).Value <> 0 Then 'land income value bonus
                do_it = text_Output(Sheets("Lan" & Language).Cells(470, 1).Value & Sheets("Buildings").Cells(building_slot, 23).Value & Sheets("Lan" & Language).Cells(471, 1).Value, 1)
        End If
        
        If Sheets("Buildings").Cells(building_slot, 25).Value <> 0 Then 'recruitable
                do_it = text_Output(Sheets("Lan" & Language).Cells(472, 1).Value & Sheets("Buildings").Cells(building_slot, 25).Value & ").", 1)
        End If
        
        If Sheets("Buildings").Cells(building_slot, 27).Value <> 0 Then 'portal
                do_it = text_Output(Sheets("Lan" & Language).Cells(857, 1).Value, 1)
        End If
        
        If Sheets("Buildings").Cells(building_slot, 28).Value <> 0 Then 'bank
                do_it = text_Output(Sheets("Lan" & Language).Cells(858, 1).Value, 1)
        End If

End If

End Function




-------------------------------------------------------------------------------
VBA MACRO Sheet12.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet12'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module8.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module8'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Function active_player_won_battle_and_main_turn_starts()
Dim current_Player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
current_Player = Sheets("Game_data1").Cells(10, 2).Value


If Sheets("Game_data1").Cells(112 + current_Player, 2).Value <> 1 Then
       
        If Sheets("Game_data1").Cells(51, 2).Value = 0 Then
                    
                If Sheets("Game_data1").Cells(190, 2).Value = 9 Then
                        If Sheets("Game_data1").Cells(46 + current_Player, 2).Value < 20 Then
                            do_it = Add_new_mob(current_Player, Sheets("Game_data1").Cells(210, 2).Value)
                            do_it = text_Output(Sheets("Mobs").Cells(Sheets("Game_data1").Cells(210, 2).Value, 1).Value, 0)
                            do_it = text_Output(Sheets("Lan" & Language).Cells(416, 1).Value, 1)
                            do_it = display_mob_stats(Sheets("Game_data1").Cells(210, 2).Value)
                            do_it = mobs_display
                        Else
                           do_it = text_Output(Sheets("Lan" & Language).Cells(412, 1).Value, 1)
                            
                        End If
                End If
                
                If Sheets("Game_data1").Cells(207, 2).Value = 1 Then
                        do_it = make_treasure_Available()
                        Sheets("Game_data1").Cells(190, 2).Value = 0
                        Sheets("Game_data1").Cells(207, 2).Value = 0
                End If
                
        End If
End If

End Function
Function greeting_from_mercenary_camp()
Dim x As Integer
Dim y As Integer
Dim listi_Counter As Integer
Dim z As Integer
Dim bonus As Integer
Dim what_player As Integer
Dim turns As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(x, 1).Value

what_player = Sheets("game_data1").Cells(10, 2).Value
max_mobs = Sheets("game_data1").Cells(185, 2).Value
Sheets("Game_data1").Cells(91, 2).Value = 0
        
bonus = 0
        
If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 1 Then
    bonus = 1
    
        do_it = text_Output(Sheets("Lan" & Language).Cells(301, 1).Value, 1)
    
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 2 Then
    bonus = 2
    
        do_it = text_Output(Sheets("Lan" & Language).Cells(302, 1).Value, 1)
    
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 3 Then
    bonus = 3
    
    If Sheets("Game_data1").Cells(46 + what_player, 2).Value > 1 Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(303, 1).Value, 1)
    Else
        do_it = text_Output(Sheets("Lan" & Language).Cells(304, 1).Value, 1)
    End If
End If

If bonus = 0 Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(300, 1).Value, 1)
End If


For x = 1 To max_mobs
        If (Sheets("mobs").Cells(x, 11).Value) > 0 And 5 + bonus > (Sheets("mobs").Cells(x, 11).Value) Then 'gallantry
             
             If Sheets("mobs").Cells(x, 12).Value > 1 And 9 > Sheets("mobs").Cells(x, 12).Value Then ' obidiance
             
                   If Sheets("mobs").Cells(x, 14).Value > 0 And 4 + bonus > Sheets("mobs").Cells(x, 14).Value Then 'rel.str
                   
                            listi_Counter = listi_Counter + 1
                            Sheets("nupud").Cells(listi_Counter, 9).Value = x
                            
                   End If
             End If
        End If
         
Next

z = Rnd * 2 + bonus 'mitu mobi(Z) temp_listist(arv=listi_counter)> merc_listi

If z > listi_Counter Then
        z = listicounter
End If

If z > 0 Then

        For y = 1 To z 'rnd arv mobe temp_listist

        
                x = Int(Rnd * listi_Counter + 1)
                
                If x > listi_Counter Then
                        x = listi_Counter
                End If
        
                Sheets("nupud").Cells(y, 6).Value = Sheets("nupud").Cells(x, 9).Value
                
                'for how many turns
                turns = Int(Rnd * 4 + 1)
                Sheets("nupud").Cells(y, 8).Value = 5 * turns
                            
                do_it = remove_merc_from_temp_list(x, listi_Counter)
                Sheets("Game_data1").Cells(91, 2).Value = Sheets("Game_data1").Cells(91, 2).Value + 1
                listi_Counter = listi_Counter - 1

        Next

End If

End Function

Function mercenary_camp()
Dim x As Integer
Dim button_string As String
Dim dot_needed As Integer
Dim y As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

dot_needed = 0
button_string = Sheets("Lan" & Language).Cells(305, 1).Value

If Sheets("Game_data1").Cells(91, 2).Value > 0 Then
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(306, 1).Value, 0)
        
        For x = 1 To Sheets("Game_data1").Cells(91, 2).Value
                
                dot_needed = dot_needed + 1
                
                If x = 2 Then
                        dot_needed = 3
                End If
                
                If (dot_needed = 2) Then
                        do_it = text_Output(", ", 0)
                End If
                    
                If (dot_needed = 3) Then
                        do_it = text_Output(", ", 1)
                        dot_needed = 1
                End If
                
                    do_it = Nuppudega_tegeleja(button_string & Sheets("Mobs").Cells(Sheets("Nupud").Cells(x, 6).Value, 1).Value, "Hire_" & x, 0, 1)
                    
                    If x = 1 Then
                        do_it = text_Output(eesti_nimi(Sheets("Mobs").Cells(Sheets("Nupud").Cells(x, 6).Value, 1).Value, 1), 0)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(307, 1).Value, 0)
                        do_it = text_Output(Sheets("Mobs").Cells(Sheets("Nupud").Cells(x, 6).Value, 31).Value * Sheets("nupud").Cells(x, 8).Value * 2, 0, 14)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(308, 1).Value, 0)
                        do_it = text_Output(Sheets("nupud").Cells(x, 8).Value, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(309, 1).Value, 0)
                        
                    Else
                        do_it = text_Output(eesti_nimi(Sheets("Mobs").Cells(Sheets("Nupud").Cells(x, 6).Value, 1).Value, 1), 0)
                        'do_it = text_Output(Sheets("Lan" & Language).Cells(307, 1).Value, 0)
                        do_it = text_Output(" " & Sheets("Mobs").Cells(Sheets("Nupud").Cells(x, 6).Value, 31).Value * Sheets("nupud").Cells(x, 8).Value * 2, 0, 14)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(308, 1).Value, 0)
                        do_it = text_Output(Sheets("nupud").Cells(x, 8).Value, 0, 5)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(309, 1).Value, 0)
                    
                    End If
                       
        Next
        do_it = text_Output(".", 1)
Else

        do_it = text_Output(Sheets("Lan" & Language).Cells(310, 1).Value, 1)
        
End If

End Function
Function hire_mercenary(mitmes As Integer, Optional true_train As Integer = 0)
Dim what_player As Integer
Dim merci_hind As Integer
Dim merci_nr As Integer
Dim x As Integer
Dim merci_contract As Integer
Dim not_enuff_money As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
Sheets("Game_data1").Cells(167, 2).Value = mitmes
what_player = Sheets("Game_data1").Cells(10, 2).Value

merci_nr = Sheets("nupud").Cells(mitmes, 6).Value
merci_contract = Sheets("nupud").Cells(mitmes, 8).Value

merci_hind = Sheets("Mobs").Cells(merci_nr, 31).Value * Sheets("nupud").Cells(mitmes, 8).Value * 2

not_enuff_money = 0
'kõik text tühjaks, kõik nupud minema
do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

'kui kulda pole piisavalt tuleb error-text (pole piisavalt raha)

If true_train = 1 Then

        If Sheets("Game_data1").Cells(24 + what_player, 2).Value < merci_hind Then
                                        
                do_it = text_Output(Sheets("Lan" & Language).Cells(311, 1).Value, 1)
                 not_enuff_money = 1
        Else
                If Sheets("Game_data1").Cells(46 + what_player, 2).Value >= 20 Then
                       do_it = text_Output(Sheets("Lan" & Language).Cells(312, 1).Value, 1)
                Else
                        do_it = Add_new_mob(what_player, merci_nr, 0, merci_contract)
                        Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - merci_hind
                        
                         do_it = text_Output(Sheets("Lan" & Language).Cells(313, 1).Value & eesti_nimi(Sheets("Mobs").Cells(Sheets("Nupud").Cells(mitmes, 6).Value, 1).Value, 1) & Sheets("Lan" & Language).Cells(307, 1).Value, 0)
                         do_it = text_Output(merci_hind & " ", 0, 45)
                         do_it = text_Output(Sheets("Lan" & Language).Cells(315, 1).Value, 0)
                         do_it = text_Output(" " & Sheets("nupud").Cells(mitmes, 8).Value, 0)
                         do_it = text_Output(Sheets("Lan" & Language).Cells(316, 1).Value, 1)
                         
                        'listist maha
                        do_it = remove_merc_from_list(mitmes)
                        
                End If
        
        End If
        
Else
        do_it = text_Output("", 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(317, 1).Value & eesti_nimi(Sheets("Mobs").Cells(Sheets("Nupud").Cells(mitmes, 6).Value, 1).Value, 1) & Sheets("Lan" & Language).Cells(307, 1).Value, 0)
        do_it = text_Output(merci_hind & " ", 0, 45)
        do_it = text_Output(Sheets("Lan" & Language).Cells(318, 1).Value, 0)
        do_it = text_Output(" " & Sheets("nupud").Cells(mitmes, 8).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(316, 1).Value, 1)
        'algab mobi statside displamine
        do_it = display_mob_stats(merci_nr)
        
        Sheets("Game_data1").Cells(167, 2).Value = mitmes
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_hire", 0, 1)
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_hire", 0, 1)

End If

If true_train = 1 Then
    If not_enuff_money = 0 Then
        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
        do_it = Main_turn
    Else
        do_it = Main_turn
    End If
End If

End Function
Function display_mob_stats(merci_nr As Integer)
Dim x As Integer
Dim y As Integer
Dim elemental_counter As Integer
Dim dot_needed As Integer
Dim what_color As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output(Sheets("Mobs").Cells(merci_nr, 1).Value & Sheets("Lan" & Language).Cells(523, 1).Value, 0)
do_it = text_Output(Sheets("mobs").Cells(merci_nr, 2).Value, 0, 22)
do_it = text_Output(Sheets("Lan" & Language).Cells(524, 1).Value & Sheets("Lan" & Language).Cells(525, 1).Value, 0)
do_it = text_Output(Sheets("mobs").Cells(merci_nr, 10).Value, 0, 18)
do_it = text_Output(Sheets("Lan" & Language).Cells(526, 1).Value, 1)

do_it = text_Output(Sheets("Mobs").Cells(merci_nr, 1).Value & Sheets("Lan" & Language).Cells(527, 1).Value, 0)
do_it = text_Output(Sheets("mobs").Cells(merci_nr, 4).Value, 0, 5)
do_it = text_Output("d", 0)
do_it = text_Output(Sheets("mobs").Cells(merci_nr, 5).Value, 0, 5)

If Sheets("mobs").Cells(merci_nr, 3).Value = 1 Then
do_it = text_Output("  " & what_damage_type(Sheets("mobs").Cells(merci_nr, 6).Value, 1) & Sheets("Lan" & Language).Cells(529, 1).Value, 1)
Else
do_it = text_Output("  " & what_damage_type(Sheets("mobs").Cells(merci_nr, 6).Value, 1) & Sheets("Lan" & Language).Cells(530, 1).Value, 0)
do_it = text_Output(Sheets("Lan" & Language).Cells(531, 1).Value, 0)
do_it = text_Output(Sheets("mobs").Cells(merci_nr, 3).Value, 0, 5)
do_it = text_Output(Sheets("Lan" & Language).Cells(532, 1).Value, 1)
End If

'elemental damage

For y = 1 To 4
        If Sheets("mobs").Cells(merci_nr, 40 + y).Value > 0 Then
                elemental_damage_counter = elemental_damage_counter1 + 1
        End If
Next

   dot_needed = elemental_damage_counter - 1

If elemental_damage_counter > 0 Then
        do_it = text_Output(Sheets("mobs").Cells(merci_nr, 1).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(517, 1).Value, 0)

        For y = 1 To 4
        
            If Sheets("mobs").Cells(merci_nr, 40 + y).Value > 0 Then
                    do_it = what_damage_type(3 + y)
                    what_color = Sheets("Game_data1").Cells(21, 2).Value
                    do_it = text_Output(Sheets("mobs").Cells(merci_nr, 40 + y).Value & " ", 0, what_color)
                    do_it = text_Output(what_damage_type(3 + y, 5), 0, what_color)
                    do_it = text_Output(Sheets("Lan" & Language).Cells(542, 1).Value, 0)
                    
                    dot_needed = dot_needed - 1
                    
                    If dot_needed >= 1 Then
                        do_it = text_Output(",", 0)
                    Else
                        do_it = text_Output(".", 1)
                    End If
                        
            End If
        
        Next
        
End If

'str&dex&power
do_it = text_Output(Sheets("Lan" & Language).Cells(533, 1).Value, 0)
do_it = text_Output("(" & Sheets("mobs").Cells(merci_nr, 7).Value & ")", 0, 9) 'str
do_it = text_Output(Sheets("Lan" & Language).Cells(534, 1).Value, 0)
do_it = text_Output("(" & Sheets("mobs").Cells(merci_nr, 8).Value & ")", 0, 9) 'dex
do_it = text_Output(Sheets("Lan" & Language).Cells(535, 1).Value, 0)
do_it = text_Output("(" & Sheets("mobs").Cells(merci_nr, 9).Value & ")", 0, 9) 'power
do_it = text_Output(". ", 1)

If Sheets("mobs").Cells(merci_nr, 32).Value > 0 Then

    do_it = text_Output(Sheets("Lan" & Language).Cells(536, 1).Value, 0)
        
        For x = 1 To Sheets("mobs").Cells(merci_nr, 32).Value
        
            If x > 1 Then
                do_it = text_Output(", ", 0)
            End If
             do_it = text_Output(Sheets("mobs").Cells(merci_nr, 32 + x).Value, 0)
                            
        Next
        do_it = text_Output(".", 1)
End If

End Function
Function remove_merc_from_temp_list(milline_merc_vaja_Removida As Integer, listi_Counter As Integer) As Integer
Dim y As Integer
Dim z As Integer

        If milline_merc_vaja_Removida < listi_Counter Then

                y = listi_Counter - milline_merc_vaja_Removida

                For z = 1 To y
                        Sheets("nupud").Cells(milline_merc_vaja_Removida - 1 + z, 9).Value = Sheets("nupud").Cells(milline_merc_vaja_Removida + z, 9).Value
                Next

        End If


End Function
Function remove_merc_from_list(milline_merc_vaja_Removida As Integer)
Dim y As Integer
Dim z As Integer


        If milline_merc_vaja_Removida < Sheets("Game_data1").Cells(91, 2).Value Then
            
                y = Sheets("Game_data1").Cells(91, 2).Value - milline_merc_vaja_Removida
                              
                For z = 1 To y
                        Sheets("nupud").Cells(milline_merc_vaja_Removida - 1 + z, 6).Value = Sheets("nupud").Cells(milline_merc_vaja_Removida + z, 6).Value
                        Sheets("nupud").Cells(milline_merc_vaja_Removida - 1 + z, 8).Value = Sheets("nupud").Cells(milline_merc_vaja_Removida + z, 8).Value
                Next
                      
        End If
        
        Sheets("Game_data1").Cells(91, 2).Value = Sheets("Game_data1").Cells(91, 2).Value - 1


End Function

Function greeting_from_training_ground()
Dim what_player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(319, 1).Value, 1)

If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 8).Value >= 6 And _
   6 <= Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 9).Value Then

 do_it = text_Output(Sheets("Lan" & Language).Cells(320, 1).Value, 1)
        do_it = text_Output(Sheets("Lan" & Language).Cells(321, 1).Value, 1)
Else
        do_it = text_Output(Sheets("Lan" & Language).Cells(322, 1).Value, 1)
End If
End Function

Function training_ground()
Dim x As Integer
Dim what_player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

If Sheets("Game_data1").Cells(84, 2).Value = 1 Then 'kui on hommik, siis saab treenida (sest võtab terve päeva)


        If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 8).Value < 6 Then
        'str nupu tekitamine
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(323, 1).Value, "Train_str", 0, 1)
        
        End If
        
        If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 9).Value < 6 Then
        
        'dex nupu tekitamine
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(324, 1).Value, "Train_dex", 0, 1)
          
        End If
End If
End Function
Function train_stat(what_stat As Integer, Optional true_train As Integer = 0)
Dim x As Integer
Dim what_player As Integer
Dim statsi_nimi As String
Dim train_cost As Integer
Dim training_succeeded As Integer
Dim free_Training As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
free_Training = 0

what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()


If Sheets("Game_data1").Cells(190, 2).Value = 7 Then
                free_Training = 1
End If
 
 
If what_stat = 1 Then
    statsi_nimi = Sheets("Lan" & Language).Cells(337, 1).Value
End If

If what_stat = 2 Then
    statsi_nimi = Sheets("Lan" & Language).Cells(338, 1).Value
End If

If what_stat = 3 Then
    statsi_nimi = Sheets("Lan" & Language).Cells(339, 1).Value
End If

train_cost = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7 + what_stat).Value * Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7 + what_stat).Value * 5

training_succeeded = 0

If true_train = 1 Then
                           
        If free_Training = 1 Then
                train_cost = 0
        End If
        
        If Sheets("Game_data1").Cells(24 + what_player, 2).Value < train_cost Then
                
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(311, 1).Value, 1)
                        
        Else
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7 + what_stat).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7 + what_stat).Value + 1
                
                do_it = add_stat(1, 10 + what_stat, what_player, Sheets("Game_data1").Cells(51 + what_player, 2).Value)
                   
                If free_Training = 0 Then
                        Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - train_cost
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(325, 1).Value & statsi_nimi & Sheets("Lan" & Language).Cells(326, 1).Value & statsi_nimi & Sheets("Lan" & Language).Cells(327, 1).Value & Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 7 + what_stat).Value & ".", 1)
                training_succeeded = 1
        End If
        
Else
        do_it = text_Output(Sheets("Lan" & Language).Cells(328, 1).Value & eesti_nimi(statsi_nimi, 3), 0)
        
        If free_Training <> 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(299, 1).Value, 0) ' for
            
                do_it = text_Output(" " & train_cost, 0, 45)
                do_it = text_Output(Sheets("Lan" & Language).Cells(329, 1).Value, 1)
        Else
                do_it = text_Output("?", 1)
        End If
        
        
        If what_stat = 1 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(330, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(331, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(332, 1).Value, 1)
        End If
        
        If what_stat = 2 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(333, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(334, 1).Value, 1)
        End If
        
        If what_stat = 3 Then
                do_it = text_Output(Sheets("Lan" & Language).Cells(335, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(336, 1).Value, 1)
        End If
        
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_to_main", 0, 1)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_train_" & what_stat, 0, 1)
End If
       
If training_succeeded = 1 Then
        If what_stat = 1 Then
                do_it = recalculate_damage(what_player, 1)
        End If
        Sheets("Game_data1").Cells(84, 2).Value = 4
End If

If true_train = 1 Then
        do_it = Main_turn
End If

End Function
Function greeting_shrine()
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(340, 1).Value, 1)
do_it = text_Output(Sheets("Lan" & Language).Cells(341, 1).Value, 1)

End Function

Function shrine_heal(Optional true_train As Integer = 0)
Dim what_player As Integer
Dim heal_power As Integer
Dim heal_cost As Integer
Dim x As Integer
Dim healing_bonus As Integer
Dim healing_succeeded As Integer
Dim free_Healing As Integer
Dim player_only_heal As Integer
Dim player_life As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

heal_cost = Sheets("Game_data1").Cells(188, 2).Value
do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

healing_succeeded = 0
healing_bonus = 0
free_Healing = 0
player_only_heal = 0
player_life = 0
what_player = Sheets("Game_data1").Cells(10, 2).Value
player_life = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value

If Sheets("Game_data1").Cells(190, 2).Value = 7 Then
                free_Healing = 1
                player_only_heal = 1
End If

If true_train = 1 Then

        If free_Healing = 1 Then
                heal_cost = 0
        End If

        If Sheets("Game_data1").Cells(24 + what_player, 2).Value < heal_cost Then
                                        
                    do_it = text_Output(Sheets("Lan" & Language).Cells(311, 1).Value, 1)
        Else
                healing_succeeded = 1
                Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value - heal_cost
                heal_power = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 13).Value * 3

                         
                If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value < 100 Then
                        
                        healing_bonus = (3 + (60 + player_life) / (5 + player_life))
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = healing_bonus + heal_power + _
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value
                Else
                
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value + heal_power + healing_bonus
                
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(342, 1).Value, 0)
                do_it = text_Output((heal_power + healing_bonus), 0, 3)
                do_it = text_Output(Sheets("Lan" & Language).Cells(62, 1).Value, 1)
        
                If player_only_heal <> 1 Then
                        'mobide healimine
                        If Sheets("Game_data1").Cells(46 + what_player, 2).Value > 1 Then
                                For x = 1 To Sheets("Game_data1").Cells(46 + what_player, 2).Value
                                        If x = Sheets("Game_data1").Cells(51 + what_player, 2).Value Then
                                        
                                        Else
                                                
                                                heal_power = 6 + Sheets("Side" & what_player).Cells(x, 13).Value * 2
                                                
                                                      
                                                Sheets("Side" & what_player).Cells(x, 2).Value = Sheets("Side" & what_player).Cells(x, 2).Value + heal_power
                                                
                                                If Sheets("Side" & what_player).Cells(x, 2).Value > Sheets("Side" & what_player).Cells(x, 3).Value Then
                                                        Sheets("Side" & what_player).Cells(x, 2).Value = Sheets("Side" & what_player).Cells(x, 3).Value
                                                End If
                                    
                                        End If
                                Next
                
                        End If
                End If
                         
                         
        End If

        
Else
        If free_Healing = 1 Then
       
        do_it = text_Output(Sheets("Lan" & Language).Cells(344, 1).Value, 1)
        
        Else
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(344, 1).Value, 0)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(345, 1).Value, 0)
    
        do_it = text_Output(" " & heal_cost, 0, 45)
        do_it = text_Output(Sheets("Lan" & Language).Cells(381, 1).Value, 1)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(346, 1).Value, 1)
        
        End If
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_heal", 0, 1)
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_heal", 0, 1)

End If

If healing_succeeded = 1 Then
        Sheets("Game_data1").Cells(84, 2).Value = 4
End If

If true_train = 1 Then
        do_it = Main_turn
End If

End Function
Function shrine()
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

If Sheets("Game_data1").Cells(84, 2).Value < 2 Then

'heal rituali  nupu tekitamine
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(347, 1).Value, "shrine_nupp", 0, 1)

End If

End Function

Function greeting_t_island()
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(348, 1).Value, 1)
do_it = vali_event(3)
do_it = execute_event(Sheets("Game_data1").Cells(190, 2).Value)

End Function
Function greeting_dungeon()
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(349, 1).Value, 1)
do_it = vali_event(7)
do_it = execute_event(Sheets("Game_data1").Cells(190, 2).Value)

End Function
Function greeting_cave()
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(350, 1).Value, 1)
do_it = vali_event(5)
do_it = execute_event(Sheets("Game_data1").Cells(190, 2).Value)

End Function
Function dungeon()

do_it = event_in_main_turn(Sheets("Game_data1").Cells(190, 2).Value)

End Function
Function cave()

do_it = event_in_main_turn(Sheets("Game_data1").Cells(190, 2).Value)

End Function

Function t_island()

do_it = event_in_main_turn(Sheets("Game_data1").Cells(190, 2).Value)

End Function
Function vali_event(koht As Integer)

Dim x As Integer
Dim what_player As Integer
Dim mitu_eventi_on_listis As Integer
Dim listi_Counter As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value
Sheets("Game_data1").Cells(215, 2).Value = koht
mitu_eventi_on_listis = Sheets("Game_data1").Cells(92, 2).Value
listi_Counter = 0

'listi tekitamine & bonuste lisamine
For x = 1 To mitu_eventi_on_listis

        If Sheets("event").Cells(x + 1, koht).Value = 1 Then
                
                listi_Counter = listi_Counter + 1
                
                Sheets("nupud").Cells(listi_Counter, 11).Value = Sheets("event").Cells(x + 1, 1).Value 'evendi nimi
                Sheets("nupud").Cells(listi_Counter, 12).Value = Sheets("event").Cells(x + 1, koht + 1).Value 'evendi sanss
        
        End If

Next

'sansu sidumine

x = rolling_odds(listi_Counter, 12)

Sheets("Game_data1").Cells(190, 2).Value = Sheets("Nupud").Cells(x, 11).Value


'override (Temporary)
If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
        Sheets("Game_data1").Cells(190, 2).Value = 10
End If

If Sheets("Game_data1").Cells(190, 2).Value = 12 Then 'choice_event
    Sheets("Game_data1").Cells(215, 2).Value = koht
End If

End Function
Function event_in_main_turn(evendi_nr As Integer)
Dim statsi_nimi As String
Dim what_player As Integer
Dim guardian As String
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
guardian = Sheets("Side5").Cells(1, 1).Value

If evendi_nr = 2 Then
         
         do_it = text_Output(Sheets("Lan" & Language).Cells(351, 1).Value, 1)
         
         do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(352, 1).Value, "fight_ok_guardian", 0, 1)
        
End If

If evendi_nr = 3 Then
        
                do_it = text_Output(Sheets("Lan" & Language).Cells(353, 1).Value, 0)
                do_it = text_Output(" " & LCase(eesti_nimi(Sheets("side5").Cells(1, 1).Value, 3)) & ",", 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(354, 1).Value, 0)
                do_it = text_Output(LCase(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(1, 20).Value, 1).Value, 3)), 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(314, 1).Value, 1)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(352, 1).Value, "fight_ok_guardian", 0, 1)
                   
End If

If evendi_nr = 4 Then 'dexi event

        If Sheets("Game_data1").Cells(84, 2).Value < 3 Then
     
         do_it = text_Output(Sheets("Lan" & Language).Cells(355, 1).Value, 1)
         do_it = text_Output(Sheets("Lan" & Language).Cells(438, 1).Value, 1)
         
         do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(356, 1).Value, "jump_try", 0, 1)
        
                If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value = 2 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(357, 1).Value, 1)
                End If
                
                If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value = 3 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(358, 1).Value, 1)
                End If
                
                If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value > 4 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(359, 1).Value, 1)
                End If
        End If
        

End If

If evendi_nr = 5 Then 'strengthi event
        
         do_it = text_Output(Sheets("Lan" & Language).Cells(360, 1).Value, 1)
         
         If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value < 3 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(361, 1).Value, 1)
         End If
         
         If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value = 3 Then
                             
                do_it = text_Output(Sheets("Lan" & Language).Cells(362, 1).Value, 1)
    
         End If
         
         If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value >= 3 Then
         
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(363, 1).Value, "clear_path", 0, 1)
        
        End If
        
End If


If evendi_nr = 6 Then 'power event
        
         do_it = text_Output(Sheets("Lan" & Language).Cells(364, 1).Value, 1)
         do_it = text_Output(Sheets("Lan" & Language).Cells(404, 1).Value, 1)
         
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(370, 1).Value, "solve_riddle", 0, 1)
        
                If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 13).Value = 2 Then
                        do_it = text_Output(Sheets("Lan" & Language).Cells(357, 1).Value, 1)
                End If

End If

If evendi_nr = 7 Then 'hermiti event
        do_it = text_Output(Sheets("Lan" & Language).Cells(365, 1).Value, 1)
        
        'If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value < 33 Then
        
        If Sheets("Game_data1").Cells(84, 2).Value < 2 Then
        
                do_it = text_Output(Sheets("Lan" & Language).Cells(366, 1).Value, 1)
                
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(367, 1).Value, "shrine_nupp", 0, 1)
                
                'Else
                
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(323, 1).Value, "train_str", 0, 1)
            
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(324, 1).Value, "train_dex", 0, 1)
        
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(368, 1).Value, "train_power", 0, 1)
         
        End If

End If

If evendi_nr = 8 Then 'gain one type mana reg.

        do_it = text_Output(Sheets("Lan" & Language).Cells(369, 1).Value, 1)
        
         do_it = mana_event

End If

If evendi_nr = 9 Then 'free_prisoner
        
         do_it = free_prisoner
         
End If

If evendi_nr = 10 Then 'sage_event
        
         do_it = dip_into_river
         
End If

If evendi_nr = 11 Then 'underground river_event
        
         do_it = sage_train_knowledge
         
End If

If evendi_nr = 12 Then 'valikuga event
        
         do_it = events_directions
         
End If

End Function
Function gen_mana_event()
Dim what_player As Integer
Dim button_string As String
Dim y As Integer
Dim x As Integer
Dim z As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = valiknuppude_Kustutamine
mana_listis_total = 7
button_string = Sheets("Lan" & Language).Cells(371, 1).Value 'drink
what_player = Sheets("Game_data1").Cells(10, 2).Value

For x = 1 To mana_listis_total
        Sheets("nupud").Cells(x, 28).Value = (3 + x)

Next
 
For z = 1 To 3 'temp_mana_listist drink_listi kirjtamine
         
                    x = Int(Rnd * mana_listis_total + 1)
                Sheets("nupud").Cells(z, 29).Value = Sheets("nupud").Cells(x, 28).Value
                mana_listis_total = mana_listis_total - 1
                
                do_it = Nuppudega_tegeleja(button_string & what_damage_type(Sheets("nupud").Cells(z, 29).Value), "drink_" & z, 0, 1)
                
          If mana_listis_total > 4 Then
            
                    For y = 1 To mana_listis_total 'mana_listis_total =7
                        
                        Sheets("nupud").Cells(x - 1 + y, 28).Value = Sheets("nupud").Cells(x + y, 28).Value
                        
                    Next
         End If
        
Next

End Function
Function mana_event()
Dim what_player As Integer
Dim button_string As String
Dim y As Integer
Dim x As Integer
Dim z As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = valiknuppude_Kustutamine
mana_listis_total = 7
button_string = Sheets("Lan" & Language).Cells(371, 1).Value 'drink
what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(372, 1).Value, 1)

For z = 1 To 3
                do_it = Nuppudega_tegeleja(button_string & what_damage_type(Sheets("nupud").Cells(z, 29).Value) & Sheets("Lan" & Language).Cells(439, 1).Value, "drink_" & z, 0, 1)
Next

End Function
Function mana_drink(mitmes As Integer, Optional true_train As Integer = 0)
Dim what_player As Integer
Dim mana_type As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = valiknuppude_Kustutamine

Sheets("Game_data1").Cells(167, 2).Value = mitmes

mana_type = Sheets("Nupud").Cells(mitmes, 29).Value

If true_train = 1 Then
    do_it = text_Output(0, 3)
    do_it = text_Output(Sheets("Lan" & Language).Cells(373, 1).Value, 1)
    do_it = text_Output(Sheets("Lan" & Language).Cells(374, 1).Value, 1)
    do_it = text_Output(Sheets("Lan" & Language).Cells(375, 1).Value, 0)
    do_it = text_Output(what_damage_type(mana_type), 0, Sheets("Game_data1").Cells(21, 2).Value)
    do_it = text_Output(Sheets("Lan" & Language).Cells(376, 1).Value, 1)
    
    Sheets("Game_data1").Cells(190, 2).Value = 0 'evendi reset
    Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 19 + mana_type).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 19 + mana_type).Value + 1

Else
   
    do_it = text_Output(0, 3)
    do_it = text_Output(Sheets("Lan" & Language).Cells(377, 1).Value, 0)
    do_it = text_Output(what_damage_type(mana_type), 0, Sheets("Game_data1").Cells(21, 2).Value)
    do_it = text_Output(Sheets("Lan" & Language).Cells(378, 1).Value, 1)
    
    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_to_main", 0, 1)
    do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_drink", 0, 1)

End If

If true_train = 1 Then
        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
        do_it = Main_turn
End If

End Function

Function treasure_list()

Dim x As Integer
Dim what_player As Integer
Dim button_string As String
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(119, 1).Value
    
    what_player = Sheets("Game_data1").Cells(10, 2).Value
    button_string = Sheets("Lan" & Language).Cells(119, 1).Value
    
If Sheets("Game_data1").Cells(191, 2).Value > 0 Then ' and kings_evendid

            do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(120, 1).Value, "Take_treasure_gold", 0, 1)

End If
    
If Sheets("Game_data1").Cells(189, 2).Value > 0 Then
        'kordus
       For x = 1 To Sheets("Game_data1").Cells(189, 2).Value
                    
                do_it = Nuppudega_tegeleja(button_string & Sheets("Items").Cells(Sheets("Game_data1").Cells(x, 18).Value, 1).Value, "Take_" & x, 0, 1)
                    
        Next
        
End If

End Function
Function Take_item(mitmes_item As Integer, Optional true_take As Integer = 0)
Dim item_tyyp As Integer
Dim what_player As Integer
Dim what_item As Integer
Dim z As Integer
Dim x As Integer
Dim itemi_flag As Integer
Dim Language As Integer
Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
itemi_flag = Sheets("Game_data1").Cells(mitmes_item, 19).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

        Sheets("Game_data1").Cells(167, 2).Value = mitmes_item
        
        If (true_take = 1) Then
                
                If (Sheets("Game_data1").Cells(120 + what_player, 2).Value < 20) Then
                        
                                do_it = text_Output(Sheets("Lan" & Language).Cells(123, 1).Value, 0)
                                do_it = text_Output(LCase(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 18 + what_item).Value, 1).Value, 1)), 0)
                                
                                do_it = text_Output(Sheets("Lan" & Language).Cells(124, 1).Value, 1)
                        
                                ' add item into player inventory
                                 Sheets("Game_data1").Cells(120 + what_player, 2).Value = Sheets("Game_data1").Cells(120 + what_player, 2).Value + 1
                                 Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(120 + what_player, 2).Value, 2 + what_player).Value = Sheets("Game_data1").Cells(mitmes_item, 18).Value
                                 
                                ' and put it right to usable slot when consumable
                                        If (Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 18).Value, 2).Value = 7) Then
                                                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(120 + what_player, 2).Value, 7 + what_player).Value = 7
                                        Else
                                                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(120 + what_player, 2).Value, 7 + what_player).Value = 0
                                        End If
                                
                                'remove item from treasure list
                                If itemi_flag > 0 Then
                                
                                        For z = 1 To Sheets("Game_data1").Cells(189, 2).Value
                                        
                                                For x = 1 To Sheets("Game_data1").Cells(189, 2).Value
                                                        If Sheets("Game_data1").Cells(x, 19).Value = itemi_flag Then
                                                                do_it = remove_item(6, x)
                                                                Exit For
                                                        End If
                                                Next
                                        Next
                                
                                Else
                                        do_it = remove_item(6, mitmes_item)
                                End If
                                
                Else
                
                        do_it = text_Output(Sheets("Lan" & Language).Cells(72, 1).Value, 1)
                
                End If
                
        Else
        
                do_it = text_Output(Sheets("Lan" & Language).Cells(125, 1).Value, 0)
                
                If Language = 1 Then
                        do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 18).Value, 1).Value, 0)
                End If
                
                If Language = 2 Then
                        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 18).Value, 1).Value, 1), 0)
                End If
                
                do_it = text_Output(Sheets("Lan" & Language).Cells(126, 1).Value, 1)
            
                do_it = text_Output(Sheets("Items").Cells(Sheets("Game_data1").Cells(mitmes_item, 18).Value, 1).Value, 0)
                do_it = text_Output(": ", 0)
            
                do_it = change_stats(16, mitmes_item, 3)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(75, 1).Value, "cancel_truetake", 0, 1)
                do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(76, 1).Value, "ok_truetake", 0, 1)
                
        End If


If (mitmes_item = 0) Then
        do_it = Main_turn()
End If

If (true_take = 1) Then
        do_it = Main_turn()
End If

End Function
Function take_gold()
Dim what_player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = text_Output("", 3)
do_it = valiknuppude_Kustutamine()

Sheets("Game_data1").Cells(24 + what_player, 2).Value = Sheets("Game_data1").Cells(24 + what_player, 2).Value + Sheets("Game_data1").Cells(191, 2).Value

        do_it = text_Output(Sheets("Lan" & Language).Cells(379, 1).Value, 1)
        do_it = text_Output(Sheets("Lan" & Language).Cells(380, 1).Value, 0)
        do_it = text_Output(" " & Sheets("Game_data1").Cells(191, 2).Value, 0, 45)
        do_it = text_Output(Sheets("Lan" & Language).Cells(381, 1).Value, 1)
        
Sheets("Game_data1").Cells(191, 2).Value = 0

do_it = Main_turn()

End Function

Function execute_event(evendi_nr As Integer)
Dim days_Counter As Integer
Dim x As Integer
Dim y As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(9, 1).Value
days_Counter = Sheets("Game_data1").Cells(81, 2).Value * 4
Sheets("Game_data1").Cells(189, 2).Value = 0 'itemireset

If evendi_nr = 1 Then '*1.sanss, et player leieb väikese varanduse
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(382, 1).Value, 1)
        
        x = Rnd * 5 + 1
                 
                 If x > 5 Then
                        x = 2
                 Else
                        x = 1
                 End If
                 
        do_it = gen_treasure_gold(x)
        
End If

If evendi_nr = 2 Then '*2.sanss, et player leieb varanduse, mida kaitseb guardian

                do_it = generate_guardian()
         
          If Sheets("Side5").Cells(1, 1).Value = "Black Dragon" Or Sheets("Side5").Cells(1, 1).Value = "Must Draakon" Then
                       do_it = gen_treasure_item(5, 999, 10000, , 1)
                        do_it = gen_treasure_item(5, 500, 10000, , 1)
                       do_it = gen_treasure_gold(4, 1)
          Else
                        
               
                         x = Rnd * 5 + 1
                         
                         If x > 5 Then
                                x = 3
                         Else
                                x = 2
                         End If
                         
                         do_it = gen_treasure_gold(x, 1)
                         
                         x = Rnd * 5 + 1
                         
                         If x > 5 Then
                                y = 2
                         Else
                                y = 1
                         End If
                         
                        For x = 1 To y
                            do_it = gen_treasure_item(1, 100 + days_Counter, 485 + days_Counter, , 1)
                        Next
                 
            End If
                
End If
 
If evendi_nr = 3 Then '*3.sanss, et player astub võitlusesse mobiga, kellel on item


                    do_it = generate_item_guardian()
                
                If Sheets("Side5").Cells(1, 1).Value = "Vampire" Or Sheets("Side5").Cells(1, 1).Value = "Minotaur" Or Sheets("Side5").Cells(1, 1).Value = "Vampiir" Then
                       do_it = gen_treasure_item(5, 301 + days_Counter, 1001 + days_Counter, , 1)
                Else
                        do_it = gen_treasure_item(5, 125 + days_Counter, 550 + days_Counter, , 1)
                End If
                
End If
                
        'adventure event
         
If evendi_nr = 4 Then 'dexi event
        
            do_it = gen_treasure_item(5, , , , 1)
End If

If evendi_nr = 5 Then
        
            do_it = gen_treasure_item(1, , , , 1)
            do_it = gen_treasure_gold(2, 1)
End If

If evendi_nr = 6 Then
            
             x = Int(Rnd * 6 + 1)
             y = Int(Rnd * 6 + 1)
             
                 If x > 4 Then
                        do_it = gen_treasure_item(6, , , , 1)
                        do_it = gen_treasure_item(3, , , , 1)
                        do_it = gen_treasure_gold(3, 1)
                        
                        If y > 4 Then
                                do_it = gen_treasure_item(6, , , , 1)
                        End If
                        
                 Else
                                         
                        do_it = gen_treasure_item(6, , , , 1)
                        do_it = gen_treasure_gold(3, 1)
                        
                        If y > 4 Then
                                do_it = gen_treasure_item(6, , , , 1)
                        End If
                        
                 End If
                 
            
End If

If evendi_nr = 8 Then
        'mana event
            
            do_it = gen_mana_event
            
End If

If evendi_nr = 9 Then
        'free_prisoner
            Sheets("Game_data1").Cells(218, 2).Value = 0
            do_it = meet_prisoner
            
End If

If evendi_nr = 10 Then

            do_it = elemental_river_event
            
End If

If evendi_nr = 11 Then

            do_it = sage_event
            
End If

If evendi_nr = 12 Then
        'valikuga evendid
                do_it = vali_event_for_choice_event()
              
End If
 
End Function
Function generate_guardian()
Dim mobinr As Integer
Dim mobi_nimi As String
Dim x As Integer
Dim what_player As Integer
Dim ruut As Integer
Dim days_Counter As Integer
Dim bonus As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value

days_Counter = Sheets("Game_data1").Cells(81, 2).Value

bonus = 0
        
If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 1 Then
    bonus = 10
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 2 Then
    bonus = 30
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 3 Then
    bonus = 50
End If

If Language = 1 Then

Sheets("Nupud").Cells(1, 11).Value = "Sprite"
Sheets("Nupud").Cells(2, 11).Value = "Skeleton"
Sheets("Nupud").Cells(3, 11).Value = "Clay Golem"
Sheets("Nupud").Cells(4, 11).Value = "Gargoyle"
Sheets("Nupud").Cells(5, 11).Value = "Spider Queen"
Sheets("Nupud").Cells(6, 11).Value = "Wraith"
Sheets("Nupud").Cells(7, 11).Value = "Black Dragon"

End If

If Language = 2 Then

Sheets("Nupud").Cells(1, 11).Value = "Tilluke haldjas"
Sheets("Nupud").Cells(2, 11).Value = "Luukere"
Sheets("Nupud").Cells(3, 11).Value = "Savi Golem"
Sheets("Nupud").Cells(4, 11).Value = "Kivideemon"
Sheets("Nupud").Cells(5, 11).Value = "Troll"
Sheets("Nupud").Cells(6, 11).Value = "Wraith"
Sheets("Nupud").Cells(7, 11).Value = "Must Draakon"

End If


Sheets("Nupud").Cells(1, 12).Value = 175 - (days_Counter + bonus)
Sheets("Nupud").Cells(2, 12).Value = 225 - (days_Counter + bonus)
Sheets("Nupud").Cells(3, 12).Value = 125 - (days_Counter + bonus)
Sheets("Nupud").Cells(4, 12).Value = 100 + bonus
Sheets("Nupud").Cells(5, 12).Value = 90 + bonus
Sheets("Nupud").Cells(6, 12).Value = 15 + days_Counter + bonus
Sheets("Nupud").Cells(7, 12).Value = 0 + days_Counter + bonus

x = rolling_odds(7, 12) '5 - mitu mobi on listis!!

mobinr = find_mob_by_name(Sheets("Nupud").Cells(x, 11).Value)
do_it = Add_new_mob(5, mobinr, 0, 0, 1)

'aktiivne mängija näeb team-5-t (land defenders)
do_it = players_detect_side5(what_player, ruut)
        
do_it = mobs_display()

End Function
Function generate_item_guardian()
Dim mobinr As Integer
Dim mobi_nimi As String
Dim x As Integer
Dim what_player As Integer
Dim ruut As Integer
Dim bonus As Integer
Dim days_Counter As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value

days_Counter = Sheets("Game_data1").Cells(81, 2).Value

bonus = 0
        
If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 1 Then
    bonus = 10
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 2 Then
    bonus = 30
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 3 Then
    bonus = 50
End If

If Language = 1 Then

Sheets("Nupud").Cells(1, 11).Value = "Kobold"
Sheets("Nupud").Cells(2, 11).Value = "Goblin"
Sheets("Nupud").Cells(3, 11).Value = "Dark Elf"
Sheets("Nupud").Cells(4, 11).Value = "Harpy"
Sheets("Nupud").Cells(5, 11).Value = "Gargoyle"
Sheets("Nupud").Cells(6, 11).Value = "Minotaur"
Sheets("Nupud").Cells(7, 11).Value = "Vampire"

End If

If Language = 2 Then

Sheets("Nupud").Cells(1, 11).Value = "Koerakoonlane"
Sheets("Nupud").Cells(2, 11).Value = "Paharett"
Sheets("Nupud").Cells(3, 11).Value = "Varjuhaldjas"
Sheets("Nupud").Cells(4, 11).Value = "Harpüia"
Sheets("Nupud").Cells(5, 11).Value = "Kivideemon"
Sheets("Nupud").Cells(6, 11).Value = "Minotaur"
Sheets("Nupud").Cells(7, 11).Value = "Vampiir"

End If


Sheets("Nupud").Cells(1, 12).Value = 150 - (days_Counter + bonus)
Sheets("Nupud").Cells(2, 12).Value = 220 - (days_Counter + bonus)
Sheets("Nupud").Cells(3, 12).Value = 200 - (days_Counter + bonus)
Sheets("Nupud").Cells(4, 12).Value = 125
Sheets("Nupud").Cells(5, 12).Value = 75
Sheets("Nupud").Cells(6, 12).Value = 2 + (days_Counter + bonus)
Sheets("Nupud").Cells(7, 12).Value = 1 + (days_Counter + bonus)

x = rolling_odds(7, 12) '5 - mitu mobi on listis!!

'aktiivne mängija näeb team-5-t (land defenders)
do_it = players_detect_side5(what_player, ruut)

mobinr = find_mob_by_name(Sheets("Nupud").Cells(x, 11).Value)
do_it = Add_new_mob(5, mobinr, 0, 0, 1)
do_it = mobs_display()

End Function

Function battle_with_guardian()

Dim what_player As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value

Sheets("Game_data1").Cells(207, 2).Value = 1 'battle for treasure is ON

Sheets("Game_data1").Cells(80, 2).Value = 0 'active player vs land

do_it = add_combat(what_player, 5)

do_it = recalculate_combat_order()
do_it = make_shadow_list_of_combatants
do_it = targeting_global()

End Function

Function gen_treasure_gold(treasure_amount As Integer, Optional closed_Treasure As Integer = 0)
Dim x As Integer

x = 0
days_Counter = Sheets("Game_data1").Cells(81, 2).Value
' 1 = small treasure
' 2 = medium treasure
' 3 = large treasure
' 4 = very very huge fortune

If treasure_amount = 1 Then
        x = Int(Rnd * 5 + 3)
        x = x * 10 + days_Counter
End If

If treasure_amount = 2 Then
        x = Int(Rnd * 6 + 7)
        x = x * 10 + days_Counter
End If

If treasure_amount = 3 Then
        x = (Rnd * 9) + 1
        x = x * 10 + 100 + days_Counter
End If

If treasure_amount = 4 Then
        x = (Rnd * 2) + 1
        x = x * 1000 + days_Counter
End If

If closed_Treasure = 0 Then
        Sheets("Game_data1").Cells(191, 2).Value = x
Else
        Sheets("Game_data1").Cells(205, 2).Value = x
End If

End Function
Function gen_treasure_item(treasure_type As Integer, Optional min_Value As Integer = 21, Optional max_Value As Integer = 10000, Optional flag As Integer = 0, Optional closed_Treasure = 0, Optional item_type_Override As Integer = 0)
Dim x As Integer
Dim item_Type As Integer

' 1 = random treasure (saab muuta optional optioneid muutes)
' 2= potions only
' 3= scrolls and other mage stuff
' 4= weapons only
' 5= smity stuff
' 6= scrolls only
'reseting

If item_type_Override > 0 Then
        
        item_Type = random_itemtype_based_on_value(min_Value, max_Value, item_type_Override)
Else


        If treasure_type = 1 Then
                item_Type = random_itemtype_based_on_value(min_Value, max_Value)
        End If
        
        If treasure_type = 2 Then
                item_Type = random_itemtype_based_on_value(min_Value, max_Value, 8)
        End If
        
        If treasure_type = 3 Then
                item_Type = random_itemtype_based_on_value(min_Value, max_Value, 7, 8, 9)
        End If
        
        If treasure_type = 4 Then
                item_Type = random_itemtype_based_on_value(min_Value, max_Value, 1, 2, 3)
        End If
        
        If treasure_type = 5 Then
                item_Type = random_itemtype_based_on_value(min_Value, max_Value, 1, 2, 3, 4, 5, 6)
        End If
        
        If treasure_type = 6 Then
                item_Type = random_itemtype_based_on_value(min_Value, max_Value, 9)
        End If

End If

If closed_Treasure = 0 Then
        Sheets("Game_data1").Cells(189, 2).Value = Sheets("Game_data1").Cells(189, 2).Value + 1
        Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 18).Value = create_item(item_Type, min_Value, max_Value)
        Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 19).Value = flag
End If

If closed_Treasure = 1 Then
        Sheets("Game_data1").Cells(206, 2).Value = Sheets("Game_data1").Cells(206, 2).Value + 1
        Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(206, 2).Value, 20).Value = create_item(item_Type, min_Value, max_Value)
        
End If

End Function
Function jump_for_treasure()
Dim x As Integer
Dim y As Integer
Dim what_player As Integer
Dim kukub_sisse As Integer
Dim dex As Integer
Dim if_dex As Integer
Dim z As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(362, 1).Value
kukub_sisse = 0
what_player = Sheets("Game_data1").Cells(10, 2).Value
do_it = text_Output("", 3)

dex = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 19).Value

If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value >= 4 Then
        do_it = text_Output(Sheets("Lan" & Language).Cells(383, 1).Value, 1)
Else
        
                x = Int(Rnd * 4 + 1)
        
                If x <= Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value Then
                'raskem hüppab üle
                do_it = text_Output(Sheets("Lan" & Language).Cells(384, 1).Value, 1)
                do_it = text_Output(Sheets("Lan" & Language).Cells(385, 1).Value, 1)
                
                     if_dex = 4 - dex
        
                        If if_dex > 0 Then 'rnd dex add
                                z = Int(Rnd * (10 - (if_dex + if_dex)) + 1)
                                
                                If z < 2 Then 'dex+1
                                          do_it = text_Output(Sheets("Lan" & Language).Cells(386, 1).Value, 1)
                                         Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 9).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 9).Value + 1
                                         Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value + 1
                                End If
                        End If
                
                Else
                        kukub_sisse = 1
                        
                End If
        
End If

If kukub_sisse = 1 Then
'kukub sisse
        do_it = text_Output(Sheets("Lan" & Language).Cells(384, 1).Value, 1)
        do_it = text_Output(Sheets("Lan" & Language).Cells(388, 1).Value, 1)
        do_it = text_Output(Sheets("Lan" & Language).Cells(389, 1).Value, 1)
                
      '  y = 25 - (Rnd * 7) + Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 12).Value + Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value
         y = Int(Rnd * 7) + Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value / 3
         
        If y > 0 Then
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value - y
                do_it = text_Output(Sheets("Lan" & Language).Cells(390, 1).Value, 0)
                do_it = text_Output(" " & y, 0, 3)
                do_it = text_Output(Sheets("Lan" & Language).Cells(391, 1).Value, 1)
        
        End If
        
        If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value <= 0 Then
                do_it = player_char_dies(what_player)
                do_it = text_Output(Sheets("Lan" & Language).Cells(392, 1).Value, 1)
        End If
        
        Sheets("Game_data1").Cells(84, 2).Value = 4
Else
        do_it = make_treasure_Available()
        
End If

Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
Sheets("Game_data1").Cells(190, 2).Value = 0

do_it = Main_turn()

End Function
Function make_treasure_Available()
Dim x As Integer

        Sheets("Game_data1").Cells(191, 2).Value = Sheets("Game_data1").Cells(191, 2).Value + Sheets("Game_data1").Cells(205, 2).Value
        Sheets("Game_data1").Cells(205, 2).Value = 0
      
        For x = 1 To Sheets("Game_data1").Cells(206, 2).Value
                Sheets("Game_data1").Cells(189, 2).Value = Sheets("Game_data1").Cells(189, 2).Value + 1
                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 18).Value = Sheets("Game_data1").Cells(x, 20).Value
                Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 19).Value = 0
        Next
        Sheets("Game_data1").Cells(206, 2).Value = 0
End Function
Function str_event()
Dim x As Integer
Dim y As Integer
Dim what_player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output("", 3)

what_player = Sheets("Game_data1").Cells(10, 2).Value

If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value >= 4 Then
       
        do_it = text_Output(Sheets("Lan" & Language).Cells(393, 1).Value, 1)
        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(394, 1).Value, 1)
        
        do_it = make_treasure_Available()
        
        Sheets("Game_data1").Cells(190, 2).Value = 0
        
End If

If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 11).Value = 3 Then
                    
        x = Int(Rnd * 2 + 1)
        
        y = Int(Rnd * 7 + 1)
        
                If y > Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value Then
                        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = 1
                End If
                
        Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value - y
                do_it = text_Output(Sheets("Lan" & Language).Cells(390, 1).Value, 0)
                do_it = text_Output(" " & y, 0, 3)
                do_it = text_Output(Sheets("Lan" & Language).Cells(391, 1).Value, 1)
        
        If x = 1 Then
       
        do_it = text_Output(Sheets("Lan" & Language).Cells(395, 1).Value, 1)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(396, 1).Value, 1)
        do_it = make_treasure_Available()
        
        Sheets("Game_data1").Cells(190, 2).Value = 0
        
        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 2
        
        Else
                 do_it = text_Output(Sheets("Lan" & Language).Cells(397, 1).Value, 1)
                Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 3
                
        End If

End If

do_it = Main_turn()

End Function

Function power_event()
Dim what_player As Integer
Dim y As Integer
Dim x As Integer
Dim power As Integer
Dim if_power As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output("", 3)

what_player = Sheets("Game_data1").Cells(10, 2).Value
power = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 10).Value
                
                x = Int(Rnd * 4 + 1)
                
If x <= Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 13).Value Then
       
       
            do_it = text_Output(Sheets("Lan" & Language).Cells(398, 1).Value, 1)
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(399, 1).Value, 1)
        
        do_it = make_treasure_Available()
       
        Sheets("Game_data1").Cells(190, 2).Value = 0
        
            if_power = 5 - power
        
        If if_power > 0 Then 'rnd power add
                z = Int(Rnd * (10 - (if_power + if_power)) + 1)
                
                If z < 2 Then 'power+1
                          do_it = text_Output(Sheets("Lan" & Language).Cells(400, 1).Value, 1)
                         Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 10).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 10).Value + 1
                         Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 13).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 13).Value + 1
                End If
        End If
        
Else
        ' trap activated
        do_it = text_Output(Sheets("Lan" & Language).Cells(401, 1).Value, 1)
        y = Int(Rnd * 10) + Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value / 4
        
        Sheets("Game_data1").Cells(190, 2).Value = 0
        
        If y > 0 Then
                Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value - y
                do_it = text_Output(Sheets("Lan" & Language).Cells(402, 1).Value, 0)
                do_it = text_Output(" " & y, 0, 3)
                do_it = text_Output(Sheets("Lan" & Language).Cells(403, 1).Value, 1)
       
        End If
        
        'surma kontroll
        If Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value <= 0 Then
                do_it = player_char_dies(what_player)
                do_it = text_Output(Sheets("Lan" & Language).Cells(392, 1).Value, 1)
        End If
        
End If

Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1

do_it = Main_turn()

End Function
Function kings_gift(title_to_control As Integer)
Dim what_player As Integer
Dim y As Integer
Dim x As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

'player saab valida kolme itemi vahel
'on ground list 0
'baron list 1
'count llist 2
'duke list 3

do_it = text_Output(Sheets("Lan" & Language).Cells(405, 1).Value, 1)
do_it = text_Output(Sheets("Lan" & Language).Cells(406, 1).Value, 1)

'Sheets("Game_data1").Cells(192, 2).Value = 1 'triggerib king_gifti_evendi

If title_to_control = 1 Then 'barons_gift

do_it = kings_item_selection(50, 120, 1)

End If

If title_to_control = 2 Then 'counts_gift

do_it = kings_item_selection(121, 300, 2)

End If

If title_to_control = 3 Then 'dukes_gift

do_it = kings_item_selection(301, 1000, 3)

End If

End Function

Function kings_item_selection(Optional min_Value As Integer = 50, Optional max_Value As Integer = 300, Optional quest_type As Integer = 1)
Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim check As Integer

'counter reset
Sheets("Game_data1").Cells(21, 2).Value = 0

For x = 1 To 9 'itemite arv

        check = random_itemtype_based_on_value(min_Value, max_Value, x)
        If check > 0 Then
            Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_data1").Cells(21, 2).Value + 1
            Sheets("nupud").Cells(Sheets("Game_data1").Cells(21, 2).Value, 28).Value = check
        End If

Next

For z = 1 To 3 'kingsi_poolt_antavate_itemite arv

           y = Int(Rnd * Sheets("Game_data1").Cells(21, 2).Value + 1)
        
        do_it = gen_treasure_item(0, min_Value, max_Value, quest_type, 0, Sheets("nupud").Cells(y, 28).Value)
                
        do_it = remove_kings_item_from_list(y)
        
Next

End Function
Function remove_kings_item_from_list(milline_merc_vaja_Removida As Integer)
Dim y As Integer
Dim z As Integer

If milline_merc_vaja_Removida < Sheets("Game_data1").Cells(21, 2).Value Then

                y = Sheets("Game_data1").Cells(21, 2).Value - milline_merc_vaja_Removida

        For z = 1 To y
                Sheets("nupud").Cells(milline_merc_vaja_Removida - 1 + z, 28).Value = Sheets("nupud").Cells(milline_merc_vaja_Removida + z, 28).Value
                
        Next

End If
        
Sheets("Game_data1").Cells(21, 2).Value = Sheets("Game_data1").Cells(21, 2).Value - 1
        
End Function
Function meet_prisoner()
Dim what_player As Integer
Dim mobinr As Integer
Dim mobi_nimi As String
Dim y As Integer
Dim x As Integer
Dim days_Counter As Integer
Dim bonus As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
days_Counter = Sheets("Game_data1").Cells(81, 2).Value

ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
    x = Int(Rnd * 2)
Sheets("Nupud").Cells(1, 29).Value = x

bonus = 0
        
If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 1 Then
    bonus = 10
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 2 Then
    bonus = 25
End If

If Sheets("Game_data1").Cells(124 + what_player, 2).Value = 3 Then
    bonus = 40
End If

'prisoneri genereerimine
If Language = 1 Then
    Sheets("Nupud").Cells(1, 11).Value = "Apprentice"
    Sheets("Nupud").Cells(2, 11).Value = "Cadet"
    Sheets("Nupud").Cells(3, 11).Value = "Dwarf"
    Sheets("Nupud").Cells(4, 11).Value = "Swordman"
    Sheets("Nupud").Cells(5, 11).Value = "Ranger"
    Sheets("Nupud").Cells(6, 11).Value = "Knight"
    Sheets("Nupud").Cells(7, 11).Value = "Dervis"
    Sheets("Nupud").Cells(8, 11).Value = "Warchief"
    Sheets("Nupud").Cells(9, 11).Value = "Mage"
    Sheets("Nupud").Cells(10, 11).Value = "Druid"
End If

If Language = 2 Then
    Sheets("Nupud").Cells(1, 11).Value = "Maagi õpilane"
    Sheets("Nupud").Cells(2, 11).Value = "Kadett"
    Sheets("Nupud").Cells(3, 11).Value = "Päkapikk"
    Sheets("Nupud").Cells(4, 11).Value = "Mõõgamees"
    Sheets("Nupud").Cells(5, 11).Value = "Metsavaht"
    Sheets("Nupud").Cells(6, 11).Value = "Rüütel"
    Sheets("Nupud").Cells(7, 11).Value = "Dervish"
    Sheets("Nupud").Cells(8, 11).Value = "Sõjapealik"
    Sheets("Nupud").Cells(9, 11).Value = "Maag"
    Sheets("Nupud").Cells(10, 11).Value = "Druiid"
End If
Sheets("Nupud").Cells(1, 12).Value = 100 - (days_Counter + bonus)
Sheets("Nupud").Cells(2, 12).Value = 80 - (days_Counter + bonus)
Sheets("Nupud").Cells(3, 12).Value = 150 - (days_Counter + bonus)
Sheets("Nupud").Cells(4, 12).Value = 100 - (days_Counter + bonus)
Sheets("Nupud").Cells(5, 12).Value = 75 - days_Counter
Sheets("Nupud").Cells(6, 12).Value = 15 + (days_Counter + bonus)
Sheets("Nupud").Cells(7, 12).Value = 15 + (days_Counter + bonus)
Sheets("Nupud").Cells(8, 12).Value = 15 + (days_Counter + bonus)
Sheets("Nupud").Cells(9, 12).Value = 15 + (days_Counter + bonus)
Sheets("Nupud").Cells(10, 12).Value = 5 + (days_Counter + bonus)

y = rolling_odds(10, 12) ' - mitu mobi on listis!!

mobinr = find_mob_by_name(Sheets("Nupud").Cells(y, 11).Value)
Sheets("Game_data1").Cells(210, 2).Value = mobinr

If x = 0 Then
    do_it = generate_prison_guardian
    mobi_nimi = Sheets("Mobs").Cells(Sheets("Game_data1").Cells(209, 2).Value, 1).Value
    do_it = text_Output(Sheets("Lan" & Language).Cells(407, 1).Value & mobi_nimi & " !", 1)
Else
    do_it = text_Output(Sheets("Lan" & Language).Cells(408, 1).Value, 1)
    do_it = text_Output(Sheets("Lan" & Language).Cells(409, 1).Value, 1)
End If


End Function
Function free_prisoner()
Dim what_player As Integer
Dim y As Integer
Dim x As Integer
Dim mobi_nimi As String
Dim mobinr As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

mobinr = Sheets("Game_data1").Cells(210, 2).Value
mobi_nimi = Sheets("Mobs").Cells(Sheets("Game_data1").Cells(210, 2).Value, 1).Value

x = Sheets("Nupud").Cells(1, 29).Value

If x = 1 Then
    'tekib nupp: dispel magic
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(410, 1).Value, "dispel_try", 0, 1)
End If

If x = 0 Then
    'tekib nupp: fight guardian
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(411, 1).Value, "fight_ok_guardian", 0, 1)
End If

do_it = text_Output(Sheets("Lan" & Language).Cells(412, 1).Value, 0)
do_it = text_Output(mobi_nimi, 0)
do_it = text_Output(Sheets("Lan" & Language).Cells(413, 1).Value, 1)

End Function
Function generate_prison_guardian()
Dim mobinr As Integer
Dim mobi_nimi As String
Dim x As Integer
Dim what_player As Integer
Dim ruut As Integer
Dim days_Counter As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
days_Counter = Sheets("Game_data1").Cells(81, 2).Value

If Language = 1 Then

    Sheets("Nupud").Cells(1, 11).Value = "Stone Golem"
    Sheets("Nupud").Cells(2, 11).Value = "Clay Golem"
    Sheets("Nupud").Cells(3, 11).Value = "Werewolf"
    Sheets("Nupud").Cells(4, 11).Value = "Gargoyle"
    Sheets("Nupud").Cells(5, 11).Value = "Spider Queen"
    Sheets("Nupud").Cells(6, 11).Value = "Demon"
    
End If

If Language = 2 Then

    Sheets("Nupud").Cells(1, 11).Value = "Kivi Golem"
    Sheets("Nupud").Cells(2, 11).Value = "Savi Golem"
    Sheets("Nupud").Cells(3, 11).Value = "Libahunt"
    Sheets("Nupud").Cells(4, 11).Value = "Kivideemon"
    Sheets("Nupud").Cells(5, 11).Value = "Troll"
    Sheets("Nupud").Cells(6, 11).Value = "Deemon"
    
End If

Sheets("Nupud").Cells(1, 12).Value = 100 - days_Counter
Sheets("Nupud").Cells(2, 12).Value = 150 - days_Counter
Sheets("Nupud").Cells(3, 12).Value = 10 + days_Counter
Sheets("Nupud").Cells(4, 12).Value = 50
Sheets("Nupud").Cells(5, 12).Value = 75
Sheets("Nupud").Cells(6, 12).Value = 1 + days_Counter

x = rolling_odds(6, 12) '5 - mitu mobi on listis!!

mobinr = find_mob_by_name(Sheets("Nupud").Cells(x, 11).Value)
do_it = Add_new_mob(5, mobinr)
do_it = mobs_display()
Sheets("Game_data1").Cells(209, 2).Value = mobinr

'aktiivne mängija näeb team-5-t (land defenders)
do_it = players_detect_side5(what_player, ruut)

End Function
Function dispel_try()
Dim what_player As Integer
Dim y As Integer
Dim x As Integer
Dim mobi_nimi As String
Dim mobinr As Integer
Dim dispel_result As Integer
Dim power As Integer
Dim Barrier As Integer
Dim x_counter As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output("", 3)
 
x_counter = Sheets("Game_data1").Cells(218, 2).Value
Barrier = 100
what_player = Sheets("Game_data1").Cells(10, 2).Value
mobi_nimi = Sheets("Mobs").Cells(Sheets("Game_data1").Cells(210, 2).Value, 1).Value
power = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 13).Value
'dispel _rollime (sõltuvalt powerist chance to succsess)

Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
If power >= 3 Then
    x = Int(Rnd * 18 + power * 7)
Else
    x = Int(Rnd * 11 + ((power + 1)) * (power + 1))
End If

x_counter = x_counter + x

Sheets("Game_data1").Cells(218, 2).Value = x_counter

If x_counter >= 100 Then  'succsessful
    do_it = text_Output(Sheets("Lan" & Language).Cells(414, 1).Value, 1)
    Sheets("Game_data1").Cells(84, 2).Value = 4
    
        If Sheets("Game_data1").Cells(46 + what_player, 2).Value > 19 Then
            
            do_it = text_Output(Sheets("Lan" & Language).Cells(415, 1).Value, 1)
        Else
            do_it = Add_new_mob(what_player, Sheets("Game_data1").Cells(210, 2).Value)
                            do_it = text_Output(mobi_nimi, 0)
                            do_it = text_Output(Sheets("Lan" & Language).Cells(416, 1).Value, 1)
                            do_it = display_mob_stats(Sheets("Game_data1").Cells(210, 2).Value)
        End If

    
End If

If x_counter < 100 Then
    do_it = text_Output(Sheets("Lan" & Language).Cells(417, 1).Value, 0)
    do_it = text_Output("(" & x_counter & "/" & Barrier & ")", 1)
End If

do_it = Main_turn

End Function

Function events_directions()
Dim Directions As Integer
Dim what_player As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value
'Sheets("Lan" & Language).Cells(413, 1).Value
what_player = Sheets("Game_data1").Cells(10, 2).Value

Directions = Sheets("Game_data1").Cells(216, 2).Value

do_it = events_directions_output

If Directions = 1 Then
       
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(418, 1).Value, "events_Choice_one", 0, 1)
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(419, 1).Value, "events_Choice_two", 0, 1)
    
End If

If Directions = 2 Then

        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(418, 1).Value, "events_Choice_one", 0, 1)
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(420, 1).Value, "events_Choice_two", 0, 1)

End If

If Directions = 3 Then
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(420, 1).Value, "events_Choice_one", 0, 1)
        
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(419, 1).Value, "events_Choice_two", 0, 1)

End If

End Function
Sub test()
    do_it = vali_event_for_choice_event
End Sub
Function vali_event_for_choice_event()
Dim x As Integer
Dim what_player As Integer
Dim mitu_eventi_on_listis As Integer
Dim listi_Counter As Integer
Dim tyyp_Counter As Integer
Dim y As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value
mitu_eventi_on_listis = Sheets("Game_data1").Cells(92, 2).Value - 1
koht = Sheets("Game_data1").Cells(215, 2).Value

x = Int(Rnd * 3 + 1)

Sheets("Game_data1").Cells(216, 2).Value = x 'directions

'mitu_eventi_on_listis = Sheets("Game_data1").Cells(92, 2).Value
listi_Counter = 0

'listi tekitamine & bonuste lisamine
For x = 1 To mitu_eventi_on_listis 'lahutadud choice event

    If Sheets("event").Cells(x + 1, koht).Value = 1 Then
                
            listi_Counter = listi_Counter + 1
                
             Sheets("nupud").Cells(listi_Counter, 33).Value = Sheets("event").Cells(x + 1, 1).Value 'evendi nimi
             Sheets("nupud").Cells(listi_Counter, 34).Value = Sheets("event").Cells(x + 1, koht + 1).Value 'evendi roll
             Sheets("nupud").Cells(listi_Counter, 35).Value = Sheets("event").Cells(x + 1, 10).Value 'evendi tyyp
        
    End If

Next
x = rolling_odds(listi_Counter, 34)
y = rolling_odds(listi_Counter, 34)

If y = x Then
    y = rolling_odds(listi_Counter, 34)
End If

Sheets("Game_data1").Cells(213, 2).Value = Sheets("Nupud").Cells(x, 33).Value
Sheets("Game_data1").Cells(213, 3).Value = Sheets("Nupud").Cells(x, 35).Value

Sheets("Game_data1").Cells(214, 2).Value = Sheets("Nupud").Cells(y, 33).Value
Sheets("Game_data1").Cells(214, 3).Value = Sheets("Nupud").Cells(y, 35).Value


'do_it = events_directions
'do_it = events_directions_output

End Function
Function events_directions_output()
Dim what_player As Integer
Dim Choice_one As Integer
Dim Choice_two As Integer
Dim Choice_output1 As String
Dim Choice_output2 As String
Dim Directions As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
Choice_one = Sheets("Game_data1").Cells(213, 3).Value
Choice_two = Sheets("Game_data1").Cells(214, 3).Value
Directions = Sheets("Game_data1").Cells(216, 2).Value

If Choice_one = 1 Then
  Choice_output1 = Sheets("Lan" & Language).Cells(421, 1).Value
End If

If Choice_one = 2 Then
  Choice_output1 = Sheets("Lan" & Language).Cells(422, 1).Value
End If
If Choice_one = 3 Then
  Choice_output1 = Sheets("Lan" & Language).Cells(423, 1).Value
End If
If Choice_one = 4 Then
  Choice_output1 = Sheets("Lan" & Language).Cells(424, 1).Value
End If

If Choice_two = 1 Then
  Choice_output2 = Sheets("Lan" & Language).Cells(421, 1).Value
End If

If Choice_two = 2 Then
  Choice_output2 = Sheets("Lan" & Language).Cells(422, 1).Value
End If
If Choice_two = 3 Then
  Choice_output2 = Sheets("Lan" & Language).Cells(423, 1).Value
End If
If Choice_two = 4 Then
  Choice_output2 = Sheets("Lan" & Language).Cells(424, 1).Value
End If

If Directions = 1 Then

    do_it = text_Output(Sheets("Lan" & Language).Cells(425, 1).Value & Choice_output1, 1)
    do_it = text_Output(Sheets("Lan" & Language).Cells(426, 1).Value & Choice_output2, 1)
    
End If

If Directions = 2 Then

    do_it = text_Output(Sheets("Lan" & Language).Cells(425, 1).Value & Choice_output1, 1)
    do_it = text_Output(Sheets("Lan" & Language).Cells(427, 1).Value & Choice_output2, 1)
    
End If

If Directions = 3 Then

    do_it = text_Output(Sheets("Lan" & Language).Cells(427, 1).Value & Choice_output1, 1)
    do_it = text_Output(Sheets("Lan" & Language).Cells(426, 1).Value & Choice_output2, 1)
    
End If

End Function
Function events_Choice_one()
Dim what_player As Integer
Dim Choice_one As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value
Choice_one = Sheets("Game_data1").Cells(213, 2).Value

do_it = valiknuppude_Kustutamine

Sheets("Game_data1").Cells(190, 2).Value = Choice_one

 do_it = text_Output(" ", 3) ' teksti kustutamine

do_it = execute_event(Choice_one)
'do_it = event_in_main_turn(Choice_one)
do_it = Main_turn

End Function

Function events_Choice_two()
Dim Choice_two As Integer
Dim what_player As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value
Choice_two = Sheets("Game_data1").Cells(214, 2).Value

do_it = valiknuppude_Kustutamine

Sheets("Game_data1").Cells(190, 2).Value = Choice_two

do_it = text_Output(" ", 3) ' teksti kustutamine

do_it = execute_event(Choice_two)
'do_it = event_in_main_turn(Choice_two)
do_it = Main_turn

End Function
Function sage_train_knowledge()
Dim what_player As Integer
Dim spell1 As Integer
Dim spell2 As Integer
Dim spell3 As Integer
Dim x As Integer
Dim y As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(429, 1).Value, 1)
do_it = text_Output(Sheets("Lan" & Language).Cells(430, 1).Value, 1)

do_it = valiknuppude_Kustutamine()

spell1 = Sheets("nupud").Cells(1, 36).Value
spell2 = Sheets("nupud").Cells(2, 36).Value
spell3 = Sheets("nupud").Cells(3, 36).Value

For x = 1 To 3

        y = Sheets("nupud").Cells(x, 36).Value
        do_it = Nuppudega_tegeleja(Sheets("Lan" & Language).Cells(428, 1).Value & Sheets("Spells").Cells(y, 1).Value & Sheets("Lan" & Language).Cells(440, 1).Value, "train_spell_f_" & y, 0, 1)
        
Next

End Function
Function sage_event()

Dim what_player As Integer
Dim spell_1 As Integer
Dim spell_2 As Integer
Dim spell_3 As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
total_spells = Sheets("Game_data1").Cells(186, 2).Value '37


spell_1 = Int(Rnd * 8 + 1) '1-8
Sheets("nupud").Cells(1, 36).Value = spell_1
spell_2 = Int(Rnd * 8 + 9) '9-16
Sheets("nupud").Cells(2, 36).Value = spell_2
spell_3 = Int(Rnd * 8 + 18) '17-25
Sheets("nupud").Cells(3, 36).Value = spell_3

End Function
Function elemental_river_event()
Dim x As Integer
Dim final_element As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

do_it = text_Output(Sheets("Lan" & Language).Cells(431, 1).Value, 1)

For x = 1 To 4 'elemental mana types
        Sheets("nupud").Cells(x, 37).Value = (3 + x)
Next

x = Int(Rnd * 4 + 1)

final_element = Sheets("nupud").Cells(x, 37).Value
Sheets("nupud").Cells(7, 37).Value = final_element

End Function
Function dip_into_river()
Dim what_player As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value

do_it = sell_list(0, 1)

End Function

Function enchant_weapon(what_weapon As Integer, Optional what_to_do As Integer = 0)
Dim what_player As Integer
Dim what_element As Integer
Dim scrolls_Start As Integer
Dim how_many_Scrolls As Integer
Dim custom_weapon_starts As Integer
Dim how_many_custom_weapons As Integer
Dim custom_weapon As Integer
Dim x As Integer
Dim y As Integer
Dim z As Integer
Dim d1 As Integer
Dim d2 As Integer
Dim who As Integer
Dim Language As Integer
Dim plus_2_to_d1 As Integer
Dim plus_2_to_d2 As Integer
Dim plus_1_to_d1 As Integer
Dim plus_1_to_d2 As Integer
Dim total_chance As Integer
Dim fail As Integer
Dim dex As Integer
Dim result As Integer
Dim percent As Integer

what_player = Sheets("Game_data1").Cells(10, 2).Value
Language = Sheets("Game_data1").Cells(100, 2).Value
who = Sheets("Game_data1").Cells(51 + what_player, 2).Value
dex = Sheets("Side" & what_player).Cells(who, 12).Value
'Sheets("Side" & what_player).Cells(who, 12).Value

scrolls_Start = Sheets("Game_data1").Cells(184, 2).Value
how_many_Scrolls = Sheets("Game_data1").Cells(166, 2).Value

what_element = Sheets("nupud").Cells(7, 37).Value
how_many_custom_weapons = Sheets("Game_data1").Cells(217, 2).Value
d1 = Sheets("Items").Cells(what_weapon, 3)
d2 = Sheets("Items").Cells(what_weapon, 4)
custom_weapon_starts = scrolls_Start + how_many_Scrolls + how_many_custom_weapons + 3



fail = 50 '1 (odds for chance rolls)
plus_1_to_d1 = 0 '2
plus_1_to_d2 = 0 '3
plus_2_to_d1 = 0 '4
plus_2_to_d2 = 0 '5


If what_to_do = 0 Then 'elemental dam adding for dip into river event
        y = (d2 / 2) * d1
        x = Int(Rnd * y + 2) 'el.damage amount
End If

If what_to_do = 1 Or what_to_do = 2 Then
        
        If d1 > d2 Then
                plus_1_to_d1 = dex * 20 + 20 - (d2 * d1 * 2)
                
                If plus_1_to_d1 < 10 Then
                    plus_1_to_d1 = 10
                End If
                
                
                    plus_2_to_d1 = plus_1_to_d1 / 50 * (dex - 1)
                
                
        Else
                plus_1_to_d2 = dex * 20 + 20 - (d2 * d1 * 2)
        
                'min 10%
                If plus_1_to_d2 < 10 Then
                    plus_1_to_d2 = 10
                End If
                    plus_2_to_d2 = plus_1_to_d2 / 50 * (dex - 1)
                
        End If
        
        total_chance = plus_1_to_d2 + plus_2_to_d2 + plus_1_to_d1 + plus_2_to_d1 + fail
        
        Sheets("Nupud").Cells(1, 52).Value = fail
        Sheets("Nupud").Cells(2, 52).Value = plus_1_to_d1
        Sheets("Nupud").Cells(3, 52).Value = plus_1_to_d2
        Sheets("Nupud").Cells(4, 52).Value = plus_2_to_d1
        Sheets("Nupud").Cells(5, 52).Value = plus_2_to_d2
        
        
        
End If


If what_to_do = 1 Then 'display and announce odds for imrpove weapon


    do_it = text_Output(Sheets("Lan" & Language).Cells(929, 1).Value, 0)
    do_it = text_Output(" " & dex, 0, 5)
    do_it = text_Output(Sheets("Lan" & Language).Cells(930, 1).Value, 1)
    
    If plus_1_to_d2 > 0 Then
        percent = 100 / total_chance * plus_1_to_d2
        do_it = text_Output(" " & percent & "%", 0, 4)
        do_it = text_Output(Sheets("Lan" & Language).Cells(931, 1).Value, 0)
        do_it = text_Output(" D2", 0, 5)
        do_it = text_Output(Sheets("Lan" & Language).Cells(932, 1).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(939, 1).Value, 0, 9)
        do_it = text_Output(Sheets("Lan" & Language).Cells(933, 1).Value, 1)
        
    End If
    
    If plus_1_to_d1 > 0 Then
        percent = 100 / total_chance * plus_1_to_d1
        do_it = text_Output(" " & percent & "%", 0, 4)
        do_it = text_Output(Sheets("Lan" & Language).Cells(931, 1).Value, 0)
        do_it = text_Output(" D1", 0, 5)
        do_it = text_Output(Sheets("Lan" & Language).Cells(932, 1).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(939, 1).Value, 0, 9)
        do_it = text_Output(Sheets("Lan" & Language).Cells(933, 1).Value, 1)
        
    End If
    
    If plus_2_to_d2 > 0 Then
        percent = 100 / total_chance * plus_2_to_d2
        do_it = text_Output(" " & percent & "%", 0, 4)
        do_it = text_Output(Sheets("Lan" & Language).Cells(931, 1).Value, 0)
        do_it = text_Output(" D2", 0, 5)
        do_it = text_Output(Sheets("Lan" & Language).Cells(932, 1).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(940, 1).Value, 0, 9)
        do_it = text_Output(Sheets("Lan" & Language).Cells(933, 1).Value, 1)
    End If
    
    If plus_2_to_d1 > 0 Then
        percent = 100 / total_chance * plus_2_to_d1
        do_it = text_Output(" " & percent & "%", 0, 4)
        do_it = text_Output(Sheets("Lan" & Language).Cells(931, 1).Value, 0)
        do_it = text_Output(" D1", 0, 5)
        do_it = text_Output(Sheets("Lan" & Language).Cells(932, 1).Value, 0)
        do_it = text_Output(Sheets("Lan" & Language).Cells(940, 1).Value, 0, 9)
        do_it = text_Output(Sheets("Lan" & Language).Cells(933, 1).Value, 1)
    End If
    
    If fail > 0 Then
        percent = 100 / total_chance * fail
        do_it = text_Output(" " & percent & "%", 0, 3)
        do_it = text_Output(Sheets("Lan" & Language).Cells(934, 1).Value, 1)
        
    End If
End If


result = 0

If what_to_do = 2 Then
        result = rolling_odds(5, 52)
End If

If what_to_do = 0 Then
    result = 6
End If

     
If result > 0 Then
        'copime vana weaponi uuele kohele
        For z = 1 To 50
            Sheets("Items").Cells(custom_weapon_starts, z) = Sheets("Items").Cells(what_weapon, z)
        Next
        
        If result = 6 Then 'add elemental dam
                Sheets("Items").Cells(custom_weapon_starts, 20 + what_element).Value = Sheets("Items").Cells(custom_weapon_starts, 20 + what_element).Value + x
        End If
        
        If result = 2 Then '+1 to d1
                Sheets("Items").Cells(custom_weapon_starts, 3).Value = Sheets("Items").Cells(custom_weapon_starts, 3).Value + 1
                do_it = text_Output(Sheets("Lan" & Language).Cells(935, 1).Value, 0)
                do_it = text_Output(Sheets("Items").Cells(custom_weapon_starts, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(936, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(939, 1).Value, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(941, 1).Value, 0)
                
        End If
        
        If result = 3 Then '+1 to d2
                Sheets("Items").Cells(custom_weapon_starts, 4).Value = Sheets("Items").Cells(custom_weapon_starts, 4).Value + 1
                do_it = text_Output(Sheets("Lan" & Language).Cells(935, 1).Value, 0)
                do_it = text_Output(Sheets("Items").Cells(custom_weapon_starts, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(936, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(939, 1).Value, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(941, 1).Value, 0)
        End If
        
        If result = 4 Then '+2 to d1
                Sheets("Items").Cells(custom_weapon_starts, 3).Value = Sheets("Items").Cells(custom_weapon_starts, 3).Value + 2
                do_it = text_Output(Sheets("Lan" & Language).Cells(935, 1).Value, 0)
                do_it = text_Output(Sheets("Items").Cells(custom_weapon_starts, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(936, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(940, 1).Value, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(941, 1).Value, 0)
        End If
        
        If result = 5 Then '+2 to d2
                do_it = text_Output(Sheets("Lan" & Language).Cells(935, 1).Value, 0)
                do_it = text_Output(Sheets("Items").Cells(custom_weapon_starts, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(936, 1).Value, 0)
                do_it = text_Output(Sheets("Lan" & Language).Cells(940, 1).Value, 0, 5)
                do_it = text_Output(Sheets("Lan" & Language).Cells(941, 1).Value, 0)
                Sheets("Items").Cells(custom_weapon_starts, 4).Value = Sheets("Items").Cells(custom_weapon_starts, 4).Value + 2
        End If
        
        
        
        If result = 6 Then
                'add to weapon value
                Sheets("Items").Cells(custom_weapon_starts, 5).Value = Sheets("Items").Cells(custom_weapon_starts, 5).Value + 12 * x
        Else
                If result > 1 Then
                        Sheets("Items").Cells(custom_weapon_starts, 5).Value = Sheets("Items").Cells(custom_weapon_starts, 5).Value + Int(Sheets("Items").Cells(custom_weapon_starts, 5).Value / 10)
                Else
                        'Sheets("Items").Cells(custom_weapon_starts, 5).Value
                        do_it = text_Output(eesti_nimi(Sheets("Items").Cells(custom_weapon_starts, 1).Value, 1), 0)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(937, 1).Value, 0)
                        do_it = text_Output(Sheets("Lan" & Language).Cells(938, 1).Value, 0, 3)
                End If
        End If
        
        do_it = text_Output(Sheets("Lan" & Language).Cells(942, 1).Value, 1)
        
        
        Sheets("Game_data1").Cells(217, 2).Value = Sheets("Game_data1").Cells(217, 2).Value + 1 'how_many_custom weapons
        
        Sheets("Game_data1").Cells(189, 2).Value = Sheets("Game_data1").Cells(189, 2).Value + 1
        Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 18).Value = custom_weapon_starts
        Sheets("Game_data1").Cells(Sheets("Game_data1").Cells(189, 2).Value, 19).Value = 0 'available
        
        Sheets("Game_data1").Cells(84, 2).Value = Sheets("Game_data1").Cells(84, 2).Value + 1
        Sheets("Game_data1").Cells(190, 2).Value = 0 'ongoing event
End If


End Function
Function rolling_odds(max_events As Integer, nupud_Y As Integer) As Integer

Dim total_odd As Integer
Dim x As Integer
Dim y As Integer

total_odd = 0 'total odd reset

For x = 1 To max_events 'oddide summa
        total_odd = total_odd + Sheets("Nupud").Cells(x, nupud_Y).Value
Next
Randomize
y = Int(Rnd * total_odd + 1)

total_odd = 0
'kontrollime vahemikku
For x = 1 To max_events
        total_odd = total_odd + Sheets("Nupud").Cells(x, nupud_Y).Value
        If y <= total_odd Then
                rolling_odds = x
                Exit For
        End If
Next

End Function

Function Vilgutamine_a()

Dim what_player As Integer
Dim asukoht As Integer

Sheets("Game_data1").Cells(101, 2).Value = Sheets("Game_data1").Cells(101, 2).Value + 1

If Sheets("Game_data1").Cells(101, 2).Value >= 5 Then
        Sheets("Game_data1").Cells(103, 2).Value = 0
        Sheets("Game_data1").Cells(101, 2).Value = 0
End If

If Sheets("Game_data1").Cells(103, 2).Value = 1 Then

        what_player = Sheets("Game_data1").Cells(10, 2).Value
        asukoht = Sheets("Game_data1").Cells(5 + what_player, 2).Value
        
        do_it = Joonista_asukoht(asukoht, 0, what_player, "V1")
        
        Sheets("Game_data1").Cells(102, 2).Value = 1
        
        Application.OnTime Now + TimeValue("00:00:01"), "Vilgutamine_b"

End If
        
End Function
Function Vilgutamine_b()

Dim what_player As Integer
Dim asukoht As Integer

Sheets("Game_data1").Cells(101, 2).Value = Sheets("Game_data1").Cells(101, 2).Value + 1

If Sheets("Game_data1").Cells(101, 2).Value >= 5 Then
        Sheets("Game_data1").Cells(103, 2).Value = 0
         Sheets("Game_data1").Cells(101, 2).Value = 0
End If


If Sheets("Game_data1").Cells(103, 2).Value = 1 Then

        what_player = Sheets("Game_data1").Cells(10, 2).Value
        asukoht = Sheets("Game_data1").Cells(5 + what_player, 2).Value
        
        do_it = Joonista_asukoht(asukoht, 0, what_player, "V2")
        Sheets("Game_data1").Cells(102, 2).Value = 0
        
        Application.OnTime Now + TimeValue("00:00:01"), "Vilgutamine_a"

End If

End Function

Function day_output()
Dim what_player As Integer
Dim what_time As Integer
Dim what_day_part As String
Dim days_count As Integer
Dim player_name As String
Dim active_combat_side As Integer
Dim player_in_combat As Integer
Dim Language As Integer

Language = Sheets("Game_data1").Cells(100, 2).Value

what_player = Sheets("Game_data1").Cells(10, 2).Value
what_time = Sheets("Game_data1").Cells(84, 2).Value
days_count = Sheets("Game_data1").Cells(81, 2).Value

If what_time = 0 Then
    what_day_part = Sheets("Lan" & Language).Cells(432, 1).Value
End If

If what_time = 1 Then
    what_day_part = Sheets("Lan" & Language).Cells(433, 1).Value
End If

If what_time = 2 Then
    what_day_part = Sheets("Lan" & Language).Cells(434, 1).Value
End If

If what_time = 3 Then
    what_day_part = Sheets("Lan" & Language).Cells(435, 1).Value
End If

If what_time = 4 Then
    what_day_part = Sheets("Lan" & Language).Cells(436, 1).Value
End If

If Sheets("Game_data1").Cells(87, 2).Value = 0 Then
        player_name = Sheets("Game_data1").Cells(10 + what_player, 2).Value
Else
        active_combat_side = Sheets("Game_data1").Cells(37, 2).Value


        player_in_combat = Sheets("Fight").Cells(active_combat_side, 6).Value


        player_name = Sheets("Game_data1").Cells(10 + player_in_combat, 2).Value
End If


If Sheets("Game_data1").Cells(87, 2).Value = 0 Then
    Sheets("Game").Cells(6, 18).Value = Sheets("Lan" & Language).Cells(437, 1).Value & days_count & Sheets("Lan" & Language).Cells(521, 1).Value & player_name & Sheets("Lan" & Language).Cells(522, 1).Value & what_day_part & ")"
Else
    If player_in_combat <> 5 Then
            Sheets("Game").Cells(6, 18).Value = Sheets("Lan" & Language).Cells(520, 1).Value & player_name & " (" & what_day_part & ")"
    End If
End If

End Function










-------------------------------------------------------------------------------
VBA MACRO Module9.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module9'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Function Ai_commands(what_player As Integer)
Dim selected_command As Long
Dim for_display As String
Dim target_side As Integer
Dim target_mob As Integer

selected_command = 0
selected_command = AI_selects_from_legal_choices(what_player)

Select Case selected_command

    Case 10 'roll a die (Move)
            If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                    MsgBox "move_player"
            End If
            do_it = move_player
            
    Case 11 'end turn
            If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                    MsgBox "end_players_turn"
            End If
            do_it = end_players_turn

    Case 12   'buy land
            If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                    MsgBox "buy_land"
            End If
            
            do_it = buy_land
      
    Case 13   'attack neutral land
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "Fight_player_land"
        End If
        
        do_it = Fight_player_land
      
    Case 14   'keep die roll
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "keep_after_double"
        End If
        do_it = keep_after_double
    
    Case 15   'roll again
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "roll_again"
        End If
        do_it = roll_again
    
    Case 16   'flee
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "target_member_selected(0, 0)"
        End If
        do_it = target_member_selected(0, 0)
    
    Case 17   'improve income
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "improve_income_true"
        End If
        do_it = improve_income_true
    
    Case 18   'rest & heal
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "rest_and_heal_True()"
        End If
        do_it = rest_and_heal_True()
    
    Case 19   'upgrade defender menüü
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "upgrade_defender(1) 'with confirm"
        End If
        do_it = upgrade_defender(1) 'with confirm
    
    Case 20   'hire camel in caravan
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "buy_caravan(1, 1) 'hire 1 camel"
        End If
        do_it = buy_caravan(1, 1)
    
    Case 21   'train power
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "train_stat(3, 1) 'with confirm"
        End If
        do_it = do_it = train_stat(3, 1) 'with confirm
    
    Case 22   'train knowledge menu
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "train_knowledge_menu()"
        End If
        do_it = train_knowledge_menu()
    
    Case 23   'hire full caravan
        If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "buy_caravan(2, 1) 'hire full caravan"
        End If
        do_it = buy_caravan(2, 1)
    
    Case 100 To 521 'target with attack
            target_side = Int(selected_command / 100)
            target_mob = Int(selected_command - (target_side * 100))
            If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "target_member_selected(" & target_mob & ", " & target_side & ")"
            End If
            
            do_it = target_member_selected(target_mob, target_side)
    Case 1100 To 1121
            If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "Buy_item(" & selected_command - 1100 & ", 1)"
            End If
            do_it = Buy_item((selected_command - 1100), 1)
     
    Case 1400 To 1421
            If Sheets("Game_data1").Cells(15, 2).Value = 1 Then
                MsgBox "Equip_item(" & selected_command - 1400 & ", 1)"
            End If
            do_it = Equip_item((selected_command - 1400), 1)
        
End Select


End Function

Function set_choice_chance(choice_nr As Long, milleks_muudame As Integer)
        
Dim x As Integer


For x = 1 To Sheets("Game_data1").Cells(274, 2).Value
        If Sheets("Nupud").Cells(x, 50).Value = choice_nr Then
                Sheets("Nupud").Cells(x, 51).Value = milleks_muudame
        End If
Next
        

End Function


Function is_legal_action_there(choice_nr As Long) As Integer
Dim x As Integer

is_legal_action_there = 0

For x = 1 To Sheets("Game_data1").Cells(274, 2).Value
        If Sheets("Nupud").Cells(x, 50).Value = choice_nr Then
                is_legal_action_there = 1
        End If
Next

End Function

Function is_player_ai(what_player As Integer) As Integer
is_player_ai = 0

If Sheets("Game_data1").Cells(269 + what_player, 2).Value = 1 Then
        is_player_ai = 1
End If

End Function
Function add_ai_choice(choice_nr As Long, Optional choice_odds As Integer = 5)
        Sheets("Game_data1").Cells(274, 2).Value = Sheets("Game_data1").Cells(274, 2).Value + 1
        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(274, 2).Value, 50).Value = choice_nr
        Sheets("Nupud").Cells(Sheets("Game_data1").Cells(274, 2).Value, 51).Value = choice_odds
End Function
-------------------------------------------------------------------------------
VBA MACRO Leht8.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht8'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Leht9.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Leht9'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet7.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet7'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet14.cls 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet14'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module10.bas 
in file: /Users/juljus/Projects/comeback/comeback0198e.xls - OLE stream: '_VBA_PROJECT_CUR/VBA/Module10'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Sub randomroll()

Randomize

MyValue = Int((16 * Rnd) + 1)
MyValue2 = Int((28 * Rnd) + 1)

MsgBox (MyValue & ", " & MyValue2)

End Sub
Function set_all_choice_chance(milleks_muudame As Integer)
        
Dim x As Integer

For x = 1 To Sheets("Game_data1").Cells(274, 2).Value
        Sheets("Nupud").Cells(x, 51).Value = milleks_muudame
Next

End Function

Function AI_selects_from_legal_choices(what_player As Integer) As Integer
Dim player_hitpoints As Integer
Dim y As Integer



player_hitpoints = Sheets("Side" & what_player).Cells(Sheets("Game_data1").Cells(51 + what_player, 2).Value, 2).Value
'For X = 1 To Sheets("Game_data1").Cells(274, 2).Value
'
'Next

If is_legal_action_there(12) = 1 Then 'kui on olemas buy land
        do_it = set_choice_chance(11, 0)
        do_it = set_choice_chance(13, 0)
End If

If is_legal_action_there(13) = 1 Then 'kui on olemas attack land
        
        ok_ai_attacks = 1
        
        ok_ai_attacks = ok_ai_attacks + con_side5(what_player)
        'ok_ai_attacks = ok_ai_attacks + check_other_players_non(what_player)
        
        If ok_ai_attacks = 2 Then
        
             do_it = set_all_choice_chance(0)
             do_it = set_choice_chance(13, 5)
        Else
             do_it = set_choice_chance(13, 0)
        End If
                        
End If

If is_legal_action_there(17) = 1 Then 'improve land

        If player_hitpoints < 9 Then
            do_it = set_choice_chance(17, 0)
            do_it = set_choice_chance(18, 5) 'rest and heal
        End If

        do_it = set_choice_chance(11, 0) 'end turn
        do_it = set_choice_chance(17, 10)
        
End If


If is_legal_action_there(18) = 1 Then 'rest and heal
        
        do_it = set_choice_chance(11, 0) 'end turn
        do_it = set_choice_chance(18, 5)

        If player_hitpoints < 6 Then
            do_it = set_all_choice_chance(0)
            do_it = set_choice_chance(18, 5) 'rest and heal
        End If
        
End If


If is_legal_action_there(19) = 1 Then 'upgrade defender income

    do_it = land_pos_check(what_player)

        If land_pos_check(what_player) = 1 Then
        
                If player_hitpoints < 9 Then
                    do_it = set_choice_chance(19, 5)
                    do_it = set_choice_chance(18, 15)
                End If
            
            do_it = set_choice_chance(11, 0) 'end turn
            do_it = set_choice_chance(19, 25)
            
        Else
            do_it = set_choice_chance(11, 0) 'end turn
            do_it = set_choice_chance(19, 5)
        End If
        
End If

AI_selects_from_legal_choices = 0

If Sheets("Game_data1").Cells(274, 2).Value > 0 Then
        y = rolling_odds(Sheets("Game_data1").Cells(274, 2).Value, 51)
        AI_selects_from_legal_choices = Sheets("Nupud").Cells(y, 50).Value
End If

Sheets("Game_data1").Cells(274, 2).Value = 0

End Function
Function con_side5(what_player As Integer, Optional player_mood = 2) As Integer
Dim mob As Integer
Dim side_max_damage As Integer
Dim player_hitpoints As Integer
Dim mob_Damage As Integer
Dim mob_total_Damage As Integer
Dim mob_hitpoints As Integer
Dim mob_total_hitpoints As Integer
Dim who As Integer
Dim side_total_damage As Integer
Dim elemental_Damage_amount As Integer
Dim elemental_Damage As Integer
Dim elemental_Damage_amount2 As Integer
Dim elemental_Damage2 As Integer
Dim rounds_left As Integer
Dim mob_armor As Integer
Dim mob_total_armor As Integer
Dim one_round_damage As Integer
Dim mobs_spells_damage As Integer
Dim x As Integer
Dim a As Integer
Dim y As Integer

con_side5 = 0

'player_mood1=coward
'player_mood2=normal
'player_mood2=berserk

what_player = Sheets("game_data1").Cells(10, 2).Value
who = Sheets("Game_data1").Cells(51 + what_player, 2).Value
side_total_damage = 0
mob_Damage = 0
elemental_Damage_amount = 0
elemental_Damage_amount2 = 0
elemental_Damage = 0
elemental_Damage2 = 0
rounds_left = 4 - Sheets("game_data1").Cells(84, 2).Value
mob_armor = 0
mob_total_armor = 0
player_hitpoints = Sheets("Side" & what_player).Cells(who, 2).Value
mob_hitpoints = 0
mob_total_hitpoints = 0
mob_total_Damage = 0

For y = 1 To Sheets("Game_data1").Cells(51, 2).Value 'side5 armori tsekk
    mob_armor = Sheets("Side5").Cells(y, 14).Value
    mob_total_armor = mob_total_armor + mob_armor
Next


For x = 1 To Sheets("Game_data1").Cells(46 + what_player, 2).Value
       side_max_damage = Sheets("Side" & what_player).Cells(x, 4).Value * Sheets("Side" & what_player).Cells(x, 5).Value * Sheets("Side" & what_player).Cells(x, 6).Value * rounds_left
       side_max_damage = side_max_damage - mob_total_armor * rounds_left
       'tsekime elemental damaget
       For a = 1 To 4
            If Sheets("Side" & what_player).Cells(x, 49 + a).Value > 0 Then
        
                elemental_Damage = Sheets("Side" & what_player).Cells(x, 49 + a).Value
                elemental_Damage_amount = elemental_Damage_amount + elemental_Damage
                
            End If
        Next

       side_total_damage = side_total_damage + side_max_damage + elemental_Damage_amount * rounds_left
Next

For y = 1 To Sheets("Game_data1").Cells(51, 2).Value
    mob_Damage = Sheets("Side5").Cells(y, 4).Value * Sheets("Side5").Cells(y, 5).Value * Sheets("Side5").Cells(y, 6).Value * rounds_left
    mob_hitpoints = Sheets("Side5").Cells(y, 2).Value
    mob_total_hitpoints = mob_total_hitpoints + mob_hitpoints
    mob_total_Damage = mob_Damage + mob_total_Damage
    
        For a = 1 To 4
            If Sheets("Side5").Cells(y, 49 + a).Value > 0 Then
            
                 elemental_Damage2 = Sheets("Side5").Cells(y, 49 + a).Value
                 elemental_Damage_amount2 = elemental_Damage_amount2 + elemental_Damage2
                 
            End If
        Next
Next

mob_total_Damage = mob_total_Damage + elemental_Damage_amount2 * rounds_left

'for mood1
If player_mood = 1 Then
    If player_hitpoints > (mob_total_Damage + 10) And side_total_damage > (mob_hitpoints * 2) Then
        con_side5 = 1
    End If
End If

'mood2
If player_mood = 2 Then
    If player_hitpoints > (mob_total_Damage + 2) And side_total_damage > (mob_hitpoints + 3) Then
        con_side5 = 1
    End If
End If

'mood3
If player_mood = 3 Then
    If player_hitpoints > mob_total_Damage And side_total_damage > mob_hitpoints Then
        con_side5 = 1
    End If
End If

End Function

Function land_pos_check(what_player As Integer) As Integer
Dim ruut As Integer
Dim what_player As Integer
Dim land_before As Integer
Dim land_after As Integer
Dim land_before_pos As Integer
Dim land_after_pos As Integer

land_before = 0
land_pos_check = 0

'land_pos_check=1 ' maa on keskmine maa

ruut = Sheets("Game_data1").Cells(5 + what_player, 2).Value
ruut = 26
what_player = Sheets("game_data1").Cells(10, 2).Value

land_current_pos = Sheets("Game_map").Cells(ruut, 1).Value
land_before_pos = Sheets("Game_map").Cells(ruut - 1, 1).Value
land_after_pos = Sheets("Game_map").Cells(ruut + 1, 1).Value

If ruut = 34 Then
    land_after_pos = Sheets("Game_map").Cells(1, 1).Value
End If

If land_before_pos = land_after_pos Then
    land_pos_check = 1
End If

If land_before_pos = land_current_pos Or land_after_pos = land_current_pos And land_before_pos <> land_after_pos Then  '2 total lands on map
    land_pos_check = 1
End If

End Function

Function keep_die_roll()


End Function



















-------------------------------------------------------------------------------
VBA MACRO xlm_macro.txt 
in file: xlm_macro - OLE stream: 'xlm_macro'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
' 0085     12 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Lan
' 0085     12 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Lan
' 0085     12 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Gam
' 0085     12 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Mob
' 0085     12 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Hel
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Side
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Side
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Side
' 0085     15 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Levelu
' 0085     18 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Game_data
' 0085     20 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Map_default
' 0085     17 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Building
' 0085     16 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Game_ma
' 0085     14 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Spell
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Nupu
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Item
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Figh
' 0085     10 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  A
' 0085     15 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Effect
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  even
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Side
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  Side
' 0085     13 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  To D
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |stat_change         |Runs when the file is opened and ActiveX     |
|          |                    |objects trigger events                       |
|Suspicious|put                 |May write to a file (if combined with Open)  |
|Suspicious|output              |May write to a file (if combined with Open)  |
|Suspicious|doit                |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|command             |May run PowerShell commands                  |
|Suspicious|Chr                 |May attempt to obfuscate specific strings    |
|          |                    |(use option --deobf to deobfuscate)          |
|Suspicious|system              |May run an executable file or a system       |
|          |                    |command on a Mac (if combined with           |
|          |                    |libc.dylib)                                  |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|Suspicious|Base64 Strings      |Base64-encoded strings were detected, may be |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|Base64    |J'^                 |Side                                         |
|String    |                    |                                             |
|Base64    |JZ0                 |Slow                                         |
|String    |                    |                                             |
+----------+--------------------+---------------------------------------------+

