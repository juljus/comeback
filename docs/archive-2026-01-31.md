# Project Archive - 2026-01-31

## Overview

Comeback is a port of a fantasy board game RPG originally built in Excel/VBA (2004-2007) to a web application using Vue/Nuxt.

## What Was Built

### Technology Stack
- Nuxt 3 with Vue 3
- Pinia for state management
- TypeScript with strict typing
- Tailwind CSS

### Implemented Phases

#### Phase 1-2: Foundation (Complete)
- Game store with state management
- Board generation (34 squares, Monopoly-style layout)
- Player setup (2-4 players)
- Turn system (3 actions: morning, noon, evening)
- Movement via 2d6 dice roll
- Basic UI

#### Phase 3: Land Ownership (Complete)
- Buy land (requires full day)
- Conquer land (starts combat)
- Upgrade defender tier (1-4)
- Improve income action
- Income collection when passing Royal Court

#### Phase 4: Combat (Complete)
- Combat state with rounds
- Damage calculation with dice rolls
- Armor reduction
- Attacks per round from dexterity (1 + dex/5)
- Victory/defeat/timeout conditions
- Flee mechanics

#### Phase 5: Economy (Complete)
- Shop/Smithy/Bazaar with different inventories
- Buy/sell items (50% sell price)
- Equipment system (weapon, armor, helm, accessory)
- Equipment bonuses in combat
- Strength requirements

#### Phase 6: Buildings & Progression (Complete)
- Building construction when owning all lands of type
- Building effects (grant spells, unlock mercenaries)
- Fortifications (Fort/Citadel/Castle with archers)
- Title system (Baron 3 lands, Count 9, Duke 15)
- King's Gift on promotion (placeholder - gold only)
- Training at Training Grounds (STR/DEX) and Mage Guild (Power)

#### Phase 7: Magic System (Partial)
- 7 mana types defined
- Mana generation from lands when passing Royal Court
- Arcane Tower scaling (1→1, 2→3, 3→6, 4→10)
- Spell casting framework (utility and combat spells)
- Magic panel UI

### Data Files Created
- `app/data/lands.json` - 38 land types
- `app/data/mobs.json` - 132 creatures
- `app/data/items.json` - items/equipment
- `app/data/buildings.json` - 48 buildings
- `app/data/spells.json` - 37 spells
- `app/data/events.json` - 12 event types (created but not implemented)

---

## What Was Verified vs Estimated

### Verified from help.csv
- Turn system (3 actions per turn)
- Movement (2d6 dice roll)
- Buy land requires full day
- Title thresholds (Baron 3, Count 9, Duke 15)
- Arcane Tower mana scaling formula
- Land-to-mana mappings (all 18 land types)
- 7 mana types and their colors
- Combat: each attack = 1 action point
- Shops: buy = 1 action, sell = 50% value

### Estimated (Not Verified in VBA)
- Defender upgrade costs (20/40/80 gold)
- Training cost (50 gold)
- Improve income cost formula
- Starting player stats (STR/DEX/POW = 2)
- Fortification archer counts (2/4/6)
- King's Gift options (using placeholder gold rewards)
- Spell mana costs (I INCORRECTLY added costs - see below)

---

## Critical Discovery: VBA Extraction

On 2026-01-31, we extracted all VBA code from the original Excel file:
- **890 functions/subs** extracted
- **20,502 lines** of VBA code
- Stored in `docs/extraction/vba/`

### Key Finding: Spell Mana Costs

**CORRECTION**: Earlier analysis was wrong due to column mapping error.

The CSV column labeled `mana_cost` (position 4) is actually "Player 3 knows spell" flag.
The REAL mana cost from VBA column 9 is in CSV position 8 (`col_8`).

Actual mana costs from original game:
- Basic utility spells: 6-15 mana
- Damage spells: 20-40 mana
- Summon spells: 15-50 mana
- Powerful spells (Wrath of God, Summon Angel): 50 mana

Spells are NOT free - they have significant mana costs that require accumulation over multiple turns.

### Other VBA Findings
- Column mappings confirmed (VBA column 9 = mana cost, column 7 = mana type)
- Combat reinforcement mechanics found (adjacent lands send defenders)
- Spell damage uses power ratio formula (needs more research)

---

## Current File Structure

```
comeback/
├── app/
│   ├── app.vue              # Main game UI (~950 lines)
│   ├── stores/game.ts       # Game state & logic (~1900 lines)
│   └── data/
│       ├── lands.json
│       ├── mobs.json
│       ├── items.json
│       ├── buildings.json
│       ├── spells.json
│       └── events.json      # Created but not used
├── docs/
│   ├── roadmap.md           # Development roadmap
│   ├── extraction/
│   │   ├── columns.md       # Column documentation
│   │   ├── raw/             # Original CSV extracts
│   │   └── vba/             # VBA code extraction
│   │       ├── all_modules.txt      # Full VBA code
│   │       └── function_index.txt   # 890 function names
│   ├── verification-phase1-2.md
│   ├── verification-phase4-5.md
│   ├── verification-phase6.md
│   └── verification-phase7.md
└── comeback0198e.xls        # Original Excel game
```

---

## Known Issues

### Data Issues
1. **Spell mana costs** - FIXED: Corrected column mapping error. Real mana cost is VBA col 9 (CSV pos 8), not CSV col 4. Spells cost 6-50 mana.
2. **Mana colors modified** - Changed Air (yellow→light blue) and Arcane (purple→golden) based on help.csv

### Missing Features
1. Events system (Cave, Dungeon, Treasure Island)
2. Companion/pet system
3. Buff spell tracking/duration
4. Summon spell companion management
5. Adjacent land combat reinforcements
6. King's Gift real options
7. AI opponents

### Unverified Mechanics
- Spell damage power ratio formula
- Exact training costs
- Defender upgrade costs
- Many building effects

---

## Git History

```
f950c15 Implement Phases 3-7: Land ownership, combat, economy, buildings, magic
6b40ce0 Update roadmap: Phase 1 & 2 complete
83c1b6c Implement Phase 1: Game foundation and basic UI
ac48467 Add development roadmap with phased approach
```

---

## Questions for Next Steps

1. **Spell costs**: Revert to original (free spells) or keep balance changes?
2. **Priority**: Continue features or verify existing mechanics with VBA?
3. **VBA research**: What mechanics need verification most urgently?
4. **Scope**: Full faithful port or modernized remake with changes?
5. **Testing**: Should we add automated tests before continuing?
